                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.21.0, LST:Full:4
                                
                                ;   似非COMMAND.COM
                                
                                    INCLUDE "DEF.ASM"
                                ;
                                ;   似非DOS
                                ;
       0021                     VER_BCD EQU 00021H
                                
       0005                     SYSTEM  EQU 00005H
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
       000C                     RDSLT   EQU 0000CH
       001C                     CALSLT  EQU 0001CH
       006C                     INITXT  EQU 0006CH
       006F                     INIT32  EQU 0006FH
       0078                     SETTXT  EQU 00078H
       007B                     SETT32  EQU 0007BH
       0147                     FORMAT  EQU 00147H
                                
       0402                     MAPPER  EQU 00402H
                                
       F307                     FCB11   EQU 0F307H
       F37D                     BDOS    EQU 0F37DH
       F3AF                     LINL32  EQU 0F3AFH
       F3AE                     LINL40  EQU 0F3AEH
       F3B0                     LINLEN  EQU 0F3B0H
                                
       F41F                     KBUF    EQU 0F41FH; 318
       F55E                     BUF EQU 0F55EH; 258
                                
       F662                     DIMFLG  EQU 0F662H
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F6A7                     TEMP    EQU 0F6A7H
       F6AF                     SAVTXT  EQU 0F6AFH
       F6B1                     SAVSTK  EQU 0F6B1H
       F6B5                     DOT EQU 0F6B5H
       F6B9                     ONELIN  EQU 0F6B9H
                                
       F7C4                     TRCFLG  EQU 0F7C4H
                                
       FAF8                     EXBRSA  EQU 0FAF8H
                                
       FC9B                     INTFLG  EQU 0FC9BH
       FCC1                     EXPTBL  EQU 0FCC1H
       FFCA                     EXTBIOS EQU 0FFCAH
[EOF:DEF.ASM:UTF_8]
                                
       0040                     PATHX   EQU 64
                                
       8000                     DATA    EQU 08000H
                                
000000 0100                         ORG 0100H
000000 0100 C31601          10      JP  START
       0103                     TITLE:
000003 0103 0D0A70736575646F        DB  00DH,00AH,"pseudo COMMAND v$"
            20434F4D4D414E44    
            207624              
       0116                     START:
000016 0116 ED7B0600        20      LD  SP,(SYSTEM+1)
00001A 011A 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
00001C 011C CD0500          17      CALL    SYSTEM
00001F 011F D8              11      RET C
000020 0120 211D01          10      LD  HL,0011DH
000023 0123 ED42            15      SBC HL,BC
000025 0125 78               4      LD  A,B
000026 0126 32FD11          13      LD  (MAJOR_VER),A
000029 0129 B5               4      OR  L
00002A 012A 32FC11          13      LD  (IS_MSX),A
00002D 012D B7               4      OR  A
00002E 012E 287A            12      JR  Z,WSTART
                                
000030 0130 3AFC13          13      LD  A,(PROCESS)
000033 0133 0E61             7      LD  C,61H       ;(BDOS)親プロセスに戻る
000035 0135 47               4      LD  B,A
000036 0136 B7               4      OR  A
000037 0137 C40500          17      CALL    NZ,SYSTEM
00003A 013A AF               4      XOR A
00003B 013B 32FC13          13      LD  (PROCESS),A
                                
00003E 013E 212B00          10      LD  HL,002BH    ;キャラクターセット・日時フォーマット・ビデオ信号の種別
000041 0141 CD0C00          17      CALL    RDSLT
000044 0144 0F               4      RRCA
000045 0145 0F               4      RRCA
000046 0146 0F               4      RRCA
000047 0147 0F               4      RRCA
000048 0148 E603             7      AND 3
00004A 014A 2814            12      JR  Z,DATEOK
00004C 014C 3D               4      DEC A
00004D 014D 21CD11          10      LD  HL,V_DATE1
000050 0150 2806            12      JR  Z,DATECHG
000052 0152 3D               4      DEC A
000053 0153 21D511          10      LD  HL,V_DATE2
000056 0156 2008            12      JR  NZ,DATEOK
       0158                     DATECHG:
000058 0158 11BD11          10      LD  DE,V_DATE
00005B 015B 010800          10      LD  BC,8
00005E 015E EDB0                    LDIR
       0160                     DATEOK:
000060 0160 CD450E          17      CALL    INIT_VAR
000063 0163 3AC4F7          13      LD  A,(TRCFLG)
000066 0166 B7               4      OR  A
000067 0167 2814            12      JR  Z,WSTART0
000069 0169 11DA10          10      LD  DE,COMERM
00006C 016C 0E09             7      LD  C,9     ;(BDOS)文字列出力
00006E 016E CD0500          17      CALL    SYSTEM
000071 0171 2AC4F7          16      LD  HL,(TRCFLG)
000074 0174 2600             7      LD  H,0
000076 0176 CDD206          17      CALL    PRDEC_HL
000079 0179 AF               4      XOR A
00007A 017A 32C4F7          13      LD  (TRCFLG),A
       017D                     WSTART0:
00007D 017D 2A0600          16      LD  HL,(SYSTEM+1)
000080 0180 2EDB             7      LD  L,256-37
000082 0182 24               4      INC H
000083 0183 22F513          16      LD  (FCB_BAT),HL
000086 0186 3A8000          13      LD  A,(DTA1)
000089 0189 B7               4      OR  A
00008A 018A 281E            12      JR  Z,WSTART
00008C 018C 110301          10      LD  DE,TITLE
00008F 018F 0E09             7      LD  C,9
000091 0191 CD0500          17      CALL    SYSTEM
                                
000094 0194 212100          10      LD  HL,VER_BCD
000097 0197 7C               4      LD  A,H
000098 0198 CDDD0A          17      CALL    PRTHX1
00009B 019B 3E2E             7      LD  A,'.'
00009D 019D CDE00A          17      CALL    MSG_A
0000A0 01A0 7D               4      LD  A,L
0000A1 01A1 CDD40A          17      CALL    PRTHX
                                
0000A4 01A4 118100          10      LD  DE,DTA1+1
0000A7 01A7 CD0D02          17      CALL    COMANL
       01AA                     WSTART:
0000AA 01AA 212C11          10      LD  HL,N_APPEND
0000AD 01AD 113311          10      LD  DE,V_APPEND
0000B0 01B0 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0000B2 01B2 CD0500          17      CALL    SYSTEM
                                
0000B5 01B5 21E511          10      LD  HL,N_PROGRAM
0000B8 01B8 11F413          10      LD  DE,ZERO
0000BB 01BB 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0000BD 01BD CD0500          17      CALL    SYSTEM
                                
0000C0 01C0 21ED11          10      LD  HL,N_PARAMETERS
0000C3 01C3 11F413          10      LD  DE,ZERO
0000C6 01C6 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0000C8 01C8 CD0500          17      CALL    SYSTEM
                                
0000CB 01CB CD7006          17      CALL    LTNL
       01CE                     COMMAND:
0000CE 01CE E5              11      PUSH    HL
0000CF 01CF 2AF513          16      LD  HL,(FCB_BAT)
0000D2 01D2 7E               7      LD  A,(HL)
0000D3 01D3 E1              10      POP HL
0000D4 01D4 B7               4      OR  A
0000D5 01D5 C2FD04          10      JP  NZ,C_BAT1
0000D8 01D8 CD9803          17      CALL    SETDTA1
0000DB 01DB D5              11      PUSH    DE
0000DC 01DC C5              11      PUSH    BC
0000DD 01DD E5              11      PUSH    HL
0000DE 01DE 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
0000E0 01E0 CD0500          17      CALL    SYSTEM
0000E3 01E3 E1              10      POP HL
0000E4 01E4 C1              10      POP BC
0000E5 01E5 C641             7      ADD A,'A'
0000E7 01E7 CDE00A          17      CALL    MSG_A
0000EA 01EA 1E3E             7      LD  E,'>'
0000EC 01EC CDC30A          17      CALL    _PRINT
0000EF 01EF D1              10      POP DE      ;DE=DTA1
0000F0 01F0 3E50             7      LD  A,80
0000F2 01F2 12               7      LD  (DE),A
0000F3 01F3 0E0A             7      LD  C,0AH       ;(BDOS)文字列入力
0000F5 01F5 CD0500          17      CALL    SYSTEM
0000F8 01F8 CD7006          17      CALL    LTNL
       01FB                     COMMAND2:
0000FB 01FB 118200          10      LD  DE,DTA1+2
0000FE 01FE CD0D02          17      CALL    COMANL
000101 0201 30CB            12      JR  NC,COMMAND
000103 0203 11DA10          10      LD  DE,COMERM
000106 0206 0E09             7      LD  C,9     ;(BDOS)文字列出力
000108 0208 CD0500          17      CALL    SYSTEM
00010B 020B 189D            12      JR  WSTART
                                
       020D                     COMANL:
00010D 020D CD0E0C          17      CALL    TOZERO
000110 0210 ED533A02        20      LD  (COMST),DE
000114 0214 CD2B0B          17      CALL    FILE
000117 0217 D5              11      PUSH    DE
000118 0218 11CF13          10      LD  DE,FNAME
00011B 021B 1A               7      LD  A,(DE)
00011C 021C FE20             7      CP  020H
00011E 021E CAAB02          10      JP  Z,SDVSW
000121 0221 1B               6      DEC DE
000122 0222 1A               7      LD  A,(DE)
000123 0223 C6FF             7      ADD A,0FFH
000125 0225 380A            12      JR  C,COMB
000127 0227 13               6      INC DE
                                
000128 0228 211E10          10      LD  HL,COMTB
00012B 022B 3E12             7      LD  A,COMS
00012D 022D 47               4      LD  B,A
00012E 022E CD600C          17      CALL    CPNAME
       0231                     COMB:
000131 0231 D1              10      POP DE
000132 0232 D2C20A          10      JP  NC,JP_HL
       0235                     COMB2:
000135 0235 EB               4      EX  DE,HL
000136 0236 222C04          16      LD  (COMPAT),HL
                                
000139 0239 110000          10      LD  DE,0
       023A                     COMST   EQU $-2
00013C 023C 21FD13          10      LD  HL,DATA_COM
00013F 023F 3600            10      LD  (HL),0
       0241                     COMPR1:
000141 0241 1A               7      LD  A,(DE)
000142 0242 13               6      INC DE
000143 0243 23               6      INC HL
000144 0244 77               7      LD  (HL),A
000145 0245 FE20             7      CP  020H
000147 0247 30F8            12      JR  NC,COMPR1
       0249                     COMPR2:
000149 0249 2B               6      DEC HL
00014A 024A 7E               7      LD  A,(HL)
00014B 024B FE5C             7      CP  05CH
00014D 024D 2014            12      JR  NZ,COMPR3
00014F 024F 3600            10      LD  (HL),0
000151 0251 23               6      INC HL
000152 0252 EB               4      EX  DE,HL
000153 0253 CD2B0B          17      CALL    FILE
000156 0256 212C11          10      LD  HL,N_APPEND
000159 0259 11FE13          10      LD  DE,DATA_COM+1
00015C 025C 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
00015E 025E CD0500          17      CALL    SYSTEM
000161 0261 1804            12      JR  COMPR4
       0263                     COMPR3:
000163 0263 FE20             7      CP  020H
000165 0265 30E2            12      JR  NC,COMPR2
       0267                     COMPR4:
000167 0267 CDEE03          17      CALL    CEXE4
                                
00016A 026A 217311          10      LD  HL,N_PATH
00016D 026D 117811          10      LD  DE,V_PATH
000170 0270 0640             7      LD  B,PATHX
000172 0272 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000174 0274 CD0500          17      CALL    SYSTEM
                                
000177 0277 217811          10      LD  HL,V_PATH
00017A 027A 22F713          16      LD  (X_PATH),HL
       027D                     CEX1:
00017D 027D 2AF713          16      LD  HL,(X_PATH)
000180 0280 7E               7      LD  A,(HL)
000181 0281 FE20             7      CP  020H
000183 0283 D8              11      RET C
       0284                     CEX2:
000184 0284 7E               7      LD  A,(HL)
000185 0285 FE20             7      CP  020H
000187 0287 3807            12      JR  C,CEX3
000189 0289 FE3B             7      CP  ';'
00018B 028B 2803            12      JR  Z,CEX3
00018D 028D 23               6      INC HL
00018E 028E 18F4            12      JR  CEX2
       0290                     CEX3:
000190 0290 3600            10      LD  (HL),0
000192 0292 FE20             7      CP  020H
000194 0294 3801            12      JR  C,CEX4
000196 0296 23               6      INC HL
       0297                     CEX4:
000197 0297 ED5BF713        20      LD  DE,(X_PATH)
00019B 029B 22F713          16      LD  (X_PATH),HL
00019E 029E 212C11          10      LD  HL,N_APPEND
0001A1 02A1 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0001A3 02A3 CD0500          17      CALL    SYSTEM
                                
0001A6 02A6 CDEE03          17      CALL    CEXE4
0001A9 02A9 18D2            12      JR  CEX1
                                
       02AB                     SDVSW:
0001AB 02AB F1              10      POP AF
0001AC 02AC 3ACE13          13      LD  A,(FDRV)
0001AF 02AF 3D               4      DEC A
0001B0 02B0 5F               4      LD  E,A
0001B1 02B1 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
0001B3 02B3 C39F03          10      JP  SYSTEM0
                                
       02B6                     OPEN_D2:            ;DOS2対応
0001B6 02B6 3AFD11          13      LD  A,(MAJOR_VER)
0001B9 02B9 FE02             7      CP  2
0001BB 02BB 384F            12      JR  C,OPEN
0001BD 02BD 11C512          10      LD  DE,PATH_FN1
0001C0 02C0 180A            12      JR  OPEN_D2X
       02C2                     OPEN1_D2:           ;DOS2対応
0001C2 02C2 3AFD11          13      LD  A,(MAJOR_VER)
0001C5 02C5 FE02             7      CP  2
0001C7 02C7 3840            12      JR  C,OPEN1
                                
0001C9 02C9 114512          10      LD  DE,PATH_CCP
       02CC                     OPEN_D2X:
0001CC 02CC DD21FE11        14      LD  IX,SEARCH_IX
0001D0 02D0 014010          10      LD  BC,01040H   ;(BDOS)最初のエントリ検索
0001D3 02D3 CD0500          17      CALL    SYSTEM
0001D6 02D6 F5              11      PUSH    AF
0001D7 02D7 118512          10      LD  DE,PATH_PAR
0001DA 02DA 0E5E             7      LD  C,05EH      ;(BDOS)完全なパス文字列の獲得(_WPATH)
0001DC 02DC CD0500          17      CALL    SYSTEM
0001DF 02DF AF               4      XOR A
0001E0 02E0 77               7      LD  (HL),A
0001E1 02E1 118512          10      LD  DE,PATH_PAR
0001E4 02E4 ED52            15      SBC HL,DE
0001E6 02E6 224012          16      LD  (PATH_POS),HL
0001E9 02E9 F1              10      POP AF
       02EA                     FIB2DIRENT:
0001EA 02EA B7               4      OR  A
0001EB 02EB C0              11      RET NZ
                                
0001EC 02EC 11FF11          10      LD  DE,SEARCH_IX+1  ;(FIB)ファイル名
0001EF 02EF 219713          10      LD  HL,DTA_CCP+1
0001F2 02F2 0E5C             7      LD  C,05CH      ;(BDOS)ファイル名の解析
0001F4 02F4 CD0500          17      CALL    SYSTEM
                                
0001F7 02F7 210C12          10      LD  HL,SEARCH_IX+14 ;(FIB)属性
0001FA 02FA 11A213          10      LD  DE,DTA_CCP+1+8+3
0001FD 02FD EDA0            16      LDI
0001FF 02FF 11AD13          10      LD  DE,DTA_CCP+1+8+3+1+10
000202 0302 010A00          10      LD  BC,2+2+2+4  ;最終変更時刻+最終変更日付+開始クラスタ+ファイルサイズ
000205 0305 EDB0                    LDIR
000207 0307 AF               4      XOR A
000208 0308 C9              10      RET
                                
       0309                     OPEN1:
000209 0309 21CE13          10      LD  HL,FDRV
       030C                     OPEN:
00020C 030C 0E11             7      LD  C,011H      ;(BDOS)最初のファイルの検索
       030E                     OPEN3:
00020E 030E D5              11      PUSH    DE
00020F 030F 119613          10      LD  DE,DTA_CCP
000212 0312 CD8B03          17      CALL    SETDTA
000215 0315 EB               4      EX  DE,HL
000216 0316 CD0500          17      CALL    SYSTEM
000219 0319 D1              10      POP DE
00021A 031A B7               4      OR  A
00021B 031B C9              10      RET
                                
       031C                     OPEN2_D2:           ;DOS2対応
00021C 031C 3AFD11          13      LD  A,(MAJOR_VER)
00021F 031F FE02             7      CP  2
000221 0321 380B            12      JR  C,OPEN2
000223 0323 DD21FE11        14      LD  IX,SEARCH_IX
000227 0327 0E41             7      LD  C,41H       ;(BDOS)次のエントリ検索
000229 0329 CD0500          17      CALL    SYSTEM
00022C 032C 18BC            12      JR  FIB2DIRENT
       032E                     OPEN2:
00022E 032E 0E12             7      LD  C,012H
000230 0330 18DC            12      JR  OPEN3
                                
       0332                     DEFCB_D2:           ;DOS2対応
000232 0332 3AFD11          13      LD  A,(MAJOR_VER)
000235 0335 FE02             7      CP  2
000237 0337 383A            12      JR  C,DEFCB
000239 0339 218512          10      LD  HL,PATH_PAR
00023C 033C 114512          10      LD  DE,PATH_CCP
00023F 033F 014000          10      LD  BC,64
000242 0342 EDB0                    LDIR
000244 0344 2A4012          16      LD  HL,(PATH_POS)
000247 0347 114512          10      LD  DE,PATH_CCP
00024A 034A 19              11      ADD HL,DE
00024B 034B 060D             7      LD  B,13
00024D 034D 11FF11          10      LD  DE,SEARCH_IX+1  ;(FIB)ファイル名
       0350                     DCB4:
000250 0350 1A               7      LD  A,(DE)
000251 0351 B7               4      OR  A
000252 0352 2805            12      JR  Z,DCB5
000254 0354 13               6      INC DE
000255 0355 77               7      LD  (HL),A
000256 0356 23               6      INC HL
000257 0357 18F7            12      JR  DCB4
       0359                     DCB5:
000259 0359 3600            10      LD  (HL),0
00025B 035B 3A1712          13      LD  A,(SEARCH_IX+25)    ;(FIB)ドライブ番号(1-8)
00025E 035E C640             7      ADD A,040H
000260 0360 114212          10      LD  DE,PATH_DRV
000263 0363 12               7      LD  (DE),A
000264 0364 0E43             7      LD  C,043H      ;_OPEN ファイルハンドルのオープン
000266 0366 3E01             7      LD  A,1     ;書き込み禁止
000268 0368 CD0500          17      CALL    SYSTEM
00026B 036B B7               4      OR  A
00026C 036C C0              11      RET NZ
00026D 036D ED433E12        20      LD  (HANDLE1),BC
000271 0371 1815            12      JR  SETDTA100
       0373                     DEFCB:              ;Z=Ok NZ=Error
000273 0373 119613          10      LD  DE,DTA_CCP
000276 0376 CD9D03          17      CALL    SYSC0F
000279 0379 B7               4      OR  A
00027A 037A C0              11      RET NZ
                                
00027B 037B 210100          10      LD  HL,1
00027E 037E 22A413          16      LD  (DTA_CCP+14),HL
000281 0381 2D               4      DEC L
000282 0382 22B713          16      LD  (DTA_CCP+33),HL
000285 0385 22B913          16      LD  (DTA_CCP+35),HL
       0388                     SETDTA100:
000288 0388 110080          10      LD  DE,DATA
       038B                     SETDTA:
00028B 038B C5              11      PUSH    BC
00028C 038C D5              11      PUSH    DE
00028D 038D E5              11      PUSH    HL
00028E 038E 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
000290 0390 CD0500          17      CALL    SYSTEM
000293 0393 E1              10      POP HL
000294 0394 D1              10      POP DE
000295 0395 C1              10      POP BC
000296 0396 AF               4      XOR A
000297 0397 C9              10      RET
                                
       0398                     SETDTA1:
000298 0398 118000          10      LD  DE,DTA1
00029B 039B 18EE            12      JR  SETDTA
                                
       039D                     SYSC0F:
00029D 039D 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       039F                     SYSTEM0:
00029F 039F CD0500          17      CALL    SYSTEM
0002A2 03A2 B7               4      OR  A
0002A3 03A3 C9              10      RET
                                
       03A4                     C_CD:
0002A4 03A4 CDFD0A          17      CALL    FILEC_D2
0002A7 03A7 114512          10      LD  DE,PATH_CCP
0002AA 03AA 1A               7      LD  A,(DE)
0002AB 03AB FE20             7      CP  020H
0002AD 03AD 3805            12      JR  C,PWD
0002AF 03AF 0E5A             7      LD  C,5AH       ;(BDOS)_CHDIR カレントディレクトリの変更
0002B1 03B1 C30500          10      JP  SYSTEM
       03B4                     PWD:
0002B4 03B4 CDB606          17      CALL    PUTDRV
0002B7 03B7 3E5C             7      LD  A,05CH
0002B9 03B9 CDE00A          17      CALL    MSG_A
0002BC 03BC C31B06          10      JP  PDSKF2
                                
       03BF                     S27DTA_D2:      ;DOS2対応
0002BF 03BF 3AFD11          13      LD  A,(MAJOR_VER)
0002C2 03C2 FE02             7      CP  2
0002C4 03C4 3817            12      JR  C,S27DTA
0002C6 03C6 ED4B3E12        20      LD  BC,(HANDLE1)
0002CA 03CA 110080          10      LD  DE,DATA
0002CD 03CD 0E48             7      LD  C,048H      ;(BDOS)ファイルハンドルからの読み出し(_READ)
0002CF 03CF CD9F03          17      CALL    SYSTEM0
0002D2 03D2 C8              11      RET Z
0002D3 03D3 FEC7             7      CP  0C7H        ;.EOF
0002D5 03D5 2803            12      JR  Z,S27EOF
0002D7 03D7 37               4      SCF
0002D8 03D8 9F               4      SBC A,A
0002D9 03D9 C9              10      RET
       03DA                     S27EOF:
0002DA 03DA 3E01             7      LD  A,1
0002DC 03DC C9              10      RET
                                
       03DD                     S27DTA:
0002DD 03DD 110100          10      LD  DE,1
0002E0 03E0 ED53A413        20      LD  (DTA_CCP+14),DE
0002E4 03E4 119613          10      LD  DE,DTA_CCP
       03E7                     S27:
0002E7 03E7 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
0002E9 03E9 CD0500          17      CALL    SYSTEM
0002EC 03EC B7               4      OR  A
0002ED 03ED C9              10      RET
                                
       03EE                     CEXE4:
0002EE 03EE 21CE13          10      LD  HL,FDRV
0002F1 03F1 119613          10      LD  DE,DTA_CCP
0002F4 03F4 010900          10      LD  BC,1+8
0002F7 03F7 EDB0                    LDIR
0002F9 03F9 219F13          10      LD  HL,DTA_CCP+9
0002FC 03FC 3643            10      LD  (HL),'C'
0002FE 03FE 23               6      INC HL
0002FF 03FF 364F            10      LD  (HL),'O'
000301 0401 23               6      INC HL
000302 0402 364D            10      LD  (HL),'M'
       0404                     C_EXE:
000304 0404 CD7303          17      CALL    DEFCB
000307 0407 C2D504          10      JP  NZ,C_BAT
00030A 040A 11FD13          10      LD  DE,DATA_COM
00030D 040D CD8B03          17      CALL    SETDTA
                                
000310 0410 2A0600          16      LD  HL,(SYSTEM+1)
000313 0413 11FD13          10      LD  DE,DATA_COM
000316 0416 ED52            15      SBC HL,DE
                                
000318 0418 CDDD03          17      CALL    S27DTA
00031B 041B 3D               4      DEC A
00031C 041C 37               4      SCF
00031D 041D C0              11      RET NZ
00031E 041E 7C               4      LD  A,H
00031F 041F B5               4      OR  L
000320 0420 37               4      SCF
000321 0421 C8              11      RET Z
000322 0422 22CF04          16      LD  (COMSIZ),HL
                                
000325 0425 11FD13          10      LD  DE,DATA_COM
000328 0428 CD8B03          17      CALL    SETDTA
00032B 042B 110000          10      LD  DE,0
       042C                     COMPAT  EQU $-2
00032E 042E CD6508          17      CALL    SETFCB
                                
000331 0431 212C11          10      LD  HL,N_APPEND
000334 0434 114512          10      LD  DE,PATH_CCP
000337 0437 0640             7      LD  B,PATHX
000339 0439 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
00033B 043B CD0500          17      CALL    SYSTEM
00033E 043E 3A4512          13      LD  A,(PATH_CCP)
000341 0441 B7               4      OR  A
000342 0442 201D            12      JR  NZ,COM_ENV1
000344 0444 0E19             7      LD  C,019H      ;(BDOS)カレントドライブ番号の獲得(_CURDRV)
000346 0446 CD0500          17      CALL    SYSTEM
000349 0449 C641             7      ADD A,'A'
00034B 044B 324512          13      LD  (PATH_CCP),A
00034E 044E 3E3A             7      LD  A,':'
000350 0450 324612          13      LD  (PATH_CCP+1),A
000353 0453 3E5C             7      LD  A,05CH      ;\
000355 0455 324712          13      LD  (PATH_CCP+2),A
000358 0458 47               4      LD  B,A     ;ドライブ
000359 0459 114712          10      LD  DE,PATH_CCP+2
00035C 045C 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
00035E 045E CD0500          17      CALL    SYSTEM
       0461                     COM_ENV1:
000361 0461 119613          10      LD  DE,DTA_CCP
000364 0464 218813          10      LD  HL,DOS2NAME
000367 0467 CD280A          17      CALL    FCB2FNAME
00036A 046A 114512          10      LD  DE,PATH_CCP
00036D 046D 218A13          10      LD  HL,DOS2NAME+2
       0470                     COM_ENV2:
000370 0470 1A               7      LD  A,(DE)
000371 0471 B7               4      OR  A
000372 0472 2803            12      JR  Z,COM_ENV3
000374 0474 13               6      INC DE
000375 0475 18F9            12      JR  COM_ENV2
       0477                     COM_ENV3:
000377 0477 1B               6      DEC DE
000378 0478 1A               7      LD  A,(DE)
000379 0479 13               6      INC DE
00037A 047A FE5C             7      CP  05CH
00037C 047C 2804            12      JR  Z,COM_ENV4
00037E 047E 3E5C             7      LD  A,05CH
000380 0480 12               7      LD  (DE),A
000381 0481 13               6      INC DE
       0482                     COM_ENV4:
000382 0482 7E               7      LD  A,(HL)
000383 0483 23               6      INC HL
000384 0484 12               7      LD  (DE),A
000385 0485 13               6      INC DE
000386 0486 B7               4      OR  A
000387 0487 20F9            12      JR  NZ,COM_ENV4
                                
000389 0489 21E511          10      LD  HL,N_PROGRAM
00038C 048C 114512          10      LD  DE,PATH_CCP
00038F 048F 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000391 0491 CD0500          17      CALL    SYSTEM
                                
000394 0494 21ED11          10      LD  HL,N_PARAMETERS
000397 0497 118100          10      LD  DE,DTA1+1
00039A 049A 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
00039C 049C CD0500          17      CALL    SYSTEM
                                
00039F 049F 212C11          10      LD  HL,N_APPEND
0003A2 04A2 113311          10      LD  DE,V_APPEND
0003A5 04A5 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0003A7 04A7 CD0500          17      CALL    SYSTEM
                                
0003AA 04AA 0E60             7      LD  C,60H       ;(BDOS)子プロセスの起動
0003AC 04AC CD0500          17      CALL    SYSTEM
0003AF 04AF B7               4      OR  A
0003B0 04B0 2004            12      JR  NZ,COMP1
0003B2 04B2 78               4      LD  A,B
0003B3 04B3 32FC13          13      LD  (PROCESS),A
       04B6                     COMP1:
0003B6 04B6 AF               4      XOR A
0003B7 04B7 67               4      LD  H,A
0003B8 04B8 6F               4      LD  L,A ;HL=0x0000
0003B9 04B9 32C4F7          13      LD  (TRCFLG),A
0003BC 04BC F3               4      DI
0003BD 04BD ED7B0600        20      LD  SP,(SYSTEM+1)
0003C1 04C1 E5              11      PUSH    HL
0003C2 04C2 21EDB0          10      LD  HL,0B0EDH   ;LDIR
0003C5 04C5 22FE00          16      LD  (000FEH),HL
0003C8 04C8 21FD13          10      LD  HL,DATA_COM
0003CB 04CB 110001          10      LD  DE,00100H
0003CE 04CE 010000          10      LD  BC,0
       04CF                     COMSIZ  EQU $-2
0003D1 04D1 FB               4      EI
0003D2 04D2 C3FE00          10      JP  000FEH
                                
       04D5                     C_BAT:
0003D5 04D5 219F13          10      LD  HL,DTA_CCP+9
0003D8 04D8 3642            10      LD  (HL),'B'
0003DA 04DA 23               6      INC HL
0003DB 04DB 3641            10      LD  (HL),'A'
0003DD 04DD 23               6      INC HL
0003DE 04DE 3654            10      LD  (HL),'T'
                                
0003E0 04E0 CD7303          17      CALL    DEFCB
0003E3 04E3 C0              11      RET NZ
                                
0003E4 04E4 219613          10      LD  HL,DTA_CCP
0003E7 04E7 7E               7      LD  A,(HL)
0003E8 04E8 B7               4      OR  A
0003E9 04E9 2009            12      JR  NZ,CBAT_DS
0003EB 04EB E5              11      PUSH    HL
0003EC 04EC 0E19             7      LD  C,019H      ;(BDOS)カレントドライブ番号の獲得(_CURDRV)
0003EE 04EE CD0500          17      CALL    SYSTEM
0003F1 04F1 E1              10      POP HL
0003F2 04F2 3C               4      INC A
0003F3 04F3 77               7      LD  (HL),A
       04F4                     CBAT_DS:
0003F4 04F4 ED5BF513        20      LD  DE,(FCB_BAT)
0003F8 04F8 012500          10      LD  BC,37
0003FB 04FB EDB0                    LDIR
       04FD                     C_BAT1:
0003FD 04FD CD8803          17      CALL    SETDTA100
000400 0500 CD3E05          17      CALL    FGETC_BAT
000403 0503 218100          10      LD  HL,DTA1+1
000406 0506 202A            12      JR  NZ,END_BATCH
000408 0508 FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
00040A 050A 38F1            12      JR  C,C_BAT1
00040C 050C 3620            10      LD  (HL),' '
00040E 050E 23               6      INC HL
       050F                     C_BAT2:
00040F 050F 77               7      LD  (HL),A
000410 0510 23               6      INC HL
000411 0511 7D               4      LD  A,L
000412 0512 3C               4      INC A       ;L==0FFH
000413 0513 2809            12      JR  Z,RUN_BATCH
000415 0515 CD3E05          17      CALL    FGETC_BAT
000418 0518 2004            12      JR  NZ,RUN_BATCH
00041A 051A FE20             7      CP  020H
00041C 051C 30F1            12      JR  NC,C_BAT2
       051E                     RUN_BATCH:
00041E 051E 7D               4      LD  A,L
00041F 051F D67F             7      SUB DTA1-1
000421 0521 328000          13      LD  (DTA1),A
000424 0524 FE04             7      CP  4
000426 0526 380A            12      JR  C,END_BATCH
000428 0528 3600            10      LD  (HL),0
00042A 052A 3A9BFC          13      LD  A,(INTFLG)
00042D 052D FE03             7      CP  3
00042F 052F C2FB01          10      JP  NZ,COMMAND2
       0532                     END_BATCH:      ;バッチファイルを閉じる
000432 0532 2AF513          16      LD  HL,(FCB_BAT)
000435 0535 3600            10      LD  (HL),0
000437 0537 ED7B0600        20      LD  SP,(SYSTEM+1)
00043B 053B C3AA01          10      JP  WSTART
                                
       053E                     FGETC_BAT:
00043E 053E ED5BF513        20      LD  DE,(FCB_BAT)
       0542                     FGETC:              ;1文字ずつ読み込む
000442 0542 E5              11      PUSH    HL      ;Z:成功
000443 0543 210100          10      LD  HL,1
000446 0546 CDE703          17      CALL    S27
000449 0549 E1              10      POP HL
00044A 054A 3A0080          13      LD  A,(DATA)
00044D 054D C9              10      RET
                                
       054E                     C_REM:
00044E 054E AF               4      XOR A
00044F 054F C9              10      RET
                                
       0550                     C_DEL:
000450 0550 CD6508          17      CALL    SETFCB
000453 0553 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力
000455 0555 CD0500          17      CALL    SYSTEM
000458 0558 0600             7      LD  B,0
00045A 055A 3AFD11          13      LD  A,(MAJOR_VER)
00045D 055D FE02             7      CP  2
00045F 055F 381E            12      JR  C,CDEL_DOS1
                                
000461 0561 215C00          10      LD  HL,FCB1
000464 0564 CDB602          17      CALL    OPEN_D2
000467 0567 37               4      SCF
       0568                     DEL1:
000468 0568 C0              11      RET NZ
000469 0569 3A0C12          13      LD  A,(SEARCH_IX+14);   (FIB)属性
00046C 056C CB67             8      BIT 4,A
00046E 056E 200A            12      JR  NZ,DEL2
                                
000470 0570 11FE11          10      LD  DE,SEARCH_IX
000473 0573 0E4D             7      LD  C,04DH      ;(BDOS)ファイル・サブディレクトリの削除(_DELETE)
000475 0575 CD9F03          17      CALL    SYSTEM0
000478 0578 37               4      SCF
000479 0579 C0              11      RET NZ
       057A                     DEL2:
00047A 057A CD1C03          17      CALL    OPEN2_D2
00047D 057D 18E9            12      JR  DEL1
                                
       057F                     CDEL_DOS1:
00047F 057F 0E13             7      LD  C,013H
000481 0581 1811            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       0583                     C_REN:
000483 0583 3AFD11          13      LD  A,(MAJOR_VER)
000486 0586 FE02             7      CP  2
000488 0588 3013            12      JR  NC,REN_DOS2
00048A 058A CD6508          17      CALL    SETFCB
00048D 058D 3E10             7      LD  A,010H      ;ディレクトリも対象にする(LSX-Dodgers)
00048F 058F 326900          13      LD  (FCB1+13),A ;属性
000492 0592 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       0594                     CDEL1:
000494 0594 115C00          10      LD  DE,FCB1
       0597                     REN2:
000497 0597 CD0500          17      CALL    SYSTEM
00049A 059A C6FF             7      ADD A,0FFH
00049C 059C C9              10      RET
                                
       059D                     REN_DOS2:           ;DOS2のリネーム(ディレクトリ対応)
00049D 059D CD080C          17      CALL    SPCUT
0004A0 05A0 6B               4      LD  L,E
0004A1 05A1 62               4      LD  H,D
       05A2                     REN_D2_1:
0004A2 05A2 7E               7      LD  A,(HL)
0004A3 05A3 FE21             7      CP  020H+1
0004A5 05A5 3803            12      JR  C,REN_D2_2
0004A7 05A7 23               6      INC HL
0004A8 05A8 18F8            12      JR  REN_D2_1
       05AA                     REN_D2_2:
0004AA 05AA 3600            10      LD  (HL),0
0004AC 05AC 23               6      INC HL
0004AD 05AD 0E4E             7      LD  C,04EH      ;(BDOS)ファイルあるいはサブディレクトリ名の変更(_RENAME)
0004AF 05AF 18E6            12      JR  REN2
                                
       05B1                     C_DIR:
0004B1 05B1 CDFD0A          17      CALL    FILEC_D2
0004B4 05B4 21CF13          10      LD  HL,FDRV+1
0004B7 05B7 CDA80A          17      CALL    CWILD1
0004BA 05BA 3EF1             7      LD  A,0F1H
0004BC 05BC 32DB13          13      LD  (FDRV+13),A
0004BF 05BF CDC202          17      CALL    OPEN1_D2
       05C2                     CDIR1:
0004C2 05C2 B7               4      OR  A
0004C3 05C3 2008            12      JR  NZ,PDSKF
0004C5 05C5 CD4806          17      CALL    P_NAME
0004C8 05C8 CD1C03          17      CALL    OPEN2_D2
0004CB 05CB 18F5            12      JR  CDIR1
                                
       05CD                     PDSKF:
0004CD 05CD 3ACE13          13      LD  A,(FDRV)
0004D0 05D0 5F               4      LD  E,A
0004D1 05D1 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0004D3 05D3 CD0500          17      CALL    SYSTEM
0004D6 05D6 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0004D7 05D7 C601             7      ADD A,001H
0004D9 05D9 D8              11      RET C       ;Aが0FFHだった場合
0004DA 05DA 3E06             7      LD  A,8-2
       05DC                     PDS1:               ;HL=未使用クラスタの総数
0004DC 05DC 3C               4      INC A
0004DD 05DD CB19             8      RR  C
0004DF 05DF 30FB            12      JR  NC,PDS1
       05E1                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0004E1 05E1 3C               4      INC A
0004E2 05E2 CB18             8      RR  B
0004E4 05E4 30FB            12      JR  NC,PDS2
0004E6 05E6 47               4      LD  B,A
                                
0004E7 05E7 110000          10      LD  DE,0
       05EA                     PDS3:
0004EA 05EA 29              11      ADD HL,HL
0004EB 05EB EB               4      EX  DE,HL
0004EC 05EC ED6A            15      ADC HL,HL
0004EE 05EE EB               4      EX  DE,HL
0004EF 05EF 10F9            13      DJNZ    PDS3
       05F1                     PDSKF1:
0004F1 05F1 CDD606          17      CALL    PRDEC_DEHL
0004F4 05F4 11C010          10      LD  DE,FREE
0004F7 05F7 0E09             7      LD  C,9     ;(BDOS)文字列出力
0004F9 05F9 CD0500          17      CALL    SYSTEM
0004FC 05FC CDB606          17      CALL    PUTDRV
0004FF 05FF 3E5C             7      LD  A,05CH      ;\
000501 0601 CDE00A          17      CALL    MSG_A
000504 0604 3AFD11          13      LD  A,(MAJOR_VER)
000507 0607 FE01             7      CP  1
000509 0609 3865            12      JR  C,LTNL
00050B 060B 200E            12      JR  NZ,PDSKF2
00050D 060D 2ADC13          16      LD  HL,(FDRV+14)
000510 0610 AF               4      XOR A
000511 0611 11FEFF          10      LD  DE,0-2
000514 0614 19              11      ADD HL,DE
000515 0615 23               6      INC HL
000516 0616 DCD206          17      CALL    C,PRDEC_HL
000519 0619 1855            12      JR  LTNL
       061B                     PDSKF2:             ;MSX-DOS2
00051B 061B 3ACE13          13      LD  A,(FDRV)
00051E 061E 47               4      LD  B,A     ;ドライブ
00051F 061F 110080          10      LD  DE,DATA
000522 0622 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
000524 0624 CD0500          17      CALL    SYSTEM
000527 0627 210080          10      LD  HL,DATA
                                
00052A 062A CD3206          17      CALL    MSX
00052D 062D 1841            12      JR  LTNL
                                
       062F                     MSX1:
00052F 062F CDE00A          17      CALL    MSG_A
       0632                     MSX:
000532 0632 7E               7      LD  A,(HL)
000533 0633 23               6      INC HL
000534 0634 B7               4      OR  A
000535 0635 20F8            12      JR  NZ,MSX1
000537 0637 C9              10      RET
                                
       0638                     MSXSLT1:
000538 0638 CDE00A          17      CALL    MSG_A
       063B                     MSXSLT:
00053B 063B C5              11      PUSH    BC
00053C 063C E5              11      PUSH    HL
00053D 063D 78               4      LD  A,B
00053E 063E CD0C00          17      CALL    RDSLT
000541 0641 E1              10      POP HL
000542 0642 C1              10      POP BC
000543 0643 23               6      INC HL
000544 0644 B7               4      OR  A
000545 0645 20F1            12      JR  NZ,MSXSLT1
000547 0647 C9              10      RET
                                
       0648                     P_NAME:
000548 0648 219713          10      LD  HL,DTA_CCP+1
00054B 064B 7E               7      LD  A,(HL)
00054C 064C FE2E             7      CP  '.'
00054E 064E C8              11      RET Z
00054F 064F CD2C07          17      CALL    FPRNT
000552 0652 3AA213          13      LD  A,(DTA_CCP+12)
000555 0655 CB67             8      BIT 4,A
000557 0657 280A            12      JR  Z,DIR3
000559 0659 11CE10          10      LD  DE,DIRMES
00055C 065C 0E09             7      LD  C,9     ;(BDOS)文字列出力
00055E 065E CD0500          17      CALL    SYSTEM
000561 0661 180A            12      JR  DIR6
       0663                     DIR3:
000563 0663 ED5BB513        20      LD  DE,(DTA_CCP+1+01EH)
000567 0667 2AB313          16      LD  HL,(DTA_CCP+1+01CH)
00056A 066A CDD606          17      CALL    PRDEC_DEHL
       066D                     DIR6:
00056D 066D CD4E07          17      CALL    PRTTMS
                                
       0670                     LTNL:
000570 0670 1E0D             7      LD  E,00DH
000572 0672 CDC30A          17      CALL    _PRINT
000575 0675 1E0A             7      LD  E,00AH
000577 0677 C3C30A          10      JP  _PRINT
                                
       067A                     C_PATH:
00057A 067A CD080C          17      CALL    SPCUT
00057D 067D FE21             7      CP  021H
00057F 067F 301C            12      JR  NC,CPATH0
                                
000581 0681 217311          10      LD  HL,N_PATH
000584 0684 117811          10      LD  DE,V_PATH
000587 0687 0640             7      LD  B,PATHX
000589 0689 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
00058B 068B CD0500          17      CALL    SYSTEM
00058E 068E 217811          10      LD  HL,V_PATH
       0691                     CPATHP:
000591 0691 7E               7      LD  A,(HL)
000592 0692 23               6      INC HL
000593 0693 FE20             7      CP  020H
000595 0695 3F               4      CCF
000596 0696 30D8            12      JR  NC,LTNL
000598 0698 CDE00A          17      CALL    MSG_A
00059B 069B 18F4            12      JR  CPATHP
       069D                     CPATH0:
00059D 069D 217811          10      LD  HL,V_PATH
0005A0 06A0 FE3B             7      CP  ';'
0005A2 06A2 2001            12      JR  NZ,CPATH1
0005A4 06A4 13               6      INC DE
       06A5                     CPATH1:
0005A5 06A5 EB               4      EX  DE,HL
0005A6 06A6 014000          10      LD  BC,PATHX
0005A9 06A9 EDB0                    LDIR
                                
0005AB 06AB 217311          10      LD  HL,N_PATH
0005AE 06AE 117811          10      LD  DE,V_PATH
0005B1 06B1 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0005B3 06B3 C30500          10      JP  SYSTEM
                                
       06B6                     PUTDRV:
0005B6 06B6 3ACE13          13      LD  A,(FDRV)
0005B9 06B9 B7               4      OR  A
0005BA 06BA 200C            12      JR  NZ,PUTDRV1
0005BC 06BC C5              11      PUSH    BC
0005BD 06BD D5              11      PUSH    DE
0005BE 06BE E5              11      PUSH    HL
0005BF 06BF 0E19             7      LD  C,019H
0005C1 06C1 CD0500          17      CALL    SYSTEM
0005C4 06C4 E1              10      POP HL
0005C5 06C5 D1              10      POP DE
0005C6 06C6 C1              10      POP BC
0005C7 06C7 3C               4      INC A
       06C8                     PUTDRV1:
0005C8 06C8 C640             7      ADD A,'A'-1
0005CA 06CA CDE00A          17      CALL    MSG_A
0005CD 06CD 3E3A             7      LD  A,':'
       06CF                     MSG_AR:
0005CF 06CF C3E00A          10      JP  MSG_A
                                
       06D2                     PRDEC_HL:
0005D2 06D2 AF               4      XOR A
       06D3                     PRDEC_AHL:
0005D3 06D3 5F               4      LD  E,A
0005D4 06D4 1600             7      LD  D,0
       06D6                     PRDEC_DEHL:
0005D6 06D6 3E02             7      LD  A,2
0005D8 06D8 322107          13      LD  (DEC6+1),A
0005DB 06DB AF               4      XOR A
0005DC 06DC E5              11      PUSH    HL
0005DD 06DD 21C813          10      LD  HL,DECBF
0005E0 06E0 0605             7      LD  B,5
0005E2 06E2 CDCF0B          17      CALL    FILL_MEMORY
0005E5 06E5 E1              10      POP HL
                                
0005E6 06E6 0E20             7      LD  C,32
       06E8                     DEC1:
0005E8 06E8 29              11      ADD HL,HL
0005E9 06E9 EB               4      EX  DE,HL
0005EA 06EA ED6A            15      ADC HL,HL
0005EC 06EC EB               4      EX  DE,HL
0005ED 06ED E5              11      PUSH    HL
0005EE 06EE 21CC13          10      LD  HL,DECBF+4
0005F1 06F1 0605             7      LD  B,5
       06F3                     DEC2:
0005F3 06F3 7E               7      LD  A,(HL)
0005F4 06F4 8F               4      ADC A,A
0005F5 06F5 27               4      DAA
0005F6 06F6 77               7      LD  (HL),A
0005F7 06F7 2B               6      DEC HL
0005F8 06F8 10F9            13      DJNZ    DEC2
0005FA 06FA E1              10      POP HL
0005FB 06FB 0D               4      DEC C
0005FC 06FC 20EA            12      JR  NZ,DEC1
                                
0005FE 06FE 21C813          10      LD  HL,DECBF
000601 0701 3E20             7      LD  A,020H
000603 0703 0604             7      LD  B,4
       0705                     DEC3:
000605 0705 CD1207          17      CALL    DEC4
000608 0708 CD1207          17      CALL    DEC4
00060B 070B 23               6      INC HL
00060C 070C 10F7            13      DJNZ    DEC3
       070E                     DECX:
00060E 070E CD1207          17      CALL    DEC4
000611 0711 AF               4      XOR A
       0712                     DEC4:
000612 0712 ED6F            18      RLD
000614 0714 FE20             7      CP  020H
000616 0716 2808            12      JR  Z,DEC6
000618 0718 F630             7      OR  030H
       071A                     DEC5:
00061A 071A 18B3            12      JR  MSG_AR
       071C                     DEC7:
00061C 071C 3E20             7      LD  A,020H
00061E 071E 18AF            12      JR  MSG_AR
       0720                     DEC6:
000620 0720 3E02             7      LD  A,2
000622 0722 B7               4      OR  A
000623 0723 28F7            12      JR  Z,DEC7
000625 0725 3D               4      DEC A
000626 0726 322107          13      LD  (DEC6+1),A
000629 0729 3E20             7      LD  A,020H
00062B 072B C9              10      RET
                                
       072C                     FPRNT:
00062C 072C 0608             7      LD  B,8
00062E 072E CD3F07          17      CALL    P_N1
000631 0731 7E               7      LD  A,(HL)
000632 0732 C680             7      ADD A,0A0H-020H
000634 0734 FEA0             7      CP  0A0H
000636 0736 2802            12      JR  Z,FPR1
000638 0738 3E2E             7      LD  A,'.'
       073A                     FPR1:
00063A 073A CDE00A          17      CALL    MSG_A
00063D 073D 0603             7      LD  B,3
                                
       073F                     P_N1:
00063F 073F C5              11      PUSH    BC
000640 0740 E5              11      PUSH    HL
000641 0741 7E               7      LD  A,(HL)
000642 0742 CD270C          17      CALL    CAP3
000645 0745 CDE00A          17      CALL    MSG_A
000648 0748 E1              10      POP HL
000649 0749 C1              10      POP BC
00064A 074A 23               6      INC HL
00064B 074B 10F2            13      DJNZ    P_N1
00064D 074D C9              10      RET
                                
       074E                     PRTTMS:
00064E 074E 3E20             7      LD  A,020H
000650 0750 CDE00A          17      CALL    MSG_A
                                
000653 0753 2AAF13          16      LD  HL,(DTA_CCP+1+24)
000656 0756 7D               4      LD  A,L
000657 0757 B7               4      OR  A
000658 0758 C8              11      RET Z
000659 0759 CB3C             8      SRL H
00065B 075B 17               4      RLA
00065C 075C 17               4      RLA
00065D 075D 17               4      RLA
00065E 075E 17               4      RLA
00065F 075F E60F             7      AND 00FH
000661 0761 57               4      LD  D,A
000662 0762 DD21BD11        14      LD  IX,V_DATE
       0766                     PRTTMS1:
000666 0766 DD7E00          19      LD  A,(IX+0)
000669 0769 B7               4      OR  A
00066A 076A 2808            12      JR  Z,PRTTMS2
00066C 076C CDEF07          17      CALL    PR_DATE
00066F 076F CD5A08          17      CALL    PR_DATE_SPLITER
000672 0772 18F2            12      JR  PRTTMS1
       0774                     PRTTMS2:
                                
000674 0774 CD060D          17      CALL    GET_WIDTH
000677 0777 FE21             7      CP  32+1
000679 0779 3005            12      JR  NC,SHOW_TIME
00067B 077B 3E1D             7      LD  A,01DH
00067D 077D C3E00A          10      JP  MSG_A
       0780                     SHOW_TIME:
000680 0780 2AAD13          16      LD  HL,(DTA_CCP+1+22)
                                
000683 0783 3E20             7      LD  A,020H
000685 0785 CDE00A          17      CALL    MSG_A
000688 0788 7C               4      LD  A,H
000689 0789 65               4      LD  H,L
00068A 078A 1F               4      RRA
00068B 078B CB1D             8      RR  L
00068D 078D 1F               4      RRA
00068E 078E CB1D             8      RR  L
000690 0790 1F               4      RRA
000691 0791 CB1D             8      RR  L
000693 0793 E61F             7      AND 01FH
000695 0795 4F               4      LD  C,A
000696 0796 3AE211          13      LD  A,(V_TIME)
000699 0799 FE31             7      CP  '1'
00069B 079B 79               4      LD  A,C
00069C 079C 200B            12      JR  NZ,TIME24
00069E 079E FE0C             7      CP  12
0006A0 07A0 3802            12      JR  C,TIME12
0006A2 07A2 D60C             7      SUB 12
       07A4                     TIME12:
0006A4 07A4 B7               4      OR  A
0006A5 07A5 2002            12      JR  NZ,TIME24
0006A7 07A7 C60C             7      ADD A,12
       07A9                     TIME24:
0006A9 07A9 C5              11      PUSH    BC
0006AA 07AA CDDA07          17      CALL    PRDEC_A
0006AD 07AD 3E3A             7      LD  A,':'
0006AF 07AF CDE00A          17      CALL    MSG_A
0006B2 07B2 7D               4      LD  A,L
0006B3 07B3 0F               4      RRCA
0006B4 07B4 0F               4      RRCA
0006B5 07B5 E63F             7      AND 03FH
0006B7 07B7 CDDA07          17      CALL    PRDEC_A
                                
0006BA 07BA 3E3A             7      LD  A,':'
0006BC 07BC CDE00A          17      CALL    MSG_A
0006BF 07BF 7C               4      LD  A,H
0006C0 07C0 E61F             7      AND 01FH
0006C2 07C2 87               4      ADD A,A
0006C3 07C3 CDDA07          17      CALL    PRDEC_A
                                
0006C6 07C6 3AE211          13      LD  A,(V_TIME)
0006C9 07C9 FE31             7      CP  '1'
0006CB 07CB C1              10      POP BC
0006CC 07CC C0              11      RET NZ
0006CD 07CD 79               4      LD  A,C
0006CE 07CE 1E61             7      LD  E,'a'
0006D0 07D0 FE0C             7      CP  12
0006D2 07D2 DAC30A          10      JP  C,_PRINT
0006D5 07D5 1E70             7      LD  E,'p'
0006D7 07D7 C3C30A          10      JP  _PRINT
                                
                                ;   PRINT10
                                
       07DA                     PRDEC_A:
0006DA 07DA E5              11      PUSH    HL
0006DB 07DB 0608             7      LD  B,8
0006DD 07DD 4F               4      LD  C,A
0006DE 07DE AF               4      XOR A
       07DF                     PRTA1:
0006DF 07DF CB01             8      RLC C
0006E1 07E1 8F               4      ADC A,A
0006E2 07E2 27               4      DAA
0006E3 07E3 10FA            13      DJNZ    PRTA1
0006E5 07E5 21C813          10      LD  HL,DECBF
0006E8 07E8 77               7      LD  (HL),A
0006E9 07E9 AF               4      XOR A
0006EA 07EA CD0E07          17      CALL    DECX
0006ED 07ED E1              10      POP HL
0006EE 07EE C9              10      RET
                                
       07EF                     PR_DATE:
0006EF 07EF DD7E00          19      LD  A,(IX+0)
0006F2 07F2 FE20             7      CP  020H
0006F4 07F4 D8              11      RET C
0006F5 07F5 CD1B0C          17      CALL    CAP
0006F8 07F8 FE44             7      CP  'D'
0006FA 07FA 2848            12      JR  Z,PR_DAY
0006FC 07FC FE4D             7      CP  'M'
0006FE 07FE 2820            12      JR  Z,PR_MONTH
000700 0800 FE59             7      CP  'Y'
000702 0802 2046            12      JR  NZ,PR_DATE1
000704 0804 4F               4      LD  C,A
000705 0805 DD7E02          19      LD  A,(IX+2)
000708 0808 CD1B0C          17      CALL    CAP
00070B 080B B9               4      CP  C
00070C 080C 200A            12      JR  NZ,YEAR2
00070E 080E 7C               4      LD  A,H     ;YEAR
00070F 080F C6EC             7      ADD A,80+256-100
000711 0811 3E13             7      LD  A,19
000713 0813 CE00             7      ADC A,0
000715 0815 CDDA07          17      CALL    PRDEC_A     ;年4桁
       0818                     YEAR2:
000718 0818 7C               4      LD  A,H     ;YEAR
000719 0819 C650             7      ADD A,80
00071B 081B CDDA07          17      CALL    PRDEC_A
00071E 081E 182A            12      JR  PR_DATE1
       0820                     PR_MONTH:
000720 0820 4F               4      LD  C,A
000721 0821 DD7E02          19      LD  A,(IX+2)
000724 0824 CD1B0C          17      CALL    CAP
000727 0827 B9               4      CP  C
000728 0828 2014            12      JR  NZ,MONTH2
00072A 082A E5              11      PUSH    HL      ;月を文字列で表示 Jan等
00072B 082B D5              11      PUSH    DE
00072C 082C 7A               4      LD  A,D
00072D 082D 3D               4      DEC A
00072E 082E 87               4      ADD A,A
00072F 082F 87               4      ADD A,A
000730 0830 21FC10          10      LD  HL,S_MONTH
000733 0833 1600             7      LD  D,0
000735 0835 5F               4      LD  E,A
000736 0836 19              11      ADD HL,DE
000737 0837 CD3206          17      CALL    MSX
00073A 083A D1              10      POP DE
00073B 083B E1              10      POP HL
00073C 083C 180C            12      JR  PR_DATE1
       083E                     MONTH2:
00073E 083E 7A               4      LD  A,D     ;月を数字で表示
00073F 083F CDDA07          17      CALL    PRDEC_A
000742 0842 1806            12      JR  PR_DATE1
       0844                     PR_DAY:
000744 0844 7D               4      LD  A,L
000745 0845 E61F             7      AND 01FH
000747 0847 CDDA07          17      CALL    PRDEC_A
       084A                     PR_DATE1:
00074A 084A DD23            10      INC IX
00074C 084C DD7E00          19      LD  A,(IX+0)
00074F 084F CD1B0C          17      CALL    CAP
000752 0852 FE41             7      CP  'A'
000754 0854 D8              11      RET C
000755 0855 FE5B             7      CP  'Z'+1
000757 0857 38F1            12      JR  C,PR_DATE1
000759 0859 C9              10      RET
       085A                     PR_DATE_SPLITER:
00075A 085A DD7E00          19      LD  A,(IX+0)
00075D 085D FE20             7      CP  020H
00075F 085F D8              11      RET C
000760 0860 DD23            10      INC IX
000762 0862 C3E00A          10      JP  MSG_A
                                
       0865                     SETFCB:
000765 0865 CD080C          17      CALL    SPCUT
000768 0868 1A               7      LD  A,(DE)
000769 0869 FE20             7      CP  020H
00076B 086B 3801            12      JR  C,SETFCBA
00076D 086D 1B               6      DEC DE
       086E                     SETFCBA:
00076E 086E D5              11      PUSH    DE
00076F 086F 215C00          10      LD  HL,FCB1
000772 0872 115D00          10      LD  DE,FCB1+1
000775 0875 012300          10      LD  BC,00023H
000778 0878 70               7      LD  (HL),B      ;B=0
000779 0879 EDB0                    LDIR
00077B 087B D1              10      POP DE
00077C 087C D5              11      PUSH    DE
00077D 087D 215C00          10      LD  HL,FCB1
000780 0880 DD21C512        14      LD  IX,PATH_FN1
000784 0884 CDAC0C          17      CALL    _SYS29      ;ファイル名の解析
000787 0887 216C00          10      LD  HL,FCB2
00078A 088A DD210513        14      LD  IX,PATH_FN2
00078E 088E CDAC0C          17      CALL    _SYS29      ;ファイル名の解析
000791 0891 E1              10      POP HL
000792 0892 010050          10      LD  BC,05000H
000795 0895 118100          10      LD  DE,00081H
       0898                     SETFCB1:
000798 0898 7E               7      LD  A,(HL)
000799 0899 23               6      INC HL
00079A 089A FE20             7      CP  020H
00079C 089C 3805            12      JR  C,SETFCB2
00079E 089E 12               7      LD  (DE),A
00079F 089F 13               6      INC DE
0007A0 08A0 0C               4      INC C
0007A1 08A1 10F5            13      DJNZ    SETFCB1
       08A3                     SETFCB2:
0007A3 08A3 79               4      LD  A,C
0007A4 08A4 328000          13      LD  (DTA1),A
0007A7 08A7 04               4      INC B
0007A8 08A8 AF               4      XOR A
       08A9                     SETFCB3:
0007A9 08A9 12               7      LD  (DE),A
0007AA 08AA 13               6      INC DE
0007AB 08AB 10FC            13      DJNZ    SETFCB3
0007AD 08AD C9              10      RET
                                
       08AE                     C_COPY:
0007AE 08AE CD6508          17      CALL    SETFCB
0007B1 08B1 3AFD11          13      LD  A,(MAJOR_VER)
0007B4 08B4 FE02             7      CP  2
0007B6 08B6 380D            12      JR  C,COPYI0
0007B8 08B8 CD190D          17      CALL    IS_FOLDER_FN2
0007BB 08BB 3808            12      JR  C,COPYI0
0007BD 08BD 21CF13          10      LD  HL,FDRV+1
0007C0 08C0 060B             7      LD  B,8+3
0007C2 08C2 CDCD0B          17      CALL    FILE10
       08C5                     COPYI0:
0007C5 08C5 3ACE13          13      LD  A,(FDRV)
0007C8 08C8 47               4      LD  B,A
0007C9 08C9 B7               4      OR  A
0007CA 08CA 200B            12      JR  NZ,COPYI1
0007CC 08CC C5              11      PUSH    BC
0007CD 08CD 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
0007CF 08CF CD0500          17      CALL    SYSTEM
0007D2 08D2 3C               4      INC A
0007D3 08D3 32CE13          13      LD  (FDRV),A
0007D6 08D6 C1              10      POP BC
       08D7                     COPYI1:
0007D7 08D7 C640             7      ADD A,040H
0007D9 08D9 324513          13      LD  (CUR_DRV),A
0007DC 08DC 114813          10      LD  DE,CUR_PATH
0007DF 08DF 0E59             7      LD  C,059H      ;(BDOS)カレントディレクトリの獲得(_GETCD)
0007E1 08E1 CD0500          17      CALL    SYSTEM
0007E4 08E4 CDF608          17      CALL    COPYSUB
       08E7                     RES_CUR_PATH:
0007E7 08E7 114513          10      LD  DE,CUR_DRV
       08EA                     SET_CUR_PATH:
0007EA 08EA F5              11      PUSH    AF
0007EB 08EB 3ACE13          13      LD  A,(FDRV)
0007EE 08EE 47               4      LD  B,A
0007EF 08EF 0E5A             7      LD  C,05AH      ;(BDOS)カレントディレクトリの変更(_CHDIR)
0007F1 08F1 CD0500          17      CALL    SYSTEM
0007F4 08F4 F1              10      POP AF
0007F5 08F5 C9              10      RET
       08F6                     COPYSUB:
0007F6 08F6 11F413          10      LD  DE,ZERO
0007F9 08F9 CD230B          17      CALL    FILEC2
0007FC 08FC 216C00          10      LD  HL,FCB2
0007FF 08FF CDF00C          17      CALL    S29X1
                                
000802 0902 3E10             7      LD  A,010H
000804 0904 326900          13      LD  (FCB1+13),A
000807 0907 216D00          10      LD  HL,FCB2+1
00080A 090A CDA80A          17      CALL    CWILD1
       090D                     COPY0:
00080D 090D CDA50A          17      CALL    CWILD
000810 0910 215C00          10      LD  HL,FCB1
000813 0913 CDB602          17      CALL    OPEN_D2
000816 0916 37               4      SCF
       0917                     COPY1:
000817 0917 C0              11      RET NZ
000818 0918 CD3203          17      CALL    DEFCB_D2
                                
00081B 091B 3AA213          13      LD  A,(DTA_CCP+12)
00081E 091E CB67             8      BIT 4,A
000820 0920 2821            12      JR  Z,COPY1A
                                
000822 0922 215D00          10      LD  HL,FCB1+1
000825 0925 CD540C          17      CALL    CHKWILD
000828 0928 3811            12      JR  C,COPY9
                                
00082A 092A 3E20             7      LD  A,020H
00082C 092C 325D00          13      LD  (FCB1+1),A
00082F 092F 2AB013          16      LD  HL,(DTA_CCP+26)
000832 0932 23               6      INC HL
000833 0933 226A00          16      LD  (FCB1+14),HL
000836 0936 18D5            12      JR  COPY0
                                
       0938                     COPY8:
000838 0938 CD0F0E          17      CALL    SHOW_OK
       093B                     COPY9:
00083B 093B CDE708          17      CALL    RES_CUR_PATH
00083E 093E CD1C03          17      CALL    OPEN2_D2
000841 0941 18D4            12      JR  COPY1
                                
       0943                     COPY1A:
000843 0943 216C00          10      LD  HL,FCB2
000846 0946 11CE13          10      LD  DE,FDRV
000849 0949 019813          10      LD  BC,DTA_CCP+2
00084C 094C EDA0            16      LDI
00084E 094E 3E0B             7      LD  A,11
       0950                     COPY2:
000850 0950 F5              11      PUSH    AF
000851 0951 7E               7      LD  A,(HL)
000852 0952 FE3F             7      CP  '?'
000854 0954 2001            12      JR  NZ,COPY3
000856 0956 0A               7      LD  A,(BC)
       0957                     COPY3:
000857 0957 12               7      LD  (DE),A
000858 0958 03               6      INC BC
000859 0959 13               6      INC DE
00085A 095A 23               6      INC HL
00085B 095B F1              10      POP AF
00085C 095C 3D               4      DEC A
00085D 095D 20F1            12      JR  NZ,COPY2
00085F 095F 010500          10      LD  BC,16-11
000862 0962 EDB0                    LDIR
       0964                     PUTNAME:
000864 0964 215D00          10      LD  HL,FCB1+1
000867 0967 CD540C          17      CALL    CHKWILD
00086A 096A 300B            12      JR  NC,PUTN1
00086C 096C 21CF13          10      LD  HL,FDRV+1
00086F 096F CD2C07          17      CALL    FPRNT
000872 0972 3E20             7      LD  A,020H
000874 0974 CDE00A          17      CALL    MSG_A
       0977                     PUTN1:
000877 0977 110513          10      LD  DE,PATH_FN2
00087A 097A CDEA08          17      CALL    SET_CUR_PATH
                                
00087D 097D 11CE13          10      LD  DE,FDRV
000880 0980 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000882 0982 CD9F03          17      CALL    SYSTEM0
000885 0985 C2260A          10      JP  NZ,COPYE2
000888 0988 67               4      LD  H,A     ;A=0
000889 0989 6F               4      LD  L,A
00088A 098A 22EF13          16      LD  (FDRV+33),HL    ;(FCB)ランダム・レコード
00088D 098D 22F113          16      LD  (FDRV+35),HL
000890 0990 2C               4      INC L       ;HL=1
000891 0991 22DC13          16      LD  (FDRV+14),HL    ;(FCB)レコード・サイズ
       0994                     COPY6:
000894 0994 CDB70A          17      CALL    BUFSIZ
000897 0997 CDBF03          17      CALL    S27DTA_D2
00089A 099A 47               4      LD  B,A
00089B 099B 3C               4      INC A
00089C 099C CA150A          10      JP  Z,COPYE
00089F 099F 7C               4      LD  A,H
0008A0 09A0 B5               4      OR  L
0008A1 09A1 280F            12      JR  Z,COPY7
0008A3 09A3 11CE13          10      LD  DE,FDRV
0008A6 09A6 C5              11      PUSH    BC
0008A7 09A7 0E26             7      LD  C,026H      ;(BDOS)ランダム・ブロック・ライト
0008A9 09A9 CD0500          17      CALL    SYSTEM
0008AC 09AC C1              10      POP BC
0008AD 09AD B7               4      OR  A
0008AE 09AE 2065            12      JR  NZ,COPYE
0008B0 09B0 10E2            13      DJNZ    COPY6
       09B2                     COPY7:
0008B2 09B2 3AFD11          13      LD  A,(MAJOR_VER)
0008B5 09B5 FE02             7      CP  2
0008B7 09B7 3011            12      JR  NC,COPY7_MSX2   ;DOS2はFCBの仕様が違う
0008B9 09B9 3AA313          13      LD  A,(DTA_CCP+13)  ;(FCB)属性(アトリビュート)
0008BC 09BC 32DB13          13      LD  (FDRV+13),A ;(FCB)属性(アトリビュート)
0008BF 09BF 21AA13          10      LD  HL,DTA_CCP+20
0008C2 09C2 11E213          10      LD  DE,FDRV+20  ;(FCB)更新日時
0008C5 09C5 010400          10      LD  BC,4
0008C8 09C8 EDB0                    LDIR
       09CA                     COPY7_MSX2:
0008CA 09CA 11CE13          10      LD  DE,FDRV
0008CD 09CD 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0008CF 09CF CD9F03          17      CALL    SYSTEM0
                                
0008D2 09D2 2041            12      JR  NZ,COPYE
0008D4 09D4 3AFD11          13      LD  A,(MAJOR_VER)
0008D7 09D7 FE02             7      CP  2
0008D9 09D9 3837            12      JR  C,COPY_DOS2DT
                                
0008DB 09DB ED4B3E12        20      LD  BC,(HANDLE1)
0008DF 09DF 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
0008E1 09E1 CD0500          17      CALL    SYSTEM
                                
0008E4 09E4 110513          10      LD  DE,PATH_FN2
0008E7 09E7 CDEA08          17      CALL    SET_CUR_PATH
                                
0008EA 09EA 11CE13          10      LD  DE,FDRV
0008ED 09ED 218813          10      LD  HL,DOS2NAME
0008F0 09F0 CD280A          17      CALL    FCB2FNAME
                                
0008F3 09F3 3A0C12          13      LD  A,(SEARCH_IX+14);   (FIB)属性
0008F6 09F6 6F               4      LD  L,A
0008F7 09F7 118813          10      LD  DE,DOS2NAME
0008FA 09FA 3E01             7      LD  A,1
0008FC 09FC 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
0008FE 09FE CD9F03          17      CALL    SYSTEM0
                                
000901 0A01 DD2A0D12        20      LD  IX,(SEARCH_IX+15)   ;(FIB)更新時間
000905 0A05 2A0F12          16      LD  HL,(SEARCH_IX+17)   ;(FIB)更新日
000908 0A08 118813          10      LD  DE,DOS2NAME
00090B 0A0B 3E01             7      LD  A,1
00090D 0A0D 0E51             7      LD  C,51H       ;(BDOS)_FTIME ファイルの日付および時刻の獲得・設定
00090F 0A0F CD9F03          17      CALL    SYSTEM0
       0A12                     COPY_DOS2DT:
000912 0A12 C33809          10      JP  COPY8
                                
       0A15                     COPYE:
000915 0A15 ED4B3E12        20      LD  BC,(HANDLE1)
000919 0A19 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
00091B 0A1B CD0500          17      CALL    SYSTEM
00091E 0A1E 11CE13          10      LD  DE,FDRV
000921 0A21 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
000923 0A23 CD0500          17      CALL    SYSTEM
       0A26                     COPYE2:
000926 0A26 37               4      SCF
000927 0A27 C9              10      RET
                                
       0A28                     FCB2FNAME:
000928 0A28 1A               7      LD  A,(DE)
000929 0A29 13               6      INC DE
00092A 0A2A C640             7      ADD A,040H
00092C 0A2C 77               7      LD  (HL),A
00092D 0A2D 23               6      INC HL
00092E 0A2E 363A            10      LD  (HL),':'
000930 0A30 23               6      INC HL
                                
000931 0A31 0608             7      LD  B,8
       0A33                     FCB2FNAME1:
000933 0A33 1A               7      LD  A,(DE)
000934 0A34 FE21             7      CP  020H+1
000936 0A36 3807            12      JR  C,FCB2FNAME2
000938 0A38 13               6      INC DE
000939 0A39 77               7      LD  (HL),A
00093A 0A3A 23               6      INC HL
00093B 0A3B 10F6            13      DJNZ    FCB2FNAME1
00093D 0A3D 1803            12      JR  FCB2FNAME3
       0A3F                     FCB2FNAME2:
00093F 0A3F 13               6      INC DE
000940 0A40 10FD            13      DJNZ    FCB2FNAME2
       0A42                     FCB2FNAME3:
000942 0A42 1A               7      LD  A,(DE)
000943 0A43 FE21             7      CP  020H+1
000945 0A45 380F            12      JR  C,FCB2FNAME5
000947 0A47 362E            10      LD  (HL),'.'
000949 0A49 23               6      INC HL
00094A 0A4A 0603             7      LD  B,3
       0A4C                     FCB2FNAME4:
00094C 0A4C 1A               7      LD  A,(DE)
00094D 0A4D 13               6      INC DE
00094E 0A4E FE21             7      CP  020H+1
000950 0A50 3804            12      JR  C,FCB2FNAME5
000952 0A52 77               7      LD  (HL),A
000953 0A53 23               6      INC HL
000954 0A54 10F6            13      DJNZ    FCB2FNAME4
       0A56                     FCB2FNAME5:
000956 0A56 3600            10      LD  (HL),0
000958 0A58 C9              10      RET
                                
       0A59                     C_TYPE:
000959 0A59 CD6508          17      CALL    SETFCB
00095C 0A5C 215C00          10      LD  HL,FCB1
00095F 0A5F CDB602          17      CALL    OPEN_D2
000962 0A62 37               4      SCF
       0A63                     TYPE1:
000963 0A63 C0              11      RET NZ
000964 0A64 CD3203          17      CALL    DEFCB_D2
000967 0A67 3E1A             7      LD  A,01AH
000969 0A69 CDE00A          17      CALL    MSG_A
       0A6C                     TYPE2:
00096C 0A6C CDB70A          17      CALL    BUFSIZ
00096F 0A6F CDBF03          17      CALL    S27DTA_D2
000972 0A72 C6FE             7      ADD A,0FEH
000974 0A74 D8              11      RET C
000975 0A75 7C               4      LD  A,H
000976 0A76 B5               4      OR  L
000977 0A77 281A            12      JR  Z,TYPEE
000979 0A79 010080          10      LD  BC,DATA
       0A7C                     TYPE3:
00097C 0A7C 0A               7      LD  A,(BC)
00097D 0A7D 03               6      INC BC
00097E 0A7E FE1A             7      CP  01AH
000980 0A80 2811            12      JR  Z,TYPEE
000982 0A82 5F               4      LD  E,A
000983 0A83 C5              11      PUSH    BC
000984 0A84 E5              11      PUSH    HL
000985 0A85 0E02             7      LD  C,2     ;(BDOS)コンソール出力
000987 0A87 CD0500          17      CALL    SYSTEM
00098A 0A8A E1              10      POP HL
00098B 0A8B C1              10      POP BC
00098C 0A8C 2B               6      DEC HL
00098D 0A8D 7C               4      LD  A,H
00098E 0A8E B5               4      OR  L
00098F 0A8F 20EB            12      JR  NZ,TYPE3
000991 0A91 18D9            12      JR  TYPE2
       0A93                     TYPEE:
000993 0A93 3AFD11          13      LD  A,(MAJOR_VER)   ;DOS2対応
000996 0A96 FE02             7      CP  2
000998 0A98 3806            12      JR  C,TYPEE2
00099A 0A9A ED4B3E12        20      LD  BC,(HANDLE1)
00099E 0A9E 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
       0AA0                     TYPEE2:
0009A0 0AA0 CD1C03          17      CALL    OPEN2_D2
0009A3 0AA3 18BE            12      JR  TYPE1
                                
       0AA5                     CWILD:
0009A5 0AA5 215D00          10      LD  HL,FCB1+1
       0AA8                     CWILD1:
0009A8 0AA8 7E               7      LD  A,(HL)
0009A9 0AA9 FE20             7      CP  020H
0009AB 0AAB C0              11      RET NZ
       0AAC                     CWILD2:
0009AC 0AAC 54               4      LD  D,H
0009AD 0AAD 5D               4      LD  E,L
0009AE 0AAE 13               6      INC DE
0009AF 0AAF 010A00          10      LD  BC,10
0009B2 0AB2 363F            10      LD  (HL),'?'
0009B4 0AB4 EDB0                    LDIR
0009B6 0AB6 C9              10      RET
                                
       0AB7                     BUFSIZ:
0009B7 0AB7 3A0700          13      LD  A,(SYSTEM+2)
0009BA 0ABA D681             7      SUB (DATA/256)+1
0009BC 0ABC E6F8             7      AND 0F8H
0009BE 0ABE 67               4      LD  H,A
0009BF 0ABF 2E00             7      LD  L,0
0009C1 0AC1 C9              10      RET
                                
0009C2 0AC2 E9               4  JP_HL:  JP  (HL)
                                
       0AC3                     _PRINT:
0009C3 0AC3 C5              11      PUSH    BC
0009C4 0AC4 D5              11      PUSH    DE
0009C5 0AC5 E5              11      PUSH    HL
0009C6 0AC6 DDE5            15      PUSH    IX
0009C8 0AC8 0E06             7      LD  C,6
0009CA 0ACA CD0500          17      CALL    SYSTEM
0009CD 0ACD DDE1            14      POP IX
0009CF 0ACF E1              10      POP HL
0009D0 0AD0 D1              10      POP DE
0009D1 0AD1 C1              10      POP BC
0009D2 0AD2 B7               4      OR  A
0009D3 0AD3 C9              10      RET
                                
       0AD4                     PRTHX:
0009D4 0AD4 F5              11      PUSH    AF
0009D5 0AD5 07               4      RLCA
0009D6 0AD6 07               4      RLCA
0009D7 0AD7 07               4      RLCA
0009D8 0AD8 07               4      RLCA
0009D9 0AD9 CDDD0A          17      CALL    PRTHX1
0009DC 0ADC F1              10      POP AF
       0ADD                     PRTHX1:
0009DD 0ADD CDF30A          17      CALL    ASC
       0AE0                     MSG_A:
0009E0 0AE0 F5              11      PUSH    AF
0009E1 0AE1 C5              11      PUSH    BC
0009E2 0AE2 D5              11      PUSH    DE
0009E3 0AE3 E5              11      PUSH    HL
0009E4 0AE4 DDE5            15      PUSH    IX
0009E6 0AE6 5F               4      LD  E,A
0009E7 0AE7 0E02             7      LD  C,2
0009E9 0AE9 CD0500          17      CALL    SYSTEM
0009EC 0AEC DDE1            14      POP IX
0009EE 0AEE E1              10      POP HL
0009EF 0AEF D1              10      POP DE
0009F0 0AF0 C1              10      POP BC
0009F1 0AF1 F1              10      POP AF
0009F2 0AF2 C9              10      RET
                                
       0AF3                     ASC:
0009F3 0AF3 E60F             7      AND 00FH
0009F5 0AF5 F630             7      OR  '0'
0009F7 0AF7 FE39             7      CP  '9'
0009F9 0AF9 D8              11      RET C
0009FA 0AFA C607             7      ADD A,7
0009FC 0AFC C9              10      RET
                                ;       FILE
       0AFD                     FILEC_D2:       ;DOS2対応
0009FD 0AFD 3AFD11          13      LD  A,(MAJOR_VER)
000A00 0B00 FE02             7      CP  2
000A02 0B02 381C            12      JR  C,FILEC
000A04 0B04 C5              11      PUSH    BC
000A05 0B05 D5              11      PUSH    DE
000A06 0B06 E5              11      PUSH    HL
000A07 0B07 CD080C          17      CALL    SPCUT
000A0A 0B0A 214512          10      LD  HL,PATH_CCP
000A0D 0B0D 0640             7      LD  B,64
       0B0F                     PATHCD1:
000A0F 0B0F 1A               7      LD  A,(DE)
000A10 0B10 13               6      INC DE
000A11 0B11 FE20             7      CP  020H
000A13 0B13 3002            12      JR  NC,PATHCD2
000A15 0B15 3E00             7      LD  A,0
       0B17                     PATHCD2:
000A17 0B17 77               7      LD  (HL),A
000A18 0B18 3803            12      JR  C,PATHCD3
000A1A 0B1A 23               6      INC HL
000A1B 0B1B 10F2            13      DJNZ    PATHCD1
       0B1D                     PATHCD3:
000A1D 0B1D E1              10      POP HL
000A1E 0B1E D1              10      POP DE
000A1F 0B1F C1              10      POP BC
       0B20                     FILEC:
000A20 0B20 CD2B0B          17      CALL    FILE
       0B23                     FILEC2:
000A23 0B23 3ACF13          13      LD  A,(FDRV+1)
000A26 0B26 FE20             7      CP  020H
000A28 0B28 C8              11      RET Z
000A29 0B29 1839            12      JR  SETDIR1
                                
       0B2B                     FILE:
000A2B 0B2B AF               4      XOR A
000A2C 0B2C 32CE13          13      LD  (FDRV),A
000A2F 0B2F 67               4      LD  H,A
000A30 0B30 6F               4      LD  L,A
000A31 0B31 22DC13          16      LD  (FDRV+14),HL
000A34 0B34 CD080C          17      CALL    SPCUT
000A37 0B37 CDED0B          17      CALL    CCHK3
000A3A 0B3A 2812            12      JR  Z,DEVI1
000A3C 0B3C 13               6      INC DE
000A3D 0B3D 1A               7      LD  A,(DE)
000A3E 0B3E 1B               6      DEC DE
000A3F 0B3F FE3A             7      CP  ':'
000A41 0B41 200B            12      JR  NZ,DEVI1
000A43 0B43 1A               7      LD  A,(DE)      ;DRIVE
000A44 0B44 CD1B0C          17      CALL    CAP
000A47 0B47 D640             7      SUB '@'
000A49 0B49 13               6      INC DE
000A4A 0B4A 13               6      INC DE
000A4B 0B4B 32CE13          13      LD  (FDRV),A
       0B4E                     DEVI1:
000A4E 0B4E 1A               7      LD  A,(DE)
000A4F 0B4F D65C             7      SUB 05CH        ;\
000A51 0B51 2009            12      JR  NZ,NOROOT
000A53 0B53 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000A54 0B54 22E813          16      LD  (FDRV+26),HL
000A57 0B57 2C               4      INC L
000A58 0B58 22DC13          16      LD  (FDRV+14),HL
000A5B 0B5B 13               6      INC DE
       0B5C                     NOROOT:
                                
       0B5C                     SETDIR:
000A5C 0B5C CD8D0B          17      CALL    FILED
000A5F 0B5F 1A               7      LD  A,(DE)
000A60 0B60 FE5C             7      CP  05CH        ;\
000A62 0B62 C0              11      RET NZ
000A63 0B63 13               6      INC DE
       0B64                     SETDIR1:
000A64 0B64 3AFD11          13      LD  A,(MAJOR_VER)
000A67 0B67 FE01             7      CP  1
000A69 0B69 C0              11      RET NZ
                                                ;for LSX-Dodgers
000A6A 0B6A 3E10             7      LD  A,010H      ;Directory
000A6C 0B6C 32DB13          13      LD  (FDRV+13),A
000A6F 0B6F D5              11      PUSH    DE
000A70 0B70 11CE13          10      LD  DE,FDRV
000A73 0B73 0E0F             7      LD  C,00FH
000A75 0B75 CD0500          17      CALL    SYSTEM
000A78 0B78 D1              10      POP DE
000A79 0B79 B7               4      OR  A
000A7A 0B7A C0              11      RET NZ
                                
000A7B 0B7B 3ADB13          13      LD  A,(FDRV+13)
000A7E 0B7E CB67             8      BIT 4,A
000A80 0B80 C8              11      RET Z
                                
000A81 0B81 CDD40B          17      CALL    FILEI
000A84 0B84 2AE813          16      LD  HL,(FDRV+26)
000A87 0B87 23               6      INC HL
000A88 0B88 22DC13          16      LD  (FDRV+14),HL
000A8B 0B8B 18CF            12      JR  SETDIR
                                
       0B8D                     FILED:
000A8D 0B8D CDD40B          17      CALL    FILEI
                                
000A90 0B90 0608             7      LD  B,8
       0B92                     FILE2:
000A92 0B92 CDE20B          17      CALL    CCHKF
000A95 0B95 C8              11      RET Z
000A96 0B96 FE2A             7      CP  '*'
000A98 0B98 282E            12      JR  Z,FILE9
000A9A 0B9A FE2E             7      CP  '.'
000A9C 0B9C 280C            12      JR  Z,FILE4
000A9E 0B9E 77               7      LD  (HL),A
000A9F 0B9F 23               6      INC HL
000AA0 0BA0 10F0            13      DJNZ    FILE2
                                
       0BA2                     FILE3:
000AA2 0BA2 CDE20B          17      CALL    CCHKF
000AA5 0BA5 C8              11      RET Z
000AA6 0BA6 FE2E             7      CP  '.'
000AA8 0BA8 20F8            12      JR  NZ,FILE3
                                
       0BAA                     FILE4:
000AAA 0BAA 21D713          10      LD  HL,FNAME+8
000AAD 0BAD 0603             7      LD  B,3
                                
       0BAF                     FILE4L:
000AAF 0BAF CDE20B          17      CALL    CCHKF
000AB2 0BB2 C8              11      RET Z
000AB3 0BB3 FE2E             7      CP  '.'
000AB5 0BB5 2008            12      JR  NZ,FILE12
000AB7 0BB7 32CF13          13      LD  (FNAME),A   ;Parent directory(..)
000ABA 0BBA 32D013          13      LD  (FNAME+1),A
000ABD 0BBD 3E20             7      LD  A,020H
       0BBF                     FILE12:
000ABF 0BBF FE2A             7      CP  '*'
000AC1 0BC1 280A            12      JR  Z,FILE10
000AC3 0BC3 77               7      LD  (HL),A
000AC4 0BC4 23               6      INC HL
000AC5 0BC5 10E8            13      DJNZ    FILE4L
000AC7 0BC7 C9              10      RET
                                
       0BC8                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000AC8 0BC8 CDCD0B          17      CALL    FILE10
000ACB 0BCB 18D5            12      JR  FILE3
                                
       0BCD                     FILE10:
000ACD 0BCD 3E3F             7      LD  A,'?'
                                
       0BCF                     FILL_MEMORY:                ;HLからBバイトAで埋める
000ACF 0BCF 77               7      LD  (HL),A
000AD0 0BD0 23               6      INC HL
000AD1 0BD1 10FC            13      DJNZ    FILL_MEMORY
000AD3 0BD3 C9              10      RET
                                
       0BD4                     FILEI:              ;名前＋拡張子をスペースで初期化
000AD4 0BD4 3E20             7      LD  A,020H
000AD6 0BD6 01000B          10      LD  BC,11*256
000AD9 0BD9 21CF13          10      LD  HL,FNAME
000ADC 0BDC E5              11      PUSH    HL
000ADD 0BDD CDCF0B          17      CALL    FILL_MEMORY
000AE0 0BE0 E1              10      POP HL
000AE1 0BE1 C9              10      RET
                                
       0BE2                     CCHKF:
000AE2 0BE2 1A               7      LD  A,(DE)
000AE3 0BE3 CDEA0B          17      CALL    CCHK2
000AE6 0BE6 C8              11      RET Z
000AE7 0BE7 C33D0C          10      JP  FKAN
                                
       0BEA                     CCHK2:
000AEA 0BEA 0C               4      INC C
000AEB 0BEB 0D               4      DEC C
000AEC 0BEC C0              11      RET NZ
       0BED                     CCHK3:              ;ZF=1 で使えない文字
000AED 0BED FE2B             7      CP  '+'
000AEF 0BEF C8              11      RET Z
000AF0 0BF0 FE2C             7      CP  ','
000AF2 0BF2 C8              11      RET Z
000AF3 0BF3 FE2F             7      CP  '/'
000AF5 0BF5 C8              11      RET Z
000AF6 0BF6 FE3A             7      CP  ':'
000AF8 0BF8 C8              11      RET Z
000AF9 0BF9 FE3B             7      CP  ';'
000AFB 0BFB C8              11      RET Z
000AFC 0BFC FE3D             7      CP  '='
000AFE 0BFE C8              11      RET Z
000AFF 0BFF FE5C             7      CP  05CH    ;\
000B01 0C01 C8              11      RET Z
000B02 0C02 FE20             7      CP  020H
000B04 0C04 D0              11      RET NC
000B05 0C05 BF               4      CP  A       ;Z=1
000B06 0C06 C9              10      RET
                                
       0C07                     SS1:
000B07 0C07 13               6      INC DE
       0C08                     SPCUT:              ;スペースをカット
000B08 0C08 1A               7      LD  A,(DE)
000B09 0C09 FE20             7      CP  020H
000B0B 0C0B 28FA            12      JR  Z,SS1
000B0D 0C0D C9              10      RET
                                
       0C0E                     TOZERO:
000B0E 0C0E D5              11      PUSH    DE
       0C0F                     TZ1:
000B0F 0C0F 1A               7      LD  A,(DE)
000B10 0C10 FE20             7      CP  20H
000B12 0C12 3803            12      JR  C,TZ2
000B14 0C14 13               6      INC DE
000B15 0C15 18F8            12      JR  TZ1
       0C17                     TZ2:
000B17 0C17 AF               4      XOR A
000B18 0C18 12               7      LD  (DE),A
000B19 0C19 D1              10      POP DE
000B1A 0C1A C9              10      RET
                                
       0C1B                     CAP:
000B1B 0C1B FE61             7      CP  'a'
000B1D 0C1D D8              11      RET C
000B1E 0C1E FE7B             7      CP  'z'+1
000B20 0C20 D0              11      RET NC
000B21 0C21 D620             7      SUB 020H
000B23 0C23 C9              10      RET
       0C24                     CAP2:
000B24 0C24 CD1B0C          17      CALL    CAP
       0C27                     CAP3:
000B27 0C27 CD300C          17      CALL    CAP4
000B2A 0C2A FE21             7      CP  021H
000B2C 0C2C D0              11      RET NC
000B2D 0C2D 3E20             7      LD  A,020H
000B2F 0C2F C9              10      RET
       0C30                     CAP4:
000B30 0C30 FE05             7      CP  5
000B32 0C32 C0              11      RET NZ
000B33 0C33 3EE5             7      LD  A,0E5H
000B35 0C35 C9              10      RET
                                
       0C36                     FKANC:
000B36 0C36 CB41             8      BIT 0,C
000B38 0C38 CC240C          17      CALL    Z,CAP2
000B3B 0C3B 1801            12      JR  FKANX
       0C3D                     FKAN:           ;漢字チェック
000B3D 0C3D 13               6      INC DE
       0C3E                     FKANX:
000B3E 0C3E CB41             8      BIT 0,C
000B40 0C40 CB81             8      RES 0,C
000B42 0C42 C0              11      RET NZ
000B43 0C43 FE80             7      CP  080H
000B45 0C45 D8              11      RET C
000B46 0C46 FEA0             7      CP  0A0H
000B48 0C48 3803            12      JR  C,FKAN1
000B4A 0C4A FEE0             7      CP  0E0H
000B4C 0C4C D8              11      RET C
       0C4D                     FKAN1:
000B4D 0C4D 0C               4      INC C
000B4E 0C4E A7               4      AND A
000B4F 0C4F C9              10      RET
                                
       0C50                     CHKWILDX:
000B50 0C50 FDE5            15      PUSH    IY
000B52 0C52 E1              10      POP HL
000B53 0C53 23               6      INC HL
       0C54                     CHKWILD:
000B54 0C54 060B             7      LD  B,11
000B56 0C56 3E3F             7      LD  A,'?'
       0C58                     CHKWIL1:
000B58 0C58 BE               7      CP  (HL)
000B59 0C59 23               6      INC HL
000B5A 0C5A 37               4      SCF
000B5B 0C5B C8              11      RET Z
000B5C 0C5C 10FA            13      DJNZ    CHKWIL1
000B5E 0C5E AF               4      XOR A
000B5F 0C5F C9              10      RET
                                
       0C60                     CPNAME:
000B60 0C60 C5              11      PUSH    BC
000B61 0C61 D5              11      PUSH    DE
000B62 0C62 11BD13          10      LD  DE,CPBUF
000B65 0C65 010700          10      LD  BC,7
000B68 0C68 EDB0                    LDIR
000B6A 0C6A D1              10      POP DE
000B6B 0C6B D5              11      PUSH    DE
000B6C 0C6C E5              11      PUSH    HL
000B6D 0C6D 21BD13          10      LD  HL,CPBUF
000B70 0C70 CD830C          17      CALL    CPFILE
000B73 0C73 E1              10      POP HL
000B74 0C74 D1              10      POP DE
000B75 0C75 C1              10      POP BC
000B76 0C76 2005            12      JR  NZ,CPNAME1
000B78 0C78 7E               7      LD  A,(HL)
000B79 0C79 23               6      INC HL
000B7A 0C7A 66               7      LD  H,(HL)
000B7B 0C7B 6F               4      LD  L,A
000B7C 0C7C C9              10      RET
       0C7D                     CPNAME1:
000B7D 0C7D 23               6      INC HL
000B7E 0C7E 23               6      INC HL
000B7F 0C7F 10DF            13      DJNZ    CPNAME
000B81 0C81 37               4      SCF
000B82 0C82 C9              10      RET
                                
       0C83                     CPFILE:
000B83 0C83 C5              11      PUSH    BC
000B84 0C84 01000B          10      LD  BC,00B00H
       0C87                     CPSTR1:
000B87 0C87 1A               7      LD  A,(DE)
000B88 0C88 FE3F             7      CP  '?'     ;Wild card
000B8A 0C8A 2812            12      JR  Z,CPSTR2
000B8C 0C8C 7E               7      LD  A,(HL)
000B8D 0C8D CD360C          17      CALL    FKANC
000B90 0C90 E5              11      PUSH    HL
000B91 0C91 67               4      LD  H,A
000B92 0C92 1A               7      LD  A,(DE)
000B93 0C93 CB01             8      RLC C
000B95 0C95 CD360C          17      CALL    FKANC
000B98 0C98 CB09             8      RRC C
000B9A 0C9A BC               4      CP  H       ;CP (HL),(DE)
000B9B 0C9B E1              10      POP HL
000B9C 0C9C 2004            12      JR  NZ,CPSTR3
       0C9E                     CPSTR2:
000B9E 0C9E 13               6      INC DE
000B9F 0C9F 23               6      INC HL
000BA0 0CA0 10E5            13      DJNZ    CPSTR1
       0CA2                     CPSTR3:
000BA2 0CA2 C1              10      POP BC
000BA3 0CA3 C9              10      RET
                                
       0CA4                     CPFILE2:
000BA4 0CA4 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
000BA7 0CA7 F6E1             7      OR  0E1H
000BA9 0CA9 2F               4      CPL
000BAA 0CAA A6               7      AND (HL)
000BAB 0CAB C9              10      RET
                                
       0CAC                     _SYS29:     ;(BDOS)ファイル名の解析
000BAC 0CAC C5              11      PUSH    BC
000BAD 0CAD D5              11      PUSH    DE
000BAE 0CAE 0640             7      LD  B,64
000BB0 0CB0 CD080C          17      CALL    SPCUT
000BB3 0CB3 DD22BB13        20      LD  (DIR_CK),IX
       0CB7                     D2FN1:
000BB7 0CB7 1A               7      LD  A,(DE)
000BB8 0CB8 FE21             7      CP  020H+1
000BBA 0CBA 3808            12      JR  C,D2FN2
000BBC 0CBC 13               6      INC DE
000BBD 0CBD DD7700          19      LD  (IX+0),A
000BC0 0CC0 DD23            10      INC IX
000BC2 0CC2 10F3            13      DJNZ    D2FN1
       0CC4                     D2FN2:
000BC4 0CC4 DD360000        19      LD  (IX+0),0
000BC8 0CC8 DD7EFF          19      LD  A,(IX-1)
000BCB 0CCB FE5C             7      CP  05CH        ;\
000BCD 0CCD 2018            12      JR  NZ,D2FN3
000BCF 0CCF DD7EFE          19      LD  A,(IX-2)
000BD2 0CD2 FE3A             7      CP  ':'
000BD4 0CD4 2811            12      JR  Z,D2FN3
                                
000BD6 0CD6 DD36FF00        19      LD  (IX-1),0
000BDA 0CDA ED5BBB13        20      LD  DE,(DIR_CK)
000BDE 0CDE CD5F0D          17      CALL    IS_FOLDER
000BE1 0CE1 3804            12      JR  C,D2FN3
       0CE3                     D2FN4:
000BE3 0CE3 DD36FF5C        19      LD  (IX-1),05CH ;\
       0CE7                     D2FN3:
000BE7 0CE7 D1              10      POP DE
000BE8 0CE8 C1              10      POP BC
000BE9 0CE9 C5              11      PUSH    BC
000BEA 0CEA E5              11      PUSH    HL
000BEB 0CEB CD2B0B          17      CALL    FILE
000BEE 0CEE E1              10      POP HL
000BEF 0CEF C1              10      POP BC
       0CF0                     S29X1:
000BF0 0CF0 C5              11      PUSH    BC
000BF1 0CF1 D5              11      PUSH    DE
000BF2 0CF2 E5              11      PUSH    HL
000BF3 0CF3 EB               4      EX  DE,HL
000BF4 0CF4 21CE13          10      LD  HL,FDRV
000BF7 0CF7 010D00          10      LD  BC,13
000BFA 0CFA EDB0                    LDIR
000BFC 0CFC 70               7      LD  (HL),B      ;B=0
000BFD 0CFD 0E03             7      LD  C,3
000BFF 0CFF EDB0                    LDIR
000C01 0D01 E1              10      POP HL
000C02 0D02 D1              10      POP DE
000C03 0D03 C1              10      POP BC
000C04 0D04 AF               4      XOR A
000C05 0D05 C9              10      RET
       0D06                     GET_WIDTH:
000C06 0D06 3AFC11          13      LD  A,(IS_MSX)
000C09 0D09 B7               4      OR  A
000C0A 0D0A 2804            12      JR  Z,NOT_MSX
000C0C 0D0C 3AB0F3          13      LD  A,(LINLEN)
000C0F 0D0F C9              10      RET
       0D10                     NOT_MSX:
000C10 0D10 E5              11      PUSH    HL
000C11 0D11 2A0100          16      LD  HL,(1)
000C14 0D14 2EB1             7      LD  L,0B1H
000C16 0D16 7E               7      LD  A,(HL)
000C17 0D17 E1              10      POP HL
000C18 0D18 C9              10      RET
                                
       0D19                     IS_FOLDER_FN2:
000C19 0D19 110513          10      LD  DE,PATH_FN2
000C1C 0D1C CD760D          17      CALL    IS_FOLDER2
000C1F 0D1F D8              11      RET C
                                
000C20 0D20 110000          10      LD  DE,0
000C23 0D23 ED53F913        20      LD  (PATH_FN2_SL),DE
000C27 0D27 110513          10      LD  DE,PATH_FN2
       0D2A                     IF2_1:
000C2A 0D2A 1A               7      LD  A,(DE)
000C2B 0D2B 13               6      INC DE
000C2C 0D2C FE5C             7      CP  '\\'
000C2E 0D2E 2004            12      JR  NZ,IF2_2
000C30 0D30 ED53F913        20      LD  (PATH_FN2_SL),DE
       0D34                     IF2_2:
000C34 0D34 B7               4      OR  A
000C35 0D35 20F3            12      JR  NZ,IF2_1
000C37 0D37 ED5BF913        20      LD  DE,(PATH_FN2_SL)
000C3B 0D3B 7A               4      LD  A,D
000C3C 0D3C B3               4      OR  E
000C3D 0D3D 280F            12      JR  Z,IS_FOLDER_FN2_E
000C3F 0D3F AF               4      XOR A
000C40 0D40 1B               6      DEC DE
000C41 0D41 12               7      LD  (DE),A
                                
000C42 0D42 110513          10      LD  DE,PATH_FN2
000C45 0D45 CD5F0D          17      CALL    IS_FOLDER
000C48 0D48 3009            12      JR  NC,IS2_3
000C4A 0D4A 3E5C             7      LD  A,'\\'
000C4C 0D4C 1B               6      DEC DE
000C4D 0D4D 12               7      LD  (DE),A
       0D4E                     IS_FOLDER_FN2_E:
000C4E 0D4E 110513          10      LD  DE,PATH_FN2
000C51 0D51 37               4      SCF
000C52 0D52 C9              10      RET
       0D53                     IS2_3:
000C53 0D53 ED5BF913        20      LD  DE,(PATH_FN2_SL)
000C57 0D57 216C00          10      LD  HL,FCB2
000C5A 0D5A CDAC0C          17      CALL    _SYS29
000C5D 0D5D 37               4      SCF
000C5E 0D5E C9              10      RET
                                
       0D5F                     IS_FOLDER:          ;out CF=0:Folder
000C5F 0D5F CD080C          17      CALL    SPCUT
000C62 0D62 1A               7      LD  A,(DE)
000C63 0D63 C6FF             7      ADD A,0FFH
000C65 0D65 D0              11      RET NC
000C66 0D66 AF               4      XOR A
000C67 0D67 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
000C69 0D69 D5              11      PUSH    DE
000C6A 0D6A CD9F03          17      CALL    SYSTEM0
000C6D 0D6D D1              10      POP DE
000C6E 0D6E 37               4      SCF
000C6F 0D6F C0              11      RET NZ
000C70 0D70 7D               4      LD  A,L
000C71 0D71 E610             7      AND 010H
000C73 0D73 D601             7      SUB 1
000C75 0D75 C9              10      RET
                                
       0D76                     IS_FOLDER2:         ;out CF=0:Folder
000C76 0D76 CD080C          17      CALL    SPCUT
000C79 0D79 1A               7      LD  A,(DE)
000C7A 0D7A C6FF             7      ADD A,0FFH
000C7C 0D7C D0              11      RET NC
000C7D 0D7D AF               4      XOR A
000C7E 0D7E 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
000C80 0D80 D5              11      PUSH    DE
000C81 0D81 CD9F03          17      CALL    SYSTEM0
000C84 0D84 D1              10      POP DE
000C85 0D85 C0              11      RET NZ
000C86 0D86 7D               4      LD  A,L
000C87 0D87 E610             7      AND 010H
000C89 0D89 D601             7      SUB 1
000C8B 0D8B C9              10      RET
                                
       0D8C                     C_MODE:
000C8C 0D8C 3AFC11          13      LD  A,(IS_MSX)
000C8F 0D8F B7               4      OR  A
000C90 0D90 C8              11      RET Z
000C91 0D91 0E29             7      LD  C,41
000C93 0D93 3AF8FA          13      LD  A,(EXBRSA)
000C96 0D96 B7               4      OR  A
000C97 0D97 2802            12      JR  Z,MODE_MSX1
000C99 0D99 0E51             7      LD  C,81
       0D9B                     MODE_MSX1:
000C9B 0D9B C5              11      PUSH    BC
000C9C 0D9C CDF40F          17      CALL    GETNUM
000C9F 0D9F C1              10      POP BC
000CA0 0DA0 7D               4      LD  A,L
000CA1 0DA1 B9               4      CP  C
000CA2 0DA2 301C            12      JR  NC,MODE1
000CA4 0DA4 B7               4      OR  A
000CA5 0DA5 2819            12      JR  Z,MODE1
000CA7 0DA7 FE21             7      CP  33
000CA9 0DA9 381E            12      JR  C,MODE32
000CAB 0DAB 32AEF3          13      LD  (LINL40),A
000CAE 0DAE DD216C00        14      LD  IX,INITXT
000CB2 0DB2 CDB90D          17      CALL    CALLROM
000CB5 0DB5 DD217800        14      LD  IX,SETTXT
       0DB9                     CALLROM:
000CB9 0DB9 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000CBD 0DBD C31C00          10      JP  CALSLT
       0DC0                     MODE1:
000CC0 0DC0 3AB0F3          13      LD  A,(LINLEN)
000CC3 0DC3 CDDA07          17      CALL    PRDEC_A
000CC6 0DC6 C37006          10      JP  LTNL
       0DC9                     MODE32:
000CC9 0DC9 32AFF3          13      LD  (LINL32),A
000CCC 0DCC DD216F00        14      LD  IX,INIT32
000CD0 0DD0 CDB90D          17      CALL    CALLROM
000CD3 0DD3 DD217B00        14      LD  IX,SETT32
000CD7 0DD7 18E0            12      JR  CALLROM
                                
       0DD9                     C_PAUSE:
000CD9 0DD9 CD080C          17      CALL    SPCUT
000CDC 0DDC EB               4      EX  DE,HL
000CDD 0DDD 7E               7      LD  A,(HL)
000CDE 0DDE B7               4      OR  A
000CDF 0DDF 2003            12      JR  NZ,C_PAUSE1
000CE1 0DE1 21E110          10      LD  HL,PAUSE
       0DE4                     C_PAUSE1:
000CE4 0DE4 CD3206          17      CALL    MSX
000CE7 0DE7 0E07             7      LD  C,7     ;(BDOS)コンソール直接入力(_DIRIN)
000CE9 0DE9 CD0500          17      CALL    SYSTEM
000CEC 0DEC FE03             7      CP  3
000CEE 0DEE CA3205          10      JP  Z,END_BATCH
000CF1 0DF1 C37006          10      JP  LTNL
                                
       0DF4                     C_ECHO:
000CF4 0DF4 CD080C          17      CALL    SPCUT
000CF7 0DF7 EB               4      EX  DE,HL
000CF8 0DF8 CD3206          17      CALL    MSX
000CFB 0DFB C37006          10      JP  LTNL
                                
       0DFE                     C_MKDIR:
000CFE 0DFE CD080C          17      CALL    SPCUT
000D01 0E01 014490          10      LD  BC,09044H   ;B=新規作成+ディレクトリ/C=(BDOS)ファイルハンドルの作成(_CREATE)
000D04 0E04 CD0500          17      CALL    SYSTEM
000D07 0E07 C6FF             7      ADD A,0FFH
000D09 0E09 D8              11      RET C
000D0A 0E0A 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
000D0C 0E0C CD0500          17      CALL    SYSTEM
       0E0F                     SHOW_OK:
000D0F 0E0F 11D710          10      LD  DE,OK
000D12 0E12 0E09             7      LD  C,9     ;(BDOS)文字列出力
000D14 0E14 CD0500          17      CALL    SYSTEM
000D17 0E17 C37006          10      JP  LTNL
                                
       0E1A                     C_RMDIR:
000D1A 0E1A CD5F0D          17      CALL    IS_FOLDER
000D1D 0E1D D8              11      RET C
000D1E 0E1E 0E4D             7      LD  C,04DH      ;(BDOS)ファイル・サブディレクトリの削除
000D20 0E20 CD0500          17      CALL    SYSTEM
000D23 0E23 C6FF             7      ADD A,0FFH
000D25 0E25 D8              11      RET C
000D26 0E26 18E7            12      JR  SHOW_OK
                                
       0E28                     C_SET:
000D28 0E28 CD080C          17      CALL    SPCUT
000D2B 0E2B ED533E0E        20      LD  (CSET_PARAM),DE
       0E2F                     CSET2:
000D2F 0E2F 1A               7      LD  A,(DE)
000D30 0E30 FE20             7      CP  020H
000D32 0E32 3838            12      JR  C,CSET_LIST
000D34 0E34 D63D             7      SUB '='
000D36 0E36 2803            12      JR  Z,CSET_SET
000D38 0E38 13               6      INC DE
000D39 0E39 18F4            12      JR  CSET2
       0E3B                     CSET_SET:
000D3B 0E3B 12               7      LD  (DE),A
000D3C 0E3C 13               6      INC DE
       0E3E                     CSET_PARAM  EQU $+1
000D3D 0E3D 210000          10      LD  HL,0
000D40 0E40 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000D42 0E42 CD0500          17      CALL    SYSTEM
       0E45                     INIT_VAR:           ;環境変数の初期化
000D45 0E45 21B811          10      LD  HL,N_DATE
000D48 0E48 11BD11          10      LD  DE,V_DATE
000D4B 0E4B 0610             7      LD  B,16
000D4D 0E4D 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000D4F 0E4F CD0500          17      CALL    SYSTEM
                                
000D52 0E52 21DD11          10      LD  HL,N_TIME
000D55 0E55 11E211          10      LD  DE,V_TIME
000D58 0E58 0603             7      LD  B,3
000D5A 0E5A 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000D5C 0E5C CD0500          17      CALL    SYSTEM
                                
000D5F 0E5F 212C11          10      LD  HL,N_APPEND
000D62 0E62 113311          10      LD  DE,V_APPEND
000D65 0E65 0640             7      LD  B,PATHX
000D67 0E67 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000D69 0E69 C30500          10      JP  SYSTEM
                                
       0E6C                     CSET_LIST:
000D6C 0E6C 3E0A             7      LD  A,10
000D6E 0E6E 32FB13          13      LD  (CSET_DATA),A
000D71 0E71 110100          10      LD  DE,1
       0E74                     CSET1:
000D74 0E74 D5              11      PUSH    DE
000D75 0E75 016DFF          10      LD  BC,0FF6DH   ;_FENV 環境変数の検索
000D78 0E78 21FD13          10      LD  HL,DATA_COM
000D7B 0E7B 3600            10      LD  (HL),0
000D7D 0E7D CD0500          17      CALL    SYSTEM
000D80 0E80 B7               4      OR  A
000D81 0E81 2030            12      JR  NZ,CSET_ERROR
000D83 0E83 21FD13          10      LD  HL,DATA_COM
000D86 0E86 7E               7      LD  A,(HL)
000D87 0E87 B7               4      OR  A
000D88 0E88 2829            12      JR  Z,CSET_ERROR
000D8A 0E8A CD3206          17      CALL    MSX
000D8D 0E8D 1E3D             7      LD  E,'='
000D8F 0E8F CDC30A          17      CALL    _PRINT
000D92 0E92 21FD13          10      LD  HL,DATA_COM
000D95 0E95 11FD14          10      LD  DE,DATA_COM+256
000D98 0E98 016BFF          10      LD  BC,0FF6BH   ;_GENV 環境変数の獲得
000D9B 0E9B CD0500          17      CALL    SYSTEM
000D9E 0E9E 21FD14          10      LD  HL,DATA_COM+256
000DA1 0EA1 CD3206          17      CALL    MSX
000DA4 0EA4 CD7006          17      CALL    LTNL
000DA7 0EA7 3E0A             7      LD  A,10
000DA9 0EA9 32FB13          13      LD  (CSET_DATA),A
       0EAC                     CSET_NEXT:
000DAC 0EAC D1              10      POP DE
000DAD 0EAD 13               6      INC DE
000DAE 0EAE 7A               4      LD  A,D
000DAF 0EAF B3               4      OR  E
000DB0 0EB0 20C2            12      JR  NZ,CSET1
000DB2 0EB2 C9              10      RET
       0EB3                     CSET_ERROR:
000DB3 0EB3 21FB13          10      LD  HL,CSET_DATA
000DB6 0EB6 35              11      DEC (HL)
000DB7 0EB7 20F3            12      JR  NZ,CSET_NEXT
       0EB9                     CSET_END:
000DB9 0EB9 D1              10      POP DE
000DBA 0EBA C9              10      RET
                                
       0EBB                     C_FORMAT:
000DBB 0EBB 3AFC11          13      LD  A,(IS_MSX)
000DBE 0EBE B7               4      OR  A
000DBF 0EBF C8              11      RET Z
000DC0 0EC0 3AFD11          13      LD  A,(MAJOR_VER)
000DC3 0EC3 FE02             7      CP  2
000DC5 0EC5 300B            12      JR  NC,FORMAT2
       0EC7                     FORMAT1:
000DC7 0EC7 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000DCB 0ECB DD214701        14      LD  IX,FORMAT
000DCF 0ECF C31C00          10      JP  CALSLT
       0ED2                     FORMAT2:
000DD2 0ED2 CD6508          17      CALL    SETFCB
000DD5 0ED5 3A5C00          13      LD  A,(FCB1)
000DD8 0ED8 B7               4      OR  A
000DD9 0ED9 28EC            12      JR  Z,FORMAT1
000DDB 0EDB 47               4      LD  B,A
000DDC 0EDC AF               4      XOR A
000DDD 0EDD 0E67             7      LD  C,067H      ;(_FORMAT)ディスクのフォーマット
000DDF 0EDF CD0500          17      CALL    SYSTEM
000DE2 0EE2 B7               4      OR  A
000DE3 0EE3 20E2            12      JR  NZ,FORMAT1
000DE5 0EE5 CD3B06          17      CALL    MSXSLT
000DE8 0EE8 21F911          10      LD  HL,PROMPT
000DEB 0EEB CD3206          17      CALL    MSX
       0EEE                     FORMAT3:
000DEE 0EEE 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力(_INNOE)
000DF0 0EF0 CD0500          17      CALL    SYSTEM
000DF3 0EF3 D631             7      SUB '0'+1
000DF5 0EF5 38F7            12      JR  C,FORMAT3
000DF7 0EF7 3C               4      INC A
000DF8 0EF8 FE0A             7      CP  10
000DFA 0EFA 30F2            12      JR  NC,FORMAT3
000DFC 0EFC F5              11      PUSH    AF
000DFD 0EFD CD7006          17      CALL    LTNL
000E00 0F00 21E110          10      LD  HL,PAUSE
000E03 0F03 CD3206          17      CALL    MSX
000E06 0F06 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力(_INNOE)
000E08 0F08 CD0500          17      CALL    SYSTEM
000E0B 0F0B CD7006          17      CALL    LTNL
000E0E 0F0E F1              10      POP AF
000E0F 0F0F ED4B5B00        20      LD  BC,(FCB1-1)
000E13 0F13 210080          10      LD  HL,08000H
000E16 0F16 110040          10      LD  DE,04000H
000E19 0F19 0E67             7      LD  C,067H      ;(_FORMAT)ディスクのフォーマット
000E1B 0F1B C30500          10      JP  SYSTEM
                                
       0F1E                     C_RAMDISK:
000E1E 0F1E 3AFC11          13      LD  A,(IS_MSX)
000E21 0F21 B7               4      OR  A
000E22 0F22 C8              11      RET Z
000E23 0F23 3AFD11          13      LD  A,(MAJOR_VER)
000E26 0F26 FE02             7      CP  2
000E28 0F28 D8              11      RET C
000E29 0F29 CD080C          17      CALL    SPCUT
000E2C 0F2C 1A               7      LD  A,(DE)
000E2D 0F2D FE30             7      CP  '0'
000E2F 0F2F D8              11      RET C
000E30 0F30 FE3A             7      CP  '9'+1
000E32 0F32 3F               4      CCF
000E33 0F33 D8              11      RET C
000E34 0F34 CDF40F          17      CALL    GETNUM
000E37 0F37 110F00          10      LD  DE,15       ;切り上げの為
000E3A 0F3A 19              11      ADD HL,DE
000E3B 0F3B 7D               4      LD  A,L
000E3C 0F3C 0604             7      LD  B,4     ;16で割る
       0F3E                     RAMDISK1:
000E3E 0F3E CB3C             8      SRL H   ;/2
000E40 0F40 1F               4      RRA
000E41 0F41 10FB            13      DJNZ    RAMDISK1
000E43 0F43 FEFF             7      CP  0FFH
000E45 0F45 2001            12      JR  NZ,RAMDISK2
000E47 0F47 3D               4      DEC A
       0F48                     RAMDISK2:
000E48 0F48 47               4      LD  B,A
000E49 0F49 0E68             7      LD  C,068H      ;(_RAMD)RAMディスクの作成あるいは消去
000E4B 0F4B CD0500          17      CALL    SYSTEM
000E4E 0F4E B7               4      OR  A
000E4F 0F4F CC0F0E          17      CALL    Z,SHOW_OK
000E52 0F52 C9              10      RET
                                
       0F53                     C_ATTRIB:
000E53 0F53 3AFC11          13      LD  A,(IS_MSX)
000E56 0F56 B7               4      OR  A
000E57 0F57 C8              11      RET Z
000E58 0F58 3AFD11          13      LD  A,(MAJOR_VER)
000E5B 0F5B FE02             7      CP  2
000E5D 0F5D D8              11      RET C
000E5E 0F5E ED537F0F        20      LD  (ATTRIB_OPT),DE
                                                ;パス名を検索
       0F62                     ATTRIB1:
000E62 0F62 CD080C          17      CALL    SPCUT
000E65 0F65 1A               7      LD  A,(DE)
000E66 0F66 13               6      INC DE
000E67 0F67 FE20             7      CP  ' '
000E69 0F69 D8              11      RET C
000E6A 0F6A FE41             7      CP  'A'
000E6C 0F6C 3003            12      JR  NC,ATTRIB2
000E6E 0F6E 13               6      INC DE
000E6F 0F6F 18F1            12      JR  ATTRIB1
       0F71                     ATTRIB2:
000E71 0F71 1B               6      DEC DE
000E72 0F72 ED53E70F        20      LD  (ATTRIB_PATH),DE
000E76 0F76 AF               4      XOR A
000E77 0F77 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
000E79 0F79 CD9F03          17      CALL    SYSTEM0
000E7C 0F7C 37               4      SCF
000E7D 0F7D C0              11      RET NZ
                                
000E7E 0F7E 110000          10      LD  DE,0
       0F7F                     ATTRIB_OPT  EQU $-2
       0F81                     ATTRIB3:
000E81 0F81 CD080C          17      CALL    SPCUT
000E84 0F84 1A               7      LD  A,(DE)
000E85 0F85 13               6      INC DE
000E86 0F86 FE41             7      CP  'A'
000E88 0F88 305C            12      JR  NC,ATTRIB_WRITE
000E8A 0F8A FE2D             7      CP  '-'
000E8C 0F8C 280A            12      JR  Z,ATTRIB_M
000E8E 0F8E FE2B             7      CP  '+'
000E90 0F90 282D            12      JR  Z,ATTRIB_P
000E92 0F92 FE2F             7      CP  '/'
000E94 0F94 1A               7      LD  A,(DE)
000E95 0F95 13               6      INC DE
000E96 0F96 18E9            12      JR  ATTRIB3
       0F98                     ATTRIB_M:
000E98 0F98 1A               7      LD  A,(DE)
000E99 0F99 13               6      INC DE
000E9A 0F9A CD1B0C          17      CALL    CAP
000E9D 0F9D FE41             7      CP  'A'
000E9F 0F9F 280E            12      JR  Z,ATTRIB_M_A
000EA1 0FA1 FE53             7      CP  'S'
000EA3 0FA3 280E            12      JR  Z,ATTRIB_M_S
000EA5 0FA5 FE48             7      CP  'H'
000EA7 0FA7 280E            12      JR  Z,ATTRIB_M_H
000EA9 0FA9 FE52             7      CP  'R'
000EAB 0FAB 280E            12      JR  Z,ATTRIB_M_R
000EAD 0FAD 18D2            12      JR  ATTRIB3
       0FAF                     ATTRIB_M_A:
000EAF 0FAF CBAD             8      RES 5,L
000EB1 0FB1 18CE            12      JR  ATTRIB3
       0FB3                     ATTRIB_M_S:
000EB3 0FB3 CB95             8      RES 2,L
000EB5 0FB5 18CA            12      JR  ATTRIB3
       0FB7                     ATTRIB_M_H:
000EB7 0FB7 CB8D             8      RES 1,L
000EB9 0FB9 18C6            12      JR  ATTRIB3
       0FBB                     ATTRIB_M_R:
000EBB 0FBB CB85             8      RES 0,L
000EBD 0FBD 18C2            12      JR  ATTRIB3
       0FBF                     ATTRIB_P:
000EBF 0FBF 1A               7      LD  A,(DE)
000EC0 0FC0 13               6      INC DE
000EC1 0FC1 CD1B0C          17      CALL    CAP
000EC4 0FC4 FE41             7      CP  'A'
000EC6 0FC6 280E            12      JR  Z,ATTRIB_P_A
000EC8 0FC8 FE53             7      CP  'S'
000ECA 0FCA 280E            12      JR  Z,ATTRIB_P_S
000ECC 0FCC FE48             7      CP  'H'
000ECE 0FCE 280E            12      JR  Z,ATTRIB_P_H
000ED0 0FD0 FE52             7      CP  'R'
000ED2 0FD2 280E            12      JR  Z,ATTRIB_P_R
000ED4 0FD4 18AB            12      JR  ATTRIB3
       0FD6                     ATTRIB_P_A:
000ED6 0FD6 CBED             8      SET 5,L
000ED8 0FD8 18A7            12      JR  ATTRIB3
       0FDA                     ATTRIB_P_S:
000EDA 0FDA CBD5             8      SET 2,L
000EDC 0FDC 18A3            12      JR  ATTRIB3
       0FDE                     ATTRIB_P_H:
000EDE 0FDE CBCD             8      SET 1,L
000EE0 0FE0 189F            12      JR  ATTRIB3
       0FE2                     ATTRIB_P_R:
000EE2 0FE2 CBC5             8      SET 0,L
000EE4 0FE4 189B            12      JR  ATTRIB3
       0FE6                     ATTRIB_WRITE:
000EE6 0FE6 110000          10      LD  DE,0
       0FE7                     ATTRIB_PATH EQU $-2
000EE9 0FE9 3E01             7      LD  A,1
000EEB 0FEB 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
000EED 0FED CD9F03          17      CALL    SYSTEM0
000EF0 0FF0 D8              11      RET C
000EF1 0FF1 C30F0E          10      JP  SHOW_OK
                                
       0FF4                     GETNUM:
000EF4 0FF4 CD080C          17      CALL    SPCUT
000EF7 0FF7 210000          10      LD  HL,0
       0FFA                     GETNUM1:
000EFA 0FFA 1A               7      LD  A,(DE)
000EFB 0FFB 13               6      INC DE
000EFC 0FFC D630             7      SUB '0'
000EFE 0FFE D8              11      RET C
000EFF 0FFF FE0A             7      CP  10
000F01 1001 D0              11      RET NC
000F02 1002 4D               4      LD  C,L
000F03 1003 44               4      LD  B,H
000F04 1004 29              11      ADD HL,HL   ;*2
000F05 1005 29              11      ADD HL,HL   ;*4
000F06 1006 09              11      ADD HL,BC   ;*5
000F07 1007 29              11      ADD HL,HL   ;*10
000F08 1008 4F               4      LD  C,A
000F09 1009 0600             7      LD  B,0
000F0B 100B 09              11      ADD HL,BC
000F0C 100C 18EC            12      JR  GETNUM1
                                
       100E                     CHDIR:
000F0E 100E 3AFD11          13      LD  A,(MAJOR_VER)
000F11 1011 FE02             7      CP  2
000F13 1013 D8              11      RET C
000F14 1014 C5              11      PUSH    BC
000F15 1015 E5              11      PUSH    HL
000F16 1016 0E5A             7      LD  C,05AH      ;(BDOS)_CHDIR カレントディレクトリの変更
000F18 1018 CD0500          17      CALL    SYSTEM
000F1B 101B E1              10      POP HL
000F1C 101C C1              10      POP BC
000F1D 101D C9              10      RET
                                
       0012                     COMS    EQU 18
       101E                     COMTB:
000F1E 101E 44202020202020          DB  "D      "   ;1
000F25 1025 B105                    DW  C_DIR
000F27 1027 44495220202020          DB  "DIR    "   ;2
000F2E 102E B105                    DW  C_DIR
000F30 1030 434F5059202020          DB  "COPY   "   ;3
000F37 1037 AE08                    DW  C_COPY
000F39 1039 43442020202020          DB  "CD     "   ;4
000F40 1040 A403                    DW  C_CD
000F42 1042 44454C20202020          DB  "DEL    "   ;5
000F49 1049 5005                    DW  C_DEL
000F4B 104B 50415448202020          DB  "PATH   "   ;6
000F52 1052 7A06                    DW  C_PATH
000F54 1054 52454E20202020          DB  "REN    "   ;7
000F5B 105B 8305                    DW  C_REN
000F5D 105D 54595045202020          DB  "TYPE   "   ;8
000F64 1064 590A                    DW  C_TYPE
000F66 1066 52454D20202020          DB  "REM    "   ;9
000F6D 106D 4E05                    DW  C_REM
000F6F 106F 4D4F4445202020          DB  "MODE   "   ;10
000F76 1076 8C0D                    DW  C_MODE
000F78 1078 50415553452020          DB  "PAUSE  "   ;11
000F7F 107F D90D                    DW  C_PAUSE
000F81 1081 53455420202020          DB  "SET    "   ;12
000F88 1088 280E                    DW  C_SET
000F8A 108A 4543484F202020          DB  "ECHO   "   ;13
000F91 1091 F40D                    DW  C_ECHO
000F93 1093 4D4B4449522020          DB  "MKDIR  "   ;14
000F9A 109A FE0D                    DW  C_MKDIR
000F9C 109C 524D4449522020          DB  "RMDIR  "   ;15
000FA3 10A3 1A0E                    DW  C_RMDIR
000FA5 10A5 464F524D415420          DB  "FORMAT "   ;16
000FAC 10AC BB0E                    DW  C_FORMAT
000FAE 10AE 52414D4449534B          DB  "RAMDISK"   ;17
000FB5 10B5 1E0F                    DW  C_RAMDISK
000FB7 10B7 41545452494220          DB  "ATTRIB "   ;18
000FBE 10BE 530F                    DW  C_ATTRIB
                                
000FC0 10C0 2062797465732066    FREE:   DB  " bytes free  $"
            726565202024        
000FCE 10CE 2020203C4449523E    DIRMES: DB  "   <DIR>$"
            24                  
000FD7 10D7 4F4B24              OK: DB  "OK$"
000FDA 10DA 4572726F722124      COMERM: DB  "Error!$"
000FE1 10E1 537472696B652061    PAUSE:  DB  "Strike any key when ready ",0
            6E79206B65792077    
            68656E2072656164    
            792000              
                                
       10FC                     S_MONTH:
000FFC 10FC 4A616E00                DB  "Jan",0
001000 1100 46656200                DB  "Feb",0
001004 1104 4D617200                DB  "Mar",0
001008 1108 41707200                DB  "Apr",0
00100C 110C 4D617900                DB  "May",0
001010 1110 4A756E00                DB  "Jun",0
001014 1114 4A756C00                DB  "Jul",0
001018 1118 41756700                DB  "Aug",0
00101C 111C 53657000                DB  "Sep",0
001020 1120 4F637400                DB  "Oct",0
001024 1124 4E6F7600                DB  "Nov",0
001028 1128 44656300                DB  "Dec",0
                                
       112C                     N_APPEND:
00102C 112C 415050454E4400          DB  "APPEND",0
       1133                     V_APPEND:
001033 1133                         DS  64
       1173                     N_PATH:
001073 1173 5041544800              DB  "PATH",0
       1178                     V_PATH:
001078 1178                         DS  PATHX
       11B8                     N_DATE:
0010B8 11B8 4441544500              DB  "DATE",0
       11BD                     V_DATE:
0010BD 11BD 79792D6D6D2D6464        DB  "yy-mm-dd"
0010C5 11C5                         DS  8
       11CD                     V_DATE1:
0010CD 11CD 6D6D2D64642D7979        DB  "mm-dd-yy"
       11D5                     V_DATE2:
0010D5 11D5 64642D6D6D2D7979        DB  "dd-mm-yy"
       11DD                     N_TIME:
0010DD 11DD 54494D4500              DB  "TIME",0
       11E2                     V_TIME:
0010E2 11E2 323400                  DB  "24",0
       11E5                     N_PROGRAM:
0010E5 11E5 50524F4752414D00        DB  "PROGRAM",0
       11ED                     N_PARAMETERS:
0010ED 11ED 504152414D455445        DB  "PARAMETERS",0
            525300              
                                
       11F8                     F_TIME:
0010F8 11F8 00                      DB  0
       11F9                     PROMPT:
0010F9 11F9 3F2000                  DB  "? ",0
       11FC                     IS_MSX:
0010FC 11FC 00                      DB  0
       11FD                     MAJOR_VER:
0010FD 11FD 00                      DB  0
       11FE                     SEARCH_IX:
0010FE 11FE                         DS  64  ;DOS2用
       123E                     HANDLE1:
00113E 123E 0000                    DW  0
       1240                     PATH_POS:
001140 1240 0000                    DW  0
       1242                     PATH_DRV:
001142 1242 413A5C                  DB  "A:\\"
       1245                     PATH_CCP:
001145 1245                         DS  64  ;DOS2用
       1285                     PATH_PAR:
001185 1285                         DS  64  ;DOS2用
       12C5                     PATH_FN1:
0011C5 12C5                         DS  64  ;DOS2用
       1305                     PATH_FN2:
001205 1305                         DS  64  ;DOS2用
       1345                     CUR_DRV:
001245 1345 413A5C                  DB  "A:\\"
       1348                     CUR_PATH:
001248 1348                         DS  64  ;DOS2用
       1388                     DOS2NAME:
001288 1388                         DS  2+8+3+1 ;DOS2用
       1396                     DTA_CCP:
001296 1396                         DS  37
       13BB                     DIR_CK:
0012BB 13BB 0000                    DW  0
                                
       13BD                     CPBUF:
0012BD 13BD 0000                LEFTX:  DW  0
0012BF 13BF 0000                DTAX:   DW  0
0012C1 13C1 20                      DB  020H    ;CPBUFで使う
0012C2 13C2 20                      DB  020H
0012C3 13C3 20                      DB  020H
0012C4 13C4 20                      DB  020H
0012C5 13C5 20                      DB  020H
0012C6 13C6 20                      DB  020H
0012C7 13C7 20                      DB  020H
                                
       13C8                     DECBF:
0012C8 13C8                         DS  5
       13CD                     FCB_BAT2:
0012CD 13CD 00                      DB  0
       13CE                     FDRV:
0012CE 13CE 00                      DB  0
       13CF                     FNAME:
0012CF 13CF                         DS  37
       13F4                     ZERO:
0012F4 13F4 00                      DB  0
       13F5                     FCB_BAT:
0012F5 13F5 CD13                    DW  FCB_BAT2
       13F7                     X_PATH:
0012F7 13F7 0000                    DW  0
       13F9                     PATH_FN2_SL:
0012F9 13F9 0000                    DW  0
       13FB                     CSET_DATA:
0012FB 13FB 00                      DB  0
       13FC                     PROCESS:
0012FC 13FC 00                      DB  0
                                
       13FD                     DATA_COM:
[EOF:COMMAND.ASM:SHIFT_JIS]
