                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                
                                ;   似非COMMAND.COM
                                
       0005                     SYSTEM  EQU 00005H
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
       001C                     CALSLT  EQU 0001CH
       006C                     INITXT  EQU 0006CH
       006F                     INIT32  EQU 0006FH
       0078                     SETTXT  EQU 00078H
       007B                     SETT32  EQU 0007BH
                                
       F3AE                     LINL40  EQU 0F3AEH
       F3AF                     LINL32  EQU 0F3AFH
       F3B0                     LINLEN  EQU 0F3B0H
       F55E                     BUF EQU 0F55EH
       FAF8                     EXBRSA  EQU 0FAF8H
       FC9B                     INTFLG  EQU 0FC9BH
       FCC1                     EXPTBL  EQU 0FCC1H
                                
                                
       0040                     PATHX   EQU 64
                                
       8000                     DATA    EQU 08000H
                                
000000 0100                         ORG 0100H
000000 0100 C31501          10      JP  START
000003 0103 0D0A434F4D4D414E    VER:    DB  00DH,00AH,"COMMAND v0.09",00DH,00AH,'$'
            442076302E30390D    
            0A24                
       0115                     START:
000015 0115 ED7B0600        20      LD  SP,(SYSTEM+1)
000019 0119 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
00001B 011B CD0500          17      CALL    SYSTEM
00001E 011E D8              11      RET C
00001F 011F 211D01          10      LD  HL,0011DH
000022 0122 ED42            15      SBC HL,BC
000024 0124 78               4      LD  A,B
000025 0125 320C0D          13      LD  (MAJOR_VER),A
000028 0128 B5               4      OR  L
000029 0129 320B0D          13      LD  (IS_MSX),A
00002C 012C B7               4      OR  A
00002D 012D 2820            12      JR  Z,WSTART
                                
00002F 012F CDFC0A          17      CALL    INIT_VAR
                                
000032 0132 2A0600          16      LD  HL,(SYSTEM+1)
000035 0135 2EDB             7      LD  L,256-37
000037 0137 24               4      INC H
000038 0138 22060E          16      LD  (FCB_BAT),HL
00003B 013B 3A8000          13      LD  A,(DTA1)
00003E 013E B7               4      OR  A
00003F 013F 280E            12      JR  Z,WSTART
000041 0141 110301          10      LD  DE,VER
000044 0144 0E09             7      LD  C,9
000046 0146 CD0500          17      CALL    SYSTEM
000049 0149 118100          10      LD  DE,DTA1+1
00004C 014C CD9D01          17      CALL    COMANL
       014F                     WSTART:
00004F 014F 21610C          10      LD  HL,N_APPEND
000052 0152 11680C          10      LD  DE,V_APPEND
000055 0155 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000057 0157 CD0500          17      CALL    SYSTEM
                                
00005A 015A CD7C04          17      CALL    LTNL
       015D                     COMMAND:
00005D 015D E5              11      PUSH    HL
00005E 015E 2A060E          16      LD  HL,(FCB_BAT)
000061 0161 7E               7      LD  A,(HL)
000062 0162 E1              10      POP HL
000063 0163 B7               4      OR  A
000064 0164 C25A03          10      JP  NZ,C_BAT1
000067 0167 CD9102          17      CALL    SETDTA1
00006A 016A D5              11      PUSH    DE
00006B 016B C5              11      PUSH    BC
00006C 016C E5              11      PUSH    HL
00006D 016D 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
00006F 016F CD0500          17      CALL    SYSTEM
000072 0172 E1              10      POP HL
000073 0173 C1              10      POP BC
000074 0174 C641             7      ADD A,'A'
000076 0176 5F               4      LD  E,A
000077 0177 CD6E08          17      CALL    _PRINT
00007A 017A 1E3E             7      LD  E,'>'
00007C 017C CD6E08          17      CALL    _PRINT
00007F 017F D1              10      POP DE      ;DE=DTA1
000080 0180 3E50             7      LD  A,80
000082 0182 12               7      LD  (DE),A
000083 0183 0E0A             7      LD  C,0AH       ;(BDOS)文字列入力
000085 0185 CD0500          17      CALL    SYSTEM
000088 0188 CD7C04          17      CALL    LTNL
       018B                     COMMAND2:
00008B 018B 118200          10      LD  DE,DTA1+2
00008E 018E CD9D01          17      CALL    COMANL
000091 0191 30CA            12      JR  NC,COMMAND
000093 0193 110F0C          10      LD  DE,COMERM
000096 0196 0E09             7      LD  C,9     ;(BDOS)文字列出力
000098 0198 CD0500          17      CALL    SYSTEM
00009B 019B 18B2            12      JR  WSTART
                                
       019D                     COMANL:
00009D 019D CDC008          17      CALL    FILE
0000A0 01A0 D5              11      PUSH    DE
0000A1 01A1 11E00D          10      LD  DE,FNAME
0000A4 01A4 1A               7      LD  A,(DE)
0000A5 01A5 FE20             7      CP  020H
0000A7 01A7 285C            12      JR  Z,SDVSW
0000A9 01A9 1B               6      DEC DE
0000AA 01AA 1A               7      LD  A,(DE)
0000AB 01AB C6FF             7      ADD A,0FFH
0000AD 01AD 380A            12      JR  C,COMB
0000AF 01AF 13               6      INC DE
                                
0000B0 01B0 219C0B          10      LD  HL,COMTB
0000B3 01B3 3E0C             7      LD  A,COMS
0000B5 01B5 47               4      LD  B,A
0000B6 01B6 CDF509          17      CALL    CPNAME
       01B9                     COMB:
0000B9 01B9 D1              10      POP DE
0000BA 01BA D26D08          10      JP  NC,JP_HL
       01BD                     COMB2:
0000BD 01BD EB               4      EX  DE,HL
0000BE 01BE 220603          16      LD  (COMPAT+1),HL
0000C1 01C1 CDC902          17      CALL    CEXE4
                                
0000C4 01C4 21A80C          10      LD  HL,N_PATH
0000C7 01C7 11AD0C          10      LD  DE,V_PATH
0000CA 01CA 0640             7      LD  B,PATHX
0000CC 01CC 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
0000CE 01CE CD0500          17      CALL    SYSTEM
                                
0000D1 01D1 21AD0C          10      LD  HL,V_PATH
0000D4 01D4 22080E          16      LD  (X_PATH),HL
       01D7                     CEX1:
0000D7 01D7 2A080E          16      LD  HL,(X_PATH)
0000DA 01DA 7E               7      LD  A,(HL)
0000DB 01DB FE20             7      CP  020H
0000DD 01DD D8              11      RET C
       01DE                     CEX2:
0000DE 01DE 7E               7      LD  A,(HL)
0000DF 01DF FE20             7      CP  020H
0000E1 01E1 3807            12      JR  C,CEX3
0000E3 01E3 FE3B             7      CP  ';'
0000E5 01E5 2803            12      JR  Z,CEX3
0000E7 01E7 23               6      INC HL
0000E8 01E8 18F4            12      JR  CEX2
       01EA                     CEX3:
0000EA 01EA 3600            10      LD  (HL),0
0000EC 01EC FE20             7      CP  020H
0000EE 01EE 3801            12      JR  C,CEX4
0000F0 01F0 23               6      INC HL
       01F1                     CEX4:
0000F1 01F1 ED5B080E        20      LD  DE,(X_PATH)
0000F5 01F5 22080E          16      LD  (X_PATH),HL
0000F8 01F8 21610C          10      LD  HL,N_APPEND
0000FB 01FB 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0000FD 01FD CD0500          17      CALL    SYSTEM
                                
000100 0200 CDC902          17      CALL    CEXE4
000103 0203 18D2            12      JR  CEX1
                                
       0205                     SDVSW:
000105 0205 F1              10      POP AF
000106 0206 3ADF0D          13      LD  A,(FDRV)
000109 0209 3D               4      DEC A
00010A 020A 5F               4      LD  E,A
00010B 020B 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
00010D 020D C39802          10      JP  SYSTEM0
                                
       0210                     OPEN1_D2:           ;DOS2対応
000110 0210 3A0C0D          13      LD  A,(MAJOR_VER)
000113 0213 FE02             7      CP  2
000115 0215 382C            12      JR  C,OPEN1
                                
000117 0217 114D0D          10      LD  DE,PATH_CCP
00011A 021A DD210D0D        14      LD  IX,SEARCH_IX
00011E 021E 014010          10      LD  BC,01040H   ;(BDOS)最初のエントリ検索
000121 0221 CD0500          17      CALL    SYSTEM
       0224                     FIB2DIRENT:
000124 0224 B7               4      OR  A
000125 0225 C0              11      RET NZ
                                
000126 0226 110E0D          10      LD  DE,SEARCH_IX+1
000129 0229 21AA0D          10      LD  HL,DTA_CCP+1
00012C 022C 0E5C             7      LD  C,05CH      ;(BDOS)ファイル名の解析
00012E 022E CD0500          17      CALL    SYSTEM
                                
000131 0231 211B0D          10      LD  HL,SEARCH_IX+14
000134 0234 11B50D          10      LD  DE,DTA_CCP+1+8+3
000137 0237 EDA0            16      LDI
000139 0239 11C00D          10      LD  DE,DTA_CCP+1+8+3+1+10
00013C 023C 010A00          10      LD  BC,2+2+2+4  ;最終変更時刻+最終変更日付+開始クラスタ+ファイルサイズ
00013F 023F EDB0                    LDIR
000141 0241 AF               4      XOR A
000142 0242 C9              10      RET
                                
       0243                     OPEN1:
000143 0243 21DF0D          10      LD  HL,FDRV
       0246                     OPEN:
000146 0246 0E11             7      LD  C,011H      ;(BDOS)最初のファイルの検索
       0248                     OPEN3:
000148 0248 D5              11      PUSH    DE
000149 0249 11A90D          10      LD  DE,DTA_CCP
00014C 024C CD8402          17      CALL    SETDTA
00014F 024F EB               4      EX  DE,HL
000150 0250 CD0500          17      CALL    SYSTEM
000153 0253 D1              10      POP DE
000154 0254 B7               4      OR  A
000155 0255 C9              10      RET
                                
       0256                     OPEN2_D2:           ;DOS2対応
000156 0256 3A0C0D          13      LD  A,(MAJOR_VER)
000159 0259 FE02             7      CP  2
00015B 025B 380B            12      JR  C,OPEN2
00015D 025D DD210D0D        14      LD  IX,SEARCH_IX
000161 0261 0E41             7      LD  C,41H       ;(BDOS)次のエントリ検索
000163 0263 CD0500          17      CALL    SYSTEM
000166 0266 18BC            12      JR  FIB2DIRENT
       0268                     OPEN2:
000168 0268 0E12             7      LD  C,012H
00016A 026A 18DC            12      JR  OPEN3
                                
       026C                     DEFCB:              ;Z=Ok NZ=Error
00016C 026C 11A90D          10      LD  DE,DTA_CCP
00016F 026F CD9602          17      CALL    SYSC0F
000172 0272 B7               4      OR  A
000173 0273 C0              11      RET NZ
                                
000174 0274 210100          10      LD  HL,1
000177 0277 22B70D          16      LD  (DTA_CCP+14),HL
00017A 027A 2D               4      DEC L
00017B 027B 22CA0D          16      LD  (DTA_CCP+33),HL
00017E 027E 22CC0D          16      LD  (DTA_CCP+35),HL
       0281                     SETDTA100:
000181 0281 110080          10      LD  DE,DATA
       0284                     SETDTA:
000184 0284 C5              11      PUSH    BC
000185 0285 D5              11      PUSH    DE
000186 0286 E5              11      PUSH    HL
000187 0287 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
000189 0289 CD0500          17      CALL    SYSTEM
00018C 028C E1              10      POP HL
00018D 028D D1              10      POP DE
00018E 028E C1              10      POP BC
00018F 028F AF               4      XOR A
000190 0290 C9              10      RET
                                
       0291                     SETDTA1:
000191 0291 118000          10      LD  DE,DTA1
000194 0294 18EE            12      JR  SETDTA
                                
       0296                     SYSC0F:
000196 0296 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       0298                     SYSTEM0:
000198 0298 CD0500          17      CALL    SYSTEM
00019B 029B B7               4      OR  A
00019C 029C C9              10      RET
                                
       029D                     C_CD:
00019D 029D CD9208          17      CALL    FILEC_D2
0001A0 02A0 114D0D          10      LD  DE,PATH_CCP
0001A3 02A3 1A               7      LD  A,(DE)
0001A4 02A4 FE20             7      CP  020H
0001A6 02A6 3805            12      JR  C,PWD
0001A8 02A8 0E5A             7      LD  C,5AH       ;(BDOS)_CHDIR カレントディレクトリの変更
0001AA 02AA C30500          10      JP  SYSTEM
       02AD                     PWD:
0001AD 02AD CDC204          17      CALL    PUTDRV
0001B0 02B0 3E5C             7      LD  A,05CH
0001B2 02B2 CD7F08          17      CALL    MSG_A
0001B5 02B5 C33604          10      JP  PDSKF2
                                
       02B8                     S27DTA:
0001B8 02B8 110100          10      LD  DE,1
0001BB 02BB ED53B70D        20      LD  (DTA_CCP+14),DE
0001BF 02BF 11A90D          10      LD  DE,DTA_CCP
       02C2                     S27:
0001C2 02C2 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
0001C4 02C4 CD0500          17      CALL    SYSTEM
0001C7 02C7 B7               4      OR  A
0001C8 02C8 C9              10      RET
                                
       02C9                     CEXE4:
0001C9 02C9 21DF0D          10      LD  HL,FDRV
0001CC 02CC 11A90D          10      LD  DE,DTA_CCP
0001CF 02CF 010900          10      LD  BC,1+8
0001D2 02D2 EDB0                    LDIR
0001D4 02D4 21B20D          10      LD  HL,DTA_CCP+9
0001D7 02D7 3643            10      LD  (HL),'C'
0001D9 02D9 23               6      INC HL
0001DA 02DA 364F            10      LD  (HL),'O'
0001DC 02DC 23               6      INC HL
0001DD 02DD 364D            10      LD  (HL),'M'
       02DF                     C_EXE:
0001DF 02DF CD6C02          17      CALL    DEFCB
0001E2 02E2 204E            12      JR  NZ,C_BAT
0001E4 02E4 110B0E          10      LD  DE,DATA_COM
0001E7 02E7 CD8402          17      CALL    SETDTA
                                
0001EA 02EA 2A0600          16      LD  HL,(SYSTEM+1)
0001ED 02ED 110B0E          10      LD  DE,DATA_COM
0001F0 02F0 ED52            15      SBC HL,DE
                                
0001F2 02F2 CDB802          17      CALL    S27DTA
0001F5 02F5 3D               4      DEC A
0001F6 02F6 37               4      SCF
0001F7 02F7 C0              11      RET NZ
0001F8 02F8 7C               4      LD  A,H
0001F9 02F9 B5               4      OR  L
0001FA 02FA 37               4      SCF
0001FB 02FB C8              11      RET Z
0001FC 02FC 222C03          16      LD  (COMSIZ+1),HL
                                
0001FF 02FF 110B0E          10      LD  DE,DATA_COM
000202 0302 CD8402          17      CALL    SETDTA
000205 0305 110000          10  COMPAT: LD  DE,0
000208 0308 CD7106          17      CALL    SETFCB
                                
00020B 030B 21610C          10      LD  HL,N_APPEND
00020E 030E 11680C          10      LD  DE,V_APPEND
000211 0311 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000213 0313 CD0500          17      CALL    SYSTEM
                                
000216 0316 AF               4      XOR A
000217 0317 67               4      LD  H,A
000218 0318 6F               4      LD  L,A ;HL=0x0000
000219 0319 F3               4      DI
00021A 031A ED7B0600        20  SPPAT:  LD  SP,(SYSTEM+1)
00021E 031E E5              11      PUSH    HL
00021F 031F 21EDB0          10      LD  HL,0B0EDH   ;LDIR
000222 0322 22FE00          16      LD  (000FEH),HL
000225 0325 210B0E          10      LD  HL,DATA_COM
000228 0328 110001          10      LD  DE,00100H
00022B 032B 010000          10  COMSIZ: LD  BC,0
00022E 032E FB               4      EI
00022F 032F C3FE00          10      JP  000FEH
                                
       0332                     C_BAT:
000232 0332 21B20D          10      LD  HL,DTA_CCP+9
000235 0335 3642            10      LD  (HL),'B'
000237 0337 23               6      INC HL
000238 0338 3641            10      LD  (HL),'A'
00023A 033A 23               6      INC HL
00023B 033B 3654            10      LD  (HL),'T'
                                
00023D 033D CD6C02          17      CALL    DEFCB
000240 0340 C0              11      RET NZ
                                
000241 0341 21A90D          10      LD  HL,DTA_CCP
000244 0344 7E               7      LD  A,(HL)
000245 0345 B7               4      OR  A
000246 0346 2009            12      JR  NZ,CBAT_DS
000248 0348 E5              11      PUSH    HL
000249 0349 0E19             7      LD  C,019H      ;(BDOS)カレントドライブ番号の獲得(_CURDRV)
00024B 034B CD0500          17      CALL    SYSTEM
00024E 034E E1              10      POP HL
00024F 034F 3C               4      INC A
000250 0350 77               7      LD  (HL),A
       0351                     CBAT_DS:
000251 0351 ED5B060E        20      LD  DE,(FCB_BAT)
000255 0355 012500          10      LD  BC,37
000258 0358 EDB0                    LDIR
       035A                     C_BAT1:
00025A 035A CD8102          17      CALL    SETDTA100
00025D 035D CD9B03          17      CALL    FGETC_BAT
000260 0360 218100          10      LD  HL,DTA1+1
000263 0363 202A            12      JR  NZ,END_BATCH
000265 0365 FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
000267 0367 38F1            12      JR  C,C_BAT1
000269 0369 3620            10      LD  (HL),' '
00026B 036B 23               6      INC HL
       036C                     C_BAT2:
00026C 036C 77               7      LD  (HL),A
00026D 036D 23               6      INC HL
00026E 036E 7D               4      LD  A,L
00026F 036F 3C               4      INC A       ;L==0FFH
000270 0370 2809            12      JR  Z,RUN_BATCH
000272 0372 CD9B03          17      CALL    FGETC_BAT
000275 0375 2004            12      JR  NZ,RUN_BATCH
000277 0377 FE20             7      CP  020H
000279 0379 30F1            12      JR  NC,C_BAT2
       037B                     RUN_BATCH:
00027B 037B 7D               4      LD  A,L
00027C 037C D67F             7      SUB DTA1-1
00027E 037E 328000          13      LD  (DTA1),A
000281 0381 FE04             7      CP  4
000283 0383 380A            12      JR  C,END_BATCH
000285 0385 3600            10      LD  (HL),0
000287 0387 3A9BFC          13      LD  A,(INTFLG)
00028A 038A FE03             7      CP  3
00028C 038C C28B01          10      JP  NZ,COMMAND2
       038F                     END_BATCH:      ;バッチファイルを閉じる
00028F 038F 2A060E          16      LD  HL,(FCB_BAT)
000292 0392 3600            10      LD  (HL),0
000294 0394 ED7B0600        20      LD  SP,(SYSTEM+1)
000298 0398 C34F01          10      JP  WSTART
                                
       039B                     FGETC_BAT:
00029B 039B ED5B060E        20      LD  DE,(FCB_BAT)
       039F                     FGETC:              ;1文字ずつ読み込む
00029F 039F E5              11      PUSH    HL      ;Z:成功
0002A0 03A0 210100          10      LD  HL,1
0002A3 03A3 CDC202          17      CALL    S27
0002A6 03A6 E1              10      POP HL
0002A7 03A7 3A0080          13      LD  A,(DATA)
0002AA 03AA C9              10      RET
                                
       03AB                     C_REM:
0002AB 03AB AF               4      XOR A
0002AC 03AC C9              10      RET
                                
       03AD                     C_DEL:
0002AD 03AD CD7106          17      CALL    SETFCB
0002B0 03B0 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力
0002B2 03B2 CD0500          17      CALL    SYSTEM
                                
0002B5 03B5 0E13             7      LD  C,013H
0002B7 03B7 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       03B9                     C_REN:
0002B9 03B9 CD7106          17      CALL    SETFCB
0002BC 03BC 3E10             7      LD  A,010H      ;ディレクトリも対象にする(LSX-Dodgers)
0002BE 03BE 326900          13      LD  (FCB1+13),A ;属性
0002C1 03C1 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       03C3                     CDEL1:
0002C3 03C3 115C00          10      LD  DE,FCB1
0002C6 03C6 CD0500          17      CALL    SYSTEM
0002C9 03C9 C6FF             7      ADD A,0FFH
0002CB 03CB C9              10      RET
                                
       03CC                     C_DIR:
0002CC 03CC CD9208          17      CALL    FILEC_D2
0002CF 03CF 21E00D          10      LD  HL,FDRV+1
0002D2 03D2 CD5308          17      CALL    CWILD1
0002D5 03D5 3EF1             7      LD  A,0F1H
0002D7 03D7 32EC0D          13      LD  (FDRV+13),A
0002DA 03DA CD1002          17      CALL    OPEN1_D2
       03DD                     CDIR1:
0002DD 03DD B7               4      OR  A
0002DE 03DE 2008            12      JR  NZ,PDSKF
0002E0 03E0 CD5404          17      CALL    P_NAME
0002E3 03E3 CD5602          17      CALL    OPEN2_D2
0002E6 03E6 18F5            12      JR  CDIR1
                                
       03E8                     PDSKF:
0002E8 03E8 3ADF0D          13      LD  A,(FDRV)
0002EB 03EB 5F               4      LD  E,A
0002EC 03EC 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0002EE 03EE CD0500          17      CALL    SYSTEM
0002F1 03F1 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0002F2 03F2 C601             7      ADD A,001H
0002F4 03F4 D8              11      RET C       ;Aが0FFHだった場合
0002F5 03F5 3E06             7      LD  A,8-2
       03F7                     PDS1:               ;HL=未使用クラスタの総数
0002F7 03F7 3C               4      INC A
0002F8 03F8 CB19             8      RR  C
0002FA 03FA 30FB            12      JR  NC,PDS1
       03FC                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0002FC 03FC 3C               4      INC A
0002FD 03FD CB18             8      RR  B
0002FF 03FF 30FB            12      JR  NC,PDS2
000301 0401 47               4      LD  B,A
                                
000302 0402 110000          10      LD  DE,0
       0405                     PDS3:
000305 0405 29              11      ADD HL,HL
000306 0406 EB               4      EX  DE,HL
000307 0407 ED6A            15      ADC HL,HL
000309 0409 EB               4      EX  DE,HL
00030A 040A 10F9            13      DJNZ    PDS3
       040C                     PDSKF1:
00030C 040C CDE204          17      CALL    PRDEC_DEHL
00030F 040F 11F00B          10      LD  DE,FREE
000312 0412 0E09             7      LD  C,9     ;(BDOS)文字列出力
000314 0414 CD0500          17      CALL    SYSTEM
000317 0417 CDC204          17      CALL    PUTDRV
00031A 041A 3E5C             7      LD  A,05CH
00031C 041C CD7F08          17      CALL    MSG_A
00031F 041F 3A0C0D          13      LD  A,(MAJOR_VER)
000322 0422 FE01             7      CP  1
000324 0424 3856            12      JR  C,LTNL
000326 0426 200E            12      JR  NZ,PDSKF2
000328 0428 2AED0D          16      LD  HL,(FDRV+14)
00032B 042B AF               4      XOR A
00032C 042C 11FEFF          10      LD  DE,0-2
00032F 042F 19              11      ADD HL,DE
000330 0430 23               6      INC HL
000331 0431 DCDE04          17      CALL    C,PRDEC_HL
000334 0434 1846            12      JR  LTNL
       0436                     PDSKF2:             ;MSX-DOS2
000336 0436 3ADF0D          13      LD  A,(FDRV)
000339 0439 47               4      LD  B,A     ;ドライブ
00033A 043A 110080          10      LD  DE,DATA
00033D 043D 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
00033F 043F CD0500          17      CALL    SYSTEM
000342 0442 210080          10      LD  HL,DATA
                                
000345 0445 CD4E04          17      CALL    MSX
000348 0448 1832            12      JR  LTNL
                                
       044A                     MSX1:
00034A 044A 5F               4      LD  E,A
00034B 044B CD6E08          17      CALL    _PRINT
       044E                     MSX:
00034E 044E 7E               7      LD  A,(HL)
00034F 044F 23               6      INC HL
000350 0450 B7               4      OR  A
000351 0451 20F7            12      JR  NZ,MSX1
000353 0453 C9              10      RET
                                
       0454                     P_NAME:
000354 0454 21AA0D          10      LD  HL,DTA_CCP+1
000357 0457 7E               7      LD  A,(HL)
000358 0458 FE2E             7      CP  '.'
00035A 045A C8              11      RET Z
00035B 045B CD3805          17      CALL    FPRNT
00035E 045E 3AB50D          13      LD  A,(DTA_CCP+12)
000361 0461 CB67             8      BIT 4,A
000363 0463 280A            12      JR  Z,DIR3
000365 0465 11FE0B          10      LD  DE,DIRMES
000368 0468 0E09             7      LD  C,9     ;(BDOS)文字列出力
00036A 046A CD0500          17      CALL    SYSTEM
00036D 046D 180A            12      JR  DIR6
       046F                     DIR3:
00036F 046F ED5BC80D        20      LD  DE,(DTA_CCP+1+01EH)
000373 0473 2AC60D          16      LD  HL,(DTA_CCP+1+01CH)
000376 0476 CDE204          17      CALL    PRDEC_DEHL
       0479                     DIR6:
000379 0479 CD5A05          17      CALL    PRTTMS
                                
       047C                     LTNL:
00037C 047C 1E0D             7      LD  E,00DH
00037E 047E CD6E08          17      CALL    _PRINT
000381 0481 1E0A             7      LD  E,00AH
000383 0483 C36E08          10      JP  _PRINT
                                
       0486                     C_PATH:
000386 0486 CD9D09          17      CALL    SPCUT
000389 0489 FE21             7      CP  021H
00038B 048B 301C            12      JR  NC,CPATH0
                                
00038D 048D 21A80C          10      LD  HL,N_PATH
000390 0490 11AD0C          10      LD  DE,V_PATH
000393 0493 0640             7      LD  B,PATHX
000395 0495 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000397 0497 CD0500          17      CALL    SYSTEM
00039A 049A 21AD0C          10      LD  HL,V_PATH
       049D                     CPATHP:
00039D 049D 7E               7      LD  A,(HL)
00039E 049E 23               6      INC HL
00039F 049F FE20             7      CP  020H
0003A1 04A1 3F               4      CCF
0003A2 04A2 30D8            12      JR  NC,LTNL
0003A4 04A4 CD7F08          17      CALL    MSG_A
0003A7 04A7 18F4            12      JR  CPATHP
       04A9                     CPATH0:
0003A9 04A9 21AD0C          10      LD  HL,V_PATH
0003AC 04AC FE3B             7      CP  ';'
0003AE 04AE 2001            12      JR  NZ,CPATH1
0003B0 04B0 13               6      INC DE
       04B1                     CPATH1:
0003B1 04B1 EB               4      EX  DE,HL
0003B2 04B2 014000          10      LD  BC,PATHX
0003B5 04B5 EDB0                    LDIR
                                
0003B7 04B7 21A80C          10      LD  HL,N_PATH
0003BA 04BA 11AD0C          10      LD  DE,V_PATH
0003BD 04BD 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0003BF 04BF C30500          10      JP  SYSTEM
                                
       04C2                     PUTDRV:
0003C2 04C2 3ADF0D          13      LD  A,(FDRV)
0003C5 04C5 B7               4      OR  A
0003C6 04C6 200C            12      JR  NZ,PUTDRV1
0003C8 04C8 C5              11      PUSH    BC
0003C9 04C9 D5              11      PUSH    DE
0003CA 04CA E5              11      PUSH    HL
0003CB 04CB 0E19             7      LD  C,019H
0003CD 04CD CD0500          17      CALL    SYSTEM
0003D0 04D0 E1              10      POP HL
0003D1 04D1 D1              10      POP DE
0003D2 04D2 C1              10      POP BC
0003D3 04D3 3C               4      INC A
       04D4                     PUTDRV1:
0003D4 04D4 C640             7      ADD A,'A'-1
0003D6 04D6 CD7F08          17      CALL    MSG_A
0003D9 04D9 3E3A             7      LD  A,':'
       04DB                     MSG_AR:
0003DB 04DB C37F08          10      JP  MSG_A
                                
       04DE                     PRDEC_HL:
0003DE 04DE AF               4      XOR A
       04DF                     PRDEC_AHL:
0003DF 04DF 5F               4      LD  E,A
0003E0 04E0 1600             7      LD  D,0
       04E2                     PRDEC_DEHL:
0003E2 04E2 3E02             7      LD  A,2
0003E4 04E4 322D05          13      LD  (DEC6+1),A
0003E7 04E7 AF               4      XOR A
0003E8 04E8 E5              11      PUSH    HL
0003E9 04E9 21D90D          10      LD  HL,DECBF
0003EC 04EC 0605             7      LD  B,5
0003EE 04EE CD6409          17      CALL    FILL_MEMORY
0003F1 04F1 E1              10      POP HL
                                
0003F2 04F2 0E20             7      LD  C,32
       04F4                     DEC1:
0003F4 04F4 29              11      ADD HL,HL
0003F5 04F5 EB               4      EX  DE,HL
0003F6 04F6 ED6A            15      ADC HL,HL
0003F8 04F8 EB               4      EX  DE,HL
0003F9 04F9 E5              11      PUSH    HL
0003FA 04FA 21DD0D          10      LD  HL,DECBF+4
0003FD 04FD 0605             7      LD  B,5
       04FF                     DEC2:
0003FF 04FF 7E               7      LD  A,(HL)
000400 0500 8F               4      ADC A,A
000401 0501 27               4      DAA
000402 0502 77               7      LD  (HL),A
000403 0503 2B               6      DEC HL
000404 0504 10F9            13      DJNZ    DEC2
000406 0506 E1              10      POP HL
000407 0507 0D               4      DEC C
000408 0508 20EA            12      JR  NZ,DEC1
                                
00040A 050A 21D90D          10      LD  HL,DECBF
00040D 050D 3E20             7      LD  A,020H
00040F 050F 0604             7      LD  B,4
       0511                     DEC3:
000411 0511 CD1E05          17      CALL    DEC4
000414 0514 CD1E05          17      CALL    DEC4
000417 0517 23               6      INC HL
000418 0518 10F7            13      DJNZ    DEC3
       051A                     DECX:
00041A 051A CD1E05          17      CALL    DEC4
00041D 051D AF               4      XOR A
       051E                     DEC4:
00041E 051E ED6F            18      RLD
000420 0520 FE20             7      CP  020H
000422 0522 2808            12      JR  Z,DEC6
000424 0524 F630             7      OR  030H
       0526                     DEC5:
000426 0526 18B3            12      JR  MSG_AR
       0528                     DEC7:
000428 0528 3E20             7      LD  A,020H
00042A 052A 18AF            12      JR  MSG_AR
       052C                     DEC6:
00042C 052C 3E02             7      LD  A,2
00042E 052E B7               4      OR  A
00042F 052F 28F7            12      JR  Z,DEC7
000431 0531 3D               4      DEC A
000432 0532 322D05          13      LD  (DEC6+1),A
000435 0535 3E20             7      LD  A,020H
000437 0537 C9              10      RET
                                
       0538                     FPRNT:
000438 0538 0608             7      LD  B,8
00043A 053A CD4B05          17      CALL    P_N1
00043D 053D 7E               7      LD  A,(HL)
00043E 053E C680             7      ADD A,0A0H-020H
000440 0540 FEA0             7      CP  0A0H
000442 0542 2802            12      JR  Z,FPR1
000444 0544 3E2E             7      LD  A,'.'
       0546                     FPR1:
000446 0546 CD7F08          17      CALL    MSG_A
000449 0549 0603             7      LD  B,3
                                
       054B                     P_N1:
00044B 054B C5              11      PUSH    BC
00044C 054C E5              11      PUSH    HL
00044D 054D 7E               7      LD  A,(HL)
00044E 054E CDBC09          17      CALL    CAP3
000451 0551 CD7F08          17      CALL    MSG_A
000454 0554 E1              10      POP HL
000455 0555 C1              10      POP BC
000456 0556 23               6      INC HL
000457 0557 10F2            13      DJNZ    P_N1
000459 0559 C9              10      RET
                                
       055A                     PRTTMS:
00045A 055A 3E20             7      LD  A,020H
00045C 055C CD7F08          17      CALL    MSG_A
                                
00045F 055F 2AC20D          16      LD  HL,(DTA_CCP+1+24)
000462 0562 7D               4      LD  A,L
000463 0563 B7               4      OR  A
000464 0564 C8              11      RET Z
000465 0565 CB3C             8      SRL H
000467 0567 17               4      RLA
000468 0568 17               4      RLA
000469 0569 17               4      RLA
00046A 056A 17               4      RLA
00046B 056B E60F             7      AND 00FH
00046D 056D 57               4      LD  D,A
00046E 056E DD21F20C        14      LD  IX,V_DATE
       0572                     PRTTMS1:
000472 0572 DD7E00          19      LD  A,(IX+0)
000475 0575 B7               4      OR  A
000476 0576 2808            12      JR  Z,PRTTMS2
000478 0578 CDFB05          17      CALL    PR_DATE
00047B 057B CD6606          17      CALL    PR_DATE_SPLITER
00047E 057E 18F2            12      JR  PRTTMS1
       0580                     PRTTMS2:
                                
000480 0580 CD5E0A          17      CALL    GET_WIDTH
000483 0583 FE21             7      CP  32+1
000485 0585 3005            12      JR  NC,SHOW_TIME
000487 0587 3E1D             7      LD  A,01DH
000489 0589 C37F08          10      JP  MSG_A
       058C                     SHOW_TIME:
00048C 058C 2AC00D          16      LD  HL,(DTA_CCP+1+22)
                                
00048F 058F 3E20             7      LD  A,020H
000491 0591 CD7F08          17      CALL    MSG_A
000494 0594 7C               4      LD  A,H
000495 0595 65               4      LD  H,L
000496 0596 1F               4      RRA
000497 0597 CB1D             8      RR  L
000499 0599 1F               4      RRA
00049A 059A CB1D             8      RR  L
00049C 059C 1F               4      RRA
00049D 059D CB1D             8      RR  L
00049F 059F E61F             7      AND 01FH
0004A1 05A1 4F               4      LD  C,A
0004A2 05A2 3A070D          13      LD  A,(V_TIME)
0004A5 05A5 FE31             7      CP  '1'
0004A7 05A7 79               4      LD  A,C
0004A8 05A8 200B            12      JR  NZ,TIME24
0004AA 05AA FE0C             7      CP  12
0004AC 05AC 3802            12      JR  C,TIME12
0004AE 05AE D60C             7      SUB 12
       05B0                     TIME12:
0004B0 05B0 B7               4      OR  A
0004B1 05B1 2002            12      JR  NZ,TIME24
0004B3 05B3 C60C             7      ADD A,12
       05B5                     TIME24:
0004B5 05B5 C5              11      PUSH    BC
0004B6 05B6 CDE605          17      CALL    PRDEC_A
0004B9 05B9 3E3A             7      LD  A,':'
0004BB 05BB CD7F08          17      CALL    MSG_A
0004BE 05BE 7D               4      LD  A,L
0004BF 05BF 0F               4      RRCA
0004C0 05C0 0F               4      RRCA
0004C1 05C1 E63F             7      AND 03FH
0004C3 05C3 CDE605          17      CALL    PRDEC_A
                                
0004C6 05C6 3E3A             7      LD  A,':'
0004C8 05C8 CD7F08          17      CALL    MSG_A
0004CB 05CB 7C               4      LD  A,H
0004CC 05CC E61F             7      AND 01FH
0004CE 05CE 87               4      ADD A,A
0004CF 05CF CDE605          17      CALL    PRDEC_A
                                
0004D2 05D2 3A070D          13      LD  A,(V_TIME)
0004D5 05D5 FE31             7      CP  '1'
0004D7 05D7 C1              10      POP BC
0004D8 05D8 C0              11      RET NZ
0004D9 05D9 79               4      LD  A,C
0004DA 05DA 1E61             7      LD  E,'a'
0004DC 05DC FE0C             7      CP  12
0004DE 05DE DA6E08          10      JP  C,_PRINT
0004E1 05E1 1E70             7      LD  E,'p'
0004E3 05E3 C36E08          10      JP  _PRINT
                                
                                ;   PRINT10
                                
       05E6                     PRDEC_A:
0004E6 05E6 E5              11      PUSH    HL
0004E7 05E7 0608             7      LD  B,8
0004E9 05E9 4F               4      LD  C,A
0004EA 05EA AF               4      XOR A
       05EB                     PRTA1:
0004EB 05EB CB01             4      RLC C
0004ED 05ED 8F               4      ADC A,A
0004EE 05EE 27               4      DAA
0004EF 05EF 10FA            13      DJNZ    PRTA1
0004F1 05F1 21D90D          10      LD  HL,DECBF
0004F4 05F4 77               7      LD  (HL),A
0004F5 05F5 AF               4      XOR A
0004F6 05F6 CD1A05          17      CALL    DECX
0004F9 05F9 E1              10      POP HL
0004FA 05FA C9              10      RET
                                
       05FB                     PR_DATE:
0004FB 05FB DD7E00          19      LD  A,(IX+0)
0004FE 05FE FE20             7      CP  020H
000500 0600 D8              11      RET C
000501 0601 CDB009          17      CALL    CAP
000504 0604 FE44             7      CP  'D'
000506 0606 2848            12      JR  Z,PR_DAY
000508 0608 FE4D             7      CP  'M'
00050A 060A 2820            12      JR  Z,PR_MONTH
00050C 060C FE59             7      CP  'Y'
00050E 060E 2046            12      JR  NZ,PR_DATE1
000510 0610 4F               4      LD  C,A
000511 0611 DD7E02          19      LD  A,(IX+2)
000514 0614 CDB009          17      CALL    CAP
000517 0617 B9               4      CP  C
000518 0618 200A            12      JR  NZ,YEAR2
00051A 061A 7C               4      LD  A,H     ;YEAR
00051B 061B C6EC             7      ADD A,80+256-100
00051D 061D 3E13             7      LD  A,19
00051F 061F CE00             7      ADC A,0
000521 0621 CDE605          17      CALL    PRDEC_A     ;年4桁
       0624                     YEAR2:
000524 0624 7C               4      LD  A,H     ;YEAR
000525 0625 C650             7      ADD A,80
000527 0627 CDE605          17      CALL    PRDEC_A
00052A 062A 182A            12      JR  PR_DATE1
       062C                     PR_MONTH:
00052C 062C 4F               4      LD  C,A
00052D 062D DD7E02          19      LD  A,(IX+2)
000530 0630 CDB009          17      CALL    CAP
000533 0633 B9               4      CP  C
000534 0634 2014            12      JR  NZ,MONTH2
000536 0636 E5              11      PUSH    HL      ;月を文字列で表示 Jan等
000537 0637 D5              11      PUSH    DE
000538 0638 7A               4      LD  A,D
000539 0639 3D               4      DEC A
00053A 063A 87               4      ADD A,A
00053B 063B 87               4      ADD A,A
00053C 063C 21310C          10      LD  HL,S_MONTH
00053F 063F 1600             7      LD  D,0
000541 0641 5F               4      LD  E,A
000542 0642 19              11      ADD HL,DE
000543 0643 CD4E04          17      CALL    MSX
000546 0646 D1              10      POP DE
000547 0647 E1              10      POP HL
000548 0648 180C            12      JR  PR_DATE1
       064A                     MONTH2:
00054A 064A 7A               4      LD  A,D     ;月を数字で表示
00054B 064B CDE605          17      CALL    PRDEC_A
00054E 064E 1806            12      JR  PR_DATE1
       0650                     PR_DAY:
000550 0650 7D               4      LD  A,L
000551 0651 E61F             7      AND 01FH
000553 0653 CDE605          17      CALL    PRDEC_A
       0656                     PR_DATE1:
000556 0656 DD23            10      INC IX
000558 0658 DD7E00          19      LD  A,(IX+0)
00055B 065B CDB009          17      CALL    CAP
00055E 065E FE41             7      CP  'A'
000560 0660 D8              11      RET C
000561 0661 FE5B             7      CP  'Z'+1
000563 0663 38F1            12      JR  C,PR_DATE1
000565 0665 C9              10      RET
       0666                     PR_DATE_SPLITER:
000566 0666 DD7E00          19      LD  A,(IX+0)
000569 0669 FE20             7      CP  020H
00056B 066B D8              11      RET C
00056C 066C DD23            10      INC IX
00056E 066E C37F08          10      JP  MSG_A
                                
       0671                     SETFCB:
000571 0671 CD9D09          17      CALL    SPCUT
000574 0674 1A               7      LD  A,(DE)
000575 0675 FE20             7      CP  020H
000577 0677 3801            12      JR  C,SETFCBA
000579 0679 1B               6      DEC DE
       067A                     SETFCBA:
00057A 067A D5              11      PUSH    DE
00057B 067B 215C00          10      LD  HL,FCB1
00057E 067E 115D00          10      LD  DE,FCB1+1
000581 0681 012300          10      LD  BC,00023H
000584 0684 70               7      LD  (HL),B      ;B=0
000585 0685 EDB0                    LDIR
000587 0687 D1              10      POP DE
000588 0688 D5              11      PUSH    DE
000589 0689 215C00          10      LD  HL,FCB1
00058C 068C CD410A          17      CALL    _SYS29      ;ファイル名の解析
00058F 068F 216C00          10      LD  HL,FCB2
000592 0692 CD410A          17      CALL    _SYS29      ;ファイル名の解析
000595 0695 E1              10      POP HL
000596 0696 010050          10      LD  BC,05000H
000599 0699 118100          10      LD  DE,00081H
       069C                     SETFCB1:
00059C 069C 7E               7      LD  A,(HL)
00059D 069D 23               6      INC HL
00059E 069E FE20             7      CP  020H
0005A0 06A0 3805            12      JR  C,SETFCB2
0005A2 06A2 12               7      LD  (DE),A
0005A3 06A3 13               6      INC DE
0005A4 06A4 0C               4      INC C
0005A5 06A5 10F5            13      DJNZ    SETFCB1
       06A7                     SETFCB2:
0005A7 06A7 79               4      LD  A,C
0005A8 06A8 328000          13      LD  (DTA1),A
0005AB 06AB 04               4      INC B
0005AC 06AC AF               4      XOR A
       06AD                     SETFCB3:
0005AD 06AD 12               7      LD  (DE),A
0005AE 06AE 13               6      INC DE
0005AF 06AF 10FC            13      DJNZ    SETFCB3
0005B1 06B1 C9              10      RET
                                
       06B2                     C_COPY:
0005B2 06B2 CD7106          17      CALL    SETFCB
                                
0005B5 06B5 11050E          10      LD  DE,ZERO
0005B8 06B8 CDB808          17      CALL    FILEC2
0005BB 06BB 216C00          10      LD  HL,FCB2
0005BE 06BE CD480A          17      CALL    S29X1
                                
0005C1 06C1 3E10             7      LD  A,010H
0005C3 06C3 326900          13      LD  (FCB1+13),A
0005C6 06C6 216D00          10      LD  HL,FCB2+1
0005C9 06C9 CD5308          17      CALL    CWILD1
       06CC                     COPY0:
0005CC 06CC CD5008          17      CALL    CWILD
0005CF 06CF 215C00          10      LD  HL,FCB1
0005D2 06D2 CD4602          17      CALL    OPEN
0005D5 06D5 37               4      SCF
       06D6                     COPY1:
0005D6 06D6 C0              11      RET NZ
0005D7 06D7 CD6C02          17      CALL    DEFCB
                                
0005DA 06DA 3AB60D          13      LD  A,(DTA_CCP+13)
0005DD 06DD CB67             8      BIT 4,A
0005DF 06DF 2823            12      JR  Z,COPY1A
                                
0005E1 06E1 215D00          10      LD  HL,FCB1+1
0005E4 06E4 CDE909          17      CALL    CHKWILD
0005E7 06E7 3816            12      JR  C,COPY9
                                
0005E9 06E9 3E20             7      LD  A,020H
0005EB 06EB 325D00          13      LD  (FCB1+1),A
0005EE 06EE 2AC30D          16      LD  HL,(DTA_CCP+26)
0005F1 06F1 23               6      INC HL
0005F2 06F2 226A00          16      LD  (FCB1+14),HL
0005F5 06F5 18D5            12      JR  COPY0
                                
       06F7                     COPY8:
0005F7 06F7 0E09             7      LD  C,9     ;(BDOS)文字列出力
0005F9 06F9 CD0500          17      CALL    SYSTEM
0005FC 06FC CD7C04          17      CALL    LTNL
       06FF                     COPY9:
0005FF 06FF CD6802          17      CALL    OPEN2
000602 0702 18D2            12      JR  COPY1
                                
       0704                     COPY1A:
000604 0704 216C00          10      LD  HL,FCB2
000607 0707 11DF0D          10      LD  DE,FDRV
00060A 070A 01AB0D          10      LD  BC,DTA_CCP+2
00060D 070D EDA0            16      LDI
00060F 070F 3E0B             7      LD  A,11
       0711                     COPY2:
000611 0711 F5              11      PUSH    AF
000612 0712 7E               7      LD  A,(HL)
000613 0713 FE3F             7      CP  '?'
000615 0715 2001            12      JR  NZ,COPY3
000617 0717 0A               7      LD  A,(BC)
       0718                     COPY3:
000618 0718 12               7      LD  (DE),A
000619 0719 03               6      INC BC
00061A 071A 13               6      INC DE
00061B 071B 23               6      INC HL
00061C 071C F1              10      POP AF
00061D 071D 3D               4      DEC A
00061E 071E 20F1            12      JR  NZ,COPY2
000620 0720 010500          10      LD  BC,16-11
000623 0723 EDB0                    LDIR
       0725                     PUTNAME:
000625 0725 215D00          10      LD  HL,FCB1+1
000628 0728 CDE909          17      CALL    CHKWILD
00062B 072B 300B            12      JR  NC,PUTN1
00062D 072D 21E00D          10      LD  HL,FDRV+1
000630 0730 CD3805          17      CALL    FPRNT
000633 0733 3E20             7      LD  A,020H
000635 0735 CD7F08          17      CALL    MSG_A
       0738                     PUTN1:
000638 0738 11DF0D          10      LD  DE,FDRV
00063B 073B 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
00063D 073D CD9802          17      CALL    SYSTEM0
000640 0740 C2DE07          10      JP  NZ,COPYE2
000643 0743 67               4      LD  H,A     ;A=0
000644 0744 6F               4      LD  L,A
000645 0745 22000E          16      LD  (FDRV+33),HL    ;(FCB)ランダム・レコード
000648 0748 22020E          16      LD  (FDRV+35),HL
00064B 074B 2C               4      INC L       ;HL=1
00064C 074C 22ED0D          16      LD  (FDRV+14),HL    ;(FCB)レコード・サイズ
       074F                     COPY6:
00064F 074F CD6208          17      CALL    BUFSIZ
000652 0752 CDB802          17      CALL    S27DTA
000655 0755 3C               4      INC A
000656 0756 287E            12      JR  Z,COPYE
000658 0758 47               4      LD  B,A
000659 0759 7C               4      LD  A,H
00065A 075A B5               4      OR  L
00065B 075B 280F            12      JR  Z,COPY7
00065D 075D 11DF0D          10      LD  DE,FDRV
000660 0760 C5              11      PUSH    BC
000661 0761 0E26             7      LD  C,026H      ;(BDOS)ランダム・ブロック・ライト
000663 0763 CD0500          17      CALL    SYSTEM
000666 0766 C1              10      POP BC
000667 0767 B7               4      OR  A
000668 0768 206C            12      JR  NZ,COPYE
00066A 076A 10E3            13      DJNZ    COPY6
       076C                     COPY7:
00066C 076C 3A0C0D          13      LD  A,(MAJOR_VER)
00066F 076F FE02             7      CP  2
000671 0771 3011            12      JR  NC,COPY7_MSX2   ;DOS2はFCBの仕様が違う
000673 0773 3AB60D          13      LD  A,(DTA_CCP+13)  ;(FCB)属性(アトリビュート)
000676 0776 32EC0D          13      LD  (FDRV+13),A ;(FCB)属性(アトリビュート)
000679 0779 21BD0D          10      LD  HL,DTA_CCP+20
00067C 077C 11F30D          10      LD  DE,FDRV+20  ;(FCB)更新日時
00067F 077F 010400          10      LD  BC,4
000682 0782 EDB0                    LDIR
       0784                     COPY7_MSX2:
000684 0784 11DF0D          10      LD  DE,FDRV
000687 0787 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
000689 0789 CD9802          17      CALL    SYSTEM0
                                
00068C 078C 2048            12      JR  NZ,COPYE
00068E 078E 3A0C0D          13      LD  A,(MAJOR_VER)
000691 0791 FE02             7      CP  2
000693 0793 383B            12      JR  C,COPY_DOS2DT
                                
000695 0795 11A90D          10      LD  DE,DTA_CCP
000698 0798 218D0D          10      LD  HL,DOS2NAME
00069B 079B CDE007          17      CALL    FCB2FNAME
                                
00069E 079E 11DF0D          10      LD  DE,FDRV
0006A1 07A1 219B0D          10      LD  HL,DOS2NAME2
0006A4 07A4 CDE007          17      CALL    FCB2FNAME
                                
0006A7 07A7 118D0D          10      LD  DE,DOS2NAME
0006AA 07AA AF               4      XOR A
0006AB 07AB 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
0006AD 07AD CD9802          17      CALL    SYSTEM0
                                
0006B0 07B0 119B0D          10      LD  DE,DOS2NAME2
0006B3 07B3 3E01             7      LD  A,1
0006B5 07B5 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
0006B7 07B7 CD9802          17      CALL    SYSTEM0
                                
0006BA 07BA 118D0D          10      LD  DE,DOS2NAME
0006BD 07BD AF               4      XOR A
0006BE 07BE 0E51             7      LD  C,51H       ;(BDOS)_FTIME ファイルの日付および時刻の獲得・設定
0006C0 07C0 CD9802          17      CALL    SYSTEM0
                                
0006C3 07C3 D5              11      PUSH    DE
0006C4 07C4 DDE1            14      POP IX
                                
0006C6 07C6 119B0D          10      LD  DE,DOS2NAME2
0006C9 07C9 3E01             7      LD  A,1
0006CB 07CB 0E51             7      LD  C,51H       ;(BDOS)_FTIME ファイルの日付および時刻の獲得・設定
0006CD 07CD CD9802          17      CALL    SYSTEM0
       07D0                     COPY_DOS2DT:
0006D0 07D0 11070C          10      LD  DE,OK
0006D3 07D3 C3F706          10      JP  COPY8
                                
       07D6                     COPYE:
0006D6 07D6 11DF0D          10      LD  DE,FDRV
0006D9 07D9 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0006DB 07DB CD0500          17      CALL    SYSTEM
       07DE                     COPYE2:
0006DE 07DE 37               4      SCF
0006DF 07DF C9              10      RET
                                
       07E0                     FCB2FNAME:
0006E0 07E0 1A               7      LD  A,(DE)
0006E1 07E1 13               6      INC DE
0006E2 07E2 C640             7      ADD A,'@'
0006E4 07E4 77               7      LD  (HL),A
0006E5 07E5 23               6      INC HL
0006E6 07E6 363A            10      LD  (HL),':'
0006E8 07E8 23               6      INC HL
                                
0006E9 07E9 0608             7      LD  B,8
       07EB                     FCB2FNAME1:
0006EB 07EB 1A               7      LD  A,(DE)
0006EC 07EC FE21             7      CP  020H+1
0006EE 07EE 3807            12      JR  C,FCB2FNAME2
0006F0 07F0 13               6      INC DE
0006F1 07F1 77               7      LD  (HL),A
0006F2 07F2 23               6      INC HL
0006F3 07F3 10F6            13      DJNZ    FCB2FNAME1
0006F5 07F5 1803            12      JR  FCB2FNAME3
       07F7                     FCB2FNAME2:
0006F7 07F7 13               6      INC DE
0006F8 07F8 10FD            13      DJNZ    FCB2FNAME2
       07FA                     FCB2FNAME3:
0006FA 07FA 1A               7      LD  A,(DE)
0006FB 07FB FE21             7      CP  020H+1
0006FD 07FD 380F            12      JR  C,FCB2FNAME5
0006FF 07FF 362E            10      LD  (HL),'.'
000701 0801 23               6      INC HL
000702 0802 0603             7      LD  B,3
       0804                     FCB2FNAME4:
000704 0804 1A               7      LD  A,(DE)
000705 0805 13               6      INC DE
000706 0806 FE21             7      CP  020H+1
000708 0808 3804            12      JR  C,FCB2FNAME5
00070A 080A 77               7      LD  (HL),A
00070B 080B 23               6      INC HL
00070C 080C 10F6            13      DJNZ    FCB2FNAME4
       080E                     FCB2FNAME5:
00070E 080E 3600            10      LD  (HL),0
000710 0810 C9              10      RET
                                
       0811                     C_TYPE:
000711 0811 CD7106          17      CALL    SETFCB
000714 0814 215C00          10      LD  HL,FCB1
000717 0817 CD4602          17      CALL    OPEN
00071A 081A 37               4      SCF
       081B                     TYPE1:
00071B 081B C0              11      RET NZ
00071C 081C CD6C02          17      CALL    DEFCB
00071F 081F 3E1A             7      LD  A,01AH
000721 0821 CD7F08          17      CALL    MSG_A
       0824                     TYPE2:
000724 0824 CD6208          17      CALL    BUFSIZ
000727 0827 CDB802          17      CALL    S27DTA
00072A 082A C6FE             7      ADD A,0FEH
00072C 082C D8              11      RET C
00072D 082D 7C               4      LD  A,H
00072E 082E B5               4      OR  L
00072F 082F 281A            12      JR  Z,TYPEE
000731 0831 010080          10      LD  BC,DATA
       0834                     TYPE3:
000734 0834 0A               7      LD  A,(BC)
000735 0835 03               6      INC BC
000736 0836 FE1A             7      CP  01AH
000738 0838 2811            12      JR  Z,TYPEE
00073A 083A 5F               4      LD  E,A
00073B 083B C5              11      PUSH    BC
00073C 083C E5              11      PUSH    HL
00073D 083D 0E02             7      LD  C,2     ;(BDOS)コンソール出力
00073F 083F CD0500          17      CALL    SYSTEM
000742 0842 E1              10      POP HL
000743 0843 C1              10      POP BC
000744 0844 2B               6      DEC HL
000745 0845 7C               4      LD  A,H
000746 0846 B5               4      OR  L
000747 0847 20EB            12      JR  NZ,TYPE3
000749 0849 18D9            12      JR  TYPE2
       084B                     TYPEE:
00074B 084B CD6802          17      CALL    OPEN2
00074E 084E 18CB            12      JR  TYPE1
                                
       0850                     CWILD:
000750 0850 215D00          10      LD  HL,FCB1+1
       0853                     CWILD1:
000753 0853 7E               7      LD  A,(HL)
000754 0854 FE20             7      CP  020H
000756 0856 C0              11      RET NZ
       0857                     CWILD2:
000757 0857 54               4      LD  D,H
000758 0858 5D               4      LD  E,L
000759 0859 13               6      INC DE
00075A 085A 010A00          10      LD  BC,10
00075D 085D 363F            10      LD  (HL),'?'
00075F 085F EDB0                    LDIR
000761 0861 C9              10      RET
                                
       0862                     BUFSIZ:
000762 0862 3A0700          13      LD  A,(SYSTEM+2)
000765 0865 D681             7      SUB (DATA/256)+1
000767 0867 E6F8             7      AND 0F8H
000769 0869 67               4      LD  H,A
00076A 086A 2E00             7      LD  L,0
00076C 086C C9              10      RET
                                
00076D 086D E9               4  JP_HL:  JP  (HL)
                                
       086E                     _PRINT:
00076E 086E C5              11      PUSH    BC
00076F 086F D5              11      PUSH    DE
000770 0870 E5              11      PUSH    HL
000771 0871 DDE5            15      PUSH    IX
000773 0873 0E06             7      LD  C,6
000775 0875 CD0500          17      CALL    SYSTEM
000778 0878 DDE1            14      POP IX
00077A 087A E1              10      POP HL
00077B 087B D1              10      POP DE
00077C 087C C1              10      POP BC
00077D 087D B7               4      OR  A
00077E 087E C9              10      RET
                                
       087F                     MSG_A:
00077F 087F F5              11      PUSH    AF
000780 0880 C5              11      PUSH    BC
000781 0881 D5              11      PUSH    DE
000782 0882 E5              11      PUSH    HL
000783 0883 DDE5            15      PUSH    IX
000785 0885 5F               4      LD  E,A
000786 0886 0E02             7      LD  C,2
000788 0888 CD0500          17      CALL    SYSTEM
00078B 088B DDE1            14      POP IX
00078D 088D E1              10      POP HL
00078E 088E D1              10      POP DE
00078F 088F C1              10      POP BC
000790 0890 F1              10      POP AF
000791 0891 C9              10      RET
                                ;       FILE
       0892                     FILEC_D2:       ;DOS2対応
000792 0892 3A0C0D          13      LD  A,(MAJOR_VER)
000795 0895 FE02             7      CP  2
000797 0897 381C            12      JR  C,FILEC
000799 0899 C5              11      PUSH    BC
00079A 089A D5              11      PUSH    DE
00079B 089B E5              11      PUSH    HL
00079C 089C CD9D09          17      CALL    SPCUT
00079F 089F 214D0D          10      LD  HL,PATH_CCP
0007A2 08A2 0640             7      LD  B,64
       08A4                     PATHCD1:
0007A4 08A4 1A               7      LD  A,(DE)
0007A5 08A5 13               6      INC DE
0007A6 08A6 FE20             7      CP  020H
0007A8 08A8 3002            12      JR  NC,PATHCD2
0007AA 08AA 3E00             7      LD  A,0
       08AC                     PATHCD2:
0007AC 08AC 77               7      LD  (HL),A
0007AD 08AD 3803            12      JR  C,PATHCD3
0007AF 08AF 23               6      INC HL
0007B0 08B0 10F2            13      DJNZ    PATHCD1
       08B2                     PATHCD3:
0007B2 08B2 E1              10      POP HL
0007B3 08B3 D1              10      POP DE
0007B4 08B4 C1              10      POP BC
       08B5                     FILEC:
0007B5 08B5 CDC008          17      CALL    FILE
       08B8                     FILEC2:
0007B8 08B8 3AE00D          13      LD  A,(FDRV+1)
0007BB 08BB FE20             7      CP  020H
0007BD 08BD C8              11      RET Z
0007BE 08BE 1839            12      JR  SETDIR1
                                
       08C0                     FILE:
0007C0 08C0 AF               4      XOR A
0007C1 08C1 32DF0D          13      LD  (FDRV),A
0007C4 08C4 67               4      LD  H,A
0007C5 08C5 6F               4      LD  L,A
0007C6 08C6 22ED0D          16      LD  (FDRV+14),HL
0007C9 08C9 CD9D09          17      CALL    SPCUT
0007CC 08CC CD8209          17      CALL    CCHK3
0007CF 08CF 2812            12      JR  Z,DEVI1
0007D1 08D1 13               6      INC DE
0007D2 08D2 1A               7      LD  A,(DE)
0007D3 08D3 1B               6      DEC DE
0007D4 08D4 FE3A             7      CP  ':'
0007D6 08D6 200B            12      JR  NZ,DEVI1
0007D8 08D8 1A               7      LD  A,(DE)      ;DRIVE
0007D9 08D9 CDB009          17      CALL    CAP
0007DC 08DC D640             7      SUB '@'
0007DE 08DE 13               6      INC DE
0007DF 08DF 13               6      INC DE
0007E0 08E0 32DF0D          13      LD  (FDRV),A
       08E3                     DEVI1:
0007E3 08E3 1A               7      LD  A,(DE)
0007E4 08E4 D65C             7      SUB 05CH        ;\
0007E6 08E6 2009            12      JR  NZ,NOROOT
0007E8 08E8 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
0007E9 08E9 22F90D          16      LD  (FDRV+26),HL
0007EC 08EC 2C               4      INC L
0007ED 08ED 22ED0D          16      LD  (FDRV+14),HL
0007F0 08F0 13               6      INC DE
       08F1                     NOROOT:
                                
       08F1                     SETDIR:
0007F1 08F1 CD2209          17      CALL    FILED
0007F4 08F4 1A               7      LD  A,(DE)
0007F5 08F5 FE5C             7      CP  05CH        ;\
0007F7 08F7 C0              11      RET NZ
0007F8 08F8 13               6      INC DE
       08F9                     SETDIR1:
0007F9 08F9 3A0C0D          13      LD  A,(MAJOR_VER)
0007FC 08FC FE01             7      CP  1
0007FE 08FE C0              11      RET NZ
                                                ;for LSX-Dodgers
0007FF 08FF 3E10             7      LD  A,010H      ;Directory
000801 0901 32EC0D          13      LD  (FDRV+13),A
000804 0904 D5              11      PUSH    DE
000805 0905 11DF0D          10      LD  DE,FDRV
000808 0908 0E0F             7      LD  C,00FH
00080A 090A CD0500          17      CALL    SYSTEM
00080D 090D D1              10      POP DE
00080E 090E B7               4      OR  A
00080F 090F C0              11      RET NZ
                                
000810 0910 3AEC0D          13      LD  A,(FDRV+13)
000813 0913 CB67             8      BIT 4,A
000815 0915 C8              11      RET Z
                                
000816 0916 CD6909          17      CALL    FILEI
000819 0919 2AF90D          16      LD  HL,(FDRV+26)
00081C 091C 23               6      INC HL
00081D 091D 22ED0D          16      LD  (FDRV+14),HL
000820 0920 18CF            12      JR  SETDIR
                                
       0922                     FILED:
000822 0922 CD6909          17      CALL    FILEI
                                
000825 0925 0608             7      LD  B,8
       0927                     FILE2:
000827 0927 CD7709          17      CALL    CCHKF
00082A 092A C8              11      RET Z
00082B 092B FE2A             7      CP  '*'
00082D 092D 282E            12      JR  Z,FILE9
00082F 092F FE2E             7      CP  '.'
000831 0931 280C            12      JR  Z,FILE4
000833 0933 77               7      LD  (HL),A
000834 0934 23               6      INC HL
000835 0935 10F0            13      DJNZ    FILE2
                                
       0937                     FILE3:
000837 0937 CD7709          17      CALL    CCHKF
00083A 093A C8              11      RET Z
00083B 093B FE2E             7      CP  '.'
00083D 093D 20F8            12      JR  NZ,FILE3
                                
       093F                     FILE4:
00083F 093F 21E80D          10      LD  HL,FNAME+8
000842 0942 0603             7      LD  B,3
                                
       0944                     FILE4L:
000844 0944 CD7709          17      CALL    CCHKF
000847 0947 C8              11      RET Z
000848 0948 FE2E             7      CP  '.'
00084A 094A 2008            12      JR  NZ,FILE12
00084C 094C 32E00D          13      LD  (FNAME),A   ;Parent directory(..)
00084F 094F 32E10D          13      LD  (FNAME+1),A
000852 0952 3E20             7      LD  A,020H
       0954                     FILE12:
000854 0954 FE2A             7      CP  '*'
000856 0956 280A            12      JR  Z,FILE10
000858 0958 77               7      LD  (HL),A
000859 0959 23               6      INC HL
00085A 095A 10E8            13      DJNZ    FILE4L
00085C 095C C9              10      RET
                                
       095D                     FILE9:              ;名前の*処理、名前の残りを?で埋める
00085D 095D CD6209          17      CALL    FILE10
000860 0960 18D5            12      JR  FILE3
                                
       0962                     FILE10:
000862 0962 3E3F             7      LD  A,'?'
                                
       0964                     FILL_MEMORY:                ;HLからBバイトAで埋める
000864 0964 77               7      LD  (HL),A
000865 0965 23               6      INC HL
000866 0966 10FC            13      DJNZ    FILL_MEMORY
000868 0968 C9              10      RET
                                
       0969                     FILEI:              ;名前＋拡張子をスペースで初期化
000869 0969 3E20             7      LD  A,020H
00086B 096B 01000B          10      LD  BC,11*256
00086E 096E 21E00D          10      LD  HL,FNAME
000871 0971 E5              11      PUSH    HL
000872 0972 CD6409          17      CALL    FILL_MEMORY
000875 0975 E1              10      POP HL
000876 0976 C9              10      RET
                                
       0977                     CCHKF:
000877 0977 1A               7      LD  A,(DE)
000878 0978 CD7F09          17      CALL    CCHK2
00087B 097B C8              11      RET Z
00087C 097C C3D209          10      JP  FKAN
                                
       097F                     CCHK2:
00087F 097F 0C               4      INC C
000880 0980 0D               4      DEC C
000881 0981 C0              11      RET NZ
       0982                     CCHK3:              ;ZF=1 で使えない文字
000882 0982 FE2B             7      CP  '+'
000884 0984 C8              11      RET Z
000885 0985 FE2C             7      CP  ','
000887 0987 C8              11      RET Z
000888 0988 FE2F             7      CP  '/'
00088A 098A C8              11      RET Z
00088B 098B FE3A             7      CP  ':'
00088D 098D C8              11      RET Z
00088E 098E FE3B             7      CP  ';'
000890 0990 C8              11      RET Z
000891 0991 FE3D             7      CP  '='
000893 0993 C8              11      RET Z
000894 0994 FE5C             7      CP  05CH    ;\
000896 0996 C8              11      RET Z
000897 0997 FE20             7      CP  020H
000899 0999 D0              11      RET NC
00089A 099A BF               4      CP  A       ;Z=1
00089B 099B C9              10      RET
                                
       099C                     SS1:
00089C 099C 13               6      INC DE
       099D                     SPCUT:              ;スペースをカット
00089D 099D 1A               7      LD  A,(DE)
00089E 099E FE20             7      CP  020H
0008A0 09A0 28FA            12      JR  Z,SS1
0008A2 09A2 C9              10      RET
                                
       09A3                     TOZERO:
0008A3 09A3 D5              11      PUSH    DE
       09A4                     TZ1:
0008A4 09A4 1A               7      LD  A,(DE)
0008A5 09A5 FE20             7      CP  20H
0008A7 09A7 3803            12      JR  C,TZ2
0008A9 09A9 13               6      INC DE
0008AA 09AA 18F8            12      JR  TZ1
       09AC                     TZ2:
0008AC 09AC AF               4      XOR A
0008AD 09AD 12               7      LD  (DE),A
0008AE 09AE D1              10      POP DE
0008AF 09AF C9              10      RET
                                
       09B0                     CAP:
0008B0 09B0 FE61             7      CP  'a'
0008B2 09B2 D8              11      RET C
0008B3 09B3 FE7B             7      CP  'z'+1
0008B5 09B5 D0              11      RET NC
0008B6 09B6 D620             7      SUB 020H
0008B8 09B8 C9              10      RET
       09B9                     CAP2:
0008B9 09B9 CDB009          17      CALL    CAP
       09BC                     CAP3:
0008BC 09BC CDC509          17      CALL    CAP4
0008BF 09BF FE21             7      CP  021H
0008C1 09C1 D0              11      RET NC
0008C2 09C2 3E20             7      LD  A,020H
0008C4 09C4 C9              10      RET
       09C5                     CAP4:
0008C5 09C5 FE05             7      CP  5
0008C7 09C7 C0              11      RET NZ
0008C8 09C8 3EE5             7      LD  A,0E5H
0008CA 09CA C9              10      RET
                                
       09CB                     FKANC:
0008CB 09CB CB41             8      BIT 0,C
0008CD 09CD CCB909          17      CALL    Z,CAP2
0008D0 09D0 1801            12      JR  FKANX
       09D2                     FKAN:           ;漢字チェック
0008D2 09D2 13               6      INC DE
       09D3                     FKANX:
0008D3 09D3 CB41             8      BIT 0,C
0008D5 09D5 CB81             8      RES 0,C
0008D7 09D7 C0              11      RET NZ
0008D8 09D8 FE80             7      CP  080H
0008DA 09DA D8              11      RET C
0008DB 09DB FEA0             7      CP  0A0H
0008DD 09DD 3803            12      JR  C,FKAN1
0008DF 09DF FEE0             7      CP  0E0H
0008E1 09E1 D8              11      RET C
       09E2                     FKAN1:
0008E2 09E2 0C               4      INC C
0008E3 09E3 A7               4      AND A
0008E4 09E4 C9              10      RET
                                
       09E5                     CHKWILDX:
0008E5 09E5 FDE5            15      PUSH    IY
0008E7 09E7 E1              10      POP HL
0008E8 09E8 23               6      INC HL
       09E9                     CHKWILD:
0008E9 09E9 060B             7      LD  B,11
0008EB 09EB 3E3F             7      LD  A,'?'
       09ED                     CHKWIL1:
0008ED 09ED BE               7      CP  (HL)
0008EE 09EE 23               6      INC HL
0008EF 09EF 37               4      SCF
0008F0 09F0 C8              11      RET Z
0008F1 09F1 10FA            13      DJNZ    CHKWIL1
0008F3 09F3 AF               4      XOR A
0008F4 09F4 C9              10      RET
                                
       09F5                     CPNAME:
0008F5 09F5 C5              11      PUSH    BC
0008F6 09F6 D5              11      PUSH    DE
0008F7 09F7 11CE0D          10      LD  DE,CPBUF
0008FA 09FA 010500          10      LD  BC,5
0008FD 09FD EDB0                    LDIR
0008FF 09FF D1              10      POP DE
000900 0A00 D5              11      PUSH    DE
000901 0A01 E5              11      PUSH    HL
000902 0A02 21CE0D          10      LD  HL,CPBUF
000905 0A05 CD180A          17      CALL    CPFILE
000908 0A08 E1              10      POP HL
000909 0A09 D1              10      POP DE
00090A 0A0A C1              10      POP BC
00090B 0A0B 2005            12      JR  NZ,CPNAME1
00090D 0A0D 7E               7      LD  A,(HL)
00090E 0A0E 23               6      INC HL
00090F 0A0F 66               7      LD  H,(HL)
000910 0A10 6F               4      LD  L,A
000911 0A11 C9              10      RET
       0A12                     CPNAME1:
000912 0A12 23               6      INC HL
000913 0A13 23               6      INC HL
000914 0A14 10DF            13      DJNZ    CPNAME
000916 0A16 37               4      SCF
000917 0A17 C9              10      RET
                                
       0A18                     CPFILE:
000918 0A18 C5              11      PUSH    BC
000919 0A19 01000B          10      LD  BC,00B00H
       0A1C                     CPSTR1:
00091C 0A1C 1A               7      LD  A,(DE)
00091D 0A1D FE3F             7      CP  '?'     ;Wild card
00091F 0A1F 2812            12      JR  Z,CPSTR2
000921 0A21 7E               7      LD  A,(HL)
000922 0A22 CDCB09          17      CALL    FKANC
000925 0A25 E5              11      PUSH    HL
000926 0A26 67               4      LD  H,A
000927 0A27 1A               7      LD  A,(DE)
000928 0A28 CB01             4      RLC C
00092A 0A2A CDCB09          17      CALL    FKANC
00092D 0A2D CB09             4      RRC C
00092F 0A2F BC               4      CP  H       ;CP (HL),(DE)
000930 0A30 E1              10      POP HL
000931 0A31 2004            12      JR  NZ,CPSTR3
       0A33                     CPSTR2:
000933 0A33 13               6      INC DE
000934 0A34 23               6      INC HL
000935 0A35 10E5            13      DJNZ    CPSTR1
       0A37                     CPSTR3:
000937 0A37 C1              10      POP BC
000938 0A38 C9              10      RET
                                
       0A39                     CPFILE2:
000939 0A39 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00093C 0A3C F6E1             7      OR  0E1H
00093E 0A3E 2F               4      CPL
00093F 0A3F A6               7      AND (HL)
000940 0A40 C9              10      RET
                                
       0A41                     _SYS29:     ;(BDOS)ファイル名の解析
000941 0A41 C5              11      PUSH    BC
000942 0A42 E5              11      PUSH    HL
000943 0A43 CDC008          17      CALL    FILE
000946 0A46 E1              10      POP HL
000947 0A47 C1              10      POP BC
       0A48                     S29X1:
000948 0A48 C5              11      PUSH    BC
000949 0A49 D5              11      PUSH    DE
00094A 0A4A E5              11      PUSH    HL
00094B 0A4B EB               4      EX  DE,HL
00094C 0A4C 21DF0D          10      LD  HL,FDRV
00094F 0A4F 010D00          10      LD  BC,13
000952 0A52 EDB0                    LDIR
000954 0A54 70               7      LD  (HL),B      ;B=0
000955 0A55 0E03             7      LD  C,3
000957 0A57 EDB0                    LDIR
000959 0A59 E1              10      POP HL
00095A 0A5A D1              10      POP DE
00095B 0A5B C1              10      POP BC
00095C 0A5C AF               4      XOR A
00095D 0A5D C9              10      RET
       0A5E                     GET_WIDTH:
00095E 0A5E 3A0B0D          13      LD  A,(IS_MSX)
000961 0A61 B7               4      OR  A
000962 0A62 2804            12      JR  Z,NOT_MSX
000964 0A64 3AB0F3          13      LD  A,(LINLEN)
000967 0A67 C9              10      RET
       0A68                     NOT_MSX:
000968 0A68 E5              11      PUSH    HL
000969 0A69 2A0100          16      LD  HL,(1)
00096C 0A6C 2EB1             7      LD  L,0B1H
00096E 0A6E 7E               7      LD  A,(HL)
00096F 0A6F E1              10      POP HL
000970 0A70 C9              10      RET
                                
       0A71                     C_MODE:
000971 0A71 3A0B0D          13      LD  A,(IS_MSX)
000974 0A74 B7               4      OR  A
000975 0A75 C8              11      RET Z
000976 0A76 0E29             7      LD  C,41
000978 0A78 3AF8FA          13      LD  A,(EXBRSA)
00097B 0A7B B7               4      OR  A
00097C 0A7C 2802            12      JR  Z,MODE_MSX1
00097E 0A7E 0E51             7      LD  C,81
       0A80                     MODE_MSX1:
000980 0A80 C5              11      PUSH    BC
000981 0A81 CD720B          17      CALL    GETNUM
000984 0A84 C1              10      POP BC
000985 0A85 7D               4      LD  A,L
000986 0A86 B9               4      CP  C
000987 0A87 301C            12      JR  NC,MODE1
000989 0A89 B7               4      OR  A
00098A 0A8A 2819            12      JR  Z,MODE1
00098C 0A8C FE21             7      CP  33
00098E 0A8E 381E            12      JR  C,MODE32
000990 0A90 32AEF3          13      LD  (LINL40),A
000993 0A93 DD216C00        14      LD  IX,INITXT
000997 0A97 CD9E0A          17      CALL    CALLROM
00099A 0A9A DD217800        14      LD  IX,SETTXT
       0A9E                     CALLROM:
00099E 0A9E FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
0009A2 0AA2 C31C00          10      JP  CALSLT
       0AA5                     MODE1:
0009A5 0AA5 3AB0F3          13      LD  A,(LINLEN)
0009A8 0AA8 CDE605          17      CALL    PRDEC_A
0009AB 0AAB C37C04          10      JP  LTNL
       0AAE                     MODE32:
0009AE 0AAE 32AFF3          13      LD  (LINL32),A
0009B1 0AB1 DD216F00        14      LD  IX,INIT32
0009B5 0AB5 CD9E0A          17      CALL    CALLROM
0009B8 0AB8 DD217B00        14      LD  IX,SETT32
0009BC 0ABC 18E0            12      JR  CALLROM
                                
       0ABE                     C_PAUSE:
0009BE 0ABE CD9D09          17      CALL    SPCUT
0009C1 0AC1 CDA309          17      CALL    TOZERO
0009C4 0AC4 EB               4      EX  DE,HL
0009C5 0AC5 7E               7      LD  A,(HL)
0009C6 0AC6 B7               4      OR  A
0009C7 0AC7 2003            12      JR  NZ,C_PAUSE1
0009C9 0AC9 21160C          10      LD  HL,PAUSE
       0ACC                     C_PAUSE1:
0009CC 0ACC CD4E04          17      CALL    MSX
0009CF 0ACF 0E07             7      LD  C,7     ;(BDOS)コンソール直接入力(_DIRIN)
0009D1 0AD1 CD0500          17      CALL    SYSTEM
0009D4 0AD4 FE03             7      CP  3
0009D6 0AD6 CA8F03          10      JP  Z,END_BATCH
0009D9 0AD9 C37C04          10      JP  LTNL
                                
       0ADC                     C_SET:
0009DC 0ADC CD9D09          17      CALL    SPCUT
0009DF 0ADF ED53F50A        20      LD  (CSET_PARAM),DE
       0AE3                     CSET2:
0009E3 0AE3 1A               7      LD  A,(DE)
0009E4 0AE4 FE20             7      CP  020H
0009E6 0AE6 383B            12      JR  C,CSET_LIST
0009E8 0AE8 D63D             7      SUB '='
0009EA 0AEA 2803            12      JR  Z,CSET_SET
0009EC 0AEC 13               6      INC DE
0009ED 0AED 18F4            12      JR  CSET2
       0AEF                     CSET_SET:
0009EF 0AEF 12               7      LD  (DE),A
0009F0 0AF0 13               6      INC DE
0009F1 0AF1 CDA309          17      CALL    TOZERO
       0AF5                     CSET_PARAM  EQU $+1
0009F4 0AF4 210000          10      LD  HL,0
0009F7 0AF7 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0009F9 0AF9 CD0500          17      CALL    SYSTEM
       0AFC                     INIT_VAR:           ;環境変数の初期化
0009FC 0AFC 21ED0C          10      LD  HL,N_DATE
0009FF 0AFF 11F20C          10      LD  DE,V_DATE
000A02 0B02 0610             7      LD  B,16
000A04 0B04 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000A06 0B06 CD0500          17      CALL    SYSTEM
                                
000A09 0B09 21020D          10      LD  HL,N_TIME
000A0C 0B0C 11070D          10      LD  DE,V_TIME
000A0F 0B0F 0603             7      LD  B,3
000A11 0B11 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000A13 0B13 CD0500          17      CALL    SYSTEM
                                
000A16 0B16 21610C          10      LD  HL,N_APPEND
000A19 0B19 11680C          10      LD  DE,V_APPEND
000A1C 0B1C 0640             7      LD  B,PATHX
000A1E 0B1E 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000A20 0B20 C30500          10      JP  SYSTEM
                                
       0B23                     CSET_LIST:
000A23 0B23 3E0A             7      LD  A,10
000A25 0B25 320A0E          13      LD  (CSET_DATA),A
000A28 0B28 110100          10      LD  DE,1
       0B2B                     CSET1:
000A2B 0B2B D5              11      PUSH    DE
000A2C 0B2C 016DFF          10      LD  BC,0FF6DH   ;_FENV 環境変数の検索
000A2F 0B2F 210B0E          10      LD  HL,DATA_COM
000A32 0B32 3600            10      LD  (HL),0
000A34 0B34 CD0500          17      CALL    SYSTEM
000A37 0B37 B7               4      OR  A
000A38 0B38 2030            12      JR  NZ,CSET_ERROR
000A3A 0B3A 210B0E          10      LD  HL,DATA_COM
000A3D 0B3D 7E               7      LD  A,(HL)
000A3E 0B3E B7               4      OR  A
000A3F 0B3F 2829            12      JR  Z,CSET_ERROR
000A41 0B41 CD4E04          17      CALL    MSX
000A44 0B44 1E3D             7      LD  E,'='
000A46 0B46 CD6E08          17      CALL    _PRINT
000A49 0B49 210B0E          10      LD  HL,DATA_COM
000A4C 0B4C 110B0F          10      LD  DE,DATA_COM+256
000A4F 0B4F 016BFF          10      LD  BC,0FF6BH   ;_GENV 環境変数の獲得
000A52 0B52 CD0500          17      CALL    SYSTEM
000A55 0B55 210B0F          10      LD  HL,DATA_COM+256
000A58 0B58 CD4E04          17      CALL    MSX
000A5B 0B5B CD7C04          17      CALL    LTNL
000A5E 0B5E 3E0A             7      LD  A,10
000A60 0B60 320A0E          13      LD  (CSET_DATA),A
       0B63                     CSET_NEXT:
000A63 0B63 D1              10      POP DE
000A64 0B64 13               6      INC DE
000A65 0B65 7A               4      LD  A,D
000A66 0B66 B3               4      OR  E
000A67 0B67 20C2            12      JR  NZ,CSET1
000A69 0B69 C9              10      RET
       0B6A                     CSET_ERROR:
000A6A 0B6A 210A0E          10      LD  HL,CSET_DATA
000A6D 0B6D 35              11      DEC (HL)
000A6E 0B6E 20F3            12      JR  NZ,CSET_NEXT
       0B70                     CSET_END:
000A70 0B70 D1              10      POP DE
000A71 0B71 C9              10      RET
                                
       0B72                     GETNUM:
000A72 0B72 CD9D09          17      CALL    SPCUT
000A75 0B75 210000          10      LD  HL,0
       0B78                     GETNUM1:
000A78 0B78 1A               7      LD  A,(DE)
000A79 0B79 13               6      INC DE
000A7A 0B7A D630             7      SUB '0'
000A7C 0B7C D8              11      RET C
000A7D 0B7D FE0A             7      CP  10
000A7F 0B7F D0              11      RET NC
000A80 0B80 4D               4      LD  C,L
000A81 0B81 44               4      LD  B,H
000A82 0B82 29              11      ADD HL,HL   ;*2
000A83 0B83 29              11      ADD HL,HL   ;*4
000A84 0B84 09              11      ADD HL,BC   ;*5
000A85 0B85 29              11      ADD HL,HL   ;*10
000A86 0B86 4F               4      LD  C,A
000A87 0B87 0600             7      LD  B,0
000A89 0B89 09              11      ADD HL,BC
000A8A 0B8A 18EC            12      JR  GETNUM1
                                
       0B8C                     CHDIR:
000A8C 0B8C 3A0C0D          13      LD  A,(MAJOR_VER)
000A8F 0B8F FE02             7      CP  2
000A91 0B91 D8              11      RET C
000A92 0B92 C5              11      PUSH    BC
000A93 0B93 E5              11      PUSH    HL
000A94 0B94 0E5A             7      LD  C,05AH      ;(BDOS)_CHDIR カレントディレクトリの変更
000A96 0B96 CD0500          17      CALL    SYSTEM
000A99 0B99 E1              10      POP HL
000A9A 0B9A C1              10      POP BC
000A9B 0B9B C9              10      RET
                                
       000C                     COMS    EQU 12
       0B9C                     COMTB:
000A9C 0B9C 4420202020              DB  "D    " ;1
000AA1 0BA1 CC03                    DW  C_DIR
000AA3 0BA3 4449522020              DB  "DIR  " ;2
000AA8 0BA8 CC03                    DW  C_DIR
000AAA 0BAA 434F505920              DB  "COPY " ;3
000AAF 0BAF B206                    DW  C_COPY
000AB1 0BB1 4344202020              DB  "CD   " ;4
000AB6 0BB6 9D02                    DW  C_CD
000AB8 0BB8 44454C2020              DB  "DEL  " ;5
000ABD 0BBD AD03                    DW  C_DEL
000ABF 0BBF 5041544820              DB  "PATH " ;6
000AC4 0BC4 8604                    DW  C_PATH
000AC6 0BC6 52454E2020              DB  "REN  " ;7
000ACB 0BCB B903                    DW  C_REN
000ACD 0BCD 5459504520              DB  "TYPE " ;8
000AD2 0BD2 1108                    DW  C_TYPE
000AD4 0BD4 52454D2020              DB  "REM  " ;9
000AD9 0BD9 AB03                    DW  C_REM
000ADB 0BDB 4D4F444520              DB  "MODE " ;10
000AE0 0BE0 710A                    DW  C_MODE
000AE2 0BE2 5041555345              DB  "PAUSE" ;11
000AE7 0BE7 BE0A                    DW  C_PAUSE
000AE9 0BE9 5345542020              DB  "SET  " ;12
000AEE 0BEE DC0A                    DW  C_SET
                                
000AF0 0BF0 2062797465732066    FREE:   DB  " bytes free  $"
            726565202024        
000AFE 0BFE 2020203C4449523E    DIRMES: DB  "   <DIR>$"
            24                  
000B07 0C07 4F4B24              OK: DB  "OK$"
000B0A 0C0A 536B697024          SKIP:   DB  "Skip$"
000B0F 0C0F 4572726F722124      COMERM: DB  "Error!$"
000B16 0C16 537472696B652061    PAUSE:  DB  "Strike any key when ready ",0
            6E79206B65792077    
            68656E2072656164    
            792000              
                                
       0C31                     S_MONTH:
000B31 0C31 4A616E00                DB  "Jan",0
000B35 0C35 46656200                DB  "Feb",0
000B39 0C39 4D617200                DB  "Mar",0
000B3D 0C3D 41707200                DB  "Apr",0
000B41 0C41 4D617900                DB  "May",0
000B45 0C45 4A756E00                DB  "Jun",0
000B49 0C49 4A756C00                DB  "Jul",0
000B4D 0C4D 41756700                DB  "Aug",0
000B51 0C51 53657000                DB  "Sep",0
000B55 0C55 4F637400                DB  "Oct",0
000B59 0C59 4E6F7600                DB  "Nov",0
000B5D 0C5D 44656300                DB  "Dec",0
                                
       0C61                     N_APPEND:
000B61 0C61 415050454E4400          DB  "APPEND",0
       0C68                     V_APPEND:
000B68 0C68                         DS  64
       0CA8                     N_PATH:
000BA8 0CA8 5041544800              DB  "PATH",0
       0CAD                     V_PATH:
000BAD 0CAD                         DS  PATHX
       0CED                     N_DATE:
000BED 0CED 4441544500              DB  "DATE",0
       0CF2                     V_DATE:
000BF2 0CF2 79792D6D6D2D6464        DB  "yy-mm-dd"
000BFA 0CFA                         DS  8
       0D02                     N_TIME:
000C02 0D02 54494D4500              DB  "TIME",0
       0D07                     V_TIME:
000C07 0D07 323400                  DB  "24",0
       0D0A                     F_TIME:
000C0A 0D0A 00                      DB  0
                                
       0D0B                     IS_MSX:
000C0B 0D0B 00                      DB  0
       0D0C                     MAJOR_VER:
000C0C 0D0C 00                      DB  0
                                
       0D0D                     SEARCH_IX:; EQU $4000
000C0D 0D0D                         DS  64  ;DOS2用
                                
       0D4D                     PATH_CCP:;  EQU $5000
000C4D 0D4D                         DS  64  ;DOS2用
                                
       0D8D                     DOS2NAME:
000C8D 0D8D                         DS  2+8+3+1
       0D9B                     DOS2NAME2:
000C9B 0D9B                         DS  2+8+3+1
                                
       0DA9                     DTA_CCP:;       EQU $6000
000CA9 0DA9                         DS  37
       0DCE                     CPBUF:
000CCE 0DCE 0000                LEFTX:  DW  0
000CD0 0DD0 0000                DTAX:   DW  0
000CD2 0DD2 20                      DB  020H    ;CPBUFで使う
000CD3 0DD3 20                      DB  020H
000CD4 0DD4 20                      DB  020H
000CD5 0DD5 20                      DB  020H
000CD6 0DD6 20                      DB  020H
000CD7 0DD7 20                      DB  020H
000CD8 0DD8 20                      DB  020H
                                
       0DD9                     DECBF:
000CD9 0DD9                         DS  5
       0DDE                     FCB_BAT2:
000CDE 0DDE 00                      DB  0
       0DDF                     FDRV:
000CDF 0DDF 00                      DB  0
       0DE0                     FNAME:
000CE0 0DE0                         DS  37
       0E05                     ZERO:
000D05 0E05 00                      DB  0
       0E06                     FCB_BAT:
000D06 0E06 DE0D                    DW  FCB_BAT2
       0E08                     X_PATH:
000D08 0E08 0000                    DW  0
       0E0A                     CSET_DATA:
000D0A 0E0A 00                      DB  0
                                
       0E0B                     DATA_COM:
[EOF:COMMAND.ASM:SHIFT_JIS]
