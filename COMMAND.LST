                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                
                                ;   似非COMMAND.COM
                                
       0005                     SYSTEM  EQU 00005H
       000B                     BASE    EQU 0000BH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
       001C                     CALSLT  EQU 0001CH
       006C                     INITXT  EQU 0006CH
       0078                     SETTXT  EQU 00078H
       F3AE                     LINL40  EQU 0F3AEH
       F3B0                     LINLEN  EQU 0F3B0H
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F55E                     BUF EQU 0F55EH
       FBF0                     KEYBUF  EQU 0FBF0H
       FC18                     KEYBUFE EQU 0FBF0H+40
       FCC1                     EXPTBL  EQU 0FCC1H
                                
                                
       0020                     PATHX   EQU 32
       F640                     PATHD   EQU BUF+258-32
                                
000000 0100                         ORG 0100H
000000 0100 C31501          10      JP  START
000003 0103 0D0A434F4D4D414E    VER:    DB  00DH,00AH,"COMMAND v0.04",00DH,00AH,'$'
            442076302E30340D    
            0A24                
       0115                     START:
000015 0115 ED7B0600        20      LD  SP,(SYSTEM+1)
000019 0119 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
00001B 011B CD0500          17      CALL    SYSTEM
00001E 011E D8              11      RET C
00001F 011F 211D01          10      LD  HL,0011DH
000022 0122 ED42            15      SBC HL,BC
000024 0124 78               4      LD  A,B
000025 0125 32120A          13      LD  (MAJOR_VER),A
000028 0128 B5               4      OR  L
000029 0129 32110A          13      LD  (IS_MSX),A
00002C 012C 3A8000          13      LD  A,(DTA1)
00002F 012F B7               4      OR  A
000030 0130 280E            12      JR  Z,WSTART
000032 0132 110301          10      LD  DE,VER
000035 0135 0E09             7      LD  C,9
000037 0137 CD0500          17      CALL    SYSTEM
00003A 013A 118100          10      LD  DE,DTA1+1
00003D 013D CD7901          17      CALL    COMANL
       0140                     WSTART:
000040 0140 CD3D04          17      CALL    LTNL
       0143                     COMMAND:
000043 0143 CD5802          17      CALL    SETDTA1
000046 0146 D5              11      PUSH    DE
000047 0147 C5              11      PUSH    BC
000048 0148 E5              11      PUSH    HL
000049 0149 0E19             7      LD  C,019H
00004B 014B CD0500          17      CALL    SYSTEM
00004E 014E E1              10      POP HL
00004F 014F C1              10      POP BC
000050 0150 C641             7      ADD A,'A'
000052 0152 5F               4      LD  E,A
000053 0153 CD4B07          17      CALL    _PRINT
000056 0156 1E3E             7      LD  E,'>'
000058 0158 CD4B07          17      CALL    _PRINT
00005B 015B D1              10      POP DE      ;DE=DTA1
00005C 015C 3E50             7      LD  A,80
00005E 015E 12               7      LD  (DE),A
00005F 015F 0E0A             7      LD  C,0AH       ;(BDOS)文字列入力
000061 0161 CD0500          17      CALL    SYSTEM
000064 0164 CD3D04          17      CALL    LTNL
                                
000067 0167 118200          10      LD  DE,DTA1+2
00006A 016A CD7901          17      CALL    COMANL
00006D 016D 30D4            12      JR  NC,COMMAND
00006F 016F 110A0A          10      LD  DE,COMERM
000072 0172 0E09             7      LD  C,9     ;(BDOS)文字列出力
000074 0174 CD0500          17      CALL    SYSTEM
000077 0177 18C7            12      JR  WSTART
                                
       0179                     COMANL:
000079 0179 CD9507          17      CALL    FILE
00007C 017C D5              11      PUSH    DE
00007D 017D 11C90A          10      LD  DE,FNAME
000080 0180 1A               7      LD  A,(DE)
000081 0181 FE20             7      CP  020H
000083 0183 284E            12      JR  Z,SDVSW
000085 0185 1B               6      DEC DE
000086 0186 1A               7      LD  A,(DE)
000087 0187 C6FF             7      ADD A,0FFH
000089 0189 380A            12      JR  C,COMB
00008B 018B 13               6      INC DE
                                
00008C 018C 21AF09          10      LD  HL,COMTB
00008F 018F 3E0A             7      LD  A,COMS
000091 0191 47               4      LD  B,A
000092 0192 CDBC08          17      CALL    CPNAME
       0195                     COMB:
000095 0195 D1              10      POP DE
000096 0196 D24A07          10      JP  NC,JP_HL
       0199                     COMB2:
000099 0199 EB               4      EX  DE,HL
00009A 019A 22DF02          16      LD  (COMPAT+1),HL
00009D 019D F5              11      PUSH    AF
00009E 019E CD8002          17      CALL    CEXE4
0000A1 01A1 F1              10      POP AF
0000A2 01A2 21C90A          10      LD  HL,FNAME
0000A5 01A5 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
0000A8 01A8 010B00          10      LD  BC,11
0000AB 01AB EDB0                    LDIR
0000AD 01AD 1140F6          10      LD  DE,PATHD
0000B0 01B0 3A110A          13      LD  A,(IS_MSX)
0000B3 01B3 B7               4      OR  A
0000B4 01B4 2003            12      JR  NZ,CEX1
0000B6 01B6 11EE0A          10      LD  DE,ZERO
       01B9                     CEX1:
0000B9 01B9 1A               7      LD  A,(DE)
0000BA 01BA FE20             7      CP  020H
0000BC 01BC D8              11      RET C
0000BD 01BD CD8A07          17      CALL    FILEC
0000C0 01C0 D5              11      PUSH    DE
0000C1 01C1 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
0000C4 01C4 11C90A          10      LD  DE,FNAME
0000C7 01C7 010B00          10      LD  BC,11
0000CA 01CA EDB0                    LDIR
0000CC 01CC CD8002          17      CALL    CEXE4
0000CF 01CF D1              10      POP DE
0000D0 01D0 13               6      INC DE
0000D1 01D1 18E6            12      JR  CEX1
                                
       01D3                     SDVSW:
0000D3 01D3 F1              10      POP AF
0000D4 01D4 3AC80A          13      LD  A,(FDRV)
0000D7 01D7 3D               4      DEC A
0000D8 01D8 5F               4      LD  E,A
0000D9 01D9 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
0000DB 01DB C35F02          10      JP  SYSTEM0
                                
       01DE                     OPEN1_D2:           ;DOS2対応
0000DE 01DE 3A120A          13      LD  A,(MAJOR_VER)
0000E1 01E1 FE02             7      CP  2
0000E3 01E3 382C            12      JR  C,OPEN1
                                
0000E5 01E5 11530A          10      LD  DE,PATH_CCP
0000E8 01E8 DD21130A        14      LD  IX,SEARCH_IX
0000EC 01EC 014010          10      LD  BC,01040H   ;(BDOS)最初のエントリ検索
0000EF 01EF CD0500          17      CALL    SYSTEM
       01F2                     FIB2DIRENT:
0000F2 01F2 B7               4      OR  A
0000F3 01F3 C0              11      RET NZ
                                
0000F4 01F4 11140A          10      LD  DE,SEARCH_IX+1
0000F7 01F7 21940A          10      LD  HL,DTA_CCP+1
0000FA 01FA 0E5C             7      LD  C,05CH      ;(BDOS)ファイル名の解析
0000FC 01FC CD0500          17      CALL    SYSTEM
                                
0000FF 01FF 21210A          10      LD  HL,SEARCH_IX+14
000102 0202 119F0A          10      LD  DE,DTA_CCP+1+8+3
000105 0205 EDA0            16      LDI
000107 0207 11AA0A          10      LD  DE,DTA_CCP+1+8+3+1+10
00010A 020A 010A00          10      LD  BC,2+2+2+4  ;最終変更時刻+最終変更日付+開始クラスタ+ファイルサイズ 
00010D 020D EDB0                    LDIR
00010F 020F AF               4      XOR A
000110 0210 C9              10      RET
                                
       0211                     OPEN1:
000111 0211 21C80A          10      LD  HL,FDRV
       0214                     OPEN:
000114 0214 0E11             7      LD  C,011H      ;(BDOS)最初のファイルの検索
       0216                     OPEN3:
000116 0216 D5              11      PUSH    DE
000117 0217 11930A          10      LD  DE,DTA_CCP
00011A 021A CD4C02          17      CALL    SETDTA
00011D 021D EB               4      EX  DE,HL
00011E 021E CD0500          17      CALL    SYSTEM
000121 0221 D1              10      POP DE
000122 0222 B7               4      OR  A
000123 0223 C9              10      RET
                                
       0224                     OPEN2_D2:           ;DOS2対応
000124 0224 3A120A          13      LD  A,(MAJOR_VER)
000127 0227 FE02             7      CP  2
000129 0229 380B            12      JR  C,OPEN2
00012B 022B DD21130A        14      LD  IX,SEARCH_IX
00012F 022F 0E41             7      LD  C,41H       ;(BDOS)次のエントリ検索
000131 0231 CD0500          17      CALL    SYSTEM
000134 0234 18BC            12      JR  FIB2DIRENT
       0236                     OPEN2:
000136 0236 0E12             7      LD  C,012H
000138 0238 18DC            12      JR  OPEN3
                                
       023A                     DEFCB:              ;Z=Ok NZ=Error
00013A 023A 11930A          10      LD  DE,DTA_CCP
00013D 023D CD5D02          17      CALL    SYSC0F
                                
000140 0240 210000          10      LD  HL,0
000143 0243 22B40A          16      LD  (DTA_CCP+33),HL
000146 0246 22B60A          16      LD  (DTA_CCP+35),HL
000149 0249 11EF0A          10      LD  DE,DATA
       024C                     SETDTA:
00014C 024C C5              11      PUSH    BC
00014D 024D D5              11      PUSH    DE
00014E 024E E5              11      PUSH    HL
00014F 024F 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
000151 0251 CD0500          17      CALL    SYSTEM
000154 0254 E1              10      POP HL
000155 0255 D1              10      POP DE
000156 0256 C1              10      POP BC
000157 0257 C9              10      RET
                                
       0258                     SETDTA1:
000158 0258 118000          10      LD  DE,DTA1
00015B 025B 18EF            12      JR  SETDTA
                                
       025D                     SYSC0F:
00015D 025D 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       025F                     SYSTEM0:
00015F 025F CD0500          17      CALL    SYSTEM
000162 0262 B7               4      OR  A
000163 0263 C9              10      RET
                                
       0264                     C_CD:
000164 0264 CD6707          17      CALL    FILEC_D2
000167 0267 11530A          10      LD  DE,PATH_CCP
00016A 026A 0E5A             7      LD  C,5AH       ;(BDOS)CHDIR カレントディレクトリの変更
00016C 026C C30500          10      JP  SYSTEM
                                
       026F                     S27DTA:
00016F 026F 110100          10      LD  DE,1
000172 0272 ED53A10A        20      LD  (DTA_CCP+14),DE
000176 0276 11930A          10      LD  DE,DTA_CCP
       0279                     S27:
000179 0279 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
00017B 027B CD0500          17      CALL    SYSTEM
00017E 027E B7               4      OR  A
00017F 027F C9              10      RET
                                
       0280                     CEXE4:
000180 0280 3AC80A          13      LD  A,(FDRV)
000183 0283 325700          13      LD  (00057H),A
000186 0286 2AD60A          16      LD  HL,(FDRV+14)
000189 0289 225800          16      LD  (00058H),HL
                                
00018C 028C 21D10A          10      LD  HL,FNAME+8
00018F 028F 7E               7      LD  A,(HL)
000190 0290 FE20             7      CP  020H
000192 0292 2007            12      JR  NZ,CEXE7
000194 0294 3E3F             7      LD  A,'?'
000196 0296 77               7      LD  (HL),A
000197 0297 23               6      INC HL
000198 0298 77               7      LD  (HL),A
000199 0299 23               6      INC HL
00019A 029A 77               7      LD  (HL),A
       029B                     CEXE7:
00019B 029B CD1102          17      CALL    OPEN1
       029E                     CEXE5:
00019E 029E C0              11      RET NZ
00019F 029F 2A9D0A          16      LD  HL,(DTA_CCP+1+9)
0001A2 02A2 7C               4      LD  A,H
0001A3 02A3 CD7708          17      CALL    CAP
0001A6 02A6 67               4      LD  H,A
0001A7 02A7 7D               4      LD  A,L
0001A8 02A8 CD7708          17      CALL    CAP
0001AB 02AB 6F               4      LD  L,A
0001AC 02AC 3A9C0A          13      LD  A,(DTA_CCP+1+8)
0001AF 02AF CD7708          17      CALL    CAP
0001B2 02B2 D642             7      SUB 'B'
0001B4 02B4 284A            12      JR  Z,C_BAT
0001B6 02B6 3D               4      DEC A       ;'C'
0001B7 02B7 2805            12      JR  Z,C_EXE
       02B9                     CEXE6:
0001B9 02B9 CD3602          17      CALL    OPEN2
0001BC 02BC 18E0            12      JR  CEXE5
                                
       02BE                     C_EXE:
0001BE 02BE 7C               4      LD  A,H
0001BF 02BF FE4D             7      CP  'M'
0001C1 02C1 20F6            12      JR  NZ,CEXE6
                                
0001C3 02C3 CD3A02          17      CALL    DEFCB
0001C6 02C6 2A0600          16      LD  HL,(SYSTEM+1)
0001C9 02C9 11EF0A          10      LD  DE,DATA
0001CC 02CC ED52            15      SBC HL,DE
0001CE 02CE CD6F02          17      CALL    S27DTA
0001D1 02D1 3D               4      DEC A
0001D2 02D2 37               4      SCF
0001D3 02D3 C0              11      RET NZ
0001D4 02D4 7C               4      LD  A,H
0001D5 02D5 B5               4      OR  L
0001D6 02D6 37               4      SCF
0001D7 02D7 C8              11      RET Z
0001D8 02D8 22FA02          16      LD  (COMSIZ+1),HL
0001DB 02DB CD5802          17      CALL    SETDTA1
0001DE 02DE 110000          10  COMPAT: LD  DE,0
0001E1 02E1 CD8305          17      CALL    SETFCB
                                
0001E4 02E4 AF               4      XOR A
0001E5 02E5 67               4      LD  H,A
0001E6 02E6 6F               4      LD  L,A ;HL=0x0000
0001E7 02E7 F3               4      DI
0001E8 02E8 ED7B0600        20  SPPAT:  LD  SP,(SYSTEM+1)
0001EC 02EC E5              11      PUSH    HL
0001ED 02ED 21EDB0          10      LD  HL,0B0EDH   ;LDIR 
0001F0 02F0 22FE00          16      LD  (000FEH),HL
0001F3 02F3 21EF0A          10      LD  HL,DATA
0001F6 02F6 110001          10      LD  DE,00100H
0001F9 02F9 010000          10  COMSIZ: LD  BC,0
0001FC 02FC FB               4      EI
0001FD 02FD C3FE00          10      JP  000FEH
                                
       0300                     C_BAT:
000200 0300 114154          10      LD  DE,'A'+'T'*256
000203 0303 ED52            15      SBC HL,DE
000205 0305 20B2            12      JR  NZ,CEXE6
                                
000207 0307 F1              10      POP AF
000208 0308 F1              10      POP AF
000209 0309 CD3A02          17      CALL    DEFCB
00020C 030C 210002          10      LD  HL,00200H
00020F 030F CD6F02          17      CALL    S27DTA
000212 0312 C6FE             7      ADD A,0FEH
000214 0314 D8              11      RET C
000215 0315 7D               4      LD  A,L
000216 0316 B7               4      OR  A
000217 0317 37               4      SCF
000218 0318 C8              11      RET Z
000219 0319 3C               4      INC A
00021A 031A F5              11      PUSH    AF
                                ;   CALL    KEYBC
                                ;   LD  A,6
                                ;   CALL    MSG_A
00021B 031B C1              10      POP BC
00021C 031C 21EF0A          10      LD  HL,DATA
       031F                     BAT1:
00021F 031F A7               4      AND A
000220 0320 05               4      DEC B
000221 0321 C8              11      RET Z
000222 0322 7E               7      LD  A,(HL)
000223 0323 FE25             7      CP  '%'
000225 0325 280C            12      JR  Z,BAT2
       0327                     BAT1X:
000227 0327 7E               7      LD  A,(HL)
000228 0328 23               6      INC HL
000229 0329 FE1A             7      CP  01AH
00022B 032B C8              11      RET Z
00022C 032C FE0A             7      CP  00AH
00022E 032E C43809          17      CALL    NZ,KEYBS
000231 0331 18EC            12      JR  BAT1
                                
       0333                     BAT2:
000233 0333 23               6      INC HL
000234 0334 7E               7      LD  A,(HL)
000235 0335 2B               6      DEC HL
000236 0336 D631             7      SUB '1'
000238 0338 38ED            12      JR  C,BAT1X
00023A 033A FE09             7      CP  9
00023C 033C 30E9            12      JR  NC,BAT1X
00023E 033E 23               6      INC HL
00023F 033F 23               6      INC HL
000240 0340 3C               4      INC A
000241 0341 4F               4      LD  C,A
000242 0342 ED5BDF02        20      LD  DE,(COMPAT+1)
       0346                     BAT3:
000246 0346 1A               7      LD  A,(DE)
000247 0347 B7               4      OR  A
000248 0348 28D5            12      JR  Z,BAT1
00024A 034A CD7108          17      CALL    SPCUT
00024D 034D 0D               4      DEC C
00024E 034E 2808            12      JR  Z,BAT5
       0350                     BAT4:
000250 0350 1A               7      LD  A,(DE)
000251 0351 FE21             7      CP  021H
000253 0353 38F1            12      JR  C,BAT3
000255 0355 13               6      INC DE
000256 0356 18F8            12      JR  BAT4
       0358                     BAT5:
000258 0358 1A               7      LD  A,(DE)
000259 0359 FE21             7      CP  021H
00025B 035B 38C2            12      JR  C,BAT1
00025D 035D 13               6      INC DE
00025E 035E CD3809          17      CALL    KEYBS
000261 0361 18F5            12      JR  BAT5
                                
       0363                     SWITCH:
000263 0363 1A               7      LD  A,(DE)
       0364                     SW1:
000264 0364 13               6      INC DE
000265 0365 B9               4      CP  C
000266 0366 1A               7      LD  A,(DE)
000267 0367 C8              11      RET Z
000268 0368 FE20             7      CP  020H
00026A 036A 30F8            12      JR  NC,SW1
       036C                     C_REM:
00026C 036C AF               4      XOR A
00026D 036D C9              10      RET
                                
       036E                     C_DEL:
00026E 036E CD8305          17      CALL    SETFCB
000271 0371 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力
000273 0373 CD0500          17      CALL    SYSTEM
                                
000276 0376 0E13             7      LD  C,013H
000278 0378 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       037A                     C_REN:
00027A 037A CD8305          17      CALL    SETFCB
00027D 037D 3E10             7      LD  A,010H      ;ディレクトリも対象にする(LSX-Dodgers)
00027F 037F 326900          13      LD  (FCB1+13),A ;属性
000282 0382 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       0384                     CDEL1:
000284 0384 115C00          10      LD  DE,FCB1
000287 0387 CD0500          17      CALL    SYSTEM
00028A 038A C6FF             7      ADD A,0FFH
00028C 038C C9              10      RET
                                
       038D                     C_DIR:
00028D 038D CD6707          17      CALL    FILEC_D2
000290 0390 21C90A          10      LD  HL,FDRV+1
000293 0393 CD3007          17      CALL    CWILD1
000296 0396 3EF1             7      LD  A,0F1H
000298 0398 32D50A          13      LD  (FDRV+13),A
00029B 039B CDDE01          17      CALL    OPEN1_D2
       039E                     CDIR1:
00029E 039E B7               4      OR  A
00029F 039F 2008            12      JR  NZ,PDSKF
0002A1 03A1 CD1504          17      CALL    P_NAME
0002A4 03A4 CD2402          17      CALL    OPEN2_D2
0002A7 03A7 18F5            12      JR  CDIR1
                                
       03A9                     PDSKF:
0002A9 03A9 3AC80A          13      LD  A,(FDRV)
0002AC 03AC 5F               4      LD  E,A
0002AD 03AD 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0002AF 03AF CD0500          17      CALL    SYSTEM
0002B2 03B2 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0002B3 03B3 C601             7      ADD A,001H
0002B5 03B5 D8              11      RET C       ;Aが0FFHだった場合
0002B6 03B6 3E06             7      LD  A,8-2
       03B8                     PDS1:               ;HL=未使用クラスタの総数
0002B8 03B8 3C               4      INC A
0002B9 03B9 CB19             8      RR  C
0002BB 03BB 30FB            12      JR  NC,PDS1
       03BD                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0002BD 03BD 3C               4      INC A
0002BE 03BE CB18             8      RR  B
0002C0 03C0 30FB            12      JR  NC,PDS2
0002C2 03C2 47               4      LD  B,A
                                
0002C3 03C3 110000          10      LD  DE,0
       03C6                     PDS3:
0002C6 03C6 29              11      ADD HL,HL
0002C7 03C7 EB               4      EX  DE,HL
0002C8 03C8 ED6A            15      ADC HL,HL
0002CA 03CA EB               4      EX  DE,HL
0002CB 03CB 10F9            13      DJNZ    PDS3
       03CD                     PDSKF1:
0002CD 03CD CD8E04          17      CALL    PRDEC_DEHL
0002D0 03D0 11EB09          10      LD  DE,FREE
0002D3 03D3 0E09             7      LD  C,9     ;(BDOS)文字列出力
0002D5 03D5 CD0500          17      CALL    SYSTEM
0002D8 03D8 CD6E04          17      CALL    PUTDRV
0002DB 03DB 3E5C             7      LD  A,05CH
0002DD 03DD CD5807          17      CALL    MSG_A
0002E0 03E0 3A120A          13      LD  A,(MAJOR_VER)
0002E3 03E3 FE01             7      CP  1
0002E5 03E5 3856            12      JR  C,LTNL
0002E7 03E7 200E            12      JR  NZ,PDSKF2
0002E9 03E9 2AD60A          16      LD  HL,(FDRV+14)
0002EC 03EC AF               4      XOR A
0002ED 03ED 11FEFF          10      LD  DE,0-2
0002F0 03F0 19              11      ADD HL,DE
0002F1 03F1 23               6      INC HL
0002F2 03F2 DC8A04          17      CALL    C,PRDEC_HL
0002F5 03F5 1846            12      JR  LTNL
       03F7                     PDSKF2:             ;MSX-DOS2
0002F7 03F7 3AC80A          13      LD  A,(FDRV)
0002FA 03FA 47               4      LD  B,A     ;ドライブ
0002FB 03FB 11EF0A          10      LD  DE,DATA
0002FE 03FE 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
000300 0400 CD0500          17      CALL    SYSTEM
000303 0403 21EF0A          10      LD  HL,DATA
                                
000306 0406 CD0F04          17      CALL    MSX
000309 0409 1832            12      JR  LTNL
                                
       040B                     MSX1:
00030B 040B 5F               4      LD  E,A
00030C 040C CD4B07          17      CALL    _PRINT
       040F                     MSX:
00030F 040F 7E               7      LD  A,(HL)
000310 0410 23               6      INC HL
000311 0411 B7               4      OR  A
000312 0412 20F7            12      JR  NZ,MSX1
000314 0414 C9              10      RET
                                
       0415                     P_NAME:
000315 0415 21940A          10      LD  HL,DTA_CCP+1
000318 0418 7E               7      LD  A,(HL)
000319 0419 FE2E             7      CP  '.'
00031B 041B C8              11      RET Z
00031C 041C CDE404          17      CALL    FPRNT
00031F 041F 3A9F0A          13      LD  A,(DTA_CCP+12)
000322 0422 CB67             8      BIT 4,A
000324 0424 280A            12      JR  Z,DIR3
000326 0426 11F909          10      LD  DE,DIRMES
000329 0429 0E09             7      LD  C,9     ;(BDOS)文字列出力
00032B 042B CD0500          17      CALL    SYSTEM
00032E 042E 180A            12      JR  DIR6
       0430                     DIR3:
000330 0430 ED5BB20A        20      LD  DE,(DTA_CCP+1+01EH)
000334 0434 2AB00A          16      LD  HL,(DTA_CCP+1+01CH)
000337 0437 CD8E04          17      CALL    PRDEC_DEHL
       043A                     DIR6:
00033A 043A CD0605          17      CALL    PRTTMS
                                
       043D                     LTNL:
00033D 043D 1E0D             7      LD  E,00DH
00033F 043F CD4B07          17      CALL    _PRINT
000342 0442 1E0A             7      LD  E,00AH
000344 0444 C34B07          10      JP  _PRINT
                                
       0447                     C_PATH:
000347 0447 3A110A          13      LD  A,(IS_MSX)
00034A 044A B7               4      OR  A
00034B 044B C8              11      RET Z
00034C 044C CD7108          17      CALL    SPCUT
00034F 044F 2140F6          10      LD  HL,PATHD
000352 0452 FE21             7      CP  021H
000354 0454 300C            12      JR  NC,CPATH0
       0456                     CPATHP:
000356 0456 7E               7      LD  A,(HL)
000357 0457 23               6      INC HL
000358 0458 FE20             7      CP  020H
00035A 045A 3F               4      CCF
00035B 045B 30E0            12      JR  NC,LTNL
00035D 045D CD5807          17      CALL    MSG_A
000360 0460 18F4            12      JR  CPATHP
       0462                     CPATH0:
000362 0462 FE3B             7      CP  ';'
000364 0464 2001            12      JR  NZ,CPATH1
000366 0466 13               6      INC DE
       0467                     CPATH1:
000367 0467 EB               4      EX  DE,HL
000368 0468 012000          10      LD  BC,PATHX
00036B 046B EDB0                    LDIR
00036D 046D C9              10      RET
                                
       046E                     PUTDRV:
00036E 046E 3AC80A          13      LD  A,(FDRV)
000371 0471 B7               4      OR  A
000372 0472 200C            12      JR  NZ,PUTDRV1
000374 0474 C5              11      PUSH    BC
000375 0475 D5              11      PUSH    DE
000376 0476 E5              11      PUSH    HL
000377 0477 0E19             7      LD  C,019H
000379 0479 CD0500          17      CALL    SYSTEM
00037C 047C E1              10      POP HL
00037D 047D D1              10      POP DE
00037E 047E C1              10      POP BC
00037F 047F 3C               4      INC A
       0480                     PUTDRV1:
000380 0480 C640             7      ADD A,'A'-1
000382 0482 CD5807          17      CALL    MSG_A
000385 0485 3E3A             7      LD  A,':'
       0487                     MSG_AR:
000387 0487 C35807          10      JP  MSG_A
                                
       048A                     PRDEC_HL:
00038A 048A AF               4      XOR A
       048B                     PRDEC_AHL:
00038B 048B 5F               4      LD  E,A
00038C 048C 1600             7      LD  D,0
       048E                     PRDEC_DEHL:
00038E 048E 3E02             7      LD  A,2
000390 0490 32D904          13      LD  (DEC6+1),A
000393 0493 AF               4      XOR A
000394 0494 E5              11      PUSH    HL
000395 0495 21C30A          10      LD  HL,DECBF
000398 0498 0605             7      LD  B,5
00039A 049A CD3808          17      CALL    FILL_MEMORY
00039D 049D E1              10      POP HL
                                
00039E 049E 0E20             7      LD  C,32
       04A0                     DEC1:
0003A0 04A0 29              11      ADD HL,HL
0003A1 04A1 EB               4      EX  DE,HL
0003A2 04A2 ED6A            15      ADC HL,HL
0003A4 04A4 EB               4      EX  DE,HL
0003A5 04A5 E5              11      PUSH    HL
0003A6 04A6 21C70A          10      LD  HL,DECBF+4
0003A9 04A9 0605             7      LD  B,5
       04AB                     DEC2:
0003AB 04AB 7E               7      LD  A,(HL)
0003AC 04AC 8F               4      ADC A,A
0003AD 04AD 27               4      DAA
0003AE 04AE 77               7      LD  (HL),A
0003AF 04AF 2B               6      DEC HL
0003B0 04B0 10F9            13      DJNZ    DEC2
0003B2 04B2 E1              10      POP HL
0003B3 04B3 0D               4      DEC C
0003B4 04B4 20EA            12      JR  NZ,DEC1
                                
0003B6 04B6 21C30A          10      LD  HL,DECBF
0003B9 04B9 3E20             7      LD  A,020H
0003BB 04BB 0604             7      LD  B,4
       04BD                     DEC3:
0003BD 04BD CDCA04          17      CALL    DEC4
0003C0 04C0 CDCA04          17      CALL    DEC4
0003C3 04C3 23               6      INC HL
0003C4 04C4 10F7            13      DJNZ    DEC3
       04C6                     DECX:
0003C6 04C6 CDCA04          17      CALL    DEC4
0003C9 04C9 AF               4      XOR A
       04CA                     DEC4:
0003CA 04CA ED6F            18      RLD
0003CC 04CC FE20             7      CP  020H
0003CE 04CE 2808            12      JR  Z,DEC6
0003D0 04D0 F630             7      OR  030H
       04D2                     DEC5:
0003D2 04D2 18B3            12      JR  MSG_AR
       04D4                     DEC7:
0003D4 04D4 3E20             7      LD  A,020H
0003D6 04D6 18AF            12      JR  MSG_AR
       04D8                     DEC6:
0003D8 04D8 3E02             7      LD  A,2
0003DA 04DA B7               4      OR  A
0003DB 04DB 28F7            12      JR  Z,DEC7
0003DD 04DD 3D               4      DEC A
0003DE 04DE 32D904          13      LD  (DEC6+1),A
0003E1 04E1 3E20             7      LD  A,020H
0003E3 04E3 C9              10      RET
                                
       04E4                     FPRNT:
0003E4 04E4 0608             7      LD  B,8
0003E6 04E6 CDF704          17      CALL    P_N1
0003E9 04E9 7E               7      LD  A,(HL)
0003EA 04EA C680             7      ADD A,0A0H-020H
0003EC 04EC FEA0             7      CP  0A0H
0003EE 04EE 2802            12      JR  Z,FPR1
0003F0 04F0 3E2E             7      LD  A,'.'
       04F2                     FPR1:
0003F2 04F2 CD5807          17      CALL    MSG_A
0003F5 04F5 0603             7      LD  B,3
                                
       04F7                     P_N1:
0003F7 04F7 C5              11      PUSH    BC
0003F8 04F8 E5              11      PUSH    HL
0003F9 04F9 7E               7      LD  A,(HL)
0003FA 04FA CD8308          17      CALL    CAP3
0003FD 04FD CD5807          17      CALL    MSG_A
000400 0500 E1              10      POP HL
000401 0501 C1              10      POP BC
000402 0502 23               6      INC HL
000403 0503 10F2            13      DJNZ    P_N1
000405 0505 C9              10      RET
                                
       0506                     PRTTMS:
000406 0506 3E20             7      LD  A,020H
000408 0508 CD5807          17      CALL    MSG_A
                                
00040B 050B 2AAC0A          16      LD  HL,(DTA_CCP+1+24)
00040E 050E 7D               4      LD  A,L
00040F 050F B7               4      OR  A
000410 0510 C8              11      RET Z
000411 0511 CB3C             8      SRL H
000413 0513 17               4      RLA
000414 0514 17               4      RLA
000415 0515 17               4      RLA
000416 0516 17               4      RLA
000417 0517 E60F             7      AND 00FH
000419 0519 57               4      LD  D,A
00041A 051A 7C               4      LD  A,H
00041B 051B C650             7      ADD A,80
00041D 051D CD6E05          17      CALL    PRDEC_A
000420 0520 3E2D             7      LD  A,'-'
000422 0522 CD5807          17      CALL    MSG_A
000425 0525 7A               4      LD  A,D
000426 0526 CD6E05          17      CALL    PRDEC_A
000429 0529 3E2D             7      LD  A,'-'
00042B 052B CD5807          17      CALL    MSG_A
00042E 052E 7D               4      LD  A,L
00042F 052F E61F             7      AND 01FH
000431 0531 CD6E05          17      CALL    PRDEC_A
                                
000434 0534 CD2509          17      CALL    GET_WIDTH
000437 0537 FE21             7      CP  32+1
000439 0539 3005            12      JR  NC,SHOW_TIME
00043B 053B 3E1D             7      LD  A,01DH
00043D 053D C35807          10      JP  MSG_A
       0540                     SHOW_TIME:
000440 0540 2AAA0A          16      LD  HL,(DTA_CCP+1+22)
                                
000443 0543 3E20             7      LD  A,020H
000445 0545 CD5807          17      CALL    MSG_A
000448 0548 7C               4      LD  A,H
000449 0549 65               4      LD  H,L
00044A 054A 1F               4      RRA
00044B 054B CB1D             8      RR  L
00044D 054D 1F               4      RRA
00044E 054E CB1D             8      RR  L
000450 0550 1F               4      RRA
000451 0551 CB1D             8      RR  L
000453 0553 E61F             7      AND 01FH
000455 0555 CD6E05          17      CALL    PRDEC_A
000458 0558 3E3A             7      LD  A,':'
00045A 055A CD5807          17      CALL    MSG_A
00045D 055D 7D               4      LD  A,L
00045E 055E 0F               4      RRCA
00045F 055F 0F               4      RRCA
000460 0560 E63F             7      AND 03FH
000462 0562 CD6E05          17      CALL    PRDEC_A
                                
000465 0565 3E3A             7      LD  A,':'
000467 0567 CD5807          17      CALL    MSG_A
00046A 056A 7C               4      LD  A,H
00046B 056B E61F             7      AND 01FH
00046D 056D 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       056E                     PRDEC_A:
00046E 056E E5              11      PUSH    HL
00046F 056F 0608             7      LD  B,8
000471 0571 4F               4      LD  C,A
000472 0572 AF               4      XOR A
       0573                     PRTA1:
000473 0573 CB01             4      RLC C
000475 0575 8F               4      ADC A,A
000476 0576 27               4      DAA
000477 0577 10FA            13      DJNZ    PRTA1
000479 0579 21C30A          10      LD  HL,DECBF
00047C 057C 77               7      LD  (HL),A
00047D 057D AF               4      XOR A
00047E 057E CDC604          17      CALL    DECX
000481 0581 E1              10      POP HL
000482 0582 C9              10      RET
                                
       0583                     SETFCB:
000483 0583 CD7108          17      CALL    SPCUT
000486 0586 1A               7      LD  A,(DE)
000487 0587 FE20             7      CP  020H
000489 0589 3801            12      JR  C,SETFCBA
00048B 058B 1B               6      DEC DE
       058C                     SETFCBA:
00048C 058C D5              11      PUSH    DE
00048D 058D 215C00          10      LD  HL,FCB1
000490 0590 115D00          10      LD  DE,FCB1+1
000493 0593 012300          10      LD  BC,00023H
000496 0596 70               7      LD  (HL),B      ;B=0
000497 0597 EDB0                    LDIR
000499 0599 D1              10      POP DE
00049A 059A D5              11      PUSH    DE
00049B 059B 215C00          10      LD  HL,FCB1
00049E 059E CD0809          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0004A1 05A1 216C00          10      LD  HL,FCB2
0004A4 05A4 CD0809          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0004A7 05A7 E1              10      POP HL
0004A8 05A8 010050          10      LD  BC,05000H
0004AB 05AB 118100          10      LD  DE,00081H
       05AE                     SETFCB1:
0004AE 05AE 7E               7      LD  A,(HL)
0004AF 05AF 23               6      INC HL
0004B0 05B0 FE20             7      CP  020H
0004B2 05B2 3805            12      JR  C,SETFCB2
0004B4 05B4 12               7      LD  (DE),A
0004B5 05B5 13               6      INC DE
0004B6 05B6 0C               4      INC C
0004B7 05B7 10F5            13      DJNZ    SETFCB1
       05B9                     SETFCB2:
0004B9 05B9 79               4      LD  A,C
0004BA 05BA 328000          13      LD  (DTA1),A
0004BD 05BD 04               4      INC B
0004BE 05BE AF               4      XOR A
       05BF                     SETFCB3:
0004BF 05BF 12               7      LD  (DE),A
0004C0 05C0 13               6      INC DE
0004C1 05C1 10FC            13      DJNZ    SETFCB3
0004C3 05C3 C9              10      RET
                                
       05C4                     C_COPY:
0004C4 05C4 CD8305          17      CALL    SETFCB
0004C7 05C7 118100          10      LD  DE,DTA1+1
0004CA 05CA 0E2F             7      LD  C,'/'
0004CC 05CC CD6303          17      CALL    SWITCH
0004CF 05CF CD7708          17      CALL    CAP
0004D2 05D2 325C06          13      LD  (SW+1),A
                                
0004D5 05D5 11EE0A          10      LD  DE,ZERO
0004D8 05D8 CD8D07          17      CALL    FILEC2
0004DB 05DB 216C00          10      LD  HL,FCB2
0004DE 05DE CD0F09          17      CALL    S29X1
                                
0004E1 05E1 3E10             7      LD  A,010H
0004E3 05E3 326900          13      LD  (FCB1+13),A
0004E6 05E6 216D00          10      LD  HL,FCB2+1
0004E9 05E9 CD3007          17      CALL    CWILD1
       05EC                     COPY0:
0004EC 05EC CD2D07          17      CALL    CWILD
0004EF 05EF 215C00          10      LD  HL,FCB1
0004F2 05F2 CD1402          17      CALL    OPEN
0004F5 05F5 37               4      SCF
       05F6                     COPY1:
0004F6 05F6 C0              11      RET NZ
0004F7 05F7 CD3A02          17      CALL    DEFCB
                                
0004FA 05FA 3AA00A          13      LD  A,(DTA_CCP+13)
0004FD 05FD CB67             8      BIT 4,A
0004FF 05FF 2826            12      JR  Z,COPY1A
                                
000501 0601 215D00          10      LD  HL,FCB1+1
000504 0604 CDB008          17      CALL    CHKWILD
000507 0607 3819            12      JR  C,COPY9
                                
000509 0609 3E20             7      LD  A,020H
00050B 060B 325D00          13      LD  (FCB1+1),A
00050E 060E 2AAD0A          16      LD  HL,(DTA_CCP+26)
000511 0611 23               6      INC HL
000512 0612 226A00          16      LD  (FCB1+14),HL
000515 0615 18D5            12      JR  COPY0
                                
       0617                     COPYS:
000517 0617 11050A          10      LD  DE,SKIP
       061A                     COPY8:
00051A 061A 0E09             7      LD  C,9     ;(BDOS)文字列出力
00051C 061C CD0500          17      CALL    SYSTEM
00051F 061F CD3D04          17      CALL    LTNL
       0622                     COPY9:
000522 0622 CD3602          17      CALL    OPEN2
000525 0625 18CF            12      JR  COPY1
                                
       0627                     COPY1A:
000527 0627 216C00          10      LD  HL,FCB2
00052A 062A 11C80A          10      LD  DE,FDRV
00052D 062D 01950A          10      LD  BC,DTA_CCP+2
000530 0630 EDA0            16      LDI
000532 0632 3E0B             7      LD  A,11
       0634                     COPY2:
000534 0634 F5              11      PUSH    AF
000535 0635 7E               7      LD  A,(HL)
000536 0636 FE3F             7      CP  '?'
000538 0638 2001            12      JR  NZ,COPY3
00053A 063A 0A               7      LD  A,(BC)
       063B                     COPY3:
00053B 063B 12               7      LD  (DE),A
00053C 063C 03               6      INC BC
00053D 063D 13               6      INC DE
00053E 063E 23               6      INC HL
00053F 063F F1              10      POP AF
000540 0640 3D               4      DEC A
000541 0641 20F1            12      JR  NZ,COPY2
000543 0643 010500          10      LD  BC,16-11
000546 0646 EDB0                    LDIR
       0648                     PUTNAME:
000548 0648 215D00          10      LD  HL,FCB1+1
00054B 064B CDB008          17      CALL    CHKWILD
00054E 064E 300B            12      JR  NC,PUTN1
000550 0650 21C90A          10      LD  HL,FDRV+1
000553 0653 CDE404          17      CALL    FPRNT
000556 0656 3E20             7      LD  A,020H
000558 0658 CD5807          17      CALL    MSG_A
       065B                     PUTN1:
00055B 065B 3E00             7  SW: LD  A,000H
00055D 065D FE54             7      CP  'T'
00055F 065F 2005            12      JR  NZ,CSW1
000561 0661 217B06          10      LD  HL,SWNE
000564 0664 1807            12      JR  SWT1
       0666                     CSW1:
000566 0666 FE4E             7      CP  'N'
000568 0668 2011            12      JR  NZ,SWNE
00056A 066A 211706          10      LD  HL,COPYS
       066D                     SWT1:
00056D 066D 11C80A          10      LD  DE,FDRV
000570 0670 CD5D02          17      CALL    SYSC0F
000573 0673 2801            12      JR  Z,SWN1
000575 0675 E9               4      JP  (HL)
       0676                     SWN1:
000576 0676 CDD906          17      CALL    CTIME
000579 0679 309C            12      JR  NC,COPYS
       067B                     SWNE:
00057B 067B 11C80A          10      LD  DE,FDRV
00057E 067E 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000580 0680 CD5F02          17      CALL    SYSTEM0
000583 0683 2052            12      JR  NZ,COPYE2
000585 0685 67               4      LD  H,A     ;A=0
000586 0686 6F               4      LD  L,A
000587 0687 22E90A          16      LD  (FDRV+33),HL    ;(FCB)ランダム・レコード
00058A 068A 22EB0A          16      LD  (FDRV+35),HL
00058D 068D 2C               4      INC L       ;HL=1
00058E 068E 22D60A          16      LD  (FDRV+14),HL    ;(FCB)レコード・サイズ
       0691                     COPY6:
000591 0691 CD3F07          17      CALL    BUFSIZ
000594 0694 CD6F02          17      CALL    S27DTA
000597 0697 3C               4      INC A
000598 0698 2835            12      JR  Z,COPYE
00059A 069A 47               4      LD  B,A
00059B 069B 7C               4      LD  A,H
00059C 069C B5               4      OR  L
00059D 069D 280F            12      JR  Z,COPY7
00059F 069F 11C80A          10      LD  DE,FDRV
0005A2 06A2 C5              11      PUSH    BC
0005A3 06A3 0E26             7      LD  C,026H      ;(BDOS)ランダム・ブロック・ライト
0005A5 06A5 CD0500          17      CALL    SYSTEM
0005A8 06A8 C1              10      POP BC
0005A9 06A9 B7               4      OR  A
0005AA 06AA 2023            12      JR  NZ,COPYE
0005AC 06AC 10E3            13      DJNZ    COPY6
       06AE                     COPY7:
0005AE 06AE 3AA00A          13      LD  A,(DTA_CCP+13)  ;(FCB)属性(アトリビュート)
0005B1 06B1 32D50A          13      LD  (FDRV+13),A ;(FCB)属性(アトリビュート)
0005B4 06B4 21A70A          10      LD  HL,DTA_CCP+20
0005B7 06B7 11DC0A          10      LD  DE,FDRV+20  ;(FCB)更新日時
0005BA 06BA 010400          10      LD  BC,4
0005BD 06BD EDB0                    LDIR
                                
0005BF 06BF 11C80A          10      LD  DE,FDRV
0005C2 06C2 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0005C4 06C4 CD5F02          17      CALL    SYSTEM0
0005C7 06C7 2006            12      JR  NZ,COPYE
                                
0005C9 06C9 11020A          10      LD  DE,OK
0005CC 06CC C31A06          10      JP  COPY8
                                
       06CF                     COPYE:
0005CF 06CF 11C80A          10      LD  DE,FDRV
0005D2 06D2 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0005D4 06D4 CD0500          17      CALL    SYSTEM
       06D7                     COPYE2:
0005D7 06D7 37               4      SCF
0005D8 06D8 C9              10      RET
                                
       06D9                     CTIME:
0005D9 06D9 ED5BA70A        20      LD  DE,(DTA_CCP+20)
0005DD 06DD 2ADC0A          16      LD  HL,(FDRV+20)
0005E0 06E0 A7               4      AND A
0005E1 06E1 ED52            15      SBC HL,DE
0005E3 06E3 C0              11      RET NZ
0005E4 06E4 ED5BA90A        20      LD  DE,(DTA_CCP+22)
0005E8 06E8 2ADE0A          16      LD  HL,(FDRV+22)
0005EB 06EB ED52            15      SBC HL,DE
0005ED 06ED C9              10      RET
                                
       06EE                     C_TYPE:
0005EE 06EE CD8305          17      CALL    SETFCB
0005F1 06F1 215C00          10      LD  HL,FCB1
0005F4 06F4 CD1402          17      CALL    OPEN
0005F7 06F7 37               4      SCF
       06F8                     TYPE1:
0005F8 06F8 C0              11      RET NZ
0005F9 06F9 CD3A02          17      CALL    DEFCB
0005FC 06FC 3E1A             7      LD  A,01AH
0005FE 06FE CD5807          17      CALL    MSG_A
       0701                     TYPE2:
000601 0701 CD3F07          17      CALL    BUFSIZ
000604 0704 CD6F02          17      CALL    S27DTA
000607 0707 C6FE             7      ADD A,0FEH
000609 0709 D8              11      RET C
00060A 070A 7C               4      LD  A,H
00060B 070B B5               4      OR  L
00060C 070C 281A            12      JR  Z,TYPEE
00060E 070E 01EF0A          10      LD  BC,DATA
       0711                     TYPE3:
000611 0711 0A               7      LD  A,(BC)
000612 0712 03               6      INC BC
000613 0713 FE1A             7      CP  01AH
000615 0715 2811            12      JR  Z,TYPEE
000617 0717 5F               4      LD  E,A
000618 0718 C5              11      PUSH    BC
000619 0719 E5              11      PUSH    HL
00061A 071A 0E02             7      LD  C,2     ;(BDOS)コンソール出力
00061C 071C CD0500          17      CALL    SYSTEM
00061F 071F E1              10      POP HL
000620 0720 C1              10      POP BC
000621 0721 2B               6      DEC HL
000622 0722 7C               4      LD  A,H
000623 0723 B5               4      OR  L
000624 0724 20EB            12      JR  NZ,TYPE3
000626 0726 18D9            12      JR  TYPE2
       0728                     TYPEE:
000628 0728 CD3602          17      CALL    OPEN2
00062B 072B 18CB            12      JR  TYPE1
                                
       072D                     CWILD:
00062D 072D 215D00          10      LD  HL,FCB1+1
       0730                     CWILD1:
000630 0730 7E               7      LD  A,(HL)
000631 0731 FE20             7      CP  020H
000633 0733 C0              11      RET NZ
       0734                     CWILD2:
000634 0734 54               4      LD  D,H
000635 0735 5D               4      LD  E,L
000636 0736 13               6      INC DE
000637 0737 010A00          10      LD  BC,10
00063A 073A 363F            10      LD  (HL),'?'
00063C 073C EDB0                    LDIR
00063E 073E C9              10      RET
                                
       073F                     BUFSIZ:
00063F 073F 3A0700          13      LD  A,(SYSTEM+2)
000642 0742 D60B             7      SUB (DATA/256)+1
000644 0744 E6F8             7      AND 0F8H
000646 0746 67               4      LD  H,A
000647 0747 2E00             7      LD  L,0
000649 0749 C9              10      RET
                                
00064A 074A E9               4  JP_HL:  JP  (HL)
                                
       074B                     _PRINT:
00064B 074B C5              11      PUSH    BC
00064C 074C D5              11      PUSH    DE
00064D 074D E5              11      PUSH    HL
00064E 074E 0E06             7      LD  C,6
000650 0750 CD0500          17      CALL    SYSTEM
000653 0753 E1              10      POP HL
000654 0754 D1              10      POP DE
000655 0755 C1              10      POP BC
000656 0756 B7               4      OR  A
000657 0757 C9              10      RET
                                
       0758                     MSG_A:
000658 0758 F5              11      PUSH    AF
000659 0759 C5              11      PUSH    BC
00065A 075A D5              11      PUSH    DE
00065B 075B E5              11      PUSH    HL
00065C 075C 5F               4      LD  E,A
00065D 075D 0E02             7      LD  C,2
00065F 075F CD0500          17      CALL    SYSTEM
000662 0762 E1              10      POP HL
000663 0763 D1              10      POP DE
000664 0764 C1              10      POP BC
000665 0765 F1              10      POP AF
000666 0766 C9              10      RET
                                ;       FILE
       0767                     FILEC_D2:       ;DOS2対応
000667 0767 3A120A          13      LD  A,(MAJOR_VER)
00066A 076A FE02             7      CP  2
00066C 076C 381C            12      JR  C,FILEC
00066E 076E C5              11      PUSH    BC
00066F 076F D5              11      PUSH    DE
000670 0770 E5              11      PUSH    HL
000671 0771 CD7108          17      CALL    SPCUT
000674 0774 21530A          10      LD  HL,PATH_CCP
000677 0777 0640             7      LD  B,64
       0779                     PATHCD1:
000679 0779 1A               7      LD  A,(DE)
00067A 077A 13               6      INC DE
00067B 077B FE20             7      CP  020H
00067D 077D 3002            12      JR  NC,PATHCD2
00067F 077F 3E00             7      LD  A,0
       0781                     PATHCD2:
000681 0781 77               7      LD  (HL),A
000682 0782 3803            12      JR  C,PATHCD3
000684 0784 23               6      INC HL
000685 0785 10F2            13      DJNZ    PATHCD1
       0787                     PATHCD3:
000687 0787 E1              10      POP HL
000688 0788 D1              10      POP DE
000689 0789 C1              10      POP BC
       078A                     FILEC:
00068A 078A CD9507          17      CALL    FILE
       078D                     FILEC2:
00068D 078D 3AC90A          13      LD  A,(FDRV+1)
000690 0790 FE20             7      CP  020H
000692 0792 C8              11      RET Z
000693 0793 1839            12      JR  SETDIR1
                                
       0795                     FILE:
000695 0795 AF               4      XOR A
000696 0796 32C80A          13      LD  (FDRV),A
000699 0799 67               4      LD  H,A
00069A 079A 6F               4      LD  L,A
00069B 079B 22D60A          16      LD  (FDRV+14),HL
00069E 079E CD7108          17      CALL    SPCUT
0006A1 07A1 CD5608          17      CALL    CCHK3
0006A4 07A4 2812            12      JR  Z,DEVI1
0006A6 07A6 13               6      INC DE
0006A7 07A7 1A               7      LD  A,(DE)
0006A8 07A8 1B               6      DEC DE
0006A9 07A9 FE3A             7      CP  ':'
0006AB 07AB 200B            12      JR  NZ,DEVI1
0006AD 07AD 1A               7      LD  A,(DE)      ;DRIVE
0006AE 07AE CD7708          17      CALL    CAP
0006B1 07B1 D640             7      SUB '@'
0006B3 07B3 13               6      INC DE
0006B4 07B4 13               6      INC DE
0006B5 07B5 32C80A          13      LD  (FDRV),A
       07B8                     DEVI1:
0006B8 07B8 1A               7      LD  A,(DE)
0006B9 07B9 D65C             7      SUB 05CH        ;\
0006BB 07BB 2009            12      JR  NZ,NOROOT
0006BD 07BD 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
0006BE 07BE 22E20A          16      LD  (FDRV+26),HL
0006C1 07C1 2C               4      INC L
0006C2 07C2 22D60A          16      LD  (FDRV+14),HL
0006C5 07C5 13               6      INC DE
       07C6                     NOROOT:
                                
       07C6                     SETDIR:
0006C6 07C6 CDF607          17      CALL    FILED
0006C9 07C9 1A               7      LD  A,(DE)
0006CA 07CA FE5C             7      CP  05CH        ;\
0006CC 07CC C0              11      RET NZ
0006CD 07CD 13               6      INC DE
       07CE                     SETDIR1:
0006CE 07CE 3A110A          13      LD  A,(IS_MSX)
0006D1 07D1 B7               4      OR  A
0006D2 07D2 C0              11      RET NZ
                                                ;for LSX-Dodgers
0006D3 07D3 3E10             7      LD  A,010H      ;Directory
0006D5 07D5 32D50A          13      LD  (FDRV+13),A
0006D8 07D8 D5              11      PUSH    DE
0006D9 07D9 11C80A          10      LD  DE,FDRV
0006DC 07DC 0E0F             7      LD  C,00FH
0006DE 07DE CD0500          17      CALL    SYSTEM
0006E1 07E1 D1              10      POP DE
0006E2 07E2 B7               4      OR  A
0006E3 07E3 C0              11      RET NZ
                                
0006E4 07E4 3AD50A          13      LD  A,(FDRV+13)
0006E7 07E7 CB67             8      BIT 4,A
0006E9 07E9 C8              11      RET Z
                                
0006EA 07EA CD3D08          17      CALL    FILEI
0006ED 07ED 2AE20A          16      LD  HL,(FDRV+26)
0006F0 07F0 23               6      INC HL
0006F1 07F1 22D60A          16      LD  (FDRV+14),HL
0006F4 07F4 18D0            12      JR  SETDIR
                                
       07F6                     FILED:
0006F6 07F6 CD3D08          17      CALL    FILEI
                                
0006F9 07F9 0608             7      LD  B,8
       07FB                     FILE2:
0006FB 07FB CD4B08          17      CALL    CCHKF
0006FE 07FE C8              11      RET Z
0006FF 07FF FE2A             7      CP  '*'
000701 0801 282E            12      JR  Z,FILE9
000703 0803 FE2E             7      CP  '.'
000705 0805 280C            12      JR  Z,FILE4
000707 0807 77               7      LD  (HL),A
000708 0808 23               6      INC HL
000709 0809 10F0            13      DJNZ    FILE2
                                
       080B                     FILE3:
00070B 080B CD4B08          17      CALL    CCHKF
00070E 080E C8              11      RET Z
00070F 080F FE2E             7      CP  '.'
000711 0811 20F8            12      JR  NZ,FILE3
                                
       0813                     FILE4:
000713 0813 21D10A          10      LD  HL,FNAME+8
000716 0816 0603             7      LD  B,3
                                
       0818                     FILE4L:
000718 0818 CD4B08          17      CALL    CCHKF
00071B 081B C8              11      RET Z
00071C 081C FE2E             7      CP  '.'
00071E 081E 2008            12      JR  NZ,FILE12
000720 0820 32C90A          13      LD  (FNAME),A   ;Parent directory(..)
000723 0823 32CA0A          13      LD  (FNAME+1),A
000726 0826 3E20             7      LD  A,020H
       0828                     FILE12:
000728 0828 FE2A             7      CP  '*'
00072A 082A 280A            12      JR  Z,FILE10
00072C 082C 77               7      LD  (HL),A
00072D 082D 23               6      INC HL
00072E 082E 10E8            13      DJNZ    FILE4L
000730 0830 C9              10      RET
                                
       0831                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000731 0831 CD3608          17      CALL    FILE10
000734 0834 18D5            12      JR  FILE3
                                
       0836                     FILE10:
000736 0836 3E3F             7      LD  A,'?'
                                
       0838                     FILL_MEMORY:                ;HLからBバイトAで埋める
000738 0838 77               7      LD  (HL),A
000739 0839 23               6      INC HL
00073A 083A 10FC            13      DJNZ    FILL_MEMORY
00073C 083C C9              10      RET
                                
       083D                     FILEI:              ;名前＋拡張子をスペースで初期化
00073D 083D 3E20             7      LD  A,020H
00073F 083F 01000B          10      LD  BC,11*256
000742 0842 21C90A          10      LD  HL,FNAME
000745 0845 E5              11      PUSH    HL
000746 0846 CD3808          17      CALL    FILL_MEMORY
000749 0849 E1              10      POP HL
00074A 084A C9              10      RET
                                
       084B                     CCHKF:
00074B 084B 1A               7      LD  A,(DE)
00074C 084C CD5308          17      CALL    CCHK2
00074F 084F C8              11      RET Z
000750 0850 C39908          10      JP  FKAN
                                
       0853                     CCHK2:
000753 0853 0C               4      INC C
000754 0854 0D               4      DEC C
000755 0855 C0              11      RET NZ
       0856                     CCHK3:              ;ZF=1 で使えない文字
000756 0856 FE2B             7      CP  '+'
000758 0858 C8              11      RET Z
000759 0859 FE2C             7      CP  ','
00075B 085B C8              11      RET Z
00075C 085C FE2F             7      CP  '/'
00075E 085E C8              11      RET Z
00075F 085F FE3A             7      CP  ':'
000761 0861 C8              11      RET Z
000762 0862 FE3B             7      CP  ';'
000764 0864 C8              11      RET Z
000765 0865 FE3D             7      CP  '='
000767 0867 C8              11      RET Z
000768 0868 FE5C             7      CP  05CH    ;\
00076A 086A C8              11      RET Z
00076B 086B FE20             7      CP  020H
00076D 086D D0              11      RET NC
00076E 086E BF               4      CP  A       ;Z=1
00076F 086F C9              10      RET
                                
       0870                     SS1:
000770 0870 13               6      INC DE
       0871                     SPCUT:              ;スペースをカット
000771 0871 1A               7      LD  A,(DE)
000772 0872 FE20             7      CP  020H
000774 0874 28FA            12      JR  Z,SS1
000776 0876 C9              10      RET
                                
       0877                     CAP:
000777 0877 FE61             7      CP  'a'
000779 0879 D8              11      RET C
00077A 087A FE7B             7      CP  'z'+1
00077C 087C D0              11      RET NC
00077D 087D D620             7      SUB 020H
00077F 087F C9              10      RET
       0880                     CAP2:
000780 0880 CD7708          17      CALL    CAP
       0883                     CAP3:
000783 0883 CD8C08          17      CALL    CAP4
000786 0886 FE21             7      CP  021H
000788 0888 D0              11      RET NC
000789 0889 3E20             7      LD  A,020H
00078B 088B C9              10      RET
       088C                     CAP4:
00078C 088C FE05             7      CP  5
00078E 088E C0              11      RET NZ
00078F 088F 3EE5             7      LD  A,0E5H
000791 0891 C9              10      RET
                                
       0892                     FKANC:
000792 0892 CB41             8      BIT 0,C
000794 0894 CC8008          17      CALL    Z,CAP2
000797 0897 1801            12      JR  FKANX
       0899                     FKAN:           ;漢字チェック
000799 0899 13               6      INC DE
       089A                     FKANX:
00079A 089A CB41             8      BIT 0,C
00079C 089C CB81             8      RES 0,C
00079E 089E C0              11      RET NZ
00079F 089F FE80             7      CP  080H
0007A1 08A1 D8              11      RET C
0007A2 08A2 FEA0             7      CP  0A0H
0007A4 08A4 3803            12      JR  C,FKAN1
0007A6 08A6 FEE0             7      CP  0E0H
0007A8 08A8 D8              11      RET C
       08A9                     FKAN1:
0007A9 08A9 0C               4      INC C
0007AA 08AA A7               4      AND A
0007AB 08AB C9              10      RET
                                
       08AC                     CHKWILDX:
0007AC 08AC FDE5            15      PUSH    IY
0007AE 08AE E1              10      POP HL
0007AF 08AF 23               6      INC HL
       08B0                     CHKWILD:
0007B0 08B0 060B             7      LD  B,11
0007B2 08B2 3E3F             7      LD  A,'?'
       08B4                     CHKWIL1:
0007B4 08B4 BE               7      CP  (HL)
0007B5 08B5 23               6      INC HL
0007B6 08B6 37               4      SCF
0007B7 08B7 C8              11      RET Z
0007B8 08B8 10FA            13      DJNZ    CHKWIL1
0007BA 08BA AF               4      XOR A
0007BB 08BB C9              10      RET
                                
       08BC                     CPNAME:
0007BC 08BC C5              11      PUSH    BC
0007BD 08BD D5              11      PUSH    DE
0007BE 08BE 11B80A          10      LD  DE,CPBUF
0007C1 08C1 010400          10      LD  BC,4
0007C4 08C4 EDB0                    LDIR
0007C6 08C6 D1              10      POP DE
0007C7 08C7 D5              11      PUSH    DE
0007C8 08C8 E5              11      PUSH    HL
0007C9 08C9 21B80A          10      LD  HL,CPBUF
0007CC 08CC CDDF08          17      CALL    CPFILE
0007CF 08CF E1              10      POP HL
0007D0 08D0 D1              10      POP DE
0007D1 08D1 C1              10      POP BC
0007D2 08D2 2005            12      JR  NZ,CPNAME1
0007D4 08D4 7E               7      LD  A,(HL)
0007D5 08D5 23               6      INC HL
0007D6 08D6 66               7      LD  H,(HL)
0007D7 08D7 6F               4      LD  L,A
0007D8 08D8 C9              10      RET
       08D9                     CPNAME1:
0007D9 08D9 23               6      INC HL
0007DA 08DA 23               6      INC HL
0007DB 08DB 10DF            13      DJNZ    CPNAME
0007DD 08DD 37               4      SCF
0007DE 08DE C9              10      RET
                                
       08DF                     CPFILE:
0007DF 08DF C5              11      PUSH    BC
0007E0 08E0 01000B          10      LD  BC,00B00H
       08E3                     CPSTR1:
0007E3 08E3 1A               7      LD  A,(DE)
0007E4 08E4 FE3F             7      CP  '?'     ;Wild card
0007E6 08E6 2812            12      JR  Z,CPSTR2
0007E8 08E8 7E               7      LD  A,(HL)
0007E9 08E9 CD9208          17      CALL    FKANC
0007EC 08EC E5              11      PUSH    HL
0007ED 08ED 67               4      LD  H,A
0007EE 08EE 1A               7      LD  A,(DE)
0007EF 08EF CB01             4      RLC C
0007F1 08F1 CD9208          17      CALL    FKANC
0007F4 08F4 CB09             4      RRC C
0007F6 08F6 BC               4      CP  H       ;CP (HL),(DE)
0007F7 08F7 E1              10      POP HL
0007F8 08F8 2004            12      JR  NZ,CPSTR3
       08FA                     CPSTR2:
0007FA 08FA 13               6      INC DE
0007FB 08FB 23               6      INC HL
0007FC 08FC 10E5            13      DJNZ    CPSTR1
       08FE                     CPSTR3:
0007FE 08FE C1              10      POP BC
0007FF 08FF C9              10      RET
                                
       0900                     CPFILE2:
000800 0900 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
000803 0903 F6E1             7      OR  0E1H
000805 0905 2F               4      CPL
000806 0906 A6               7      AND (HL)
000807 0907 C9              10      RET
                                
       0908                     _SYS29:     ;(BDOS)ファイル名の解析
000808 0908 C5              11      PUSH    BC
000809 0909 E5              11      PUSH    HL
00080A 090A CD9507          17      CALL    FILE
00080D 090D E1              10      POP HL
00080E 090E C1              10      POP BC
       090F                     S29X1:
00080F 090F C5              11      PUSH    BC
000810 0910 D5              11      PUSH    DE
000811 0911 E5              11      PUSH    HL
000812 0912 EB               4      EX  DE,HL
000813 0913 21C80A          10      LD  HL,FDRV
000816 0916 010D00          10      LD  BC,13
000819 0919 EDB0                    LDIR
00081B 091B 70               7      LD  (HL),B      ;B=0
00081C 091C 0E03             7      LD  C,3
00081E 091E EDB0                    LDIR
000820 0920 E1              10      POP HL
000821 0921 D1              10      POP DE
000822 0922 C1              10      POP BC
000823 0923 AF               4      XOR A
000824 0924 C9              10      RET
       0925                     GET_WIDTH:
000825 0925 3A110A          13      LD  A,(IS_MSX)
000828 0928 B7               4      OR  A
000829 0929 2804            12      JR  Z,NOT_MSX
00082B 092B 3AB0F3          13      LD  A,(LINLEN)
00082E 092E C9              10      RET
       092F                     NOT_MSX:
00082F 092F E5              11      PUSH    HL
000830 0930 2A0A00          16      LD  HL,(BASE-1)
000833 0933 2EB1             7      LD  L,0B1H
000835 0935 7E               7      LD  A,(HL)
000836 0936 E1              10      POP HL
000837 0937 C9              10      RET
                                
       0938                     KEYBS:
000838 0938 B7               4      OR  A
000839 0939 C8              11      RET Z
       093A                     KEYBS1:
00083A 093A D5              11      PUSH    DE
00083B 093B E5              11      PUSH    HL
00083C 093C F5              11      PUSH    AF
00083D 093D 2AF8F3          16      LD  HL,(PUTPNT)
000840 0940 23               6      INC HL
000841 0941 1118FC          10      LD  DE,KEYBUFE
000844 0944 A7               4      AND A
000845 0945 ED52            15      SBC HL,DE
000847 0947 19              11      ADD HL,DE
000848 0948 2003            12      JR  NZ,KEYBS2
00084A 094A 21F0FB          10      LD  HL,KEYBUF
       094D                     KEYBS2:
00084D 094D ED5BFAF3        20      LD  DE,(GETPNT)
000851 0951 A7               4      AND A
000852 0952 ED52            15      SBC HL,DE
000854 0954 19              11      ADD HL,DE
000855 0955 280C            12      JR  Z,KEYBS3
000857 0957 F1              10      POP AF
000858 0958 ED5BF8F3        20      LD  DE,(PUTPNT)
00085C 095C 12               7      LD  (DE),A
00085D 095D 22F8F3          16      LD  (PUTPNT),HL
000860 0960 E1              10      POP HL
000861 0961 D1              10      POP DE
000862 0962 C9              10      RET
       0963                     KEYBS3:
000863 0963 F1              10      POP AF
000864 0964 E1              10      POP HL
000865 0965 D1              10      POP DE
000866 0966 C9              10      RET
                                
       0967                     C_MODE:
000867 0967 3A110A          13      LD  A,(IS_MSX)
00086A 096A B7               4      OR  A
00086B 096B C8              11      RET Z
00086C 096C CD9509          17      CALL    GETNUM
00086F 096F 7D               4      LD  A,L
000870 0970 B7               4      OR  A
000871 0971 2009            12      JR  NZ,MODE1
000873 0973 3AAEF3          13      LD  A,(LINL40)
000876 0976 CD6E05          17      CALL    PRDEC_A
000879 0979 C33D04          10      JP  LTNL
       097C                     MODE1:
00087C 097C 32AEF3          13      LD  (LINL40),A
00087F 097F FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000883 0983 DD216C00        14      LD  IX,INITXT
000887 0987 CD1C00          17      CALL    CALSLT
00088A 098A FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
00088E 098E DD217800        14      LD  IX,SETTXT
000892 0992 C31C00          10      JP  CALSLT
                                
       0995                     GETNUM:
000895 0995 CD7108          17      CALL    SPCUT
000898 0998 210000          10      LD  HL,0
       099B                     GETNUM1:
00089B 099B 1A               7      LD  A,(DE)
00089C 099C 13               6      INC DE
00089D 099D D630             7      SUB '0'
00089F 099F D8              11      RET C
0008A0 09A0 FE0A             7      CP  10
0008A2 09A2 D0              11      RET NC
0008A3 09A3 4D               4      LD  C,L
0008A4 09A4 44               4      LD  B,H
0008A5 09A5 29              11      ADD HL,HL   ;*2
0008A6 09A6 29              11      ADD HL,HL   ;*4
0008A7 09A7 09              11      ADD HL,BC   ;*5
0008A8 09A8 29              11      ADD HL,HL   ;*10
0008A9 09A9 4F               4      LD  C,A
0008AA 09AA 0600             7      LD  B,0
0008AC 09AC 09              11      ADD HL,BC
0008AD 09AD 18EC            12      JR  GETNUM1
                                
       000A                     COMS    EQU 10
       09AF                     COMTB:
0008AF 09AF 44202020                DB  "D   "  ;1
0008B3 09B3 8D03                    DW  C_DIR
0008B5 09B5 44495220                DB  "DIR "  ;2
0008B9 09B9 8D03                    DW  C_DIR
0008BB 09BB 434F5059                DB  "COPY"  ;3
0008BF 09BF C405                    DW  C_COPY
0008C1 09C1 43442020                DB  "CD  "  ;4
0008C5 09C5 6402                    DW  C_CD
0008C7 09C7 44454C20                DB  "DEL "  ;5
0008CB 09CB 6E03                    DW  C_DEL
0008CD 09CD 50415448                DB  "PATH"  ;6
0008D1 09D1 4704                    DW  C_PATH
0008D3 09D3 52454E20                DB  "REN "  ;7
0008D7 09D7 7A03                    DW  C_REN
0008D9 09D9 54595045                DB  "TYPE"  ;8
0008DD 09DD EE06                    DW  C_TYPE
0008DF 09DF 52454D20                DB  "REM "  ;9
0008E3 09E3 6C03                    DW  C_REM
0008E5 09E5 4D4F4445                DB  "MODE"  ;10
0008E9 09E9 6709                    DW  C_MODE
                                
0008EB 09EB 2062797465732066    FREE:   DB  " bytes free  $"
            726565202024        
0008F9 09F9 2020203C4449523E    DIRMES: DB  "   <DIR>$"
            24                  
000902 0A02 4F4B24              OK: DB  "OK$"
000905 0A05 536B697024          SKIP:   DB  "Skip$"
00090A 0A0A 4572726F722124      COMERM: DB  "Error!$"
                                
       0A11                     IS_MSX:
000911 0A11 00                      DB  0
       0A12                     MAJOR_VER:
000912 0A12 00                      DB  0
                                
       0A13                     SEARCH_IX:; EQU $4000
000913 0A13                         DS  64  ;DOS2用
                                
       0A53                     PATH_CCP:;  EQU $5000
000953 0A53                         DS  64  ;DOS2用
                                
       0A93                     DTA_CCP:;       EQU $6000
000993 0A93                         DS  37
       0AB8                     CPBUF:
0009B8 0AB8 0000                LEFTX:  DW  0
0009BA 0ABA 0000                DTAX:   DW  0
0009BC 0ABC 20                      DB  020H    ;CPBUFで使う
0009BD 0ABD 20                      DB  020H
0009BE 0ABE 20                      DB  020H
0009BF 0ABF 20                      DB  020H
0009C0 0AC0 20                      DB  020H
0009C1 0AC1 20                      DB  020H
0009C2 0AC2 20                      DB  020H
                                
       0AC3                     DECBF:
0009C3 0AC3                         DS  5
       0AC8                     FDRV:
0009C8 0AC8 00                      DB  0
       0AC9                     FNAME:
0009C9 0AC9                         DS  37
       0AEE                     ZERO:
0009EE 0AEE 00                      DB  0
                                
       0AEF                     DATA:
[EOF:COMMAND.ASM:SHIFT_JIS]
