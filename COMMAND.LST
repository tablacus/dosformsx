                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                
                                ;   似非COMMAND.COM
                                
       0005                     SYSTEM  EQU 00005H
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
       000C                     RDSLT   EQU 0000CH
       001C                     CALSLT  EQU 0001CH
       006C                     INITXT  EQU 0006CH
       006F                     INIT32  EQU 0006FH
       0078                     SETTXT  EQU 00078H
       007B                     SETT32  EQU 0007BH
       0147                     FORMAT  EQU 00147H
                                
       F3AE                     LINL40  EQU 0F3AEH
       F3AF                     LINL32  EQU 0F3AFH
       F3B0                     LINLEN  EQU 0F3B0H
       F55E                     BUF EQU 0F55EH
       FAF8                     EXBRSA  EQU 0FAF8H
       FC9B                     INTFLG  EQU 0FC9BH
       FCC1                     EXPTBL  EQU 0FCC1H
                                
                                
       0040                     PATHX   EQU 64
                                
       8000                     DATA    EQU 08000H
                                
000000 0100                         ORG 0100H
000000 0100 C31501          10      JP  START
000003 0103 0D0A434F4D4D414E    VER:    DB  00DH,00AH,"COMMAND v0.12",00DH,00AH,'$'
            442076302E31320D    
            0A24                
       0115                     START:
000015 0115 ED7B0600        20      LD  SP,(SYSTEM+1)
000019 0119 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
00001B 011B CD0500          17      CALL    SYSTEM
00001E 011E D8              11      RET C
00001F 011F 211D01          10      LD  HL,0011DH
000022 0122 ED42            15      SBC HL,BC
000024 0124 78               4      LD  A,B
000025 0125 32950F          13      LD  (MAJOR_VER),A
000028 0128 B5               4      OR  L
000029 0129 32940F          13      LD  (IS_MSX),A
00002C 012C B7               4      OR  A
00002D 012D 2850            12      JR  Z,WSTART
                                
00002F 012F 3A9011          13      LD  A,(PROCESS)
000032 0132 0E61             7      LD  C,61H       ;(BDOS)親プロセスに戻る
000034 0134 47               4      LD  B,A
000035 0135 B7               4      OR  A
000036 0136 C40500          17      CALL    NZ,SYSTEM
000039 0139 AF               4      XOR A
00003A 013A 329011          13      LD  (PROCESS),A
                                
00003D 013D 212B00          10      LD  HL,002BH    ;キャラクターセット・日時フォーマット・ビデオ信号の種別
000040 0140 CD0C00          17      CALL    RDSLT
000043 0143 0F               4      RRCA
000044 0144 0F               4      RRCA
000045 0145 0F               4      RRCA
000046 0146 0F               4      RRCA
000047 0147 E603             7      AND 3
000049 0149 2814            12      JR  Z,DATEOK
00004B 014B 3D               4      DEC A
00004C 014C 21780F          10      LD  HL,V_DATE1
00004F 014F 2806            12      JR  Z,DATECHG
000051 0151 3D               4      DEC A
000052 0152 21800F          10      LD  HL,V_DATE2
000055 0155 2008            12      JR  NZ,DATEOK
       0157                     DATECHG:
000057 0157 11680F          10      LD  DE,V_DATE
00005A 015A 010800          10      LD  BC,8
00005D 015D EDB0                    LDIR
       015F                     DATEOK:
00005F 015F CD9A0C          17      CALL    INIT_VAR
                                
000062 0162 2A0600          16      LD  HL,(SYSTEM+1)
000065 0165 2EDB             7      LD  L,256-37
000067 0167 24               4      INC H
000068 0168 228B11          16      LD  (FCB_BAT),HL
00006B 016B 3A8000          13      LD  A,(DTA1)
00006E 016E B7               4      OR  A
00006F 016F 280E            12      JR  Z,WSTART
000071 0171 110301          10      LD  DE,VER
000074 0174 0E09             7      LD  C,9
000076 0176 CD0500          17      CALL    SYSTEM
000079 0179 118100          10      LD  DE,DTA1+1
00007C 017C CDCC01          17      CALL    COMANL
       017F                     WSTART:
00007F 017F 21D70E          10      LD  HL,N_APPEND
000082 0182 11DE0E          10      LD  DE,V_APPEND
000085 0185 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000087 0187 CD0500          17      CALL    SYSTEM
                                
00008A 018A CD5905          17      CALL    LTNL
       018D                     COMMAND:
00008D 018D E5              11      PUSH    HL
00008E 018E 2A8B11          16      LD  HL,(FCB_BAT)
000091 0191 7E               7      LD  A,(HL)
000092 0192 E1              10      POP HL
000093 0193 B7               4      OR  A
000094 0194 C20D04          10      JP  NZ,C_BAT1
000097 0197 CD2103          17      CALL    SETDTA1
00009A 019A D5              11      PUSH    DE
00009B 019B C5              11      PUSH    BC
00009C 019C E5              11      PUSH    HL
00009D 019D 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
00009F 019F CD0500          17      CALL    SYSTEM
0000A2 01A2 E1              10      POP HL
0000A3 01A3 C1              10      POP BC
0000A4 01A4 C641             7      ADD A,'A'
0000A6 01A6 CDC809          17      CALL    MSG_A
0000A9 01A9 1E3E             7      LD  E,'>'
0000AB 01AB CDB709          17      CALL    _PRINT
0000AE 01AE D1              10      POP DE      ;DE=DTA1
0000AF 01AF 3E50             7      LD  A,80
0000B1 01B1 12               7      LD  (DE),A
0000B2 01B2 0E0A             7      LD  C,0AH       ;(BDOS)文字列入力
0000B4 01B4 CD0500          17      CALL    SYSTEM
0000B7 01B7 CD5905          17      CALL    LTNL
       01BA                     COMMAND2:
0000BA 01BA 118200          10      LD  DE,DTA1+2
0000BD 01BD CDCC01          17      CALL    COMANL
0000C0 01C0 30CB            12      JR  NC,COMMAND
0000C2 01C2 11850E          10      LD  DE,COMERM
0000C5 01C5 0E09             7      LD  C,9     ;(BDOS)文字列出力
0000C7 01C7 CD0500          17      CALL    SYSTEM
0000CA 01CA 18B3            12      JR  WSTART
                                
       01CC                     COMANL:
0000CC 01CC CDEC0A          17      CALL    TOZERO
0000CF 01CF CD090A          17      CALL    FILE
0000D2 01D2 D5              11      PUSH    DE
0000D3 01D3 116511          10      LD  DE,FNAME
0000D6 01D6 1A               7      LD  A,(DE)
0000D7 01D7 FE20             7      CP  020H
0000D9 01D9 285C            12      JR  Z,SDVSW
0000DB 01DB 1B               6      DEC DE
0000DC 01DC 1A               7      LD  A,(DE)
0000DD 01DD C6FF             7      ADD A,0FFH
0000DF 01DF 380A            12      JR  C,COMB
0000E1 01E1 13               6      INC DE
                                
0000E2 01E2 21D20D          10      LD  HL,COMTB
0000E5 01E5 3E11             7      LD  A,COMS
0000E7 01E7 47               4      LD  B,A
0000E8 01E8 CD3E0B          17      CALL    CPNAME
       01EB                     COMB:
0000EB 01EB D1              10      POP DE
0000EC 01EC D2B609          10      JP  NC,JP_HL
       01EF                     COMB2:
0000EF 01EF EB               4      EX  DE,HL
0000F0 01F0 22AD03          16      LD  (COMPAT+1),HL
0000F3 01F3 CD7003          17      CALL    CEXE4
                                
0000F6 01F6 211E0F          10      LD  HL,N_PATH
0000F9 01F9 11230F          10      LD  DE,V_PATH
0000FC 01FC 0640             7      LD  B,PATHX
0000FE 01FE 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000100 0200 CD0500          17      CALL    SYSTEM
                                
000103 0203 21230F          10      LD  HL,V_PATH
000106 0206 228D11          16      LD  (X_PATH),HL
       0209                     CEX1:
000109 0209 2A8D11          16      LD  HL,(X_PATH)
00010C 020C 7E               7      LD  A,(HL)
00010D 020D FE20             7      CP  020H
00010F 020F D8              11      RET C
       0210                     CEX2:
000110 0210 7E               7      LD  A,(HL)
000111 0211 FE20             7      CP  020H
000113 0213 3807            12      JR  C,CEX3
000115 0215 FE3B             7      CP  ';'
000117 0217 2803            12      JR  Z,CEX3
000119 0219 23               6      INC HL
00011A 021A 18F4            12      JR  CEX2
       021C                     CEX3:
00011C 021C 3600            10      LD  (HL),0
00011E 021E FE20             7      CP  020H
000120 0220 3801            12      JR  C,CEX4
000122 0222 23               6      INC HL
       0223                     CEX4:
000123 0223 ED5B8D11        20      LD  DE,(X_PATH)
000127 0227 228D11          16      LD  (X_PATH),HL
00012A 022A 21D70E          10      LD  HL,N_APPEND
00012D 022D 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
00012F 022F CD0500          17      CALL    SYSTEM
                                
000132 0232 CD7003          17      CALL    CEXE4
000135 0235 18D2            12      JR  CEX1
                                
       0237                     SDVSW:
000137 0237 F1              10      POP AF
000138 0238 3A6411          13      LD  A,(FDRV)
00013B 023B 3D               4      DEC A
00013C 023C 5F               4      LD  E,A
00013D 023D 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
00013F 023F C32803          10      JP  SYSTEM0
                                
       0242                     OPEN_D2:            ;DOS2対応
000142 0242 3A950F          13      LD  A,(MAJOR_VER)
000145 0245 FE02             7      CP  2
000147 0247 384F            12      JR  C,OPEN
000149 0249 115D10          10      LD  DE,PATH_FN1
00014C 024C 180A            12      JR  OPEN_D2X
       024E                     OPEN1_D2:           ;DOS2対応
00014E 024E 3A950F          13      LD  A,(MAJOR_VER)
000151 0251 FE02             7      CP  2
000153 0253 3840            12      JR  C,OPEN1
                                
000155 0255 11DB0F          10      LD  DE,PATH_CCP
       0258                     OPEN_D2X:
000158 0258 DD21960F        14      LD  IX,SEARCH_IX
00015C 025C 014010          10      LD  BC,01040H   ;(BDOS)最初のエントリ検索
00015F 025F CD0500          17      CALL    SYSTEM
000162 0262 F5              11      PUSH    AF
000163 0263 111B10          10      LD  DE,PATH_PAR
000166 0266 0E5E             7      LD  C,05EH      ;(BDOS)完全なパス文字列の獲得(_WPATH)
000168 0268 CD0500          17      CALL    SYSTEM
00016B 026B AF               4      XOR A
00016C 026C 77               7      LD  (HL),A
00016D 026D 111B10          10      LD  DE,PATH_PAR
000170 0270 ED52            15      SBC HL,DE
000172 0272 225B10          16      LD  (PATH_POS),HL
000175 0275 F1              10      POP AF
       0276                     FIB2DIRENT:
000176 0276 B7               4      OR  A
000177 0277 C0              11      RET NZ
                                
000178 0278 11970F          10      LD  DE,SEARCH_IX+1
00017B 027B 212F11          10      LD  HL,DTA_CCP+1
00017E 027E 0E5C             7      LD  C,05CH      ;(BDOS)ファイル名の解析
000180 0280 CD0500          17      CALL    SYSTEM
                                
000183 0283 21A40F          10      LD  HL,SEARCH_IX+14
000186 0286 113A11          10      LD  DE,DTA_CCP+1+8+3
000189 0289 EDA0            16      LDI
00018B 028B 114511          10      LD  DE,DTA_CCP+1+8+3+1+10
00018E 028E 010A00          10      LD  BC,2+2+2+4  ;最終変更時刻+最終変更日付+開始クラスタ+ファイルサイズ
000191 0291 EDB0                    LDIR
000193 0293 AF               4      XOR A
000194 0294 C9              10      RET
                                
       0295                     OPEN1:
000195 0295 216411          10      LD  HL,FDRV
       0298                     OPEN:
000198 0298 0E11             7      LD  C,011H      ;(BDOS)最初のファイルの検索
       029A                     OPEN3:
00019A 029A D5              11      PUSH    DE
00019B 029B 112E11          10      LD  DE,DTA_CCP
00019E 029E CD1403          17      CALL    SETDTA
0001A1 02A1 EB               4      EX  DE,HL
0001A2 02A2 CD0500          17      CALL    SYSTEM
0001A5 02A5 D1              10      POP DE
0001A6 02A6 B7               4      OR  A
0001A7 02A7 C9              10      RET
                                
       02A8                     OPEN2_D2:           ;DOS2対応
0001A8 02A8 3A950F          13      LD  A,(MAJOR_VER)
0001AB 02AB FE02             7      CP  2
0001AD 02AD 380B            12      JR  C,OPEN2
0001AF 02AF DD21960F        14      LD  IX,SEARCH_IX
0001B3 02B3 0E41             7      LD  C,41H       ;(BDOS)次のエントリ検索
0001B5 02B5 CD0500          17      CALL    SYSTEM
0001B8 02B8 18BC            12      JR  FIB2DIRENT
       02BA                     OPEN2:
0001BA 02BA 0E12             7      LD  C,012H
0001BC 02BC 18DC            12      JR  OPEN3
                                
       02BE                     DEFCB_D2:           ;DOS2対応
0001BE 02BE 3A950F          13      LD  A,(MAJOR_VER)
0001C1 02C1 FE02             7      CP  2
0001C3 02C3 3837            12      JR  C,DEFCB
0001C5 02C5 211B10          10      LD  HL,PATH_PAR
0001C8 02C8 11DB0F          10      LD  DE,PATH_CCP
0001CB 02CB 014000          10      LD  BC,64
0001CE 02CE EDB0                    LDIR
0001D0 02D0 2A5B10          16      LD  HL,(PATH_POS)
0001D3 02D3 11DB0F          10      LD  DE,PATH_CCP
0001D6 02D6 19              11      ADD HL,DE
0001D7 02D7 060D             7      LD  B,13
0001D9 02D9 11970F          10      LD  DE,SEARCH_IX+1
       02DC                     DCB4:
0001DC 02DC 1A               7      LD  A,(DE)
0001DD 02DD B7               4      OR  A
0001DE 02DE 2805            12      JR  Z,DCB5
0001E0 02E0 13               6      INC DE
0001E1 02E1 77               7      LD  (HL),A
0001E2 02E2 23               6      INC HL
0001E3 02E3 18F7            12      JR  DCB4
       02E5                     DCB5:
0001E5 02E5 3600            10      LD  (HL),0
0001E7 02E7 3AAF0F          13      LD  A,(SEARCH_IX+25)
0001EA 02EA C640             7      ADD A,040H
0001EC 02EC 11D80F          10      LD  DE,PATH_DRV
0001EF 02EF 12               7      LD  (DE),A
0001F0 02F0 0E43             7      LD  C,043H      ;_OPEN ファイルハンドルのオープン
0001F2 02F2 3E01             7      LD  A,1     ;書き込み禁止
0001F4 02F4 CD0500          17      CALL    SYSTEM
0001F7 02F7 ED43D60F        20      LD  (HANDLE1),BC
0001FB 02FB C9              10      RET
       02FC                     DEFCB:              ;Z=Ok NZ=Error
0001FC 02FC 112E11          10      LD  DE,DTA_CCP
0001FF 02FF CD2603          17      CALL    SYSC0F
000202 0302 B7               4      OR  A
000203 0303 C0              11      RET NZ
                                
000204 0304 210100          10      LD  HL,1
000207 0307 223C11          16      LD  (DTA_CCP+14),HL
00020A 030A 2D               4      DEC L
00020B 030B 224F11          16      LD  (DTA_CCP+33),HL
00020E 030E 225111          16      LD  (DTA_CCP+35),HL
       0311                     SETDTA100:
000211 0311 110080          10      LD  DE,DATA
       0314                     SETDTA:
000214 0314 C5              11      PUSH    BC
000215 0315 D5              11      PUSH    DE
000216 0316 E5              11      PUSH    HL
000217 0317 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
000219 0319 CD0500          17      CALL    SYSTEM
00021C 031C E1              10      POP HL
00021D 031D D1              10      POP DE
00021E 031E C1              10      POP BC
00021F 031F AF               4      XOR A
000220 0320 C9              10      RET
                                
       0321                     SETDTA1:
000221 0321 118000          10      LD  DE,DTA1
000224 0324 18EE            12      JR  SETDTA
                                
       0326                     SYSC0F:
000226 0326 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       0328                     SYSTEM0:
000228 0328 CD0500          17      CALL    SYSTEM
00022B 032B B7               4      OR  A
00022C 032C C9              10      RET
                                
       032D                     C_CD:
00022D 032D CDDB09          17      CALL    FILEC_D2
000230 0330 11DB0F          10      LD  DE,PATH_CCP
000233 0333 1A               7      LD  A,(DE)
000234 0334 FE20             7      CP  020H
000236 0336 3805            12      JR  C,PWD
000238 0338 0E5A             7      LD  C,5AH       ;(BDOS)_CHDIR カレントディレクトリの変更
00023A 033A C30500          10      JP  SYSTEM
       033D                     PWD:
00023D 033D CD9F05          17      CALL    PUTDRV
000240 0340 3E5C             7      LD  A,05CH
000242 0342 CDC809          17      CALL    MSG_A
000245 0345 C30405          10      JP  PDSKF2
                                
       0348                     S27DTA_D2:      ;DOS2対応
000248 0348 3A950F          13      LD  A,(MAJOR_VER)
00024B 034B FE02             7      CP  2
00024D 034D 3810            12      JR  C,S27DTA
00024F 034F ED4BD60F        20      LD  BC,(HANDLE1)
000253 0353 110080          10      LD  DE,DATA
000256 0356 0E48             7      LD  C,048H      ;(BDOS)ファイルハンドルからの読み出し(_READ)
000258 0358 CD2803          17      CALL    SYSTEM0
00025B 035B C8              11      RET Z
00025C 035C 37               4      SCF
00025D 035D 9F               4      SBC A,A
00025E 035E C9              10      RET
                                
       035F                     S27DTA:
00025F 035F 110100          10      LD  DE,1
000262 0362 ED533C11        20      LD  (DTA_CCP+14),DE
000266 0366 112E11          10      LD  DE,DTA_CCP
       0369                     S27:
000269 0369 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
00026B 036B CD0500          17      CALL    SYSTEM
00026E 036E B7               4      OR  A
00026F 036F C9              10      RET
                                
       0370                     CEXE4:
000270 0370 216411          10      LD  HL,FDRV
000273 0373 112E11          10      LD  DE,DTA_CCP
000276 0376 010900          10      LD  BC,1+8
000279 0379 EDB0                    LDIR
00027B 037B 213711          10      LD  HL,DTA_CCP+9
00027E 037E 3643            10      LD  (HL),'C'
000280 0380 23               6      INC HL
000281 0381 364F            10      LD  (HL),'O'
000283 0383 23               6      INC HL
000284 0384 364D            10      LD  (HL),'M'
       0386                     C_EXE:
000286 0386 CDFC02          17      CALL    DEFCB
000289 0389 205A            12      JR  NZ,C_BAT
00028B 038B 119111          10      LD  DE,DATA_COM
00028E 038E CD1403          17      CALL    SETDTA
                                
000291 0391 2A0600          16      LD  HL,(SYSTEM+1)
000294 0394 119111          10      LD  DE,DATA_COM
000297 0397 ED52            15      SBC HL,DE
                                
000299 0399 CD5F03          17      CALL    S27DTA
00029C 039C 3D               4      DEC A
00029D 039D 37               4      SCF
00029E 039E C0              11      RET NZ
00029F 039F 7C               4      LD  A,H
0002A0 03A0 B5               4      OR  L
0002A1 03A1 37               4      SCF
0002A2 03A2 C8              11      RET Z
0002A3 03A3 22DF03          16      LD  (COMSIZ+1),HL
                                
0002A6 03A6 119111          10      LD  DE,DATA_COM
0002A9 03A9 CD1403          17      CALL    SETDTA
0002AC 03AC 110000          10  COMPAT: LD  DE,0
0002AF 03AF CD4E07          17      CALL    SETFCB
                                
0002B2 03B2 21D70E          10      LD  HL,N_APPEND
0002B5 03B5 11DE0E          10      LD  DE,V_APPEND
0002B8 03B8 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0002BA 03BA CD0500          17      CALL    SYSTEM
                                
0002BD 03BD 0E60             7      LD  C,60H       ;(BDOS)子プロセスの起動
0002BF 03BF CD0500          17      CALL    SYSTEM
0002C2 03C2 B7               4      OR  A
0002C3 03C3 2004            12      JR  NZ,COMP1
0002C5 03C5 78               4      LD  A,B
0002C6 03C6 329011          13      LD  (PROCESS),A
       03C9                     COMP1:
0002C9 03C9 AF               4      XOR A
0002CA 03CA 67               4      LD  H,A
0002CB 03CB 6F               4      LD  L,A ;HL=0x0000
0002CC 03CC F3               4      DI
0002CD 03CD ED7B0600        20  SPPAT:  LD  SP,(SYSTEM+1)
0002D1 03D1 E5              11      PUSH    HL
0002D2 03D2 21EDB0          10      LD  HL,0B0EDH   ;LDIR
0002D5 03D5 22FE00          16      LD  (000FEH),HL
0002D8 03D8 219111          10      LD  HL,DATA_COM
0002DB 03DB 110001          10      LD  DE,00100H
0002DE 03DE 010000          10  COMSIZ: LD  BC,0
0002E1 03E1 FB               4      EI
0002E2 03E2 C3FE00          10      JP  000FEH
                                
       03E5                     C_BAT:
0002E5 03E5 213711          10      LD  HL,DTA_CCP+9
0002E8 03E8 3642            10      LD  (HL),'B'
0002EA 03EA 23               6      INC HL
0002EB 03EB 3641            10      LD  (HL),'A'
0002ED 03ED 23               6      INC HL
0002EE 03EE 3654            10      LD  (HL),'T'
                                
0002F0 03F0 CDFC02          17      CALL    DEFCB
0002F3 03F3 C0              11      RET NZ
                                
0002F4 03F4 212E11          10      LD  HL,DTA_CCP
0002F7 03F7 7E               7      LD  A,(HL)
0002F8 03F8 B7               4      OR  A
0002F9 03F9 2009            12      JR  NZ,CBAT_DS
0002FB 03FB E5              11      PUSH    HL
0002FC 03FC 0E19             7      LD  C,019H      ;(BDOS)カレントドライブ番号の獲得(_CURDRV)
0002FE 03FE CD0500          17      CALL    SYSTEM
000301 0401 E1              10      POP HL
000302 0402 3C               4      INC A
000303 0403 77               7      LD  (HL),A
       0404                     CBAT_DS:
000304 0404 ED5B8B11        20      LD  DE,(FCB_BAT)
000308 0408 012500          10      LD  BC,37
00030B 040B EDB0                    LDIR
       040D                     C_BAT1:
00030D 040D CD1103          17      CALL    SETDTA100
000310 0410 CD4E04          17      CALL    FGETC_BAT
000313 0413 218100          10      LD  HL,DTA1+1
000316 0416 202A            12      JR  NZ,END_BATCH
000318 0418 FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
00031A 041A 38F1            12      JR  C,C_BAT1
00031C 041C 3620            10      LD  (HL),' '
00031E 041E 23               6      INC HL
       041F                     C_BAT2:
00031F 041F 77               7      LD  (HL),A
000320 0420 23               6      INC HL
000321 0421 7D               4      LD  A,L
000322 0422 3C               4      INC A       ;L==0FFH
000323 0423 2809            12      JR  Z,RUN_BATCH
000325 0425 CD4E04          17      CALL    FGETC_BAT
000328 0428 2004            12      JR  NZ,RUN_BATCH
00032A 042A FE20             7      CP  020H
00032C 042C 30F1            12      JR  NC,C_BAT2
       042E                     RUN_BATCH:
00032E 042E 7D               4      LD  A,L
00032F 042F D67F             7      SUB DTA1-1
000331 0431 328000          13      LD  (DTA1),A
000334 0434 FE04             7      CP  4
000336 0436 380A            12      JR  C,END_BATCH
000338 0438 3600            10      LD  (HL),0
00033A 043A 3A9BFC          13      LD  A,(INTFLG)
00033D 043D FE03             7      CP  3
00033F 043F C2BA01          10      JP  NZ,COMMAND2
       0442                     END_BATCH:      ;バッチファイルを閉じる
000342 0442 2A8B11          16      LD  HL,(FCB_BAT)
000345 0445 3600            10      LD  (HL),0
000347 0447 ED7B0600        20      LD  SP,(SYSTEM+1)
00034B 044B C37F01          10      JP  WSTART
                                
       044E                     FGETC_BAT:
00034E 044E ED5B8B11        20      LD  DE,(FCB_BAT)
       0452                     FGETC:              ;1文字ずつ読み込む
000352 0452 E5              11      PUSH    HL      ;Z:成功
000353 0453 210100          10      LD  HL,1
000356 0456 CD6903          17      CALL    S27
000359 0459 E1              10      POP HL
00035A 045A 3A0080          13      LD  A,(DATA)
00035D 045D C9              10      RET
                                
       045E                     C_REM:
00035E 045E AF               4      XOR A
00035F 045F C9              10      RET
                                
       0460                     C_DEL:
000360 0460 CD4E07          17      CALL    SETFCB
000363 0463 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力
000365 0465 CD0500          17      CALL    SYSTEM
                                
000368 0468 0E13             7      LD  C,013H
00036A 046A 1811            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       046C                     C_REN:
00036C 046C 3A950F          13      LD  A,(MAJOR_VER)
00036F 046F FE02             7      CP  2
000371 0471 3013            12      JR  NC,REN_DOS2
000373 0473 CD4E07          17      CALL    SETFCB
000376 0476 3E10             7      LD  A,010H      ;ディレクトリも対象にする(LSX-Dodgers)
000378 0478 326900          13      LD  (FCB1+13),A ;属性
00037B 047B 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       047D                     CDEL1:
00037D 047D 115C00          10      LD  DE,FCB1
       0480                     REN2:
000380 0480 CD0500          17      CALL    SYSTEM
000383 0483 C6FF             7      ADD A,0FFH
000385 0485 C9              10      RET
                                
       0486                     REN_DOS2:           ;DOS2のリネーム(ディレクトリ対応)
000386 0486 CDE60A          17      CALL    SPCUT
000389 0489 6B               4      LD  L,E
00038A 048A 62               4      LD  H,D
       048B                     REN_D2_1:
00038B 048B 7E               7      LD  A,(HL)
00038C 048C FE21             7      CP  020H+1
00038E 048E 3803            12      JR  C,REN_D2_2
000390 0490 23               6      INC HL
000391 0491 18F8            12      JR  REN_D2_1
       0493                     REN_D2_2:
000393 0493 3600            10      LD  (HL),0
000395 0495 23               6      INC HL
000396 0496 0E4E             7      LD  C,04EH      ;(BDOS)ファイルあるいはサブディレクトリ名の変更(_RENAME)
000398 0498 18E6            12      JR  REN2
                                
       049A                     C_DIR:
00039A 049A CDDB09          17      CALL    FILEC_D2
00039D 049D 216511          10      LD  HL,FDRV+1
0003A0 04A0 CD9C09          17      CALL    CWILD1
0003A3 04A3 3EF1             7      LD  A,0F1H
0003A5 04A5 327111          13      LD  (FDRV+13),A
0003A8 04A8 CD4E02          17      CALL    OPEN1_D2
       04AB                     CDIR1:
0003AB 04AB B7               4      OR  A
0003AC 04AC 2008            12      JR  NZ,PDSKF
0003AE 04AE CD3105          17      CALL    P_NAME
0003B1 04B1 CDA802          17      CALL    OPEN2_D2
0003B4 04B4 18F5            12      JR  CDIR1
                                
       04B6                     PDSKF:
0003B6 04B6 3A6411          13      LD  A,(FDRV)
0003B9 04B9 5F               4      LD  E,A
0003BA 04BA 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0003BC 04BC CD0500          17      CALL    SYSTEM
0003BF 04BF 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0003C0 04C0 C601             7      ADD A,001H
0003C2 04C2 D8              11      RET C       ;Aが0FFHだった場合
0003C3 04C3 3E06             7      LD  A,8-2
       04C5                     PDS1:               ;HL=未使用クラスタの総数
0003C5 04C5 3C               4      INC A
0003C6 04C6 CB19             8      RR  C
0003C8 04C8 30FB            12      JR  NC,PDS1
       04CA                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0003CA 04CA 3C               4      INC A
0003CB 04CB CB18             8      RR  B
0003CD 04CD 30FB            12      JR  NC,PDS2
0003CF 04CF 47               4      LD  B,A
                                
0003D0 04D0 110000          10      LD  DE,0
       04D3                     PDS3:
0003D3 04D3 29              11      ADD HL,HL
0003D4 04D4 EB               4      EX  DE,HL
0003D5 04D5 ED6A            15      ADC HL,HL
0003D7 04D7 EB               4      EX  DE,HL
0003D8 04D8 10F9            13      DJNZ    PDS3
       04DA                     PDSKF1:
0003DA 04DA CDBF05          17      CALL    PRDEC_DEHL
0003DD 04DD 116B0E          10      LD  DE,FREE
0003E0 04E0 0E09             7      LD  C,9     ;(BDOS)文字列出力
0003E2 04E2 CD0500          17      CALL    SYSTEM
0003E5 04E5 CD9F05          17      CALL    PUTDRV
0003E8 04E8 3E5C             7      LD  A,05CH
0003EA 04EA CDC809          17      CALL    MSG_A
0003ED 04ED 3A950F          13      LD  A,(MAJOR_VER)
0003F0 04F0 FE01             7      CP  1
0003F2 04F2 3865            12      JR  C,LTNL
0003F4 04F4 200E            12      JR  NZ,PDSKF2
0003F6 04F6 2A7211          16      LD  HL,(FDRV+14)
0003F9 04F9 AF               4      XOR A
0003FA 04FA 11FEFF          10      LD  DE,0-2
0003FD 04FD 19              11      ADD HL,DE
0003FE 04FE 23               6      INC HL
0003FF 04FF DCBB05          17      CALL    C,PRDEC_HL
000402 0502 1855            12      JR  LTNL
       0504                     PDSKF2:             ;MSX-DOS2
000404 0504 3A6411          13      LD  A,(FDRV)
000407 0507 47               4      LD  B,A     ;ドライブ
000408 0508 110080          10      LD  DE,DATA
00040B 050B 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
00040D 050D CD0500          17      CALL    SYSTEM
000410 0510 210080          10      LD  HL,DATA
                                
000413 0513 CD1B05          17      CALL    MSX
000416 0516 1841            12      JR  LTNL
                                
       0518                     MSX1:
000418 0518 CDC809          17      CALL    MSG_A
       051B                     MSX:
00041B 051B 7E               7      LD  A,(HL)
00041C 051C 23               6      INC HL
00041D 051D B7               4      OR  A
00041E 051E 20F8            12      JR  NZ,MSX1
000420 0520 C9              10      RET
                                
       0521                     MSXSLT1:
000421 0521 CDC809          17      CALL    MSG_A
       0524                     MSXSLT:
000424 0524 C5              11      PUSH    BC
000425 0525 E5              11      PUSH    HL
000426 0526 78               4      LD  A,B
000427 0527 CD0C00          17      CALL    RDSLT
00042A 052A E1              10      POP HL
00042B 052B C1              10      POP BC
00042C 052C 23               6      INC HL
00042D 052D B7               4      OR  A
00042E 052E 20F1            12      JR  NZ,MSXSLT1
000430 0530 C9              10      RET
                                
       0531                     P_NAME:
000431 0531 212F11          10      LD  HL,DTA_CCP+1
000434 0534 7E               7      LD  A,(HL)
000435 0535 FE2E             7      CP  '.'
000437 0537 C8              11      RET Z
000438 0538 CD1506          17      CALL    FPRNT
00043B 053B 3A3A11          13      LD  A,(DTA_CCP+12)
00043E 053E CB67             8      BIT 4,A
000440 0540 280A            12      JR  Z,DIR3
000442 0542 11790E          10      LD  DE,DIRMES
000445 0545 0E09             7      LD  C,9     ;(BDOS)文字列出力
000447 0547 CD0500          17      CALL    SYSTEM
00044A 054A 180A            12      JR  DIR6
       054C                     DIR3:
00044C 054C ED5B4D11        20      LD  DE,(DTA_CCP+1+01EH)
000450 0550 2A4B11          16      LD  HL,(DTA_CCP+1+01CH)
000453 0553 CDBF05          17      CALL    PRDEC_DEHL
       0556                     DIR6:
000456 0556 CD3706          17      CALL    PRTTMS
                                
       0559                     LTNL:
000459 0559 1E0D             7      LD  E,00DH
00045B 055B CDB709          17      CALL    _PRINT
00045E 055E 1E0A             7      LD  E,00AH
000460 0560 C3B709          10      JP  _PRINT
                                
       0563                     C_PATH:
000463 0563 CDE60A          17      CALL    SPCUT
000466 0566 FE21             7      CP  021H
000468 0568 301C            12      JR  NC,CPATH0
                                
00046A 056A 211E0F          10      LD  HL,N_PATH
00046D 056D 11230F          10      LD  DE,V_PATH
000470 0570 0640             7      LD  B,PATHX
000472 0572 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000474 0574 CD0500          17      CALL    SYSTEM
000477 0577 21230F          10      LD  HL,V_PATH
       057A                     CPATHP:
00047A 057A 7E               7      LD  A,(HL)
00047B 057B 23               6      INC HL
00047C 057C FE20             7      CP  020H
00047E 057E 3F               4      CCF
00047F 057F 30D8            12      JR  NC,LTNL
000481 0581 CDC809          17      CALL    MSG_A
000484 0584 18F4            12      JR  CPATHP
       0586                     CPATH0:
000486 0586 21230F          10      LD  HL,V_PATH
000489 0589 FE3B             7      CP  ';'
00048B 058B 2001            12      JR  NZ,CPATH1
00048D 058D 13               6      INC DE
       058E                     CPATH1:
00048E 058E EB               4      EX  DE,HL
00048F 058F 014000          10      LD  BC,PATHX
000492 0592 EDB0                    LDIR
                                
000494 0594 211E0F          10      LD  HL,N_PATH
000497 0597 11230F          10      LD  DE,V_PATH
00049A 059A 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
00049C 059C C30500          10      JP  SYSTEM
                                
       059F                     PUTDRV:
00049F 059F 3A6411          13      LD  A,(FDRV)
0004A2 05A2 B7               4      OR  A
0004A3 05A3 200C            12      JR  NZ,PUTDRV1
0004A5 05A5 C5              11      PUSH    BC
0004A6 05A6 D5              11      PUSH    DE
0004A7 05A7 E5              11      PUSH    HL
0004A8 05A8 0E19             7      LD  C,019H
0004AA 05AA CD0500          17      CALL    SYSTEM
0004AD 05AD E1              10      POP HL
0004AE 05AE D1              10      POP DE
0004AF 05AF C1              10      POP BC
0004B0 05B0 3C               4      INC A
       05B1                     PUTDRV1:
0004B1 05B1 C640             7      ADD A,'A'-1
0004B3 05B3 CDC809          17      CALL    MSG_A
0004B6 05B6 3E3A             7      LD  A,':'
       05B8                     MSG_AR:
0004B8 05B8 C3C809          10      JP  MSG_A
                                
       05BB                     PRDEC_HL:
0004BB 05BB AF               4      XOR A
       05BC                     PRDEC_AHL:
0004BC 05BC 5F               4      LD  E,A
0004BD 05BD 1600             7      LD  D,0
       05BF                     PRDEC_DEHL:
0004BF 05BF 3E02             7      LD  A,2
0004C1 05C1 320A06          13      LD  (DEC6+1),A
0004C4 05C4 AF               4      XOR A
0004C5 05C5 E5              11      PUSH    HL
0004C6 05C6 215E11          10      LD  HL,DECBF
0004C9 05C9 0605             7      LD  B,5
0004CB 05CB CDAD0A          17      CALL    FILL_MEMORY
0004CE 05CE E1              10      POP HL
                                
0004CF 05CF 0E20             7      LD  C,32
       05D1                     DEC1:
0004D1 05D1 29              11      ADD HL,HL
0004D2 05D2 EB               4      EX  DE,HL
0004D3 05D3 ED6A            15      ADC HL,HL
0004D5 05D5 EB               4      EX  DE,HL
0004D6 05D6 E5              11      PUSH    HL
0004D7 05D7 216211          10      LD  HL,DECBF+4
0004DA 05DA 0605             7      LD  B,5
       05DC                     DEC2:
0004DC 05DC 7E               7      LD  A,(HL)
0004DD 05DD 8F               4      ADC A,A
0004DE 05DE 27               4      DAA
0004DF 05DF 77               7      LD  (HL),A
0004E0 05E0 2B               6      DEC HL
0004E1 05E1 10F9            13      DJNZ    DEC2
0004E3 05E3 E1              10      POP HL
0004E4 05E4 0D               4      DEC C
0004E5 05E5 20EA            12      JR  NZ,DEC1
                                
0004E7 05E7 215E11          10      LD  HL,DECBF
0004EA 05EA 3E20             7      LD  A,020H
0004EC 05EC 0604             7      LD  B,4
       05EE                     DEC3:
0004EE 05EE CDFB05          17      CALL    DEC4
0004F1 05F1 CDFB05          17      CALL    DEC4
0004F4 05F4 23               6      INC HL
0004F5 05F5 10F7            13      DJNZ    DEC3
       05F7                     DECX:
0004F7 05F7 CDFB05          17      CALL    DEC4
0004FA 05FA AF               4      XOR A
       05FB                     DEC4:
0004FB 05FB ED6F            18      RLD
0004FD 05FD FE20             7      CP  020H
0004FF 05FF 2808            12      JR  Z,DEC6
000501 0601 F630             7      OR  030H
       0603                     DEC5:
000503 0603 18B3            12      JR  MSG_AR
       0605                     DEC7:
000505 0605 3E20             7      LD  A,020H
000507 0607 18AF            12      JR  MSG_AR
       0609                     DEC6:
000509 0609 3E02             7      LD  A,2
00050B 060B B7               4      OR  A
00050C 060C 28F7            12      JR  Z,DEC7
00050E 060E 3D               4      DEC A
00050F 060F 320A06          13      LD  (DEC6+1),A
000512 0612 3E20             7      LD  A,020H
000514 0614 C9              10      RET
                                
       0615                     FPRNT:
000515 0615 0608             7      LD  B,8
000517 0617 CD2806          17      CALL    P_N1
00051A 061A 7E               7      LD  A,(HL)
00051B 061B C680             7      ADD A,0A0H-020H
00051D 061D FEA0             7      CP  0A0H
00051F 061F 2802            12      JR  Z,FPR1
000521 0621 3E2E             7      LD  A,'.'
       0623                     FPR1:
000523 0623 CDC809          17      CALL    MSG_A
000526 0626 0603             7      LD  B,3
                                
       0628                     P_N1:
000528 0628 C5              11      PUSH    BC
000529 0629 E5              11      PUSH    HL
00052A 062A 7E               7      LD  A,(HL)
00052B 062B CD050B          17      CALL    CAP3
00052E 062E CDC809          17      CALL    MSG_A
000531 0631 E1              10      POP HL
000532 0632 C1              10      POP BC
000533 0633 23               6      INC HL
000534 0634 10F2            13      DJNZ    P_N1
000536 0636 C9              10      RET
                                
       0637                     PRTTMS:
000537 0637 3E20             7      LD  A,020H
000539 0639 CDC809          17      CALL    MSG_A
                                
00053C 063C 2A4711          16      LD  HL,(DTA_CCP+1+24)
00053F 063F 7D               4      LD  A,L
000540 0640 B7               4      OR  A
000541 0641 C8              11      RET Z
000542 0642 CB3C             8      SRL H
000544 0644 17               4      RLA
000545 0645 17               4      RLA
000546 0646 17               4      RLA
000547 0647 17               4      RLA
000548 0648 E60F             7      AND 00FH
00054A 064A 57               4      LD  D,A
00054B 064B DD21680F        14      LD  IX,V_DATE
       064F                     PRTTMS1:
00054F 064F DD7E00          19      LD  A,(IX+0)
000552 0652 B7               4      OR  A
000553 0653 2808            12      JR  Z,PRTTMS2
000555 0655 CDD806          17      CALL    PR_DATE
000558 0658 CD4307          17      CALL    PR_DATE_SPLITER
00055B 065B 18F2            12      JR  PRTTMS1
       065D                     PRTTMS2:
                                
00055D 065D CDC10B          17      CALL    GET_WIDTH
000560 0660 FE21             7      CP  32+1
000562 0662 3005            12      JR  NC,SHOW_TIME
000564 0664 3E1D             7      LD  A,01DH
000566 0666 C3C809          10      JP  MSG_A
       0669                     SHOW_TIME:
000569 0669 2A4511          16      LD  HL,(DTA_CCP+1+22)
                                
00056C 066C 3E20             7      LD  A,020H
00056E 066E CDC809          17      CALL    MSG_A
000571 0671 7C               4      LD  A,H
000572 0672 65               4      LD  H,L
000573 0673 1F               4      RRA
000574 0674 CB1D             8      RR  L
000576 0676 1F               4      RRA
000577 0677 CB1D             8      RR  L
000579 0679 1F               4      RRA
00057A 067A CB1D             8      RR  L
00057C 067C E61F             7      AND 01FH
00057E 067E 4F               4      LD  C,A
00057F 067F 3A8D0F          13      LD  A,(V_TIME)
000582 0682 FE31             7      CP  '1'
000584 0684 79               4      LD  A,C
000585 0685 200B            12      JR  NZ,TIME24
000587 0687 FE0C             7      CP  12
000589 0689 3802            12      JR  C,TIME12
00058B 068B D60C             7      SUB 12
       068D                     TIME12:
00058D 068D B7               4      OR  A
00058E 068E 2002            12      JR  NZ,TIME24
000590 0690 C60C             7      ADD A,12
       0692                     TIME24:
000592 0692 C5              11      PUSH    BC
000593 0693 CDC306          17      CALL    PRDEC_A
000596 0696 3E3A             7      LD  A,':'
000598 0698 CDC809          17      CALL    MSG_A
00059B 069B 7D               4      LD  A,L
00059C 069C 0F               4      RRCA
00059D 069D 0F               4      RRCA
00059E 069E E63F             7      AND 03FH
0005A0 06A0 CDC306          17      CALL    PRDEC_A
                                
0005A3 06A3 3E3A             7      LD  A,':'
0005A5 06A5 CDC809          17      CALL    MSG_A
0005A8 06A8 7C               4      LD  A,H
0005A9 06A9 E61F             7      AND 01FH
0005AB 06AB 87               4      ADD A,A
0005AC 06AC CDC306          17      CALL    PRDEC_A
                                
0005AF 06AF 3A8D0F          13      LD  A,(V_TIME)
0005B2 06B2 FE31             7      CP  '1'
0005B4 06B4 C1              10      POP BC
0005B5 06B5 C0              11      RET NZ
0005B6 06B6 79               4      LD  A,C
0005B7 06B7 1E61             7      LD  E,'a'
0005B9 06B9 FE0C             7      CP  12
0005BB 06BB DAB709          10      JP  C,_PRINT
0005BE 06BE 1E70             7      LD  E,'p'
0005C0 06C0 C3B709          10      JP  _PRINT
                                
                                ;   PRINT10
                                
       06C3                     PRDEC_A:
0005C3 06C3 E5              11      PUSH    HL
0005C4 06C4 0608             7      LD  B,8
0005C6 06C6 4F               4      LD  C,A
0005C7 06C7 AF               4      XOR A
       06C8                     PRTA1:
0005C8 06C8 CB01             4      RLC C
0005CA 06CA 8F               4      ADC A,A
0005CB 06CB 27               4      DAA
0005CC 06CC 10FA            13      DJNZ    PRTA1
0005CE 06CE 215E11          10      LD  HL,DECBF
0005D1 06D1 77               7      LD  (HL),A
0005D2 06D2 AF               4      XOR A
0005D3 06D3 CDF705          17      CALL    DECX
0005D6 06D6 E1              10      POP HL
0005D7 06D7 C9              10      RET
                                
       06D8                     PR_DATE:
0005D8 06D8 DD7E00          19      LD  A,(IX+0)
0005DB 06DB FE20             7      CP  020H
0005DD 06DD D8              11      RET C
0005DE 06DE CDF90A          17      CALL    CAP
0005E1 06E1 FE44             7      CP  'D'
0005E3 06E3 2848            12      JR  Z,PR_DAY
0005E5 06E5 FE4D             7      CP  'M'
0005E7 06E7 2820            12      JR  Z,PR_MONTH
0005E9 06E9 FE59             7      CP  'Y'
0005EB 06EB 2046            12      JR  NZ,PR_DATE1
0005ED 06ED 4F               4      LD  C,A
0005EE 06EE DD7E02          19      LD  A,(IX+2)
0005F1 06F1 CDF90A          17      CALL    CAP
0005F4 06F4 B9               4      CP  C
0005F5 06F5 200A            12      JR  NZ,YEAR2
0005F7 06F7 7C               4      LD  A,H     ;YEAR
0005F8 06F8 C6EC             7      ADD A,80+256-100
0005FA 06FA 3E13             7      LD  A,19
0005FC 06FC CE00             7      ADC A,0
0005FE 06FE CDC306          17      CALL    PRDEC_A     ;年4桁
       0701                     YEAR2:
000601 0701 7C               4      LD  A,H     ;YEAR
000602 0702 C650             7      ADD A,80
000604 0704 CDC306          17      CALL    PRDEC_A
000607 0707 182A            12      JR  PR_DATE1
       0709                     PR_MONTH:
000609 0709 4F               4      LD  C,A
00060A 070A DD7E02          19      LD  A,(IX+2)
00060D 070D CDF90A          17      CALL    CAP
000610 0710 B9               4      CP  C
000611 0711 2014            12      JR  NZ,MONTH2
000613 0713 E5              11      PUSH    HL      ;月を文字列で表示 Jan等
000614 0714 D5              11      PUSH    DE
000615 0715 7A               4      LD  A,D
000616 0716 3D               4      DEC A
000617 0717 87               4      ADD A,A
000618 0718 87               4      ADD A,A
000619 0719 21A70E          10      LD  HL,S_MONTH
00061C 071C 1600             7      LD  D,0
00061E 071E 5F               4      LD  E,A
00061F 071F 19              11      ADD HL,DE
000620 0720 CD1B05          17      CALL    MSX
000623 0723 D1              10      POP DE
000624 0724 E1              10      POP HL
000625 0725 180C            12      JR  PR_DATE1
       0727                     MONTH2:
000627 0727 7A               4      LD  A,D     ;月を数字で表示
000628 0728 CDC306          17      CALL    PRDEC_A
00062B 072B 1806            12      JR  PR_DATE1
       072D                     PR_DAY:
00062D 072D 7D               4      LD  A,L
00062E 072E E61F             7      AND 01FH
000630 0730 CDC306          17      CALL    PRDEC_A
       0733                     PR_DATE1:
000633 0733 DD23            10      INC IX
000635 0735 DD7E00          19      LD  A,(IX+0)
000638 0738 CDF90A          17      CALL    CAP
00063B 073B FE41             7      CP  'A'
00063D 073D D8              11      RET C
00063E 073E FE5B             7      CP  'Z'+1
000640 0740 38F1            12      JR  C,PR_DATE1
000642 0742 C9              10      RET
       0743                     PR_DATE_SPLITER:
000643 0743 DD7E00          19      LD  A,(IX+0)
000646 0746 FE20             7      CP  020H
000648 0748 D8              11      RET C
000649 0749 DD23            10      INC IX
00064B 074B C3C809          10      JP  MSG_A
                                
       074E                     SETFCB:
00064E 074E CDE60A          17      CALL    SPCUT
000651 0751 1A               7      LD  A,(DE)
000652 0752 FE20             7      CP  020H
000654 0754 3801            12      JR  C,SETFCBA
000656 0756 1B               6      DEC DE
       0757                     SETFCBA:
000657 0757 D5              11      PUSH    DE
000658 0758 215C00          10      LD  HL,FCB1
00065B 075B 115D00          10      LD  DE,FCB1+1
00065E 075E 012300          10      LD  BC,00023H
000661 0761 70               7      LD  (HL),B      ;B=0
000662 0762 EDB0                    LDIR
000664 0764 D1              10      POP DE
000665 0765 D5              11      PUSH    DE
000666 0766 215C00          10      LD  HL,FCB1
000669 0769 DD215D10        14      LD  IX,PATH_FN1
00066D 076D CD8A0B          17      CALL    _SYS29      ;ファイル名の解析
000670 0770 216C00          10      LD  HL,FCB2
000673 0773 DD219D10        14      LD  IX,PATH_FN2
000677 0777 CD8A0B          17      CALL    _SYS29      ;ファイル名の解析
00067A 077A E1              10      POP HL
00067B 077B 010050          10      LD  BC,05000H
00067E 077E 118100          10      LD  DE,00081H
       0781                     SETFCB1:
000681 0781 7E               7      LD  A,(HL)
000682 0782 23               6      INC HL
000683 0783 FE20             7      CP  020H
000685 0785 3805            12      JR  C,SETFCB2
000687 0787 12               7      LD  (DE),A
000688 0788 13               6      INC DE
000689 0789 0C               4      INC C
00068A 078A 10F5            13      DJNZ    SETFCB1
       078C                     SETFCB2:
00068C 078C 79               4      LD  A,C
00068D 078D 328000          13      LD  (DTA1),A
000690 0790 04               4      INC B
000691 0791 AF               4      XOR A
       0792                     SETFCB3:
000692 0792 12               7      LD  (DE),A
000693 0793 13               6      INC DE
000694 0794 10FC            13      DJNZ    SETFCB3
000696 0796 C9              10      RET
                                
       0797                     C_COPY:
000697 0797 CD4E07          17      CALL    SETFCB
00069A 079A 3A950F          13      LD  A,(MAJOR_VER)
00069D 079D FE02             7      CP  2
00069F 079F 3818            12      JR  C,COPYI0
0006A1 07A1 119D10          10      LD  DE,PATH_FN2
0006A4 07A4 AF               4      XOR A
0006A5 07A5 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
0006A7 07A7 CD2803          17      CALL    SYSTEM0
0006AA 07AA B7               4      OR  A
0006AB 07AB 200C            12      JR  NZ,COPYI0
0006AD 07AD CB65             8      BIT 4,L     ;ディレクトリ
0006AF 07AF 2808            12      JR  Z,COPYI0
0006B1 07B1 216511          10      LD  HL,FDRV+1
0006B4 07B4 060B             7      LD  B,8+3
0006B6 07B6 CDAB0A          17      CALL    FILE10
       07B9                     COPYI0:
0006B9 07B9 3A6411          13      LD  A,(FDRV)
0006BC 07BC 47               4      LD  B,A
0006BD 07BD B7               4      OR  A
0006BE 07BE 200B            12      JR  NZ,COPYI1
0006C0 07C0 C5              11      PUSH    BC
0006C1 07C1 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
0006C3 07C3 CD0500          17      CALL    SYSTEM
0006C6 07C6 3C               4      INC A
0006C7 07C7 326411          13      LD  (FDRV),A
0006CA 07CA C1              10      POP BC
       07CB                     COPYI1:
0006CB 07CB C640             7      ADD A,040H
0006CD 07CD 32DD10          13      LD  (CUR_DRV),A
0006D0 07D0 11E010          10      LD  DE,CUR_PATH
0006D3 07D3 0E59             7      LD  C,059H      ;(BDOS)カレントディレクトリの獲得(_GETCD)
0006D5 07D5 CD0500          17      CALL    SYSTEM
0006D8 07D8 CDEA07          17      CALL    COPYSUB
       07DB                     RES_CUR_PATH:
0006DB 07DB 11DD10          10      LD  DE,CUR_DRV
       07DE                     SET_CUR_PATH:
0006DE 07DE F5              11      PUSH    AF
0006DF 07DF 3A6411          13      LD  A,(FDRV)
0006E2 07E2 47               4      LD  B,A
0006E3 07E3 0E5A             7      LD  C,05AH      ;(BDOS)カレントディレクトリの変更(_CHDIR)
0006E5 07E5 CD0500          17      CALL    SYSTEM
0006E8 07E8 F1              10      POP AF
0006E9 07E9 C9              10      RET
       07EA                     COPYSUB:
0006EA 07EA 118A11          10      LD  DE,ZERO
0006ED 07ED CD010A          17      CALL    FILEC2
0006F0 07F0 216C00          10      LD  HL,FCB2
0006F3 07F3 CDAB0B          17      CALL    S29X1
                                
0006F6 07F6 3E10             7      LD  A,010H
0006F8 07F8 326900          13      LD  (FCB1+13),A
0006FB 07FB 216D00          10      LD  HL,FCB2+1
0006FE 07FE CD9C09          17      CALL    CWILD1
       0801                     COPY0:
000701 0801 CD9909          17      CALL    CWILD
000704 0804 215C00          10      LD  HL,FCB1
000707 0807 CD4202          17      CALL    OPEN_D2
00070A 080A 37               4      SCF
       080B                     COPY1:
00070B 080B C0              11      RET NZ
00070C 080C CDBE02          17      CALL    DEFCB_D2
                                
00070F 080F 3A3A11          13      LD  A,(DTA_CCP+12)
000712 0812 CB67             8      BIT 4,A
000714 0814 2821            12      JR  Z,COPY1A
                                
000716 0816 215D00          10      LD  HL,FCB1+1
000719 0819 CD320B          17      CALL    CHKWILD
00071C 081C 3811            12      JR  C,COPY9
                                
00071E 081E 3E20             7      LD  A,020H
000720 0820 325D00          13      LD  (FCB1+1),A
000723 0823 2A4811          16      LD  HL,(DTA_CCP+26)
000726 0826 23               6      INC HL
000727 0827 226A00          16      LD  (FCB1+14),HL
00072A 082A 18D5            12      JR  COPY0
                                
       082C                     COPY8:
00072C 082C CD570C          17      CALL    SHOW_OK
       082F                     COPY9:
00072F 082F CDDB07          17      CALL    RES_CUR_PATH
000732 0832 CDA802          17      CALL    OPEN2_D2
000735 0835 18D4            12      JR  COPY1
                                
       0837                     COPY1A:
000737 0837 216C00          10      LD  HL,FCB2
00073A 083A 116411          10      LD  DE,FDRV
00073D 083D 013011          10      LD  BC,DTA_CCP+2
000740 0840 EDA0            16      LDI
000742 0842 3E0B             7      LD  A,11
       0844                     COPY2:
000744 0844 F5              11      PUSH    AF
000745 0845 7E               7      LD  A,(HL)
000746 0846 FE3F             7      CP  '?'
000748 0848 2001            12      JR  NZ,COPY3
00074A 084A 0A               7      LD  A,(BC)
       084B                     COPY3:
00074B 084B 12               7      LD  (DE),A
00074C 084C 03               6      INC BC
00074D 084D 13               6      INC DE
00074E 084E 23               6      INC HL
00074F 084F F1              10      POP AF
000750 0850 3D               4      DEC A
000751 0851 20F1            12      JR  NZ,COPY2
000753 0853 010500          10      LD  BC,16-11
000756 0856 EDB0                    LDIR
       0858                     PUTNAME:
000758 0858 215D00          10      LD  HL,FCB1+1
00075B 085B CD320B          17      CALL    CHKWILD
00075E 085E 300B            12      JR  NC,PUTN1
000760 0860 216511          10      LD  HL,FDRV+1
000763 0863 CD1506          17      CALL    FPRNT
000766 0866 3E20             7      LD  A,020H
000768 0868 CDC809          17      CALL    MSG_A
       086B                     PUTN1:
00076B 086B 119D10          10      LD  DE,PATH_FN2
00076E 086E CDDE07          17      CALL    SET_CUR_PATH
                                
000771 0871 116411          10      LD  DE,FDRV
000774 0874 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000776 0876 CD2803          17      CALL    SYSTEM0
000779 0879 C21A09          10      JP  NZ,COPYE2
00077C 087C 67               4      LD  H,A     ;A=0
00077D 087D 6F               4      LD  L,A
00077E 087E 228511          16      LD  (FDRV+33),HL    ;(FCB)ランダム・レコード
000781 0881 228711          16      LD  (FDRV+35),HL
000784 0884 2C               4      INC L       ;HL=1
000785 0885 227211          16      LD  (FDRV+14),HL    ;(FCB)レコード・サイズ
       0888                     COPY6:
000788 0888 CDAB09          17      CALL    BUFSIZ
00078B 088B CD4803          17      CALL    S27DTA_D2
00078E 088E 3C               4      INC A
00078F 088F CA0909          10      JP  Z,COPYE
000792 0892 47               4      LD  B,A
000793 0893 7C               4      LD  A,H
000794 0894 B5               4      OR  L
000795 0895 280F            12      JR  Z,COPY7
000797 0897 116411          10      LD  DE,FDRV
00079A 089A C5              11      PUSH    BC
00079B 089B 0E26             7      LD  C,026H      ;(BDOS)ランダム・ブロック・ライト
00079D 089D CD0500          17      CALL    SYSTEM
0007A0 08A0 C1              10      POP BC
0007A1 08A1 B7               4      OR  A
0007A2 08A2 2065            12      JR  NZ,COPYE
0007A4 08A4 10E2            13      DJNZ    COPY6
       08A6                     COPY7:
0007A6 08A6 3A950F          13      LD  A,(MAJOR_VER)
0007A9 08A9 FE02             7      CP  2
0007AB 08AB 3011            12      JR  NC,COPY7_MSX2   ;DOS2はFCBの仕様が違う
0007AD 08AD 3A3B11          13      LD  A,(DTA_CCP+13)  ;(FCB)属性(アトリビュート)
0007B0 08B0 327111          13      LD  (FDRV+13),A ;(FCB)属性(アトリビュート)
0007B3 08B3 214211          10      LD  HL,DTA_CCP+20
0007B6 08B6 117811          10      LD  DE,FDRV+20  ;(FCB)更新日時
0007B9 08B9 010400          10      LD  BC,4
0007BC 08BC EDB0                    LDIR
       08BE                     COPY7_MSX2:
0007BE 08BE 116411          10      LD  DE,FDRV
0007C1 08C1 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0007C3 08C3 CD2803          17      CALL    SYSTEM0
                                
0007C6 08C6 2041            12      JR  NZ,COPYE
0007C8 08C8 3A950F          13      LD  A,(MAJOR_VER)
0007CB 08CB FE02             7      CP  2
0007CD 08CD 3837            12      JR  C,COPY_DOS2DT
                                
0007CF 08CF ED4BD60F        20      LD  BC,(HANDLE1)
0007D3 08D3 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
0007D5 08D5 CD0500          17      CALL    SYSTEM
                                
0007D8 08D8 119D10          10      LD  DE,PATH_FN2
0007DB 08DB CDDE07          17      CALL    SET_CUR_PATH
                                
0007DE 08DE 116411          10      LD  DE,FDRV
0007E1 08E1 212011          10      LD  HL,DOS2NAME
0007E4 08E4 CD1C09          17      CALL    FCB2FNAME
                                
0007E7 08E7 3AA40F          13      LD  A,(SEARCH_IX+14)
0007EA 08EA 6F               4      LD  L,A
0007EB 08EB 112011          10      LD  DE,DOS2NAME
0007EE 08EE 3E01             7      LD  A,1
0007F0 08F0 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
0007F2 08F2 CD2803          17      CALL    SYSTEM0
                                
0007F5 08F5 DD2AA50F        20      LD  IX,(SEARCH_IX+15)
0007F9 08F9 2AA70F          16      LD  HL,(SEARCH_IX+17)
0007FC 08FC 112011          10      LD  DE,DOS2NAME
0007FF 08FF 3E01             7      LD  A,1
000801 0901 0E51             7      LD  C,51H       ;(BDOS)_FTIME ファイルの日付および時刻の獲得・設定
000803 0903 CD2803          17      CALL    SYSTEM0
       0906                     COPY_DOS2DT:
000806 0906 C32C08          10      JP  COPY8
                                
       0909                     COPYE:
000809 0909 ED4BD60F        20      LD  BC,(HANDLE1)
00080D 090D 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
00080F 090F CD0500          17      CALL    SYSTEM
000812 0912 116411          10      LD  DE,FDRV
000815 0915 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
000817 0917 CD0500          17      CALL    SYSTEM
       091A                     COPYE2:
00081A 091A 37               4      SCF
00081B 091B C9              10      RET
                                
       091C                     FCB2FNAME:
00081C 091C 1A               7      LD  A,(DE)
00081D 091D 13               6      INC DE
00081E 091E C640             7      ADD A,040H
000820 0920 77               7      LD  (HL),A
000821 0921 23               6      INC HL
000822 0922 363A            10      LD  (HL),':'
000824 0924 23               6      INC HL
                                
000825 0925 0608             7      LD  B,8
       0927                     FCB2FNAME1:
000827 0927 1A               7      LD  A,(DE)
000828 0928 FE21             7      CP  020H+1
00082A 092A 3807            12      JR  C,FCB2FNAME2
00082C 092C 13               6      INC DE
00082D 092D 77               7      LD  (HL),A
00082E 092E 23               6      INC HL
00082F 092F 10F6            13      DJNZ    FCB2FNAME1
000831 0931 1803            12      JR  FCB2FNAME3
       0933                     FCB2FNAME2:
000833 0933 13               6      INC DE
000834 0934 10FD            13      DJNZ    FCB2FNAME2
       0936                     FCB2FNAME3:
000836 0936 1A               7      LD  A,(DE)
000837 0937 FE21             7      CP  020H+1
000839 0939 380F            12      JR  C,FCB2FNAME5
00083B 093B 362E            10      LD  (HL),'.'
00083D 093D 23               6      INC HL
00083E 093E 0603             7      LD  B,3
       0940                     FCB2FNAME4:
000840 0940 1A               7      LD  A,(DE)
000841 0941 13               6      INC DE
000842 0942 FE21             7      CP  020H+1
000844 0944 3804            12      JR  C,FCB2FNAME5
000846 0946 77               7      LD  (HL),A
000847 0947 23               6      INC HL
000848 0948 10F6            13      DJNZ    FCB2FNAME4
       094A                     FCB2FNAME5:
00084A 094A 3600            10      LD  (HL),0
00084C 094C C9              10      RET
                                
       094D                     C_TYPE:
00084D 094D CD4E07          17      CALL    SETFCB
000850 0950 215C00          10      LD  HL,FCB1
000853 0953 CD4202          17      CALL    OPEN_D2
000856 0956 37               4      SCF
       0957                     TYPE1:
000857 0957 C0              11      RET NZ
000858 0958 CDBE02          17      CALL    DEFCB_D2
00085B 095B 3E1A             7      LD  A,01AH
00085D 095D CDC809          17      CALL    MSG_A
       0960                     TYPE2:
000860 0960 CDAB09          17      CALL    BUFSIZ
000863 0963 CD4803          17      CALL    S27DTA_D2
000866 0966 C6FE             7      ADD A,0FEH
000868 0968 D8              11      RET C
000869 0969 7C               4      LD  A,H
00086A 096A B5               4      OR  L
00086B 096B 281A            12      JR  Z,TYPEE
00086D 096D 010080          10      LD  BC,DATA
       0970                     TYPE3:
000870 0970 0A               7      LD  A,(BC)
000871 0971 03               6      INC BC
000872 0972 FE1A             7      CP  01AH
000874 0974 2811            12      JR  Z,TYPEE
000876 0976 5F               4      LD  E,A
000877 0977 C5              11      PUSH    BC
000878 0978 E5              11      PUSH    HL
000879 0979 0E02             7      LD  C,2     ;(BDOS)コンソール出力
00087B 097B CD0500          17      CALL    SYSTEM
00087E 097E E1              10      POP HL
00087F 097F C1              10      POP BC
000880 0980 2B               6      DEC HL
000881 0981 7C               4      LD  A,H
000882 0982 B5               4      OR  L
000883 0983 20EB            12      JR  NZ,TYPE3
000885 0985 18D9            12      JR  TYPE2
       0987                     TYPEE:
000887 0987 3A950F          13      LD  A,(MAJOR_VER)   ;DOS2対応
00088A 098A FE02             7      CP  2
00088C 098C 3806            12      JR  C,TYPEE2
00088E 098E ED4BD60F        20      LD  BC,(HANDLE1)
000892 0992 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
       0994                     TYPEE2:
000894 0994 CDA802          17      CALL    OPEN2_D2
000897 0997 18BE            12      JR  TYPE1
                                
       0999                     CWILD:
000899 0999 215D00          10      LD  HL,FCB1+1
       099C                     CWILD1:
00089C 099C 7E               7      LD  A,(HL)
00089D 099D FE20             7      CP  020H
00089F 099F C0              11      RET NZ
       09A0                     CWILD2:
0008A0 09A0 54               4      LD  D,H
0008A1 09A1 5D               4      LD  E,L
0008A2 09A2 13               6      INC DE
0008A3 09A3 010A00          10      LD  BC,10
0008A6 09A6 363F            10      LD  (HL),'?'
0008A8 09A8 EDB0                    LDIR
0008AA 09AA C9              10      RET
                                
       09AB                     BUFSIZ:
0008AB 09AB 3A0700          13      LD  A,(SYSTEM+2)
0008AE 09AE D681             7      SUB (DATA/256)+1
0008B0 09B0 E6F8             7      AND 0F8H
0008B2 09B2 67               4      LD  H,A
0008B3 09B3 2E00             7      LD  L,0
0008B5 09B5 C9              10      RET
                                
0008B6 09B6 E9               4  JP_HL:  JP  (HL)
                                
       09B7                     _PRINT:
0008B7 09B7 C5              11      PUSH    BC
0008B8 09B8 D5              11      PUSH    DE
0008B9 09B9 E5              11      PUSH    HL
0008BA 09BA DDE5            15      PUSH    IX
0008BC 09BC 0E06             7      LD  C,6
0008BE 09BE CD0500          17      CALL    SYSTEM
0008C1 09C1 DDE1            14      POP IX
0008C3 09C3 E1              10      POP HL
0008C4 09C4 D1              10      POP DE
0008C5 09C5 C1              10      POP BC
0008C6 09C6 B7               4      OR  A
0008C7 09C7 C9              10      RET
                                
       09C8                     MSG_A:
0008C8 09C8 F5              11      PUSH    AF
0008C9 09C9 C5              11      PUSH    BC
0008CA 09CA D5              11      PUSH    DE
0008CB 09CB E5              11      PUSH    HL
0008CC 09CC DDE5            15      PUSH    IX
0008CE 09CE 5F               4      LD  E,A
0008CF 09CF 0E02             7      LD  C,2
0008D1 09D1 CD0500          17      CALL    SYSTEM
0008D4 09D4 DDE1            14      POP IX
0008D6 09D6 E1              10      POP HL
0008D7 09D7 D1              10      POP DE
0008D8 09D8 C1              10      POP BC
0008D9 09D9 F1              10      POP AF
0008DA 09DA C9              10      RET
                                ;       FILE
       09DB                     FILEC_D2:       ;DOS2対応
0008DB 09DB 3A950F          13      LD  A,(MAJOR_VER)
0008DE 09DE FE02             7      CP  2
0008E0 09E0 381C            12      JR  C,FILEC
0008E2 09E2 C5              11      PUSH    BC
0008E3 09E3 D5              11      PUSH    DE
0008E4 09E4 E5              11      PUSH    HL
0008E5 09E5 CDE60A          17      CALL    SPCUT
0008E8 09E8 21DB0F          10      LD  HL,PATH_CCP
0008EB 09EB 0640             7      LD  B,64
       09ED                     PATHCD1:
0008ED 09ED 1A               7      LD  A,(DE)
0008EE 09EE 13               6      INC DE
0008EF 09EF FE20             7      CP  020H
0008F1 09F1 3002            12      JR  NC,PATHCD2
0008F3 09F3 3E00             7      LD  A,0
       09F5                     PATHCD2:
0008F5 09F5 77               7      LD  (HL),A
0008F6 09F6 3803            12      JR  C,PATHCD3
0008F8 09F8 23               6      INC HL
0008F9 09F9 10F2            13      DJNZ    PATHCD1
       09FB                     PATHCD3:
0008FB 09FB E1              10      POP HL
0008FC 09FC D1              10      POP DE
0008FD 09FD C1              10      POP BC
       09FE                     FILEC:
0008FE 09FE CD090A          17      CALL    FILE
       0A01                     FILEC2:
000901 0A01 3A6511          13      LD  A,(FDRV+1)
000904 0A04 FE20             7      CP  020H
000906 0A06 C8              11      RET Z
000907 0A07 1839            12      JR  SETDIR1
                                
       0A09                     FILE:
000909 0A09 AF               4      XOR A
00090A 0A0A 326411          13      LD  (FDRV),A
00090D 0A0D 67               4      LD  H,A
00090E 0A0E 6F               4      LD  L,A
00090F 0A0F 227211          16      LD  (FDRV+14),HL
000912 0A12 CDE60A          17      CALL    SPCUT
000915 0A15 CDCB0A          17      CALL    CCHK3
000918 0A18 2812            12      JR  Z,DEVI1
00091A 0A1A 13               6      INC DE
00091B 0A1B 1A               7      LD  A,(DE)
00091C 0A1C 1B               6      DEC DE
00091D 0A1D FE3A             7      CP  ':'
00091F 0A1F 200B            12      JR  NZ,DEVI1
000921 0A21 1A               7      LD  A,(DE)      ;DRIVE
000922 0A22 CDF90A          17      CALL    CAP
000925 0A25 D640             7      SUB '@'
000927 0A27 13               6      INC DE
000928 0A28 13               6      INC DE
000929 0A29 326411          13      LD  (FDRV),A
       0A2C                     DEVI1:
00092C 0A2C 1A               7      LD  A,(DE)
00092D 0A2D D65C             7      SUB 05CH        ;\
00092F 0A2F 2009            12      JR  NZ,NOROOT
000931 0A31 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000932 0A32 227E11          16      LD  (FDRV+26),HL
000935 0A35 2C               4      INC L
000936 0A36 227211          16      LD  (FDRV+14),HL
000939 0A39 13               6      INC DE
       0A3A                     NOROOT:
                                
       0A3A                     SETDIR:
00093A 0A3A CD6B0A          17      CALL    FILED
00093D 0A3D 1A               7      LD  A,(DE)
00093E 0A3E FE5C             7      CP  05CH        ;\
000940 0A40 C0              11      RET NZ
000941 0A41 13               6      INC DE
       0A42                     SETDIR1:
000942 0A42 3A950F          13      LD  A,(MAJOR_VER)
000945 0A45 FE01             7      CP  1
000947 0A47 C0              11      RET NZ
                                                ;for LSX-Dodgers
000948 0A48 3E10             7      LD  A,010H      ;Directory
00094A 0A4A 327111          13      LD  (FDRV+13),A
00094D 0A4D D5              11      PUSH    DE
00094E 0A4E 116411          10      LD  DE,FDRV
000951 0A51 0E0F             7      LD  C,00FH
000953 0A53 CD0500          17      CALL    SYSTEM
000956 0A56 D1              10      POP DE
000957 0A57 B7               4      OR  A
000958 0A58 C0              11      RET NZ
                                
000959 0A59 3A7111          13      LD  A,(FDRV+13)
00095C 0A5C CB67             8      BIT 4,A
00095E 0A5E C8              11      RET Z
                                
00095F 0A5F CDB20A          17      CALL    FILEI
000962 0A62 2A7E11          16      LD  HL,(FDRV+26)
000965 0A65 23               6      INC HL
000966 0A66 227211          16      LD  (FDRV+14),HL
000969 0A69 18CF            12      JR  SETDIR
                                
       0A6B                     FILED:
00096B 0A6B CDB20A          17      CALL    FILEI
                                
00096E 0A6E 0608             7      LD  B,8
       0A70                     FILE2:
000970 0A70 CDC00A          17      CALL    CCHKF
000973 0A73 C8              11      RET Z
000974 0A74 FE2A             7      CP  '*'
000976 0A76 282E            12      JR  Z,FILE9
000978 0A78 FE2E             7      CP  '.'
00097A 0A7A 280C            12      JR  Z,FILE4
00097C 0A7C 77               7      LD  (HL),A
00097D 0A7D 23               6      INC HL
00097E 0A7E 10F0            13      DJNZ    FILE2
                                
       0A80                     FILE3:
000980 0A80 CDC00A          17      CALL    CCHKF
000983 0A83 C8              11      RET Z
000984 0A84 FE2E             7      CP  '.'
000986 0A86 20F8            12      JR  NZ,FILE3
                                
       0A88                     FILE4:
000988 0A88 216D11          10      LD  HL,FNAME+8
00098B 0A8B 0603             7      LD  B,3
                                
       0A8D                     FILE4L:
00098D 0A8D CDC00A          17      CALL    CCHKF
000990 0A90 C8              11      RET Z
000991 0A91 FE2E             7      CP  '.'
000993 0A93 2008            12      JR  NZ,FILE12
000995 0A95 326511          13      LD  (FNAME),A   ;Parent directory(..)
000998 0A98 326611          13      LD  (FNAME+1),A
00099B 0A9B 3E20             7      LD  A,020H
       0A9D                     FILE12:
00099D 0A9D FE2A             7      CP  '*'
00099F 0A9F 280A            12      JR  Z,FILE10
0009A1 0AA1 77               7      LD  (HL),A
0009A2 0AA2 23               6      INC HL
0009A3 0AA3 10E8            13      DJNZ    FILE4L
0009A5 0AA5 C9              10      RET
                                
       0AA6                     FILE9:              ;名前の*処理、名前の残りを?で埋める
0009A6 0AA6 CDAB0A          17      CALL    FILE10
0009A9 0AA9 18D5            12      JR  FILE3
                                
       0AAB                     FILE10:
0009AB 0AAB 3E3F             7      LD  A,'?'
                                
       0AAD                     FILL_MEMORY:                ;HLからBバイトAで埋める
0009AD 0AAD 77               7      LD  (HL),A
0009AE 0AAE 23               6      INC HL
0009AF 0AAF 10FC            13      DJNZ    FILL_MEMORY
0009B1 0AB1 C9              10      RET
                                
       0AB2                     FILEI:              ;名前＋拡張子をスペースで初期化
0009B2 0AB2 3E20             7      LD  A,020H
0009B4 0AB4 01000B          10      LD  BC,11*256
0009B7 0AB7 216511          10      LD  HL,FNAME
0009BA 0ABA E5              11      PUSH    HL
0009BB 0ABB CDAD0A          17      CALL    FILL_MEMORY
0009BE 0ABE E1              10      POP HL
0009BF 0ABF C9              10      RET
                                
       0AC0                     CCHKF:
0009C0 0AC0 1A               7      LD  A,(DE)
0009C1 0AC1 CDC80A          17      CALL    CCHK2
0009C4 0AC4 C8              11      RET Z
0009C5 0AC5 C31B0B          10      JP  FKAN
                                
       0AC8                     CCHK2:
0009C8 0AC8 0C               4      INC C
0009C9 0AC9 0D               4      DEC C
0009CA 0ACA C0              11      RET NZ
       0ACB                     CCHK3:              ;ZF=1 で使えない文字
0009CB 0ACB FE2B             7      CP  '+'
0009CD 0ACD C8              11      RET Z
0009CE 0ACE FE2C             7      CP  ','
0009D0 0AD0 C8              11      RET Z
0009D1 0AD1 FE2F             7      CP  '/'
0009D3 0AD3 C8              11      RET Z
0009D4 0AD4 FE3A             7      CP  ':'
0009D6 0AD6 C8              11      RET Z
0009D7 0AD7 FE3B             7      CP  ';'
0009D9 0AD9 C8              11      RET Z
0009DA 0ADA FE3D             7      CP  '='
0009DC 0ADC C8              11      RET Z
0009DD 0ADD FE5C             7      CP  05CH    ;\
0009DF 0ADF C8              11      RET Z
0009E0 0AE0 FE20             7      CP  020H
0009E2 0AE2 D0              11      RET NC
0009E3 0AE3 BF               4      CP  A       ;Z=1
0009E4 0AE4 C9              10      RET
                                
       0AE5                     SS1:
0009E5 0AE5 13               6      INC DE
       0AE6                     SPCUT:              ;スペースをカット
0009E6 0AE6 1A               7      LD  A,(DE)
0009E7 0AE7 FE20             7      CP  020H
0009E9 0AE9 28FA            12      JR  Z,SS1
0009EB 0AEB C9              10      RET
                                
       0AEC                     TOZERO:
0009EC 0AEC D5              11      PUSH    DE
       0AED                     TZ1:
0009ED 0AED 1A               7      LD  A,(DE)
0009EE 0AEE FE20             7      CP  20H
0009F0 0AF0 3803            12      JR  C,TZ2
0009F2 0AF2 13               6      INC DE
0009F3 0AF3 18F8            12      JR  TZ1
       0AF5                     TZ2:
0009F5 0AF5 AF               4      XOR A
0009F6 0AF6 12               7      LD  (DE),A
0009F7 0AF7 D1              10      POP DE
0009F8 0AF8 C9              10      RET
                                
       0AF9                     CAP:
0009F9 0AF9 FE61             7      CP  'a'
0009FB 0AFB D8              11      RET C
0009FC 0AFC FE7B             7      CP  'z'+1
0009FE 0AFE D0              11      RET NC
0009FF 0AFF D620             7      SUB 020H
000A01 0B01 C9              10      RET
       0B02                     CAP2:
000A02 0B02 CDF90A          17      CALL    CAP
       0B05                     CAP3:
000A05 0B05 CD0E0B          17      CALL    CAP4
000A08 0B08 FE21             7      CP  021H
000A0A 0B0A D0              11      RET NC
000A0B 0B0B 3E20             7      LD  A,020H
000A0D 0B0D C9              10      RET
       0B0E                     CAP4:
000A0E 0B0E FE05             7      CP  5
000A10 0B10 C0              11      RET NZ
000A11 0B11 3EE5             7      LD  A,0E5H
000A13 0B13 C9              10      RET
                                
       0B14                     FKANC:
000A14 0B14 CB41             8      BIT 0,C
000A16 0B16 CC020B          17      CALL    Z,CAP2
000A19 0B19 1801            12      JR  FKANX
       0B1B                     FKAN:           ;漢字チェック
000A1B 0B1B 13               6      INC DE
       0B1C                     FKANX:
000A1C 0B1C CB41             8      BIT 0,C
000A1E 0B1E CB81             8      RES 0,C
000A20 0B20 C0              11      RET NZ
000A21 0B21 FE80             7      CP  080H
000A23 0B23 D8              11      RET C
000A24 0B24 FEA0             7      CP  0A0H
000A26 0B26 3803            12      JR  C,FKAN1
000A28 0B28 FEE0             7      CP  0E0H
000A2A 0B2A D8              11      RET C
       0B2B                     FKAN1:
000A2B 0B2B 0C               4      INC C
000A2C 0B2C A7               4      AND A
000A2D 0B2D C9              10      RET
                                
       0B2E                     CHKWILDX:
000A2E 0B2E FDE5            15      PUSH    IY
000A30 0B30 E1              10      POP HL
000A31 0B31 23               6      INC HL
       0B32                     CHKWILD:
000A32 0B32 060B             7      LD  B,11
000A34 0B34 3E3F             7      LD  A,'?'
       0B36                     CHKWIL1:
000A36 0B36 BE               7      CP  (HL)
000A37 0B37 23               6      INC HL
000A38 0B38 37               4      SCF
000A39 0B39 C8              11      RET Z
000A3A 0B3A 10FA            13      DJNZ    CHKWIL1
000A3C 0B3C AF               4      XOR A
000A3D 0B3D C9              10      RET
                                
       0B3E                     CPNAME:
000A3E 0B3E C5              11      PUSH    BC
000A3F 0B3F D5              11      PUSH    DE
000A40 0B40 115311          10      LD  DE,CPBUF
000A43 0B43 010700          10      LD  BC,7
000A46 0B46 EDB0                    LDIR
000A48 0B48 D1              10      POP DE
000A49 0B49 D5              11      PUSH    DE
000A4A 0B4A E5              11      PUSH    HL
000A4B 0B4B 215311          10      LD  HL,CPBUF
000A4E 0B4E CD610B          17      CALL    CPFILE
000A51 0B51 E1              10      POP HL
000A52 0B52 D1              10      POP DE
000A53 0B53 C1              10      POP BC
000A54 0B54 2005            12      JR  NZ,CPNAME1
000A56 0B56 7E               7      LD  A,(HL)
000A57 0B57 23               6      INC HL
000A58 0B58 66               7      LD  H,(HL)
000A59 0B59 6F               4      LD  L,A
000A5A 0B5A C9              10      RET
       0B5B                     CPNAME1:
000A5B 0B5B 23               6      INC HL
000A5C 0B5C 23               6      INC HL
000A5D 0B5D 10DF            13      DJNZ    CPNAME
000A5F 0B5F 37               4      SCF
000A60 0B60 C9              10      RET
                                
       0B61                     CPFILE:
000A61 0B61 C5              11      PUSH    BC
000A62 0B62 01000B          10      LD  BC,00B00H
       0B65                     CPSTR1:
000A65 0B65 1A               7      LD  A,(DE)
000A66 0B66 FE3F             7      CP  '?'     ;Wild card
000A68 0B68 2812            12      JR  Z,CPSTR2
000A6A 0B6A 7E               7      LD  A,(HL)
000A6B 0B6B CD140B          17      CALL    FKANC
000A6E 0B6E E5              11      PUSH    HL
000A6F 0B6F 67               4      LD  H,A
000A70 0B70 1A               7      LD  A,(DE)
000A71 0B71 CB01             4      RLC C
000A73 0B73 CD140B          17      CALL    FKANC
000A76 0B76 CB09             4      RRC C
000A78 0B78 BC               4      CP  H       ;CP (HL),(DE)
000A79 0B79 E1              10      POP HL
000A7A 0B7A 2004            12      JR  NZ,CPSTR3
       0B7C                     CPSTR2:
000A7C 0B7C 13               6      INC DE
000A7D 0B7D 23               6      INC HL
000A7E 0B7E 10E5            13      DJNZ    CPSTR1
       0B80                     CPSTR3:
000A80 0B80 C1              10      POP BC
000A81 0B81 C9              10      RET
                                
       0B82                     CPFILE2:
000A82 0B82 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
000A85 0B85 F6E1             7      OR  0E1H
000A87 0B87 2F               4      CPL
000A88 0B88 A6               7      AND (HL)
000A89 0B89 C9              10      RET
                                
       0B8A                     _SYS29:     ;(BDOS)ファイル名の解析
000A8A 0B8A C5              11      PUSH    BC
000A8B 0B8B D5              11      PUSH    DE
000A8C 0B8C 0640             7      LD  B,64
000A8E 0B8E CDE60A          17      CALL    SPCUT
       0B91                     D2FN1:
000A91 0B91 1A               7      LD  A,(DE)
000A92 0B92 FE21             7      CP  020H+1
000A94 0B94 3808            12      JR  C,D2FN2
000A96 0B96 13               6      INC DE
000A97 0B97 DD7700          19      LD  (IX+0),A
000A9A 0B9A DD23            10      INC IX
000A9C 0B9C 10F3            13      DJNZ    D2FN1
       0B9E                     D2FN2:
000A9E 0B9E DD360000        19      LD  (IX+0),0
                                
000AA2 0BA2 D1              10      POP DE
000AA3 0BA3 C1              10      POP BC
000AA4 0BA4 C5              11      PUSH    BC
000AA5 0BA5 E5              11      PUSH    HL
000AA6 0BA6 CD090A          17      CALL    FILE
000AA9 0BA9 E1              10      POP HL
000AAA 0BAA C1              10      POP BC
       0BAB                     S29X1:
000AAB 0BAB C5              11      PUSH    BC
000AAC 0BAC D5              11      PUSH    DE
000AAD 0BAD E5              11      PUSH    HL
000AAE 0BAE EB               4      EX  DE,HL
000AAF 0BAF 216411          10      LD  HL,FDRV
000AB2 0BB2 010D00          10      LD  BC,13
000AB5 0BB5 EDB0                    LDIR
000AB7 0BB7 70               7      LD  (HL),B      ;B=0
000AB8 0BB8 0E03             7      LD  C,3
000ABA 0BBA EDB0                    LDIR
000ABC 0BBC E1              10      POP HL
000ABD 0BBD D1              10      POP DE
000ABE 0BBE C1              10      POP BC
000ABF 0BBF AF               4      XOR A
000AC0 0BC0 C9              10      RET
       0BC1                     GET_WIDTH:
000AC1 0BC1 3A940F          13      LD  A,(IS_MSX)
000AC4 0BC4 B7               4      OR  A
000AC5 0BC5 2804            12      JR  Z,NOT_MSX
000AC7 0BC7 3AB0F3          13      LD  A,(LINLEN)
000ACA 0BCA C9              10      RET
       0BCB                     NOT_MSX:
000ACB 0BCB E5              11      PUSH    HL
000ACC 0BCC 2A0100          16      LD  HL,(1)
000ACF 0BCF 2EB1             7      LD  L,0B1H
000AD1 0BD1 7E               7      LD  A,(HL)
000AD2 0BD2 E1              10      POP HL
000AD3 0BD3 C9              10      RET
                                
       0BD4                     C_MODE:
000AD4 0BD4 3A940F          13      LD  A,(IS_MSX)
000AD7 0BD7 B7               4      OR  A
000AD8 0BD8 C8              11      RET Z
000AD9 0BD9 0E29             7      LD  C,41
000ADB 0BDB 3AF8FA          13      LD  A,(EXBRSA)
000ADE 0BDE B7               4      OR  A
000ADF 0BDF 2802            12      JR  Z,MODE_MSX1
000AE1 0BE1 0E51             7      LD  C,81
       0BE3                     MODE_MSX1:
000AE3 0BE3 C5              11      PUSH    BC
000AE4 0BE4 CDA80D          17      CALL    GETNUM
000AE7 0BE7 C1              10      POP BC
000AE8 0BE8 7D               4      LD  A,L
000AE9 0BE9 B9               4      CP  C
000AEA 0BEA 301C            12      JR  NC,MODE1
000AEC 0BEC B7               4      OR  A
000AED 0BED 2819            12      JR  Z,MODE1
000AEF 0BEF FE21             7      CP  33
000AF1 0BF1 381E            12      JR  C,MODE32
000AF3 0BF3 32AEF3          13      LD  (LINL40),A
000AF6 0BF6 DD216C00        14      LD  IX,INITXT
000AFA 0BFA CD010C          17      CALL    CALLROM
000AFD 0BFD DD217800        14      LD  IX,SETTXT
       0C01                     CALLROM:
000B01 0C01 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000B05 0C05 C31C00          10      JP  CALSLT
       0C08                     MODE1:
000B08 0C08 3AB0F3          13      LD  A,(LINLEN)
000B0B 0C0B CDC306          17      CALL    PRDEC_A
000B0E 0C0E C35905          10      JP  LTNL
       0C11                     MODE32:
000B11 0C11 32AFF3          13      LD  (LINL32),A
000B14 0C14 DD216F00        14      LD  IX,INIT32
000B18 0C18 CD010C          17      CALL    CALLROM
000B1B 0C1B DD217B00        14      LD  IX,SETT32
000B1F 0C1F 18E0            12      JR  CALLROM
                                
       0C21                     C_PAUSE:
000B21 0C21 CDE60A          17      CALL    SPCUT
000B24 0C24 EB               4      EX  DE,HL
000B25 0C25 7E               7      LD  A,(HL)
000B26 0C26 B7               4      OR  A
000B27 0C27 2003            12      JR  NZ,C_PAUSE1
000B29 0C29 218C0E          10      LD  HL,PAUSE
       0C2C                     C_PAUSE1:
000B2C 0C2C CD1B05          17      CALL    MSX
000B2F 0C2F 0E07             7      LD  C,7     ;(BDOS)コンソール直接入力(_DIRIN)
000B31 0C31 CD0500          17      CALL    SYSTEM
000B34 0C34 FE03             7      CP  3
000B36 0C36 CA4204          10      JP  Z,END_BATCH
000B39 0C39 C35905          10      JP  LTNL
                                
       0C3C                     C_ECHO:
000B3C 0C3C CDE60A          17      CALL    SPCUT
000B3F 0C3F EB               4      EX  DE,HL
000B40 0C40 CD1B05          17      CALL    MSX
000B43 0C43 C35905          10      JP  LTNL
                                
       0C46                     C_MKDIR:
000B46 0C46 CDE60A          17      CALL    SPCUT
000B49 0C49 014490          10      LD  BC,09044H   ;B=新規作成+ディレクトリ/C=(BDOS)ファイルハンドルの作成(_CREATE)
000B4C 0C4C CD0500          17      CALL    SYSTEM
000B4F 0C4F C6FF             7      ADD A,0FFH
000B51 0C51 D8              11      RET C
000B52 0C52 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
000B54 0C54 CD0500          17      CALL    SYSTEM
       0C57                     SHOW_OK:
000B57 0C57 11820E          10      LD  DE,OK
000B5A 0C5A 0E09             7      LD  C,9     ;(BDOS)文字列出力
000B5C 0C5C CD0500          17      CALL    SYSTEM
000B5F 0C5F C35905          10      JP  LTNL
                                
       0C62                     C_RMDIR:
000B62 0C62 CDE60A          17      CALL    SPCUT
000B65 0C65 AF               4      XOR A
000B66 0C66 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
000B68 0C68 D5              11      PUSH    DE
000B69 0C69 CD0500          17      CALL    SYSTEM
000B6C 0C6C D1              10      POP DE
000B6D 0C6D C6FF             7      ADD A,0FFH
000B6F 0C6F D8              11      RET C
000B70 0C70 CB65             8      BIT 4,L
000B72 0C72 C8              11      RET Z
000B73 0C73 0E4D             7      LD  C,04DH      ;(BDOS)ファイル・サブディレクトリの削除
000B75 0C75 CD0500          17      CALL    SYSTEM
000B78 0C78 C6FF             7      ADD A,0FFH
000B7A 0C7A D8              11      RET C
000B7B 0C7B 18DA            12      JR  SHOW_OK
                                
       0C7D                     C_SET:
000B7D 0C7D CDE60A          17      CALL    SPCUT
000B80 0C80 ED53930C        20      LD  (CSET_PARAM),DE
       0C84                     CSET2:
000B84 0C84 1A               7      LD  A,(DE)
000B85 0C85 FE20             7      CP  020H
000B87 0C87 3838            12      JR  C,CSET_LIST
000B89 0C89 D63D             7      SUB '='
000B8B 0C8B 2803            12      JR  Z,CSET_SET
000B8D 0C8D 13               6      INC DE
000B8E 0C8E 18F4            12      JR  CSET2
       0C90                     CSET_SET:
000B90 0C90 12               7      LD  (DE),A
000B91 0C91 13               6      INC DE
       0C93                     CSET_PARAM  EQU $+1
000B92 0C92 210000          10      LD  HL,0
000B95 0C95 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000B97 0C97 CD0500          17      CALL    SYSTEM
       0C9A                     INIT_VAR:           ;環境変数の初期化
000B9A 0C9A 21630F          10      LD  HL,N_DATE
000B9D 0C9D 11680F          10      LD  DE,V_DATE
000BA0 0CA0 0610             7      LD  B,16
000BA2 0CA2 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000BA4 0CA4 CD0500          17      CALL    SYSTEM
                                
000BA7 0CA7 21880F          10      LD  HL,N_TIME
000BAA 0CAA 118D0F          10      LD  DE,V_TIME
000BAD 0CAD 0603             7      LD  B,3
000BAF 0CAF 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000BB1 0CB1 CD0500          17      CALL    SYSTEM
                                
000BB4 0CB4 21D70E          10      LD  HL,N_APPEND
000BB7 0CB7 11DE0E          10      LD  DE,V_APPEND
000BBA 0CBA 0640             7      LD  B,PATHX
000BBC 0CBC 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000BBE 0CBE C30500          10      JP  SYSTEM
                                
       0CC1                     CSET_LIST:
000BC1 0CC1 3E0A             7      LD  A,10
000BC3 0CC3 328F11          13      LD  (CSET_DATA),A
000BC6 0CC6 110100          10      LD  DE,1
       0CC9                     CSET1:
000BC9 0CC9 D5              11      PUSH    DE
000BCA 0CCA 016DFF          10      LD  BC,0FF6DH   ;_FENV 環境変数の検索
000BCD 0CCD 219111          10      LD  HL,DATA_COM
000BD0 0CD0 3600            10      LD  (HL),0
000BD2 0CD2 CD0500          17      CALL    SYSTEM
000BD5 0CD5 B7               4      OR  A
000BD6 0CD6 2030            12      JR  NZ,CSET_ERROR
000BD8 0CD8 219111          10      LD  HL,DATA_COM
000BDB 0CDB 7E               7      LD  A,(HL)
000BDC 0CDC B7               4      OR  A
000BDD 0CDD 2829            12      JR  Z,CSET_ERROR
000BDF 0CDF CD1B05          17      CALL    MSX
000BE2 0CE2 1E3D             7      LD  E,'='
000BE4 0CE4 CDB709          17      CALL    _PRINT
000BE7 0CE7 219111          10      LD  HL,DATA_COM
000BEA 0CEA 119112          10      LD  DE,DATA_COM+256
000BED 0CED 016BFF          10      LD  BC,0FF6BH   ;_GENV 環境変数の獲得
000BF0 0CF0 CD0500          17      CALL    SYSTEM
000BF3 0CF3 219112          10      LD  HL,DATA_COM+256
000BF6 0CF6 CD1B05          17      CALL    MSX
000BF9 0CF9 CD5905          17      CALL    LTNL
000BFC 0CFC 3E0A             7      LD  A,10
000BFE 0CFE 328F11          13      LD  (CSET_DATA),A
       0D01                     CSET_NEXT:
000C01 0D01 D1              10      POP DE
000C02 0D02 13               6      INC DE
000C03 0D03 7A               4      LD  A,D
000C04 0D04 B3               4      OR  E
000C05 0D05 20C2            12      JR  NZ,CSET1
000C07 0D07 C9              10      RET
       0D08                     CSET_ERROR:
000C08 0D08 218F11          10      LD  HL,CSET_DATA
000C0B 0D0B 35              11      DEC (HL)
000C0C 0D0C 20F3            12      JR  NZ,CSET_NEXT
       0D0E                     CSET_END:
000C0E 0D0E D1              10      POP DE
000C0F 0D0F C9              10      RET
                                
       0D10                     C_FORMAT:
000C10 0D10 3A940F          13      LD  A,(IS_MSX)
000C13 0D13 B7               4      OR  A
000C14 0D14 C8              11      RET Z
000C15 0D15 3A950F          13      LD  A,(MAJOR_VER)
000C18 0D18 FE02             7      CP  2
000C1A 0D1A 300B            12      JR  NC,FORMAT2
       0D1C                     FORMAT1:
000C1C 0D1C FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000C20 0D20 DD214701        14      LD  IX,FORMAT
000C24 0D24 C31C00          10      JP  CALSLT
       0D27                     FORMAT2:
000C27 0D27 CD4E07          17      CALL    SETFCB
000C2A 0D2A 3A5C00          13      LD  A,(FCB1)
000C2D 0D2D B7               4      OR  A
000C2E 0D2E 28EC            12      JR  Z,FORMAT1
000C30 0D30 47               4      LD  B,A
000C31 0D31 AF               4      XOR A
000C32 0D32 0E67             7      LD  C,067H      ;(_FORMAT)ディスクのフォーマット
000C34 0D34 CD0500          17      CALL    SYSTEM
000C37 0D37 B7               4      OR  A
000C38 0D38 20E2            12      JR  NZ,FORMAT1
000C3A 0D3A CD2405          17      CALL    MSXSLT
000C3D 0D3D 21910F          10      LD  HL,PROMPT
000C40 0D40 CD1B05          17      CALL    MSX
       0D43                     FORMAT3:
000C43 0D43 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力(_INNOE)
000C45 0D45 CD0500          17      CALL    SYSTEM
000C48 0D48 D631             7      SUB '0'+1
000C4A 0D4A 38F7            12      JR  C,FORMAT3
000C4C 0D4C 3C               4      INC A
000C4D 0D4D FE0A             7      CP  10
000C4F 0D4F 30F2            12      JR  NC,FORMAT3
000C51 0D51 F5              11      PUSH    AF
000C52 0D52 CD5905          17      CALL    LTNL
000C55 0D55 218C0E          10      LD  HL,PAUSE
000C58 0D58 CD1B05          17      CALL    MSX
000C5B 0D5B 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力(_INNOE)
000C5D 0D5D CD0500          17      CALL    SYSTEM
000C60 0D60 CD5905          17      CALL    LTNL
000C63 0D63 F1              10      POP AF
000C64 0D64 ED4B5B00        20      LD  BC,(FCB1-1)
000C68 0D68 210080          10      LD  HL,08000H
000C6B 0D6B 110040          10      LD  DE,04000H
000C6E 0D6E 0E67             7      LD  C,067H      ;(_FORMAT)ディスクのフォーマット
000C70 0D70 C30500          10      JP  SYSTEM
                                
       0D73                     C_RAMDISK:
000C73 0D73 3A940F          13      LD  A,(IS_MSX)
000C76 0D76 B7               4      OR  A
000C77 0D77 C8              11      RET Z
000C78 0D78 3A950F          13      LD  A,(MAJOR_VER)
000C7B 0D7B FE02             7      CP  2
000C7D 0D7D D8              11      RET C
000C7E 0D7E CDE60A          17      CALL    SPCUT
000C81 0D81 1A               7      LD  A,(DE)
000C82 0D82 FE30             7      CP  '0'
000C84 0D84 D8              11      RET C
000C85 0D85 FE3A             7      CP  '9'+1
000C87 0D87 3F               4      CCF
000C88 0D88 D8              11      RET C
000C89 0D89 CDA80D          17      CALL    GETNUM
000C8C 0D8C 110F00          10      LD  DE,15       ;切り上げの為
000C8F 0D8F 19              11      ADD HL,DE
000C90 0D90 7D               4      LD  A,L
000C91 0D91 0604             7      LD  B,4     ;16で割る
       0D93                     RAMDISK1:
000C93 0D93 CB3C             8      SRL H   ;/2
000C95 0D95 1F               4      RRA
000C96 0D96 10FB            13      DJNZ    RAMDISK1
000C98 0D98 FEFF             7      CP  0FFH
000C9A 0D9A 2001            12      JR  NZ,RAMDISK2
000C9C 0D9C 3D               4      DEC A
       0D9D                     RAMDISK2:
000C9D 0D9D 47               4      LD  B,A
000C9E 0D9E 0E68             7      LD  C,068H      ;(_RAMD)RAMディスクの作成あるいは消去
000CA0 0DA0 CD0500          17      CALL    SYSTEM
000CA3 0DA3 B7               4      OR  A
000CA4 0DA4 CC570C          17      CALL    Z,SHOW_OK
000CA7 0DA7 C9              10      RET
                                
       0DA8                     GETNUM:
000CA8 0DA8 CDE60A          17      CALL    SPCUT
000CAB 0DAB 210000          10      LD  HL,0
       0DAE                     GETNUM1:
000CAE 0DAE 1A               7      LD  A,(DE)
000CAF 0DAF 13               6      INC DE
000CB0 0DB0 D630             7      SUB '0'
000CB2 0DB2 D8              11      RET C
000CB3 0DB3 FE0A             7      CP  10
000CB5 0DB5 D0              11      RET NC
000CB6 0DB6 4D               4      LD  C,L
000CB7 0DB7 44               4      LD  B,H
000CB8 0DB8 29              11      ADD HL,HL   ;*2
000CB9 0DB9 29              11      ADD HL,HL   ;*4
000CBA 0DBA 09              11      ADD HL,BC   ;*5
000CBB 0DBB 29              11      ADD HL,HL   ;*10
000CBC 0DBC 4F               4      LD  C,A
000CBD 0DBD 0600             7      LD  B,0
000CBF 0DBF 09              11      ADD HL,BC
000CC0 0DC0 18EC            12      JR  GETNUM1
                                
       0DC2                     CHDIR:
000CC2 0DC2 3A950F          13      LD  A,(MAJOR_VER)
000CC5 0DC5 FE02             7      CP  2
000CC7 0DC7 D8              11      RET C
000CC8 0DC8 C5              11      PUSH    BC
000CC9 0DC9 E5              11      PUSH    HL
000CCA 0DCA 0E5A             7      LD  C,05AH      ;(BDOS)_CHDIR カレントディレクトリの変更
000CCC 0DCC CD0500          17      CALL    SYSTEM
000CCF 0DCF E1              10      POP HL
000CD0 0DD0 C1              10      POP BC
000CD1 0DD1 C9              10      RET
                                
       0011                     COMS    EQU 17
       0DD2                     COMTB:
000CD2 0DD2 44202020202020          DB  "D      "   ;1
000CD9 0DD9 9A04                    DW  C_DIR
000CDB 0DDB 44495220202020          DB  "DIR    "   ;2
000CE2 0DE2 9A04                    DW  C_DIR
000CE4 0DE4 434F5059202020          DB  "COPY   "   ;3
000CEB 0DEB 9707                    DW  C_COPY
000CED 0DED 43442020202020          DB  "CD     "   ;4
000CF4 0DF4 2D03                    DW  C_CD
000CF6 0DF6 44454C20202020          DB  "DEL    "   ;5
000CFD 0DFD 6004                    DW  C_DEL
000CFF 0DFF 50415448202020          DB  "PATH   "   ;6
000D06 0E06 6305                    DW  C_PATH
000D08 0E08 52454E20202020          DB  "REN    "   ;7
000D0F 0E0F 6C04                    DW  C_REN
000D11 0E11 54595045202020          DB  "TYPE   "   ;8
000D18 0E18 4D09                    DW  C_TYPE
000D1A 0E1A 52454D20202020          DB  "REM    "   ;9
000D21 0E21 5E04                    DW  C_REM
000D23 0E23 4D4F4445202020          DB  "MODE   "   ;10
000D2A 0E2A D40B                    DW  C_MODE
000D2C 0E2C 50415553452020          DB  "PAUSE  "   ;11
000D33 0E33 210C                    DW  C_PAUSE
000D35 0E35 53455420202020          DB  "SET    "   ;12
000D3C 0E3C 7D0C                    DW  C_SET
000D3E 0E3E 4543484F202020          DB  "ECHO   "   ;13
000D45 0E45 3C0C                    DW  C_ECHO
000D47 0E47 4D4B4449522020          DB  "MKDIR  "   ;14
000D4E 0E4E 460C                    DW  C_MKDIR
000D50 0E50 524D4449522020          DB  "RMDIR  "   ;15
000D57 0E57 620C                    DW  C_RMDIR
000D59 0E59 464F524D415420          DB  "FORMAT "   ;16
000D60 0E60 100D                    DW  C_FORMAT
000D62 0E62 52414D4449534B          DB  "RAMDISK"   ;17
000D69 0E69 730D                    DW  C_RAMDISK
                                
000D6B 0E6B 2062797465732066    FREE:   DB  " bytes free  $"
            726565202024        
000D79 0E79 2020203C4449523E    DIRMES: DB  "   <DIR>$"
            24                  
000D82 0E82 4F4B24              OK: DB  "OK$"
000D85 0E85 4572726F722124      COMERM: DB  "Error!$"
000D8C 0E8C 537472696B652061    PAUSE:  DB  "Strike any key when ready ",0
            6E79206B65792077    
            68656E2072656164    
            792000              
                                
       0EA7                     S_MONTH:
000DA7 0EA7 4A616E00                DB  "Jan",0
000DAB 0EAB 46656200                DB  "Feb",0
000DAF 0EAF 4D617200                DB  "Mar",0
000DB3 0EB3 41707200                DB  "Apr",0
000DB7 0EB7 4D617900                DB  "May",0
000DBB 0EBB 4A756E00                DB  "Jun",0
000DBF 0EBF 4A756C00                DB  "Jul",0
000DC3 0EC3 41756700                DB  "Aug",0
000DC7 0EC7 53657000                DB  "Sep",0
000DCB 0ECB 4F637400                DB  "Oct",0
000DCF 0ECF 4E6F7600                DB  "Nov",0
000DD3 0ED3 44656300                DB  "Dec",0
                                
       0ED7                     N_APPEND:
000DD7 0ED7 415050454E4400          DB  "APPEND",0
       0EDE                     V_APPEND:
000DDE 0EDE                         DS  64
       0F1E                     N_PATH:
000E1E 0F1E 5041544800              DB  "PATH",0
       0F23                     V_PATH:
000E23 0F23                         DS  PATHX
       0F63                     N_DATE:
000E63 0F63 4441544500              DB  "DATE",0
       0F68                     V_DATE:
000E68 0F68 79792D6D6D2D6464        DB  "yy-mm-dd"
000E70 0F70                         DS  8
       0F78                     V_DATE1:
000E78 0F78 6D6D2D64642D7979        DB  "mm-dd-yy"
       0F80                     V_DATE2:
000E80 0F80 64642D6D6D2D7979        DB  "dd-mm-yy"
       0F88                     N_TIME:
000E88 0F88 54494D4500              DB  "TIME",0
       0F8D                     V_TIME:
000E8D 0F8D 323400                  DB  "24",0
       0F90                     F_TIME:
000E90 0F90 00                      DB  0
       0F91                     PROMPT:
000E91 0F91 3F2000                  DB  "? ",0
       0F94                     IS_MSX:
000E94 0F94 00                      DB  0
       0F95                     MAJOR_VER:
000E95 0F95 00                      DB  0
       0F96                     SEARCH_IX:
000E96 0F96                         DS  64  ;DOS2用
       0FD6                     HANDLE1:
000ED6 0FD6 0000                    DW  0
       0FD8                     PATH_DRV:
000ED8 0FD8 413A5C                  DB  "A:\\"
       0FDB                     PATH_CCP:
000EDB 0FDB                         DS  64  ;DOS2用
       101B                     PATH_PAR:
000F1B 101B                         DS  64  ;DOS2用
       105B                     PATH_POS:
000F5B 105B 0000                    DW  0
       105D                     PATH_FN1:
000F5D 105D                         DS  64  ;DOS2用
       109D                     PATH_FN2:
000F9D 109D                         DS  64  ;DOS2用
       10DD                     CUR_DRV:
000FDD 10DD 413A5C                  DB  "A:\\"
       10E0                     CUR_PATH:
000FE0 10E0                         DS  64  ;DOS2用
       1120                     DOS2NAME:
001020 1120                         DS  2+8+3+1 ;DOS2用
       112E                     DTA_CCP:
00102E 112E                         DS  37
       1153                     CPBUF:
001053 1153 0000                LEFTX:  DW  0
001055 1155 0000                DTAX:   DW  0
001057 1157 20                      DB  020H    ;CPBUFで使う
001058 1158 20                      DB  020H
001059 1159 20                      DB  020H
00105A 115A 20                      DB  020H
00105B 115B 20                      DB  020H
00105C 115C 20                      DB  020H
00105D 115D 20                      DB  020H
                                
       115E                     DECBF:
00105E 115E                         DS  5
       1163                     FCB_BAT2:
001063 1163 00                      DB  0
       1164                     FDRV:
001064 1164 00                      DB  0
       1165                     FNAME:
001065 1165                         DS  37
       118A                     ZERO:
00108A 118A 00                      DB  0
       118B                     FCB_BAT:
00108B 118B 6311                    DW  FCB_BAT2
       118D                     X_PATH:
00108D 118D 0000                    DW  0
       118F                     CSET_DATA:
00108F 118F 00                      DB  0
       1190                     PROCESS:
001090 1190 00                      DB  0
                                
       1191                     DATA_COM:
[EOF:COMMAND.ASM:SHIFT_JIS]
