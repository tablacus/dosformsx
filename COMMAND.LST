                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                
                                ;   似非COMMAND.COM
                                
       0005                     SYSTEM  EQU 00005H
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
       000C                     RDSLT   EQU 0000CH
       001C                     CALSLT  EQU 0001CH
       006C                     INITXT  EQU 0006CH
       006F                     INIT32  EQU 0006FH
       0078                     SETTXT  EQU 00078H
       007B                     SETT32  EQU 0007BH
       0147                     FORMAT  EQU 00147H
                                
       F3AE                     LINL40  EQU 0F3AEH
       F3AF                     LINL32  EQU 0F3AFH
       F3B0                     LINLEN  EQU 0F3B0H
       F55E                     BUF EQU 0F55EH
       FAF8                     EXBRSA  EQU 0FAF8H
       FC9B                     INTFLG  EQU 0FC9BH
       FCC1                     EXPTBL  EQU 0FCC1H
                                
                                
       0040                     PATHX   EQU 64
                                
       8000                     DATA    EQU 08000H
                                
000000 0100                         ORG 0100H
000000 0100 C31501          10      JP  START
000003 0103 0D0A434F4D4D414E    VER:    DB  00DH,00AH,"COMMAND v0.15",00DH,00AH,'$'
            442076302E31350D    
            0A24                
       0115                     START:
000015 0115 ED7B0600        20      LD  SP,(SYSTEM+1)
000019 0119 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
00001B 011B CD0500          17      CALL    SYSTEM
00001E 011E D8              11      RET C
00001F 011F 211D01          10      LD  HL,0011DH
000022 0122 ED42            15      SBC HL,BC
000024 0124 78               4      LD  A,B
000025 0125 32B610          13      LD  (MAJOR_VER),A
000028 0128 B5               4      OR  L
000029 0129 32B510          13      LD  (IS_MSX),A
00002C 012C B7               4      OR  A
00002D 012D 2850            12      JR  Z,WSTART
                                
00002F 012F 3AB312          13      LD  A,(PROCESS)
000032 0132 0E61             7      LD  C,61H       ;(BDOS)親プロセスに戻る
000034 0134 47               4      LD  B,A
000035 0135 B7               4      OR  A
000036 0136 C40500          17      CALL    NZ,SYSTEM
000039 0139 AF               4      XOR A
00003A 013A 32B312          13      LD  (PROCESS),A
                                
00003D 013D 212B00          10      LD  HL,002BH    ;キャラクターセット・日時フォーマット・ビデオ信号の種別
000040 0140 CD0C00          17      CALL    RDSLT
000043 0143 0F               4      RRCA
000044 0144 0F               4      RRCA
000045 0145 0F               4      RRCA
000046 0146 0F               4      RRCA
000047 0147 E603             7      AND 3
000049 0149 2814            12      JR  Z,DATEOK
00004B 014B 3D               4      DEC A
00004C 014C 218610          10      LD  HL,V_DATE1
00004F 014F 2806            12      JR  Z,DATECHG
000051 0151 3D               4      DEC A
000052 0152 218E10          10      LD  HL,V_DATE2
000055 0155 2008            12      JR  NZ,DATEOK
       0157                     DATECHG:
000057 0157 117610          10      LD  DE,V_DATE
00005A 015A 010800          10      LD  BC,8
00005D 015D EDB0                    LDIR
       015F                     DATEOK:
00005F 015F CDA80D          17      CALL    INIT_VAR
                                
000062 0162 2A0600          16      LD  HL,(SYSTEM+1)
000065 0165 2EDB             7      LD  L,256-37
000067 0167 24               4      INC H
000068 0168 22AE12          16      LD  (FCB_BAT),HL
00006B 016B 3A8000          13      LD  A,(DTA1)
00006E 016E B7               4      OR  A
00006F 016F 280E            12      JR  Z,WSTART
000071 0171 110301          10      LD  DE,VER
000074 0174 0E09             7      LD  C,9
000076 0176 CD0500          17      CALL    SYSTEM
000079 0179 118100          10      LD  DE,DTA1+1
00007C 017C CDE201          17      CALL    COMANL
       017F                     WSTART:
00007F 017F 21E50F          10      LD  HL,N_APPEND
000082 0182 11EC0F          10      LD  DE,V_APPEND
000085 0185 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000087 0187 CD0500          17      CALL    SYSTEM
                                
00008A 018A 219E10          10      LD  HL,N_PROGRAM
00008D 018D 11AD12          10      LD  DE,ZERO
000090 0190 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000092 0192 CD0500          17      CALL    SYSTEM
                                
000095 0195 21A610          10      LD  HL,N_PARAMETERS
000098 0198 11AD12          10      LD  DE,ZERO
00009B 019B 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
00009D 019D CD0500          17      CALL    SYSTEM
                                
0000A0 01A0 CD4206          17      CALL    LTNL
       01A3                     COMMAND:
0000A3 01A3 E5              11      PUSH    HL
0000A4 01A4 2AAE12          16      LD  HL,(FCB_BAT)
0000A7 01A7 7E               7      LD  A,(HL)
0000A8 01A8 E1              10      POP HL
0000A9 01A9 B7               4      OR  A
0000AA 01AA C2CF04          10      JP  NZ,C_BAT1
0000AD 01AD CD6D03          17      CALL    SETDTA1
0000B0 01B0 D5              11      PUSH    DE
0000B1 01B1 C5              11      PUSH    BC
0000B2 01B2 E5              11      PUSH    HL
0000B3 01B3 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
0000B5 01B5 CD0500          17      CALL    SYSTEM
0000B8 01B8 E1              10      POP HL
0000B9 01B9 C1              10      POP BC
0000BA 01BA C641             7      ADD A,'A'
0000BC 01BC CDA90A          17      CALL    MSG_A
0000BF 01BF 1E3E             7      LD  E,'>'
0000C1 01C1 CD980A          17      CALL    _PRINT
0000C4 01C4 D1              10      POP DE      ;DE=DTA1
0000C5 01C5 3E50             7      LD  A,80
0000C7 01C7 12               7      LD  (DE),A
0000C8 01C8 0E0A             7      LD  C,0AH       ;(BDOS)文字列入力
0000CA 01CA CD0500          17      CALL    SYSTEM
0000CD 01CD CD4206          17      CALL    LTNL
       01D0                     COMMAND2:
0000D0 01D0 118200          10      LD  DE,DTA1+2
0000D3 01D3 CDE201          17      CALL    COMANL
0000D6 01D6 30CB            12      JR  NC,COMMAND
0000D8 01D8 11930F          10      LD  DE,COMERM
0000DB 01DB 0E09             7      LD  C,9     ;(BDOS)文字列出力
0000DD 01DD CD0500          17      CALL    SYSTEM
0000E0 01E0 189D            12      JR  WSTART
                                
       01E2                     COMANL:
0000E2 01E2 CDCD0B          17      CALL    TOZERO
0000E5 01E5 ED530F02        20      LD  (COMST),DE
0000E9 01E9 CDEA0A          17      CALL    FILE
0000EC 01EC D5              11      PUSH    DE
0000ED 01ED 118812          10      LD  DE,FNAME
0000F0 01F0 1A               7      LD  A,(DE)
0000F1 01F1 FE20             7      CP  020H
0000F3 01F3 CA8002          10      JP  Z,SDVSW
0000F6 01F6 1B               6      DEC DE
0000F7 01F7 1A               7      LD  A,(DE)
0000F8 01F8 C6FF             7      ADD A,0FFH
0000FA 01FA 380A            12      JR  C,COMB
0000FC 01FC 13               6      INC DE
                                
0000FD 01FD 21E00E          10      LD  HL,COMTB
000100 0200 3E11             7      LD  A,COMS
000102 0202 47               4      LD  B,A
000103 0203 CD1F0C          17      CALL    CPNAME
       0206                     COMB:
000106 0206 D1              10      POP DE
000107 0207 D2970A          10      JP  NC,JP_HL
       020A                     COMB2:
00010A 020A EB               4      EX  DE,HL
00010B 020B 220104          16      LD  (COMPAT),HL
                                
00010E 020E 110000          10      LD  DE,0
       020F                     COMST   EQU $-2
000111 0211 21B412          10      LD  HL,DATA_COM
000114 0214 3600            10      LD  (HL),0
       0216                     COMPR1:
000116 0216 1A               7      LD  A,(DE)
000117 0217 13               6      INC DE
000118 0218 23               6      INC HL
000119 0219 77               7      LD  (HL),A
00011A 021A FE20             7      CP  020H
00011C 021C 30F8            12      JR  NC,COMPR1
       021E                     COMPR2:
00011E 021E 2B               6      DEC HL
00011F 021F 7E               7      LD  A,(HL)
000120 0220 FE5C             7      CP  05CH
000122 0222 2014            12      JR  NZ,COMPR3
000124 0224 3600            10      LD  (HL),0
000126 0226 23               6      INC HL
000127 0227 EB               4      EX  DE,HL
000128 0228 CDEA0A          17      CALL    FILE
00012B 022B 21E50F          10      LD  HL,N_APPEND
00012E 022E 11B512          10      LD  DE,DATA_COM+1
000131 0231 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000133 0233 CD0500          17      CALL    SYSTEM
000136 0236 1804            12      JR  COMPR4
       0238                     COMPR3:
000138 0238 FE20             7      CP  020H
00013A 023A 30E2            12      JR  NC,COMPR2
       023C                     COMPR4:
00013C 023C CDC303          17      CALL    CEXE4
                                
00013F 023F 212C10          10      LD  HL,N_PATH
000142 0242 113110          10      LD  DE,V_PATH
000145 0245 0640             7      LD  B,PATHX
000147 0247 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000149 0249 CD0500          17      CALL    SYSTEM
                                
00014C 024C 213110          10      LD  HL,V_PATH
00014F 024F 22B012          16      LD  (X_PATH),HL
       0252                     CEX1:
000152 0252 2AB012          16      LD  HL,(X_PATH)
000155 0255 7E               7      LD  A,(HL)
000156 0256 FE20             7      CP  020H
000158 0258 D8              11      RET C
       0259                     CEX2:
000159 0259 7E               7      LD  A,(HL)
00015A 025A FE20             7      CP  020H
00015C 025C 3807            12      JR  C,CEX3
00015E 025E FE3B             7      CP  ';'
000160 0260 2803            12      JR  Z,CEX3
000162 0262 23               6      INC HL
000163 0263 18F4            12      JR  CEX2
       0265                     CEX3:
000165 0265 3600            10      LD  (HL),0
000167 0267 FE20             7      CP  020H
000169 0269 3801            12      JR  C,CEX4
00016B 026B 23               6      INC HL
       026C                     CEX4:
00016C 026C ED5BB012        20      LD  DE,(X_PATH)
000170 0270 22B012          16      LD  (X_PATH),HL
000173 0273 21E50F          10      LD  HL,N_APPEND
000176 0276 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000178 0278 CD0500          17      CALL    SYSTEM
                                
00017B 027B CDC303          17      CALL    CEXE4
00017E 027E 18D2            12      JR  CEX1
                                
       0280                     SDVSW:
000180 0280 F1              10      POP AF
000181 0281 3A8712          13      LD  A,(FDRV)
000184 0284 3D               4      DEC A
000185 0285 5F               4      LD  E,A
000186 0286 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000188 0288 C37403          10      JP  SYSTEM0
                                
       028B                     OPEN_D2:            ;DOS2対応
00018B 028B 3AB610          13      LD  A,(MAJOR_VER)
00018E 028E FE02             7      CP  2
000190 0290 384F            12      JR  C,OPEN
000192 0292 117E11          10      LD  DE,PATH_FN1
000195 0295 180A            12      JR  OPEN_D2X
       0297                     OPEN1_D2:           ;DOS2対応
000197 0297 3AB610          13      LD  A,(MAJOR_VER)
00019A 029A FE02             7      CP  2
00019C 029C 3840            12      JR  C,OPEN1
                                
00019E 029E 11FE10          10      LD  DE,PATH_CCP
       02A1                     OPEN_D2X:
0001A1 02A1 DD21B710        14      LD  IX,SEARCH_IX
0001A5 02A5 014010          10      LD  BC,01040H   ;(BDOS)最初のエントリ検索
0001A8 02A8 CD0500          17      CALL    SYSTEM
0001AB 02AB F5              11      PUSH    AF
0001AC 02AC 113E11          10      LD  DE,PATH_PAR
0001AF 02AF 0E5E             7      LD  C,05EH      ;(BDOS)完全なパス文字列の獲得(_WPATH)
0001B1 02B1 CD0500          17      CALL    SYSTEM
0001B4 02B4 AF               4      XOR A
0001B5 02B5 77               7      LD  (HL),A
0001B6 02B6 113E11          10      LD  DE,PATH_PAR
0001B9 02B9 ED52            15      SBC HL,DE
0001BB 02BB 22F910          16      LD  (PATH_POS),HL
0001BE 02BE F1              10      POP AF
       02BF                     FIB2DIRENT:
0001BF 02BF B7               4      OR  A
0001C0 02C0 C0              11      RET NZ
                                
0001C1 02C1 11B810          10      LD  DE,SEARCH_IX+1  ;(FIB)ファイル名
0001C4 02C4 215012          10      LD  HL,DTA_CCP+1
0001C7 02C7 0E5C             7      LD  C,05CH      ;(BDOS)ファイル名の解析
0001C9 02C9 CD0500          17      CALL    SYSTEM
                                
0001CC 02CC 21C510          10      LD  HL,SEARCH_IX+14 ;(FIB)属性
0001CF 02CF 115B12          10      LD  DE,DTA_CCP+1+8+3
0001D2 02D2 EDA0            16      LDI
0001D4 02D4 116612          10      LD  DE,DTA_CCP+1+8+3+1+10
0001D7 02D7 010A00          10      LD  BC,2+2+2+4  ;最終変更時刻+最終変更日付+開始クラスタ+ファイルサイズ
0001DA 02DA EDB0                    LDIR
0001DC 02DC AF               4      XOR A
0001DD 02DD C9              10      RET
                                
       02DE                     OPEN1:
0001DE 02DE 218712          10      LD  HL,FDRV
       02E1                     OPEN:
0001E1 02E1 0E11             7      LD  C,011H      ;(BDOS)最初のファイルの検索
       02E3                     OPEN3:
0001E3 02E3 D5              11      PUSH    DE
0001E4 02E4 114F12          10      LD  DE,DTA_CCP
0001E7 02E7 CD6003          17      CALL    SETDTA
0001EA 02EA EB               4      EX  DE,HL
0001EB 02EB CD0500          17      CALL    SYSTEM
0001EE 02EE D1              10      POP DE
0001EF 02EF B7               4      OR  A
0001F0 02F0 C9              10      RET
                                
       02F1                     OPEN2_D2:           ;DOS2対応
0001F1 02F1 3AB610          13      LD  A,(MAJOR_VER)
0001F4 02F4 FE02             7      CP  2
0001F6 02F6 380B            12      JR  C,OPEN2
0001F8 02F8 DD21B710        14      LD  IX,SEARCH_IX
0001FC 02FC 0E41             7      LD  C,41H       ;(BDOS)次のエントリ検索
0001FE 02FE CD0500          17      CALL    SYSTEM
000201 0301 18BC            12      JR  FIB2DIRENT
       0303                     OPEN2:
000203 0303 0E12             7      LD  C,012H
000205 0305 18DC            12      JR  OPEN3
                                
       0307                     DEFCB_D2:           ;DOS2対応
000207 0307 3AB610          13      LD  A,(MAJOR_VER)
00020A 030A FE02             7      CP  2
00020C 030C 383A            12      JR  C,DEFCB
00020E 030E 213E11          10      LD  HL,PATH_PAR
000211 0311 11FE10          10      LD  DE,PATH_CCP
000214 0314 014000          10      LD  BC,64
000217 0317 EDB0                    LDIR
000219 0319 2AF910          16      LD  HL,(PATH_POS)
00021C 031C 11FE10          10      LD  DE,PATH_CCP
00021F 031F 19              11      ADD HL,DE
000220 0320 060D             7      LD  B,13
000222 0322 11B810          10      LD  DE,SEARCH_IX+1  ;(FIB)ファイル名
       0325                     DCB4:
000225 0325 1A               7      LD  A,(DE)
000226 0326 B7               4      OR  A
000227 0327 2805            12      JR  Z,DCB5
000229 0329 13               6      INC DE
00022A 032A 77               7      LD  (HL),A
00022B 032B 23               6      INC HL
00022C 032C 18F7            12      JR  DCB4
       032E                     DCB5:
00022E 032E 3600            10      LD  (HL),0
000230 0330 3AD010          13      LD  A,(SEARCH_IX+25)    ;(FIB)ドライブ番号(1-8)
000233 0333 C640             7      ADD A,040H
000235 0335 11FB10          10      LD  DE,PATH_DRV
000238 0338 12               7      LD  (DE),A
000239 0339 0E43             7      LD  C,043H      ;_OPEN ファイルハンドルのオープン
00023B 033B 3E01             7      LD  A,1     ;書き込み禁止
00023D 033D CD0500          17      CALL    SYSTEM
000240 0340 B7               4      OR  A
000241 0341 C0              11      RET NZ
000242 0342 ED43F710        20      LD  (HANDLE1),BC
000246 0346 1815            12      JR  SETDTA100
       0348                     DEFCB:              ;Z=Ok NZ=Error
000248 0348 114F12          10      LD  DE,DTA_CCP
00024B 034B CD7203          17      CALL    SYSC0F
00024E 034E B7               4      OR  A
00024F 034F C0              11      RET NZ
                                
000250 0350 210100          10      LD  HL,1
000253 0353 225D12          16      LD  (DTA_CCP+14),HL
000256 0356 2D               4      DEC L
000257 0357 227012          16      LD  (DTA_CCP+33),HL
00025A 035A 227212          16      LD  (DTA_CCP+35),HL
       035D                     SETDTA100:
00025D 035D 110080          10      LD  DE,DATA
       0360                     SETDTA:
000260 0360 C5              11      PUSH    BC
000261 0361 D5              11      PUSH    DE
000262 0362 E5              11      PUSH    HL
000263 0363 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
000265 0365 CD0500          17      CALL    SYSTEM
000268 0368 E1              10      POP HL
000269 0369 D1              10      POP DE
00026A 036A C1              10      POP BC
00026B 036B AF               4      XOR A
00026C 036C C9              10      RET
                                
       036D                     SETDTA1:
00026D 036D 118000          10      LD  DE,DTA1
000270 0370 18EE            12      JR  SETDTA
                                
       0372                     SYSC0F:
000272 0372 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       0374                     SYSTEM0:
000274 0374 CD0500          17      CALL    SYSTEM
000277 0377 B7               4      OR  A
000278 0378 C9              10      RET
                                
       0379                     C_CD:
000279 0379 CDBC0A          17      CALL    FILEC_D2
00027C 037C 11FE10          10      LD  DE,PATH_CCP
00027F 037F 1A               7      LD  A,(DE)
000280 0380 FE20             7      CP  020H
000282 0382 3805            12      JR  C,PWD
000284 0384 0E5A             7      LD  C,5AH       ;(BDOS)_CHDIR カレントディレクトリの変更
000286 0386 C30500          10      JP  SYSTEM
       0389                     PWD:
000289 0389 CD8806          17      CALL    PUTDRV
00028C 038C 3E5C             7      LD  A,05CH
00028E 038E CDA90A          17      CALL    MSG_A
000291 0391 C3ED05          10      JP  PDSKF2
                                
       0394                     S27DTA_D2:      ;DOS2対応
000294 0394 3AB610          13      LD  A,(MAJOR_VER)
000297 0397 FE02             7      CP  2
000299 0399 3817            12      JR  C,S27DTA
00029B 039B ED4BF710        20      LD  BC,(HANDLE1)
00029F 039F 110080          10      LD  DE,DATA
0002A2 03A2 0E48             7      LD  C,048H      ;(BDOS)ファイルハンドルからの読み出し(_READ)
0002A4 03A4 CD7403          17      CALL    SYSTEM0
0002A7 03A7 C8              11      RET Z
0002A8 03A8 FEC7             7      CP  0C7H        ;.EOF
0002AA 03AA 2803            12      JR  Z,S27EOF
0002AC 03AC 37               4      SCF
0002AD 03AD 9F               4      SBC A,A
0002AE 03AE C9              10      RET
       03AF                     S27EOF:
0002AF 03AF 3E01             7      LD  A,1
0002B1 03B1 C9              10      RET
                                
       03B2                     S27DTA:
0002B2 03B2 110100          10      LD  DE,1
0002B5 03B5 ED535D12        20      LD  (DTA_CCP+14),DE
0002B9 03B9 114F12          10      LD  DE,DTA_CCP
       03BC                     S27:
0002BC 03BC 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
0002BE 03BE CD0500          17      CALL    SYSTEM
0002C1 03C1 B7               4      OR  A
0002C2 03C2 C9              10      RET
                                
       03C3                     CEXE4:
0002C3 03C3 218712          10      LD  HL,FDRV
0002C6 03C6 114F12          10      LD  DE,DTA_CCP
0002C9 03C9 010900          10      LD  BC,1+8
0002CC 03CC EDB0                    LDIR
0002CE 03CE 215812          10      LD  HL,DTA_CCP+9
0002D1 03D1 3643            10      LD  (HL),'C'
0002D3 03D3 23               6      INC HL
0002D4 03D4 364F            10      LD  (HL),'O'
0002D6 03D6 23               6      INC HL
0002D7 03D7 364D            10      LD  (HL),'M'
       03D9                     C_EXE:
0002D9 03D9 CD4803          17      CALL    DEFCB
0002DC 03DC C2A704          10      JP  NZ,C_BAT
0002DF 03DF 11B412          10      LD  DE,DATA_COM
0002E2 03E2 CD6003          17      CALL    SETDTA
                                
0002E5 03E5 2A0600          16      LD  HL,(SYSTEM+1)
0002E8 03E8 11B412          10      LD  DE,DATA_COM
0002EB 03EB ED52            15      SBC HL,DE
                                
0002ED 03ED CDB203          17      CALL    S27DTA
0002F0 03F0 3D               4      DEC A
0002F1 03F1 37               4      SCF
0002F2 03F2 C0              11      RET NZ
0002F3 03F3 7C               4      LD  A,H
0002F4 03F4 B5               4      OR  L
0002F5 03F5 37               4      SCF
0002F6 03F6 C8              11      RET Z
0002F7 03F7 22A104          16      LD  (COMSIZ),HL
                                
0002FA 03FA 11B412          10      LD  DE,DATA_COM
0002FD 03FD CD6003          17      CALL    SETDTA
000300 0400 110000          10      LD  DE,0
       0401                     COMPAT  EQU $-2
000303 0403 CD3708          17      CALL    SETFCB
                                
000306 0406 21E50F          10      LD  HL,N_APPEND
000309 0409 11FE10          10      LD  DE,PATH_CCP
00030C 040C 0640             7      LD  B,PATHX
00030E 040E 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000310 0410 CD0500          17      CALL    SYSTEM
000313 0413 3AFE10          13      LD  A,(PATH_CCP)
000316 0416 B7               4      OR  A
000317 0417 201D            12      JR  NZ,COM_ENV1
000319 0419 0E19             7      LD  C,019H      ;(BDOS)カレントドライブ番号の獲得(_CURDRV)
00031B 041B CD0500          17      CALL    SYSTEM
00031E 041E C641             7      ADD A,'A'
000320 0420 32FE10          13      LD  (PATH_CCP),A
000323 0423 3E3A             7      LD  A,':'
000325 0425 32FF10          13      LD  (PATH_CCP+1),A
000328 0428 3E5C             7      LD  A,05CH      ;\
00032A 042A 320011          13      LD  (PATH_CCP+2),A
00032D 042D 47               4      LD  B,A     ;ドライブ
00032E 042E 110011          10      LD  DE,PATH_CCP+2
000331 0431 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
000333 0433 CD0500          17      CALL    SYSTEM
       0436                     COM_ENV1:
000336 0436 114F12          10      LD  DE,DTA_CCP
000339 0439 214112          10      LD  HL,DOS2NAME
00033C 043C CDFD09          17      CALL    FCB2FNAME
00033F 043F 11FE10          10      LD  DE,PATH_CCP
000342 0442 214312          10      LD  HL,DOS2NAME+2
       0445                     COM_ENV2:
000345 0445 1A               7      LD  A,(DE)
000346 0446 B7               4      OR  A
000347 0447 2803            12      JR  Z,COM_ENV3
000349 0449 13               6      INC DE
00034A 044A 18F9            12      JR  COM_ENV2
       044C                     COM_ENV3:
00034C 044C 1B               6      DEC DE
00034D 044D 1A               7      LD  A,(DE)
00034E 044E 13               6      INC DE
00034F 044F FE5C             7      CP  05CH
000351 0451 2804            12      JR  Z,COM_ENV4
000353 0453 3E5C             7      LD  A,05CH
000355 0455 12               7      LD  (DE),A
000356 0456 13               6      INC DE
       0457                     COM_ENV4:
000357 0457 7E               7      LD  A,(HL)
000358 0458 23               6      INC HL
000359 0459 12               7      LD  (DE),A
00035A 045A 13               6      INC DE
00035B 045B B7               4      OR  A
00035C 045C 20F9            12      JR  NZ,COM_ENV4
                                
00035E 045E 219E10          10      LD  HL,N_PROGRAM
000361 0461 11FE10          10      LD  DE,PATH_CCP
000364 0464 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000366 0466 CD0500          17      CALL    SYSTEM
                                
000369 0469 21A610          10      LD  HL,N_PARAMETERS
00036C 046C 110104          10      LD  DE,COMPAT
00036F 046F 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000371 0471 CD0500          17      CALL    SYSTEM
                                
000374 0474 21E50F          10      LD  HL,N_APPEND
000377 0477 11EC0F          10      LD  DE,V_APPEND
00037A 047A 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
00037C 047C CD0500          17      CALL    SYSTEM
                                
00037F 047F 0E60             7      LD  C,60H       ;(BDOS)子プロセスの起動
000381 0481 CD0500          17      CALL    SYSTEM
000384 0484 B7               4      OR  A
000385 0485 2004            12      JR  NZ,COMP1
000387 0487 78               4      LD  A,B
000388 0488 32B312          13      LD  (PROCESS),A
       048B                     COMP1:
00038B 048B AF               4      XOR A
00038C 048C 67               4      LD  H,A
00038D 048D 6F               4      LD  L,A ;HL=0x0000
00038E 048E F3               4      DI
00038F 048F ED7B0600        20  SPPAT:  LD  SP,(SYSTEM+1)
000393 0493 E5              11      PUSH    HL
000394 0494 21EDB0          10      LD  HL,0B0EDH   ;LDIR
000397 0497 22FE00          16      LD  (000FEH),HL
00039A 049A 21B412          10      LD  HL,DATA_COM
00039D 049D 110001          10      LD  DE,00100H
0003A0 04A0 010000          10      LD  BC,0
       04A1                     COMSIZ  EQU $-2
0003A3 04A3 FB               4      EI
0003A4 04A4 C3FE00          10      JP  000FEH
                                
       04A7                     C_BAT:
0003A7 04A7 215812          10      LD  HL,DTA_CCP+9
0003AA 04AA 3642            10      LD  (HL),'B'
0003AC 04AC 23               6      INC HL
0003AD 04AD 3641            10      LD  (HL),'A'
0003AF 04AF 23               6      INC HL
0003B0 04B0 3654            10      LD  (HL),'T'
                                
0003B2 04B2 CD4803          17      CALL    DEFCB
0003B5 04B5 C0              11      RET NZ
                                
0003B6 04B6 214F12          10      LD  HL,DTA_CCP
0003B9 04B9 7E               7      LD  A,(HL)
0003BA 04BA B7               4      OR  A
0003BB 04BB 2009            12      JR  NZ,CBAT_DS
0003BD 04BD E5              11      PUSH    HL
0003BE 04BE 0E19             7      LD  C,019H      ;(BDOS)カレントドライブ番号の獲得(_CURDRV)
0003C0 04C0 CD0500          17      CALL    SYSTEM
0003C3 04C3 E1              10      POP HL
0003C4 04C4 3C               4      INC A
0003C5 04C5 77               7      LD  (HL),A
       04C6                     CBAT_DS:
0003C6 04C6 ED5BAE12        20      LD  DE,(FCB_BAT)
0003CA 04CA 012500          10      LD  BC,37
0003CD 04CD EDB0                    LDIR
       04CF                     C_BAT1:
0003CF 04CF CD5D03          17      CALL    SETDTA100
0003D2 04D2 CD1005          17      CALL    FGETC_BAT
0003D5 04D5 218100          10      LD  HL,DTA1+1
0003D8 04D8 202A            12      JR  NZ,END_BATCH
0003DA 04DA FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
0003DC 04DC 38F1            12      JR  C,C_BAT1
0003DE 04DE 3620            10      LD  (HL),' '
0003E0 04E0 23               6      INC HL
       04E1                     C_BAT2:
0003E1 04E1 77               7      LD  (HL),A
0003E2 04E2 23               6      INC HL
0003E3 04E3 7D               4      LD  A,L
0003E4 04E4 3C               4      INC A       ;L==0FFH
0003E5 04E5 2809            12      JR  Z,RUN_BATCH
0003E7 04E7 CD1005          17      CALL    FGETC_BAT
0003EA 04EA 2004            12      JR  NZ,RUN_BATCH
0003EC 04EC FE20             7      CP  020H
0003EE 04EE 30F1            12      JR  NC,C_BAT2
       04F0                     RUN_BATCH:
0003F0 04F0 7D               4      LD  A,L
0003F1 04F1 D67F             7      SUB DTA1-1
0003F3 04F3 328000          13      LD  (DTA1),A
0003F6 04F6 FE04             7      CP  4
0003F8 04F8 380A            12      JR  C,END_BATCH
0003FA 04FA 3600            10      LD  (HL),0
0003FC 04FC 3A9BFC          13      LD  A,(INTFLG)
0003FF 04FF FE03             7      CP  3
000401 0501 C2D001          10      JP  NZ,COMMAND2
       0504                     END_BATCH:      ;バッチファイルを閉じる
000404 0504 2AAE12          16      LD  HL,(FCB_BAT)
000407 0507 3600            10      LD  (HL),0
000409 0509 ED7B0600        20      LD  SP,(SYSTEM+1)
00040D 050D C37F01          10      JP  WSTART
                                
       0510                     FGETC_BAT:
000410 0510 ED5BAE12        20      LD  DE,(FCB_BAT)
       0514                     FGETC:              ;1文字ずつ読み込む
000414 0514 E5              11      PUSH    HL      ;Z:成功
000415 0515 210100          10      LD  HL,1
000418 0518 CDBC03          17      CALL    S27
00041B 051B E1              10      POP HL
00041C 051C 3A0080          13      LD  A,(DATA)
00041F 051F C9              10      RET
                                
       0520                     C_REM:
000420 0520 AF               4      XOR A
000421 0521 C9              10      RET
                                
       0522                     C_DEL:
000422 0522 CD3708          17      CALL    SETFCB
000425 0525 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力
000427 0527 CD0500          17      CALL    SYSTEM
00042A 052A 0600             7      LD  B,0
00042C 052C 3AB610          13      LD  A,(MAJOR_VER)
00042F 052F FE02             7      CP  2
000431 0531 381E            12      JR  C,CDEL_DOS1
                                
000433 0533 215C00          10      LD  HL,FCB1
000436 0536 CD8B02          17      CALL    OPEN_D2
000439 0539 37               4      SCF
       053A                     DEL1:
00043A 053A C0              11      RET NZ
00043B 053B 3AC510          13      LD  A,(SEARCH_IX+14);   (FIB)属性
00043E 053E CB67             8      BIT 4,A
000440 0540 200A            12      JR  NZ,DEL2
                                
000442 0542 11B710          10      LD  DE,SEARCH_IX
000445 0545 0E4D             7      LD  C,04DH      ;(BDOS)ファイル・サブディレクトリの削除(_DELETE)
000447 0547 CD7403          17      CALL    SYSTEM0
00044A 054A 37               4      SCF
00044B 054B C0              11      RET NZ
       054C                     DEL2:
00044C 054C CDF102          17      CALL    OPEN2_D2
00044F 054F 18E9            12      JR  DEL1
                                
       0551                     CDEL_DOS1:
000451 0551 0E13             7      LD  C,013H
000453 0553 1811            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       0555                     C_REN:
000455 0555 3AB610          13      LD  A,(MAJOR_VER)
000458 0558 FE02             7      CP  2
00045A 055A 3013            12      JR  NC,REN_DOS2
00045C 055C CD3708          17      CALL    SETFCB
00045F 055F 3E10             7      LD  A,010H      ;ディレクトリも対象にする(LSX-Dodgers)
000461 0561 326900          13      LD  (FCB1+13),A ;属性
000464 0564 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       0566                     CDEL1:
000466 0566 115C00          10      LD  DE,FCB1
       0569                     REN2:
000469 0569 CD0500          17      CALL    SYSTEM
00046C 056C C6FF             7      ADD A,0FFH
00046E 056E C9              10      RET
                                
       056F                     REN_DOS2:           ;DOS2のリネーム(ディレクトリ対応)
00046F 056F CDC70B          17      CALL    SPCUT
000472 0572 6B               4      LD  L,E
000473 0573 62               4      LD  H,D
       0574                     REN_D2_1:
000474 0574 7E               7      LD  A,(HL)
000475 0575 FE21             7      CP  020H+1
000477 0577 3803            12      JR  C,REN_D2_2
000479 0579 23               6      INC HL
00047A 057A 18F8            12      JR  REN_D2_1
       057C                     REN_D2_2:
00047C 057C 3600            10      LD  (HL),0
00047E 057E 23               6      INC HL
00047F 057F 0E4E             7      LD  C,04EH      ;(BDOS)ファイルあるいはサブディレクトリ名の変更(_RENAME)
000481 0581 18E6            12      JR  REN2
                                
       0583                     C_DIR:
000483 0583 CDBC0A          17      CALL    FILEC_D2
000486 0586 218812          10      LD  HL,FDRV+1
000489 0589 CD7D0A          17      CALL    CWILD1
00048C 058C 3EF1             7      LD  A,0F1H
00048E 058E 329412          13      LD  (FDRV+13),A
000491 0591 CD9702          17      CALL    OPEN1_D2
       0594                     CDIR1:
000494 0594 B7               4      OR  A
000495 0595 2008            12      JR  NZ,PDSKF
000497 0597 CD1A06          17      CALL    P_NAME
00049A 059A CDF102          17      CALL    OPEN2_D2
00049D 059D 18F5            12      JR  CDIR1
                                
       059F                     PDSKF:
00049F 059F 3A8712          13      LD  A,(FDRV)
0004A2 05A2 5F               4      LD  E,A
0004A3 05A3 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0004A5 05A5 CD0500          17      CALL    SYSTEM
0004A8 05A8 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0004A9 05A9 C601             7      ADD A,001H
0004AB 05AB D8              11      RET C       ;Aが0FFHだった場合
0004AC 05AC 3E06             7      LD  A,8-2
       05AE                     PDS1:               ;HL=未使用クラスタの総数
0004AE 05AE 3C               4      INC A
0004AF 05AF CB19             8      RR  C
0004B1 05B1 30FB            12      JR  NC,PDS1
       05B3                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0004B3 05B3 3C               4      INC A
0004B4 05B4 CB18             8      RR  B
0004B6 05B6 30FB            12      JR  NC,PDS2
0004B8 05B8 47               4      LD  B,A
                                
0004B9 05B9 110000          10      LD  DE,0
       05BC                     PDS3:
0004BC 05BC 29              11      ADD HL,HL
0004BD 05BD EB               4      EX  DE,HL
0004BE 05BE ED6A            15      ADC HL,HL
0004C0 05C0 EB               4      EX  DE,HL
0004C1 05C1 10F9            13      DJNZ    PDS3
       05C3                     PDSKF1:
0004C3 05C3 CDA806          17      CALL    PRDEC_DEHL
0004C6 05C6 11790F          10      LD  DE,FREE
0004C9 05C9 0E09             7      LD  C,9     ;(BDOS)文字列出力
0004CB 05CB CD0500          17      CALL    SYSTEM
0004CE 05CE CD8806          17      CALL    PUTDRV
0004D1 05D1 3E5C             7      LD  A,05CH      ;\
0004D3 05D3 CDA90A          17      CALL    MSG_A
0004D6 05D6 3AB610          13      LD  A,(MAJOR_VER)
0004D9 05D9 FE01             7      CP  1
0004DB 05DB 3865            12      JR  C,LTNL
0004DD 05DD 200E            12      JR  NZ,PDSKF2
0004DF 05DF 2A9512          16      LD  HL,(FDRV+14)
0004E2 05E2 AF               4      XOR A
0004E3 05E3 11FEFF          10      LD  DE,0-2
0004E6 05E6 19              11      ADD HL,DE
0004E7 05E7 23               6      INC HL
0004E8 05E8 DCA406          17      CALL    C,PRDEC_HL
0004EB 05EB 1855            12      JR  LTNL
       05ED                     PDSKF2:             ;MSX-DOS2
0004ED 05ED 3A8712          13      LD  A,(FDRV)
0004F0 05F0 47               4      LD  B,A     ;ドライブ
0004F1 05F1 110080          10      LD  DE,DATA
0004F4 05F4 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
0004F6 05F6 CD0500          17      CALL    SYSTEM
0004F9 05F9 210080          10      LD  HL,DATA
                                
0004FC 05FC CD0406          17      CALL    MSX
0004FF 05FF 1841            12      JR  LTNL
                                
       0601                     MSX1:
000501 0601 CDA90A          17      CALL    MSG_A
       0604                     MSX:
000504 0604 7E               7      LD  A,(HL)
000505 0605 23               6      INC HL
000506 0606 B7               4      OR  A
000507 0607 20F8            12      JR  NZ,MSX1
000509 0609 C9              10      RET
                                
       060A                     MSXSLT1:
00050A 060A CDA90A          17      CALL    MSG_A
       060D                     MSXSLT:
00050D 060D C5              11      PUSH    BC
00050E 060E E5              11      PUSH    HL
00050F 060F 78               4      LD  A,B
000510 0610 CD0C00          17      CALL    RDSLT
000513 0613 E1              10      POP HL
000514 0614 C1              10      POP BC
000515 0615 23               6      INC HL
000516 0616 B7               4      OR  A
000517 0617 20F1            12      JR  NZ,MSXSLT1
000519 0619 C9              10      RET
                                
       061A                     P_NAME:
00051A 061A 215012          10      LD  HL,DTA_CCP+1
00051D 061D 7E               7      LD  A,(HL)
00051E 061E FE2E             7      CP  '.'
000520 0620 C8              11      RET Z
000521 0621 CDFE06          17      CALL    FPRNT
000524 0624 3A5B12          13      LD  A,(DTA_CCP+12)
000527 0627 CB67             8      BIT 4,A
000529 0629 280A            12      JR  Z,DIR3
00052B 062B 11870F          10      LD  DE,DIRMES
00052E 062E 0E09             7      LD  C,9     ;(BDOS)文字列出力
000530 0630 CD0500          17      CALL    SYSTEM
000533 0633 180A            12      JR  DIR6
       0635                     DIR3:
000535 0635 ED5B6E12        20      LD  DE,(DTA_CCP+1+01EH)
000539 0639 2A6C12          16      LD  HL,(DTA_CCP+1+01CH)
00053C 063C CDA806          17      CALL    PRDEC_DEHL
       063F                     DIR6:
00053F 063F CD2007          17      CALL    PRTTMS
                                
       0642                     LTNL:
000542 0642 1E0D             7      LD  E,00DH
000544 0644 CD980A          17      CALL    _PRINT
000547 0647 1E0A             7      LD  E,00AH
000549 0649 C3980A          10      JP  _PRINT
                                
       064C                     C_PATH:
00054C 064C CDC70B          17      CALL    SPCUT
00054F 064F FE21             7      CP  021H
000551 0651 301C            12      JR  NC,CPATH0
                                
000553 0653 212C10          10      LD  HL,N_PATH
000556 0656 113110          10      LD  DE,V_PATH
000559 0659 0640             7      LD  B,PATHX
00055B 065B 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
00055D 065D CD0500          17      CALL    SYSTEM
000560 0660 213110          10      LD  HL,V_PATH
       0663                     CPATHP:
000563 0663 7E               7      LD  A,(HL)
000564 0664 23               6      INC HL
000565 0665 FE20             7      CP  020H
000567 0667 3F               4      CCF
000568 0668 30D8            12      JR  NC,LTNL
00056A 066A CDA90A          17      CALL    MSG_A
00056D 066D 18F4            12      JR  CPATHP
       066F                     CPATH0:
00056F 066F 213110          10      LD  HL,V_PATH
000572 0672 FE3B             7      CP  ';'
000574 0674 2001            12      JR  NZ,CPATH1
000576 0676 13               6      INC DE
       0677                     CPATH1:
000577 0677 EB               4      EX  DE,HL
000578 0678 014000          10      LD  BC,PATHX
00057B 067B EDB0                    LDIR
                                
00057D 067D 212C10          10      LD  HL,N_PATH
000580 0680 113110          10      LD  DE,V_PATH
000583 0683 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000585 0685 C30500          10      JP  SYSTEM
                                
       0688                     PUTDRV:
000588 0688 3A8712          13      LD  A,(FDRV)
00058B 068B B7               4      OR  A
00058C 068C 200C            12      JR  NZ,PUTDRV1
00058E 068E C5              11      PUSH    BC
00058F 068F D5              11      PUSH    DE
000590 0690 E5              11      PUSH    HL
000591 0691 0E19             7      LD  C,019H
000593 0693 CD0500          17      CALL    SYSTEM
000596 0696 E1              10      POP HL
000597 0697 D1              10      POP DE
000598 0698 C1              10      POP BC
000599 0699 3C               4      INC A
       069A                     PUTDRV1:
00059A 069A C640             7      ADD A,'A'-1
00059C 069C CDA90A          17      CALL    MSG_A
00059F 069F 3E3A             7      LD  A,':'
       06A1                     MSG_AR:
0005A1 06A1 C3A90A          10      JP  MSG_A
                                
       06A4                     PRDEC_HL:
0005A4 06A4 AF               4      XOR A
       06A5                     PRDEC_AHL:
0005A5 06A5 5F               4      LD  E,A
0005A6 06A6 1600             7      LD  D,0
       06A8                     PRDEC_DEHL:
0005A8 06A8 3E02             7      LD  A,2
0005AA 06AA 32F306          13      LD  (DEC6+1),A
0005AD 06AD AF               4      XOR A
0005AE 06AE E5              11      PUSH    HL
0005AF 06AF 218112          10      LD  HL,DECBF
0005B2 06B2 0605             7      LD  B,5
0005B4 06B4 CD8E0B          17      CALL    FILL_MEMORY
0005B7 06B7 E1              10      POP HL
                                
0005B8 06B8 0E20             7      LD  C,32
       06BA                     DEC1:
0005BA 06BA 29              11      ADD HL,HL
0005BB 06BB EB               4      EX  DE,HL
0005BC 06BC ED6A            15      ADC HL,HL
0005BE 06BE EB               4      EX  DE,HL
0005BF 06BF E5              11      PUSH    HL
0005C0 06C0 218512          10      LD  HL,DECBF+4
0005C3 06C3 0605             7      LD  B,5
       06C5                     DEC2:
0005C5 06C5 7E               7      LD  A,(HL)
0005C6 06C6 8F               4      ADC A,A
0005C7 06C7 27               4      DAA
0005C8 06C8 77               7      LD  (HL),A
0005C9 06C9 2B               6      DEC HL
0005CA 06CA 10F9            13      DJNZ    DEC2
0005CC 06CC E1              10      POP HL
0005CD 06CD 0D               4      DEC C
0005CE 06CE 20EA            12      JR  NZ,DEC1
                                
0005D0 06D0 218112          10      LD  HL,DECBF
0005D3 06D3 3E20             7      LD  A,020H
0005D5 06D5 0604             7      LD  B,4
       06D7                     DEC3:
0005D7 06D7 CDE406          17      CALL    DEC4
0005DA 06DA CDE406          17      CALL    DEC4
0005DD 06DD 23               6      INC HL
0005DE 06DE 10F7            13      DJNZ    DEC3
       06E0                     DECX:
0005E0 06E0 CDE406          17      CALL    DEC4
0005E3 06E3 AF               4      XOR A
       06E4                     DEC4:
0005E4 06E4 ED6F            18      RLD
0005E6 06E6 FE20             7      CP  020H
0005E8 06E8 2808            12      JR  Z,DEC6
0005EA 06EA F630             7      OR  030H
       06EC                     DEC5:
0005EC 06EC 18B3            12      JR  MSG_AR
       06EE                     DEC7:
0005EE 06EE 3E20             7      LD  A,020H
0005F0 06F0 18AF            12      JR  MSG_AR
       06F2                     DEC6:
0005F2 06F2 3E02             7      LD  A,2
0005F4 06F4 B7               4      OR  A
0005F5 06F5 28F7            12      JR  Z,DEC7
0005F7 06F7 3D               4      DEC A
0005F8 06F8 32F306          13      LD  (DEC6+1),A
0005FB 06FB 3E20             7      LD  A,020H
0005FD 06FD C9              10      RET
                                
       06FE                     FPRNT:
0005FE 06FE 0608             7      LD  B,8
000600 0700 CD1107          17      CALL    P_N1
000603 0703 7E               7      LD  A,(HL)
000604 0704 C680             7      ADD A,0A0H-020H
000606 0706 FEA0             7      CP  0A0H
000608 0708 2802            12      JR  Z,FPR1
00060A 070A 3E2E             7      LD  A,'.'
       070C                     FPR1:
00060C 070C CDA90A          17      CALL    MSG_A
00060F 070F 0603             7      LD  B,3
                                
       0711                     P_N1:
000611 0711 C5              11      PUSH    BC
000612 0712 E5              11      PUSH    HL
000613 0713 7E               7      LD  A,(HL)
000614 0714 CDE60B          17      CALL    CAP3
000617 0717 CDA90A          17      CALL    MSG_A
00061A 071A E1              10      POP HL
00061B 071B C1              10      POP BC
00061C 071C 23               6      INC HL
00061D 071D 10F2            13      DJNZ    P_N1
00061F 071F C9              10      RET
                                
       0720                     PRTTMS:
000620 0720 3E20             7      LD  A,020H
000622 0722 CDA90A          17      CALL    MSG_A
                                
000625 0725 2A6812          16      LD  HL,(DTA_CCP+1+24)
000628 0728 7D               4      LD  A,L
000629 0729 B7               4      OR  A
00062A 072A C8              11      RET Z
00062B 072B CB3C             8      SRL H
00062D 072D 17               4      RLA
00062E 072E 17               4      RLA
00062F 072F 17               4      RLA
000630 0730 17               4      RLA
000631 0731 E60F             7      AND 00FH
000633 0733 57               4      LD  D,A
000634 0734 DD217610        14      LD  IX,V_DATE
       0738                     PRTTMS1:
000638 0738 DD7E00          19      LD  A,(IX+0)
00063B 073B B7               4      OR  A
00063C 073C 2808            12      JR  Z,PRTTMS2
00063E 073E CDC107          17      CALL    PR_DATE
000641 0741 CD2C08          17      CALL    PR_DATE_SPLITER
000644 0744 18F2            12      JR  PRTTMS1
       0746                     PRTTMS2:
                                
000646 0746 CDC50C          17      CALL    GET_WIDTH
000649 0749 FE21             7      CP  32+1
00064B 074B 3005            12      JR  NC,SHOW_TIME
00064D 074D 3E1D             7      LD  A,01DH
00064F 074F C3A90A          10      JP  MSG_A
       0752                     SHOW_TIME:
000652 0752 2A6612          16      LD  HL,(DTA_CCP+1+22)
                                
000655 0755 3E20             7      LD  A,020H
000657 0757 CDA90A          17      CALL    MSG_A
00065A 075A 7C               4      LD  A,H
00065B 075B 65               4      LD  H,L
00065C 075C 1F               4      RRA
00065D 075D CB1D             8      RR  L
00065F 075F 1F               4      RRA
000660 0760 CB1D             8      RR  L
000662 0762 1F               4      RRA
000663 0763 CB1D             8      RR  L
000665 0765 E61F             7      AND 01FH
000667 0767 4F               4      LD  C,A
000668 0768 3A9B10          13      LD  A,(V_TIME)
00066B 076B FE31             7      CP  '1'
00066D 076D 79               4      LD  A,C
00066E 076E 200B            12      JR  NZ,TIME24
000670 0770 FE0C             7      CP  12
000672 0772 3802            12      JR  C,TIME12
000674 0774 D60C             7      SUB 12
       0776                     TIME12:
000676 0776 B7               4      OR  A
000677 0777 2002            12      JR  NZ,TIME24
000679 0779 C60C             7      ADD A,12
       077B                     TIME24:
00067B 077B C5              11      PUSH    BC
00067C 077C CDAC07          17      CALL    PRDEC_A
00067F 077F 3E3A             7      LD  A,':'
000681 0781 CDA90A          17      CALL    MSG_A
000684 0784 7D               4      LD  A,L
000685 0785 0F               4      RRCA
000686 0786 0F               4      RRCA
000687 0787 E63F             7      AND 03FH
000689 0789 CDAC07          17      CALL    PRDEC_A
                                
00068C 078C 3E3A             7      LD  A,':'
00068E 078E CDA90A          17      CALL    MSG_A
000691 0791 7C               4      LD  A,H
000692 0792 E61F             7      AND 01FH
000694 0794 87               4      ADD A,A
000695 0795 CDAC07          17      CALL    PRDEC_A
                                
000698 0798 3A9B10          13      LD  A,(V_TIME)
00069B 079B FE31             7      CP  '1'
00069D 079D C1              10      POP BC
00069E 079E C0              11      RET NZ
00069F 079F 79               4      LD  A,C
0006A0 07A0 1E61             7      LD  E,'a'
0006A2 07A2 FE0C             7      CP  12
0006A4 07A4 DA980A          10      JP  C,_PRINT
0006A7 07A7 1E70             7      LD  E,'p'
0006A9 07A9 C3980A          10      JP  _PRINT
                                
                                ;   PRINT10
                                
       07AC                     PRDEC_A:
0006AC 07AC E5              11      PUSH    HL
0006AD 07AD 0608             7      LD  B,8
0006AF 07AF 4F               4      LD  C,A
0006B0 07B0 AF               4      XOR A
       07B1                     PRTA1:
0006B1 07B1 CB01             4      RLC C
0006B3 07B3 8F               4      ADC A,A
0006B4 07B4 27               4      DAA
0006B5 07B5 10FA            13      DJNZ    PRTA1
0006B7 07B7 218112          10      LD  HL,DECBF
0006BA 07BA 77               7      LD  (HL),A
0006BB 07BB AF               4      XOR A
0006BC 07BC CDE006          17      CALL    DECX
0006BF 07BF E1              10      POP HL
0006C0 07C0 C9              10      RET
                                
       07C1                     PR_DATE:
0006C1 07C1 DD7E00          19      LD  A,(IX+0)
0006C4 07C4 FE20             7      CP  020H
0006C6 07C6 D8              11      RET C
0006C7 07C7 CDDA0B          17      CALL    CAP
0006CA 07CA FE44             7      CP  'D'
0006CC 07CC 2848            12      JR  Z,PR_DAY
0006CE 07CE FE4D             7      CP  'M'
0006D0 07D0 2820            12      JR  Z,PR_MONTH
0006D2 07D2 FE59             7      CP  'Y'
0006D4 07D4 2046            12      JR  NZ,PR_DATE1
0006D6 07D6 4F               4      LD  C,A
0006D7 07D7 DD7E02          19      LD  A,(IX+2)
0006DA 07DA CDDA0B          17      CALL    CAP
0006DD 07DD B9               4      CP  C
0006DE 07DE 200A            12      JR  NZ,YEAR2
0006E0 07E0 7C               4      LD  A,H     ;YEAR
0006E1 07E1 C6EC             7      ADD A,80+256-100
0006E3 07E3 3E13             7      LD  A,19
0006E5 07E5 CE00             7      ADC A,0
0006E7 07E7 CDAC07          17      CALL    PRDEC_A     ;年4桁
       07EA                     YEAR2:
0006EA 07EA 7C               4      LD  A,H     ;YEAR
0006EB 07EB C650             7      ADD A,80
0006ED 07ED CDAC07          17      CALL    PRDEC_A
0006F0 07F0 182A            12      JR  PR_DATE1
       07F2                     PR_MONTH:
0006F2 07F2 4F               4      LD  C,A
0006F3 07F3 DD7E02          19      LD  A,(IX+2)
0006F6 07F6 CDDA0B          17      CALL    CAP
0006F9 07F9 B9               4      CP  C
0006FA 07FA 2014            12      JR  NZ,MONTH2
0006FC 07FC E5              11      PUSH    HL      ;月を文字列で表示 Jan等
0006FD 07FD D5              11      PUSH    DE
0006FE 07FE 7A               4      LD  A,D
0006FF 07FF 3D               4      DEC A
000700 0800 87               4      ADD A,A
000701 0801 87               4      ADD A,A
000702 0802 21B50F          10      LD  HL,S_MONTH
000705 0805 1600             7      LD  D,0
000707 0807 5F               4      LD  E,A
000708 0808 19              11      ADD HL,DE
000709 0809 CD0406          17      CALL    MSX
00070C 080C D1              10      POP DE
00070D 080D E1              10      POP HL
00070E 080E 180C            12      JR  PR_DATE1
       0810                     MONTH2:
000710 0810 7A               4      LD  A,D     ;月を数字で表示
000711 0811 CDAC07          17      CALL    PRDEC_A
000714 0814 1806            12      JR  PR_DATE1
       0816                     PR_DAY:
000716 0816 7D               4      LD  A,L
000717 0817 E61F             7      AND 01FH
000719 0819 CDAC07          17      CALL    PRDEC_A
       081C                     PR_DATE1:
00071C 081C DD23            10      INC IX
00071E 081E DD7E00          19      LD  A,(IX+0)
000721 0821 CDDA0B          17      CALL    CAP
000724 0824 FE41             7      CP  'A'
000726 0826 D8              11      RET C
000727 0827 FE5B             7      CP  'Z'+1
000729 0829 38F1            12      JR  C,PR_DATE1
00072B 082B C9              10      RET
       082C                     PR_DATE_SPLITER:
00072C 082C DD7E00          19      LD  A,(IX+0)
00072F 082F FE20             7      CP  020H
000731 0831 D8              11      RET C
000732 0832 DD23            10      INC IX
000734 0834 C3A90A          10      JP  MSG_A
                                
       0837                     SETFCB:
000737 0837 CDC70B          17      CALL    SPCUT
00073A 083A 1A               7      LD  A,(DE)
00073B 083B FE20             7      CP  020H
00073D 083D 3801            12      JR  C,SETFCBA
00073F 083F 1B               6      DEC DE
       0840                     SETFCBA:
000740 0840 D5              11      PUSH    DE
000741 0841 215C00          10      LD  HL,FCB1
000744 0844 115D00          10      LD  DE,FCB1+1
000747 0847 012300          10      LD  BC,00023H
00074A 084A 70               7      LD  (HL),B      ;B=0
00074B 084B EDB0                    LDIR
00074D 084D D1              10      POP DE
00074E 084E D5              11      PUSH    DE
00074F 084F 215C00          10      LD  HL,FCB1
000752 0852 DD217E11        14      LD  IX,PATH_FN1
000756 0856 CD6B0C          17      CALL    _SYS29      ;ファイル名の解析
000759 0859 216C00          10      LD  HL,FCB2
00075C 085C DD21BE11        14      LD  IX,PATH_FN2
000760 0860 CD6B0C          17      CALL    _SYS29      ;ファイル名の解析
000763 0863 E1              10      POP HL
000764 0864 010050          10      LD  BC,05000H
000767 0867 118100          10      LD  DE,00081H
       086A                     SETFCB1:
00076A 086A 7E               7      LD  A,(HL)
00076B 086B 23               6      INC HL
00076C 086C FE20             7      CP  020H
00076E 086E 3805            12      JR  C,SETFCB2
000770 0870 12               7      LD  (DE),A
000771 0871 13               6      INC DE
000772 0872 0C               4      INC C
000773 0873 10F5            13      DJNZ    SETFCB1
       0875                     SETFCB2:
000775 0875 79               4      LD  A,C
000776 0876 328000          13      LD  (DTA1),A
000779 0879 04               4      INC B
00077A 087A AF               4      XOR A
       087B                     SETFCB3:
00077B 087B 12               7      LD  (DE),A
00077C 087C 13               6      INC DE
00077D 087D 10FC            13      DJNZ    SETFCB3
00077F 087F C9              10      RET
                                
       0880                     C_COPY:
000780 0880 CD3708          17      CALL    SETFCB
000783 0883 3AB610          13      LD  A,(MAJOR_VER)
000786 0886 FE02             7      CP  2
000788 0888 3810            12      JR  C,COPYI0
00078A 088A 11BE11          10      LD  DE,PATH_FN2
00078D 088D CDD80C          17      CALL    IS_FOLDER
000790 0890 3808            12      JR  C,COPYI0
000792 0892 218812          10      LD  HL,FDRV+1
000795 0895 060B             7      LD  B,8+3
000797 0897 CD8C0B          17      CALL    FILE10
       089A                     COPYI0:
00079A 089A 3A8712          13      LD  A,(FDRV)
00079D 089D 47               4      LD  B,A
00079E 089E B7               4      OR  A
00079F 089F 200B            12      JR  NZ,COPYI1
0007A1 08A1 C5              11      PUSH    BC
0007A2 08A2 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
0007A4 08A4 CD0500          17      CALL    SYSTEM
0007A7 08A7 3C               4      INC A
0007A8 08A8 328712          13      LD  (FDRV),A
0007AB 08AB C1              10      POP BC
       08AC                     COPYI1:
0007AC 08AC C640             7      ADD A,040H
0007AE 08AE 32FE11          13      LD  (CUR_DRV),A
0007B1 08B1 110112          10      LD  DE,CUR_PATH
0007B4 08B4 0E59             7      LD  C,059H      ;(BDOS)カレントディレクトリの獲得(_GETCD)
0007B6 08B6 CD0500          17      CALL    SYSTEM
0007B9 08B9 CDCB08          17      CALL    COPYSUB
       08BC                     RES_CUR_PATH:
0007BC 08BC 11FE11          10      LD  DE,CUR_DRV
       08BF                     SET_CUR_PATH:
0007BF 08BF F5              11      PUSH    AF
0007C0 08C0 3A8712          13      LD  A,(FDRV)
0007C3 08C3 47               4      LD  B,A
0007C4 08C4 0E5A             7      LD  C,05AH      ;(BDOS)カレントディレクトリの変更(_CHDIR)
0007C6 08C6 CD0500          17      CALL    SYSTEM
0007C9 08C9 F1              10      POP AF
0007CA 08CA C9              10      RET
       08CB                     COPYSUB:
0007CB 08CB 11AD12          10      LD  DE,ZERO
0007CE 08CE CDE20A          17      CALL    FILEC2
0007D1 08D1 216C00          10      LD  HL,FCB2
0007D4 08D4 CDAF0C          17      CALL    S29X1
                                
0007D7 08D7 3E10             7      LD  A,010H
0007D9 08D9 326900          13      LD  (FCB1+13),A
0007DC 08DC 216D00          10      LD  HL,FCB2+1
0007DF 08DF CD7D0A          17      CALL    CWILD1
       08E2                     COPY0:
0007E2 08E2 CD7A0A          17      CALL    CWILD
0007E5 08E5 215C00          10      LD  HL,FCB1
0007E8 08E8 CD8B02          17      CALL    OPEN_D2
0007EB 08EB 37               4      SCF
       08EC                     COPY1:
0007EC 08EC C0              11      RET NZ
0007ED 08ED CD0703          17      CALL    DEFCB_D2
                                
0007F0 08F0 3A5B12          13      LD  A,(DTA_CCP+12)
0007F3 08F3 CB67             8      BIT 4,A
0007F5 08F5 2821            12      JR  Z,COPY1A
                                
0007F7 08F7 215D00          10      LD  HL,FCB1+1
0007FA 08FA CD130C          17      CALL    CHKWILD
0007FD 08FD 3811            12      JR  C,COPY9
                                
0007FF 08FF 3E20             7      LD  A,020H
000801 0901 325D00          13      LD  (FCB1+1),A
000804 0904 2A6912          16      LD  HL,(DTA_CCP+26)
000807 0907 23               6      INC HL
000808 0908 226A00          16      LD  (FCB1+14),HL
00080B 090B 18D5            12      JR  COPY0
                                
       090D                     COPY8:
00080D 090D CD720D          17      CALL    SHOW_OK
       0910                     COPY9:
000810 0910 CDBC08          17      CALL    RES_CUR_PATH
000813 0913 CDF102          17      CALL    OPEN2_D2
000816 0916 18D4            12      JR  COPY1
                                
       0918                     COPY1A:
000818 0918 216C00          10      LD  HL,FCB2
00081B 091B 118712          10      LD  DE,FDRV
00081E 091E 015112          10      LD  BC,DTA_CCP+2
000821 0921 EDA0            16      LDI
000823 0923 3E0B             7      LD  A,11
       0925                     COPY2:
000825 0925 F5              11      PUSH    AF
000826 0926 7E               7      LD  A,(HL)
000827 0927 FE3F             7      CP  '?'
000829 0929 2001            12      JR  NZ,COPY3
00082B 092B 0A               7      LD  A,(BC)
       092C                     COPY3:
00082C 092C 12               7      LD  (DE),A
00082D 092D 03               6      INC BC
00082E 092E 13               6      INC DE
00082F 092F 23               6      INC HL
000830 0930 F1              10      POP AF
000831 0931 3D               4      DEC A
000832 0932 20F1            12      JR  NZ,COPY2
000834 0934 010500          10      LD  BC,16-11
000837 0937 EDB0                    LDIR
       0939                     PUTNAME:
000839 0939 215D00          10      LD  HL,FCB1+1
00083C 093C CD130C          17      CALL    CHKWILD
00083F 093F 300B            12      JR  NC,PUTN1
000841 0941 218812          10      LD  HL,FDRV+1
000844 0944 CDFE06          17      CALL    FPRNT
000847 0947 3E20             7      LD  A,020H
000849 0949 CDA90A          17      CALL    MSG_A
       094C                     PUTN1:
00084C 094C 11BE11          10      LD  DE,PATH_FN2
00084F 094F CDBF08          17      CALL    SET_CUR_PATH
                                
000852 0952 118712          10      LD  DE,FDRV
000855 0955 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000857 0957 CD7403          17      CALL    SYSTEM0
00085A 095A C2FB09          10      JP  NZ,COPYE2
00085D 095D 67               4      LD  H,A     ;A=0
00085E 095E 6F               4      LD  L,A
00085F 095F 22A812          16      LD  (FDRV+33),HL    ;(FCB)ランダム・レコード
000862 0962 22AA12          16      LD  (FDRV+35),HL
000865 0965 2C               4      INC L       ;HL=1
000866 0966 229512          16      LD  (FDRV+14),HL    ;(FCB)レコード・サイズ
       0969                     COPY6:
000869 0969 CD8C0A          17      CALL    BUFSIZ
00086C 096C CD9403          17      CALL    S27DTA_D2
00086F 096F 3C               4      INC A
000870 0970 CAEA09          10      JP  Z,COPYE
000873 0973 47               4      LD  B,A
000874 0974 7C               4      LD  A,H
000875 0975 B5               4      OR  L
000876 0976 280F            12      JR  Z,COPY7
000878 0978 118712          10      LD  DE,FDRV
00087B 097B C5              11      PUSH    BC
00087C 097C 0E26             7      LD  C,026H      ;(BDOS)ランダム・ブロック・ライト
00087E 097E CD0500          17      CALL    SYSTEM
000881 0981 C1              10      POP BC
000882 0982 B7               4      OR  A
000883 0983 2065            12      JR  NZ,COPYE
000885 0985 10E2            13      DJNZ    COPY6
       0987                     COPY7:
000887 0987 3AB610          13      LD  A,(MAJOR_VER)
00088A 098A FE02             7      CP  2
00088C 098C 3011            12      JR  NC,COPY7_MSX2   ;DOS2はFCBの仕様が違う
00088E 098E 3A5C12          13      LD  A,(DTA_CCP+13)  ;(FCB)属性(アトリビュート)
000891 0991 329412          13      LD  (FDRV+13),A ;(FCB)属性(アトリビュート)
000894 0994 216312          10      LD  HL,DTA_CCP+20
000897 0997 119B12          10      LD  DE,FDRV+20  ;(FCB)更新日時
00089A 099A 010400          10      LD  BC,4
00089D 099D EDB0                    LDIR
       099F                     COPY7_MSX2:
00089F 099F 118712          10      LD  DE,FDRV
0008A2 09A2 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0008A4 09A4 CD7403          17      CALL    SYSTEM0
                                
0008A7 09A7 2041            12      JR  NZ,COPYE
0008A9 09A9 3AB610          13      LD  A,(MAJOR_VER)
0008AC 09AC FE02             7      CP  2
0008AE 09AE 3837            12      JR  C,COPY_DOS2DT
                                
0008B0 09B0 ED4BF710        20      LD  BC,(HANDLE1)
0008B4 09B4 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
0008B6 09B6 CD0500          17      CALL    SYSTEM
                                
0008B9 09B9 11BE11          10      LD  DE,PATH_FN2
0008BC 09BC CDBF08          17      CALL    SET_CUR_PATH
                                
0008BF 09BF 118712          10      LD  DE,FDRV
0008C2 09C2 214112          10      LD  HL,DOS2NAME
0008C5 09C5 CDFD09          17      CALL    FCB2FNAME
                                
0008C8 09C8 3AC510          13      LD  A,(SEARCH_IX+14);   (FIB)属性
0008CB 09CB 6F               4      LD  L,A
0008CC 09CC 114112          10      LD  DE,DOS2NAME
0008CF 09CF 3E01             7      LD  A,1
0008D1 09D1 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
0008D3 09D3 CD7403          17      CALL    SYSTEM0
                                
0008D6 09D6 DD2AC610        20      LD  IX,(SEARCH_IX+15)   ;(FIB)更新時間
0008DA 09DA 2AC810          16      LD  HL,(SEARCH_IX+17)   ;(FIB)更新日
0008DD 09DD 114112          10      LD  DE,DOS2NAME
0008E0 09E0 3E01             7      LD  A,1
0008E2 09E2 0E51             7      LD  C,51H       ;(BDOS)_FTIME ファイルの日付および時刻の獲得・設定
0008E4 09E4 CD7403          17      CALL    SYSTEM0
       09E7                     COPY_DOS2DT:
0008E7 09E7 C30D09          10      JP  COPY8
                                
       09EA                     COPYE:
0008EA 09EA ED4BF710        20      LD  BC,(HANDLE1)
0008EE 09EE 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
0008F0 09F0 CD0500          17      CALL    SYSTEM
0008F3 09F3 118712          10      LD  DE,FDRV
0008F6 09F6 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0008F8 09F8 CD0500          17      CALL    SYSTEM
       09FB                     COPYE2:
0008FB 09FB 37               4      SCF
0008FC 09FC C9              10      RET
                                
       09FD                     FCB2FNAME:
0008FD 09FD 1A               7      LD  A,(DE)
0008FE 09FE 13               6      INC DE
0008FF 09FF C640             7      ADD A,040H
000901 0A01 77               7      LD  (HL),A
000902 0A02 23               6      INC HL
000903 0A03 363A            10      LD  (HL),':'
000905 0A05 23               6      INC HL
                                
000906 0A06 0608             7      LD  B,8
       0A08                     FCB2FNAME1:
000908 0A08 1A               7      LD  A,(DE)
000909 0A09 FE21             7      CP  020H+1
00090B 0A0B 3807            12      JR  C,FCB2FNAME2
00090D 0A0D 13               6      INC DE
00090E 0A0E 77               7      LD  (HL),A
00090F 0A0F 23               6      INC HL
000910 0A10 10F6            13      DJNZ    FCB2FNAME1
000912 0A12 1803            12      JR  FCB2FNAME3
       0A14                     FCB2FNAME2:
000914 0A14 13               6      INC DE
000915 0A15 10FD            13      DJNZ    FCB2FNAME2
       0A17                     FCB2FNAME3:
000917 0A17 1A               7      LD  A,(DE)
000918 0A18 FE21             7      CP  020H+1
00091A 0A1A 380F            12      JR  C,FCB2FNAME5
00091C 0A1C 362E            10      LD  (HL),'.'
00091E 0A1E 23               6      INC HL
00091F 0A1F 0603             7      LD  B,3
       0A21                     FCB2FNAME4:
000921 0A21 1A               7      LD  A,(DE)
000922 0A22 13               6      INC DE
000923 0A23 FE21             7      CP  020H+1
000925 0A25 3804            12      JR  C,FCB2FNAME5
000927 0A27 77               7      LD  (HL),A
000928 0A28 23               6      INC HL
000929 0A29 10F6            13      DJNZ    FCB2FNAME4
       0A2B                     FCB2FNAME5:
00092B 0A2B 3600            10      LD  (HL),0
00092D 0A2D C9              10      RET
                                
       0A2E                     C_TYPE:
00092E 0A2E CD3708          17      CALL    SETFCB
000931 0A31 215C00          10      LD  HL,FCB1
000934 0A34 CD8B02          17      CALL    OPEN_D2
000937 0A37 37               4      SCF
       0A38                     TYPE1:
000938 0A38 C0              11      RET NZ
000939 0A39 CD0703          17      CALL    DEFCB_D2
00093C 0A3C 3E1A             7      LD  A,01AH
00093E 0A3E CDA90A          17      CALL    MSG_A
       0A41                     TYPE2:
000941 0A41 CD8C0A          17      CALL    BUFSIZ
000944 0A44 CD9403          17      CALL    S27DTA_D2
000947 0A47 C6FE             7      ADD A,0FEH
000949 0A49 D8              11      RET C
00094A 0A4A 7C               4      LD  A,H
00094B 0A4B B5               4      OR  L
00094C 0A4C 281A            12      JR  Z,TYPEE
00094E 0A4E 010080          10      LD  BC,DATA
       0A51                     TYPE3:
000951 0A51 0A               7      LD  A,(BC)
000952 0A52 03               6      INC BC
000953 0A53 FE1A             7      CP  01AH
000955 0A55 2811            12      JR  Z,TYPEE
000957 0A57 5F               4      LD  E,A
000958 0A58 C5              11      PUSH    BC
000959 0A59 E5              11      PUSH    HL
00095A 0A5A 0E02             7      LD  C,2     ;(BDOS)コンソール出力
00095C 0A5C CD0500          17      CALL    SYSTEM
00095F 0A5F E1              10      POP HL
000960 0A60 C1              10      POP BC
000961 0A61 2B               6      DEC HL
000962 0A62 7C               4      LD  A,H
000963 0A63 B5               4      OR  L
000964 0A64 20EB            12      JR  NZ,TYPE3
000966 0A66 18D9            12      JR  TYPE2
       0A68                     TYPEE:
000968 0A68 3AB610          13      LD  A,(MAJOR_VER)   ;DOS2対応
00096B 0A6B FE02             7      CP  2
00096D 0A6D 3806            12      JR  C,TYPEE2
00096F 0A6F ED4BF710        20      LD  BC,(HANDLE1)
000973 0A73 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
       0A75                     TYPEE2:
000975 0A75 CDF102          17      CALL    OPEN2_D2
000978 0A78 18BE            12      JR  TYPE1
                                
       0A7A                     CWILD:
00097A 0A7A 215D00          10      LD  HL,FCB1+1
       0A7D                     CWILD1:
00097D 0A7D 7E               7      LD  A,(HL)
00097E 0A7E FE20             7      CP  020H
000980 0A80 C0              11      RET NZ
       0A81                     CWILD2:
000981 0A81 54               4      LD  D,H
000982 0A82 5D               4      LD  E,L
000983 0A83 13               6      INC DE
000984 0A84 010A00          10      LD  BC,10
000987 0A87 363F            10      LD  (HL),'?'
000989 0A89 EDB0                    LDIR
00098B 0A8B C9              10      RET
                                
       0A8C                     BUFSIZ:
00098C 0A8C 3A0700          13      LD  A,(SYSTEM+2)
00098F 0A8F D681             7      SUB (DATA/256)+1
000991 0A91 E6F8             7      AND 0F8H
000993 0A93 67               4      LD  H,A
000994 0A94 2E00             7      LD  L,0
000996 0A96 C9              10      RET
                                
000997 0A97 E9               4  JP_HL:  JP  (HL)
                                
       0A98                     _PRINT:
000998 0A98 C5              11      PUSH    BC
000999 0A99 D5              11      PUSH    DE
00099A 0A9A E5              11      PUSH    HL
00099B 0A9B DDE5            15      PUSH    IX
00099D 0A9D 0E06             7      LD  C,6
00099F 0A9F CD0500          17      CALL    SYSTEM
0009A2 0AA2 DDE1            14      POP IX
0009A4 0AA4 E1              10      POP HL
0009A5 0AA5 D1              10      POP DE
0009A6 0AA6 C1              10      POP BC
0009A7 0AA7 B7               4      OR  A
0009A8 0AA8 C9              10      RET
                                
       0AA9                     MSG_A:
0009A9 0AA9 F5              11      PUSH    AF
0009AA 0AAA C5              11      PUSH    BC
0009AB 0AAB D5              11      PUSH    DE
0009AC 0AAC E5              11      PUSH    HL
0009AD 0AAD DDE5            15      PUSH    IX
0009AF 0AAF 5F               4      LD  E,A
0009B0 0AB0 0E02             7      LD  C,2
0009B2 0AB2 CD0500          17      CALL    SYSTEM
0009B5 0AB5 DDE1            14      POP IX
0009B7 0AB7 E1              10      POP HL
0009B8 0AB8 D1              10      POP DE
0009B9 0AB9 C1              10      POP BC
0009BA 0ABA F1              10      POP AF
0009BB 0ABB C9              10      RET
                                ;       FILE
       0ABC                     FILEC_D2:       ;DOS2対応
0009BC 0ABC 3AB610          13      LD  A,(MAJOR_VER)
0009BF 0ABF FE02             7      CP  2
0009C1 0AC1 381C            12      JR  C,FILEC
0009C3 0AC3 C5              11      PUSH    BC
0009C4 0AC4 D5              11      PUSH    DE
0009C5 0AC5 E5              11      PUSH    HL
0009C6 0AC6 CDC70B          17      CALL    SPCUT
0009C9 0AC9 21FE10          10      LD  HL,PATH_CCP
0009CC 0ACC 0640             7      LD  B,64
       0ACE                     PATHCD1:
0009CE 0ACE 1A               7      LD  A,(DE)
0009CF 0ACF 13               6      INC DE
0009D0 0AD0 FE20             7      CP  020H
0009D2 0AD2 3002            12      JR  NC,PATHCD2
0009D4 0AD4 3E00             7      LD  A,0
       0AD6                     PATHCD2:
0009D6 0AD6 77               7      LD  (HL),A
0009D7 0AD7 3803            12      JR  C,PATHCD3
0009D9 0AD9 23               6      INC HL
0009DA 0ADA 10F2            13      DJNZ    PATHCD1
       0ADC                     PATHCD3:
0009DC 0ADC E1              10      POP HL
0009DD 0ADD D1              10      POP DE
0009DE 0ADE C1              10      POP BC
       0ADF                     FILEC:
0009DF 0ADF CDEA0A          17      CALL    FILE
       0AE2                     FILEC2:
0009E2 0AE2 3A8812          13      LD  A,(FDRV+1)
0009E5 0AE5 FE20             7      CP  020H
0009E7 0AE7 C8              11      RET Z
0009E8 0AE8 1839            12      JR  SETDIR1
                                
       0AEA                     FILE:
0009EA 0AEA AF               4      XOR A
0009EB 0AEB 328712          13      LD  (FDRV),A
0009EE 0AEE 67               4      LD  H,A
0009EF 0AEF 6F               4      LD  L,A
0009F0 0AF0 229512          16      LD  (FDRV+14),HL
0009F3 0AF3 CDC70B          17      CALL    SPCUT
0009F6 0AF6 CDAC0B          17      CALL    CCHK3
0009F9 0AF9 2812            12      JR  Z,DEVI1
0009FB 0AFB 13               6      INC DE
0009FC 0AFC 1A               7      LD  A,(DE)
0009FD 0AFD 1B               6      DEC DE
0009FE 0AFE FE3A             7      CP  ':'
000A00 0B00 200B            12      JR  NZ,DEVI1
000A02 0B02 1A               7      LD  A,(DE)      ;DRIVE
000A03 0B03 CDDA0B          17      CALL    CAP
000A06 0B06 D640             7      SUB '@'
000A08 0B08 13               6      INC DE
000A09 0B09 13               6      INC DE
000A0A 0B0A 328712          13      LD  (FDRV),A
       0B0D                     DEVI1:
000A0D 0B0D 1A               7      LD  A,(DE)
000A0E 0B0E D65C             7      SUB 05CH        ;\
000A10 0B10 2009            12      JR  NZ,NOROOT
000A12 0B12 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000A13 0B13 22A112          16      LD  (FDRV+26),HL
000A16 0B16 2C               4      INC L
000A17 0B17 229512          16      LD  (FDRV+14),HL
000A1A 0B1A 13               6      INC DE
       0B1B                     NOROOT:
                                
       0B1B                     SETDIR:
000A1B 0B1B CD4C0B          17      CALL    FILED
000A1E 0B1E 1A               7      LD  A,(DE)
000A1F 0B1F FE5C             7      CP  05CH        ;\
000A21 0B21 C0              11      RET NZ
000A22 0B22 13               6      INC DE
       0B23                     SETDIR1:
000A23 0B23 3AB610          13      LD  A,(MAJOR_VER)
000A26 0B26 FE01             7      CP  1
000A28 0B28 C0              11      RET NZ
                                                ;for LSX-Dodgers
000A29 0B29 3E10             7      LD  A,010H      ;Directory
000A2B 0B2B 329412          13      LD  (FDRV+13),A
000A2E 0B2E D5              11      PUSH    DE
000A2F 0B2F 118712          10      LD  DE,FDRV
000A32 0B32 0E0F             7      LD  C,00FH
000A34 0B34 CD0500          17      CALL    SYSTEM
000A37 0B37 D1              10      POP DE
000A38 0B38 B7               4      OR  A
000A39 0B39 C0              11      RET NZ
                                
000A3A 0B3A 3A9412          13      LD  A,(FDRV+13)
000A3D 0B3D CB67             8      BIT 4,A
000A3F 0B3F C8              11      RET Z
                                
000A40 0B40 CD930B          17      CALL    FILEI
000A43 0B43 2AA112          16      LD  HL,(FDRV+26)
000A46 0B46 23               6      INC HL
000A47 0B47 229512          16      LD  (FDRV+14),HL
000A4A 0B4A 18CF            12      JR  SETDIR
                                
       0B4C                     FILED:
000A4C 0B4C CD930B          17      CALL    FILEI
                                
000A4F 0B4F 0608             7      LD  B,8
       0B51                     FILE2:
000A51 0B51 CDA10B          17      CALL    CCHKF
000A54 0B54 C8              11      RET Z
000A55 0B55 FE2A             7      CP  '*'
000A57 0B57 282E            12      JR  Z,FILE9
000A59 0B59 FE2E             7      CP  '.'
000A5B 0B5B 280C            12      JR  Z,FILE4
000A5D 0B5D 77               7      LD  (HL),A
000A5E 0B5E 23               6      INC HL
000A5F 0B5F 10F0            13      DJNZ    FILE2
                                
       0B61                     FILE3:
000A61 0B61 CDA10B          17      CALL    CCHKF
000A64 0B64 C8              11      RET Z
000A65 0B65 FE2E             7      CP  '.'
000A67 0B67 20F8            12      JR  NZ,FILE3
                                
       0B69                     FILE4:
000A69 0B69 219012          10      LD  HL,FNAME+8
000A6C 0B6C 0603             7      LD  B,3
                                
       0B6E                     FILE4L:
000A6E 0B6E CDA10B          17      CALL    CCHKF
000A71 0B71 C8              11      RET Z
000A72 0B72 FE2E             7      CP  '.'
000A74 0B74 2008            12      JR  NZ,FILE12
000A76 0B76 328812          13      LD  (FNAME),A   ;Parent directory(..)
000A79 0B79 328912          13      LD  (FNAME+1),A
000A7C 0B7C 3E20             7      LD  A,020H
       0B7E                     FILE12:
000A7E 0B7E FE2A             7      CP  '*'
000A80 0B80 280A            12      JR  Z,FILE10
000A82 0B82 77               7      LD  (HL),A
000A83 0B83 23               6      INC HL
000A84 0B84 10E8            13      DJNZ    FILE4L
000A86 0B86 C9              10      RET
                                
       0B87                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000A87 0B87 CD8C0B          17      CALL    FILE10
000A8A 0B8A 18D5            12      JR  FILE3
                                
       0B8C                     FILE10:
000A8C 0B8C 3E3F             7      LD  A,'?'
                                
       0B8E                     FILL_MEMORY:                ;HLからBバイトAで埋める
000A8E 0B8E 77               7      LD  (HL),A
000A8F 0B8F 23               6      INC HL
000A90 0B90 10FC            13      DJNZ    FILL_MEMORY
000A92 0B92 C9              10      RET
                                
       0B93                     FILEI:              ;名前＋拡張子をスペースで初期化
000A93 0B93 3E20             7      LD  A,020H
000A95 0B95 01000B          10      LD  BC,11*256
000A98 0B98 218812          10      LD  HL,FNAME
000A9B 0B9B E5              11      PUSH    HL
000A9C 0B9C CD8E0B          17      CALL    FILL_MEMORY
000A9F 0B9F E1              10      POP HL
000AA0 0BA0 C9              10      RET
                                
       0BA1                     CCHKF:
000AA1 0BA1 1A               7      LD  A,(DE)
000AA2 0BA2 CDA90B          17      CALL    CCHK2
000AA5 0BA5 C8              11      RET Z
000AA6 0BA6 C3FC0B          10      JP  FKAN
                                
       0BA9                     CCHK2:
000AA9 0BA9 0C               4      INC C
000AAA 0BAA 0D               4      DEC C
000AAB 0BAB C0              11      RET NZ
       0BAC                     CCHK3:              ;ZF=1 で使えない文字
000AAC 0BAC FE2B             7      CP  '+'
000AAE 0BAE C8              11      RET Z
000AAF 0BAF FE2C             7      CP  ','
000AB1 0BB1 C8              11      RET Z
000AB2 0BB2 FE2F             7      CP  '/'
000AB4 0BB4 C8              11      RET Z
000AB5 0BB5 FE3A             7      CP  ':'
000AB7 0BB7 C8              11      RET Z
000AB8 0BB8 FE3B             7      CP  ';'
000ABA 0BBA C8              11      RET Z
000ABB 0BBB FE3D             7      CP  '='
000ABD 0BBD C8              11      RET Z
000ABE 0BBE FE5C             7      CP  05CH    ;\
000AC0 0BC0 C8              11      RET Z
000AC1 0BC1 FE20             7      CP  020H
000AC3 0BC3 D0              11      RET NC
000AC4 0BC4 BF               4      CP  A       ;Z=1
000AC5 0BC5 C9              10      RET
                                
       0BC6                     SS1:
000AC6 0BC6 13               6      INC DE
       0BC7                     SPCUT:              ;スペースをカット
000AC7 0BC7 1A               7      LD  A,(DE)
000AC8 0BC8 FE20             7      CP  020H
000ACA 0BCA 28FA            12      JR  Z,SS1
000ACC 0BCC C9              10      RET
                                
       0BCD                     TOZERO:
000ACD 0BCD D5              11      PUSH    DE
       0BCE                     TZ1:
000ACE 0BCE 1A               7      LD  A,(DE)
000ACF 0BCF FE20             7      CP  20H
000AD1 0BD1 3803            12      JR  C,TZ2
000AD3 0BD3 13               6      INC DE
000AD4 0BD4 18F8            12      JR  TZ1
       0BD6                     TZ2:
000AD6 0BD6 AF               4      XOR A
000AD7 0BD7 12               7      LD  (DE),A
000AD8 0BD8 D1              10      POP DE
000AD9 0BD9 C9              10      RET
                                
       0BDA                     CAP:
000ADA 0BDA FE61             7      CP  'a'
000ADC 0BDC D8              11      RET C
000ADD 0BDD FE7B             7      CP  'z'+1
000ADF 0BDF D0              11      RET NC
000AE0 0BE0 D620             7      SUB 020H
000AE2 0BE2 C9              10      RET
       0BE3                     CAP2:
000AE3 0BE3 CDDA0B          17      CALL    CAP
       0BE6                     CAP3:
000AE6 0BE6 CDEF0B          17      CALL    CAP4
000AE9 0BE9 FE21             7      CP  021H
000AEB 0BEB D0              11      RET NC
000AEC 0BEC 3E20             7      LD  A,020H
000AEE 0BEE C9              10      RET
       0BEF                     CAP4:
000AEF 0BEF FE05             7      CP  5
000AF1 0BF1 C0              11      RET NZ
000AF2 0BF2 3EE5             7      LD  A,0E5H
000AF4 0BF4 C9              10      RET
                                
       0BF5                     FKANC:
000AF5 0BF5 CB41             8      BIT 0,C
000AF7 0BF7 CCE30B          17      CALL    Z,CAP2
000AFA 0BFA 1801            12      JR  FKANX
       0BFC                     FKAN:           ;漢字チェック
000AFC 0BFC 13               6      INC DE
       0BFD                     FKANX:
000AFD 0BFD CB41             8      BIT 0,C
000AFF 0BFF CB81             8      RES 0,C
000B01 0C01 C0              11      RET NZ
000B02 0C02 FE80             7      CP  080H
000B04 0C04 D8              11      RET C
000B05 0C05 FEA0             7      CP  0A0H
000B07 0C07 3803            12      JR  C,FKAN1
000B09 0C09 FEE0             7      CP  0E0H
000B0B 0C0B D8              11      RET C
       0C0C                     FKAN1:
000B0C 0C0C 0C               4      INC C
000B0D 0C0D A7               4      AND A
000B0E 0C0E C9              10      RET
                                
       0C0F                     CHKWILDX:
000B0F 0C0F FDE5            15      PUSH    IY
000B11 0C11 E1              10      POP HL
000B12 0C12 23               6      INC HL
       0C13                     CHKWILD:
000B13 0C13 060B             7      LD  B,11
000B15 0C15 3E3F             7      LD  A,'?'
       0C17                     CHKWIL1:
000B17 0C17 BE               7      CP  (HL)
000B18 0C18 23               6      INC HL
000B19 0C19 37               4      SCF
000B1A 0C1A C8              11      RET Z
000B1B 0C1B 10FA            13      DJNZ    CHKWIL1
000B1D 0C1D AF               4      XOR A
000B1E 0C1E C9              10      RET
                                
       0C1F                     CPNAME:
000B1F 0C1F C5              11      PUSH    BC
000B20 0C20 D5              11      PUSH    DE
000B21 0C21 117612          10      LD  DE,CPBUF
000B24 0C24 010700          10      LD  BC,7
000B27 0C27 EDB0                    LDIR
000B29 0C29 D1              10      POP DE
000B2A 0C2A D5              11      PUSH    DE
000B2B 0C2B E5              11      PUSH    HL
000B2C 0C2C 217612          10      LD  HL,CPBUF
000B2F 0C2F CD420C          17      CALL    CPFILE
000B32 0C32 E1              10      POP HL
000B33 0C33 D1              10      POP DE
000B34 0C34 C1              10      POP BC
000B35 0C35 2005            12      JR  NZ,CPNAME1
000B37 0C37 7E               7      LD  A,(HL)
000B38 0C38 23               6      INC HL
000B39 0C39 66               7      LD  H,(HL)
000B3A 0C3A 6F               4      LD  L,A
000B3B 0C3B C9              10      RET
       0C3C                     CPNAME1:
000B3C 0C3C 23               6      INC HL
000B3D 0C3D 23               6      INC HL
000B3E 0C3E 10DF            13      DJNZ    CPNAME
000B40 0C40 37               4      SCF
000B41 0C41 C9              10      RET
                                
       0C42                     CPFILE:
000B42 0C42 C5              11      PUSH    BC
000B43 0C43 01000B          10      LD  BC,00B00H
       0C46                     CPSTR1:
000B46 0C46 1A               7      LD  A,(DE)
000B47 0C47 FE3F             7      CP  '?'     ;Wild card
000B49 0C49 2812            12      JR  Z,CPSTR2
000B4B 0C4B 7E               7      LD  A,(HL)
000B4C 0C4C CDF50B          17      CALL    FKANC
000B4F 0C4F E5              11      PUSH    HL
000B50 0C50 67               4      LD  H,A
000B51 0C51 1A               7      LD  A,(DE)
000B52 0C52 CB01             4      RLC C
000B54 0C54 CDF50B          17      CALL    FKANC
000B57 0C57 CB09             4      RRC C
000B59 0C59 BC               4      CP  H       ;CP (HL),(DE)
000B5A 0C5A E1              10      POP HL
000B5B 0C5B 2004            12      JR  NZ,CPSTR3
       0C5D                     CPSTR2:
000B5D 0C5D 13               6      INC DE
000B5E 0C5E 23               6      INC HL
000B5F 0C5F 10E5            13      DJNZ    CPSTR1
       0C61                     CPSTR3:
000B61 0C61 C1              10      POP BC
000B62 0C62 C9              10      RET
                                
       0C63                     CPFILE2:
000B63 0C63 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
000B66 0C66 F6E1             7      OR  0E1H
000B68 0C68 2F               4      CPL
000B69 0C69 A6               7      AND (HL)
000B6A 0C6A C9              10      RET
                                
       0C6B                     _SYS29:     ;(BDOS)ファイル名の解析
000B6B 0C6B C5              11      PUSH    BC
000B6C 0C6C D5              11      PUSH    DE
000B6D 0C6D 0640             7      LD  B,64
000B6F 0C6F CDC70B          17      CALL    SPCUT
000B72 0C72 DD227412        20      LD  (DIR_CK),IX
       0C76                     D2FN1:
000B76 0C76 1A               7      LD  A,(DE)
000B77 0C77 FE21             7      CP  020H+1
000B79 0C79 3808            12      JR  C,D2FN2
000B7B 0C7B 13               6      INC DE
000B7C 0C7C DD7700          19      LD  (IX+0),A
000B7F 0C7F DD23            10      INC IX
000B81 0C81 10F3            13      DJNZ    D2FN1
       0C83                     D2FN2:
000B83 0C83 DD360000        19      LD  (IX+0),0
000B87 0C87 DD7EFF          19      LD  A,(IX-1)
000B8A 0C8A FE5C             7      CP  05CH        ;\
000B8C 0C8C 2018            12      JR  NZ,D2FN3
000B8E 0C8E DD7EFE          19      LD  A,(IX-2)
000B91 0C91 FE3A             7      CP  ':'
000B93 0C93 2811            12      JR  Z,D2FN3
                                
000B95 0C95 DD36FF00        19      LD  (IX-1),0
000B99 0C99 ED5B7412        20      LD  DE,(DIR_CK)
000B9D 0C9D CDD80C          17      CALL    IS_FOLDER
000BA0 0CA0 3804            12      JR  C,D2FN3
       0CA2                     D2FN4:
000BA2 0CA2 DD36FF5C        19      LD  (IX-1),05CH ;\
       0CA6                     D2FN3:
000BA6 0CA6 D1              10      POP DE
000BA7 0CA7 C1              10      POP BC
000BA8 0CA8 C5              11      PUSH    BC
000BA9 0CA9 E5              11      PUSH    HL
000BAA 0CAA CDEA0A          17      CALL    FILE
000BAD 0CAD E1              10      POP HL
000BAE 0CAE C1              10      POP BC
       0CAF                     S29X1:
000BAF 0CAF C5              11      PUSH    BC
000BB0 0CB0 D5              11      PUSH    DE
000BB1 0CB1 E5              11      PUSH    HL
000BB2 0CB2 EB               4      EX  DE,HL
000BB3 0CB3 218712          10      LD  HL,FDRV
000BB6 0CB6 010D00          10      LD  BC,13
000BB9 0CB9 EDB0                    LDIR
000BBB 0CBB 70               7      LD  (HL),B      ;B=0
000BBC 0CBC 0E03             7      LD  C,3
000BBE 0CBE EDB0                    LDIR
000BC0 0CC0 E1              10      POP HL
000BC1 0CC1 D1              10      POP DE
000BC2 0CC2 C1              10      POP BC
000BC3 0CC3 AF               4      XOR A
000BC4 0CC4 C9              10      RET
       0CC5                     GET_WIDTH:
000BC5 0CC5 3AB510          13      LD  A,(IS_MSX)
000BC8 0CC8 B7               4      OR  A
000BC9 0CC9 2804            12      JR  Z,NOT_MSX
000BCB 0CCB 3AB0F3          13      LD  A,(LINLEN)
000BCE 0CCE C9              10      RET
       0CCF                     NOT_MSX:
000BCF 0CCF E5              11      PUSH    HL
000BD0 0CD0 2A0100          16      LD  HL,(1)
000BD3 0CD3 2EB1             7      LD  L,0B1H
000BD5 0CD5 7E               7      LD  A,(HL)
000BD6 0CD6 E1              10      POP HL
000BD7 0CD7 C9              10      RET
                                
       0CD8                     IS_FOLDER:          ;out CF=0:Folder
000BD8 0CD8 CDC70B          17      CALL    SPCUT
000BDB 0CDB 1A               7      LD  A,(DE)
000BDC 0CDC C6FF             7      ADD A,0FFH
000BDE 0CDE D0              11      RET NC
000BDF 0CDF AF               4      XOR A
000BE0 0CE0 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
000BE2 0CE2 D5              11      PUSH    DE
000BE3 0CE3 CD7403          17      CALL    SYSTEM0
000BE6 0CE6 D1              10      POP DE
000BE7 0CE7 37               4      SCF
000BE8 0CE8 C0              11      RET NZ
000BE9 0CE9 7D               4      LD  A,L
000BEA 0CEA E610             7      AND 010H
000BEC 0CEC D601             7      SUB 1
000BEE 0CEE C9              10      RET
                                
       0CEF                     C_MODE:
000BEF 0CEF 3AB510          13      LD  A,(IS_MSX)
000BF2 0CF2 B7               4      OR  A
000BF3 0CF3 C8              11      RET Z
000BF4 0CF4 0E29             7      LD  C,41
000BF6 0CF6 3AF8FA          13      LD  A,(EXBRSA)
000BF9 0CF9 B7               4      OR  A
000BFA 0CFA 2802            12      JR  Z,MODE_MSX1
000BFC 0CFC 0E51             7      LD  C,81
       0CFE                     MODE_MSX1:
000BFE 0CFE C5              11      PUSH    BC
000BFF 0CFF CDB60E          17      CALL    GETNUM
000C02 0D02 C1              10      POP BC
000C03 0D03 7D               4      LD  A,L
000C04 0D04 B9               4      CP  C
000C05 0D05 301C            12      JR  NC,MODE1
000C07 0D07 B7               4      OR  A
000C08 0D08 2819            12      JR  Z,MODE1
000C0A 0D0A FE21             7      CP  33
000C0C 0D0C 381E            12      JR  C,MODE32
000C0E 0D0E 32AEF3          13      LD  (LINL40),A
000C11 0D11 DD216C00        14      LD  IX,INITXT
000C15 0D15 CD1C0D          17      CALL    CALLROM
000C18 0D18 DD217800        14      LD  IX,SETTXT
       0D1C                     CALLROM:
000C1C 0D1C FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000C20 0D20 C31C00          10      JP  CALSLT
       0D23                     MODE1:
000C23 0D23 3AB0F3          13      LD  A,(LINLEN)
000C26 0D26 CDAC07          17      CALL    PRDEC_A
000C29 0D29 C34206          10      JP  LTNL
       0D2C                     MODE32:
000C2C 0D2C 32AFF3          13      LD  (LINL32),A
000C2F 0D2F DD216F00        14      LD  IX,INIT32
000C33 0D33 CD1C0D          17      CALL    CALLROM
000C36 0D36 DD217B00        14      LD  IX,SETT32
000C3A 0D3A 18E0            12      JR  CALLROM
                                
       0D3C                     C_PAUSE:
000C3C 0D3C CDC70B          17      CALL    SPCUT
000C3F 0D3F EB               4      EX  DE,HL
000C40 0D40 7E               7      LD  A,(HL)
000C41 0D41 B7               4      OR  A
000C42 0D42 2003            12      JR  NZ,C_PAUSE1
000C44 0D44 219A0F          10      LD  HL,PAUSE
       0D47                     C_PAUSE1:
000C47 0D47 CD0406          17      CALL    MSX
000C4A 0D4A 0E07             7      LD  C,7     ;(BDOS)コンソール直接入力(_DIRIN)
000C4C 0D4C CD0500          17      CALL    SYSTEM
000C4F 0D4F FE03             7      CP  3
000C51 0D51 CA0405          10      JP  Z,END_BATCH
000C54 0D54 C34206          10      JP  LTNL
                                
       0D57                     C_ECHO:
000C57 0D57 CDC70B          17      CALL    SPCUT
000C5A 0D5A EB               4      EX  DE,HL
000C5B 0D5B CD0406          17      CALL    MSX
000C5E 0D5E C34206          10      JP  LTNL
                                
       0D61                     C_MKDIR:
000C61 0D61 CDC70B          17      CALL    SPCUT
000C64 0D64 014490          10      LD  BC,09044H   ;B=新規作成+ディレクトリ/C=(BDOS)ファイルハンドルの作成(_CREATE)
000C67 0D67 CD0500          17      CALL    SYSTEM
000C6A 0D6A C6FF             7      ADD A,0FFH
000C6C 0D6C D8              11      RET C
000C6D 0D6D 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
000C6F 0D6F CD0500          17      CALL    SYSTEM
       0D72                     SHOW_OK:
000C72 0D72 11900F          10      LD  DE,OK
000C75 0D75 0E09             7      LD  C,9     ;(BDOS)文字列出力
000C77 0D77 CD0500          17      CALL    SYSTEM
000C7A 0D7A C34206          10      JP  LTNL
                                
       0D7D                     C_RMDIR:
000C7D 0D7D CDD80C          17      CALL    IS_FOLDER
000C80 0D80 D8              11      RET C
000C81 0D81 0E4D             7      LD  C,04DH      ;(BDOS)ファイル・サブディレクトリの削除
000C83 0D83 CD0500          17      CALL    SYSTEM
000C86 0D86 C6FF             7      ADD A,0FFH
000C88 0D88 D8              11      RET C
000C89 0D89 18E7            12      JR  SHOW_OK
                                
       0D8B                     C_SET:
000C8B 0D8B CDC70B          17      CALL    SPCUT
000C8E 0D8E ED53A10D        20      LD  (CSET_PARAM),DE
       0D92                     CSET2:
000C92 0D92 1A               7      LD  A,(DE)
000C93 0D93 FE20             7      CP  020H
000C95 0D95 3838            12      JR  C,CSET_LIST
000C97 0D97 D63D             7      SUB '='
000C99 0D99 2803            12      JR  Z,CSET_SET
000C9B 0D9B 13               6      INC DE
000C9C 0D9C 18F4            12      JR  CSET2
       0D9E                     CSET_SET:
000C9E 0D9E 12               7      LD  (DE),A
000C9F 0D9F 13               6      INC DE
       0DA1                     CSET_PARAM  EQU $+1
000CA0 0DA0 210000          10      LD  HL,0
000CA3 0DA3 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000CA5 0DA5 CD0500          17      CALL    SYSTEM
       0DA8                     INIT_VAR:           ;環境変数の初期化
000CA8 0DA8 217110          10      LD  HL,N_DATE
000CAB 0DAB 117610          10      LD  DE,V_DATE
000CAE 0DAE 0610             7      LD  B,16
000CB0 0DB0 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000CB2 0DB2 CD0500          17      CALL    SYSTEM
                                
000CB5 0DB5 219610          10      LD  HL,N_TIME
000CB8 0DB8 119B10          10      LD  DE,V_TIME
000CBB 0DBB 0603             7      LD  B,3
000CBD 0DBD 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000CBF 0DBF CD0500          17      CALL    SYSTEM
                                
000CC2 0DC2 21E50F          10      LD  HL,N_APPEND
000CC5 0DC5 11EC0F          10      LD  DE,V_APPEND
000CC8 0DC8 0640             7      LD  B,PATHX
000CCA 0DCA 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000CCC 0DCC C30500          10      JP  SYSTEM
                                
       0DCF                     CSET_LIST:
000CCF 0DCF 3E0A             7      LD  A,10
000CD1 0DD1 32B212          13      LD  (CSET_DATA),A
000CD4 0DD4 110100          10      LD  DE,1
       0DD7                     CSET1:
000CD7 0DD7 D5              11      PUSH    DE
000CD8 0DD8 016DFF          10      LD  BC,0FF6DH   ;_FENV 環境変数の検索
000CDB 0DDB 21B412          10      LD  HL,DATA_COM
000CDE 0DDE 3600            10      LD  (HL),0
000CE0 0DE0 CD0500          17      CALL    SYSTEM
000CE3 0DE3 B7               4      OR  A
000CE4 0DE4 2030            12      JR  NZ,CSET_ERROR
000CE6 0DE6 21B412          10      LD  HL,DATA_COM
000CE9 0DE9 7E               7      LD  A,(HL)
000CEA 0DEA B7               4      OR  A
000CEB 0DEB 2829            12      JR  Z,CSET_ERROR
000CED 0DED CD0406          17      CALL    MSX
000CF0 0DF0 1E3D             7      LD  E,'='
000CF2 0DF2 CD980A          17      CALL    _PRINT
000CF5 0DF5 21B412          10      LD  HL,DATA_COM
000CF8 0DF8 11B413          10      LD  DE,DATA_COM+256
000CFB 0DFB 016BFF          10      LD  BC,0FF6BH   ;_GENV 環境変数の獲得
000CFE 0DFE CD0500          17      CALL    SYSTEM
000D01 0E01 21B413          10      LD  HL,DATA_COM+256
000D04 0E04 CD0406          17      CALL    MSX
000D07 0E07 CD4206          17      CALL    LTNL
000D0A 0E0A 3E0A             7      LD  A,10
000D0C 0E0C 32B212          13      LD  (CSET_DATA),A
       0E0F                     CSET_NEXT:
000D0F 0E0F D1              10      POP DE
000D10 0E10 13               6      INC DE
000D11 0E11 7A               4      LD  A,D
000D12 0E12 B3               4      OR  E
000D13 0E13 20C2            12      JR  NZ,CSET1
000D15 0E15 C9              10      RET
       0E16                     CSET_ERROR:
000D16 0E16 21B212          10      LD  HL,CSET_DATA
000D19 0E19 35              11      DEC (HL)
000D1A 0E1A 20F3            12      JR  NZ,CSET_NEXT
       0E1C                     CSET_END:
000D1C 0E1C D1              10      POP DE
000D1D 0E1D C9              10      RET
                                
       0E1E                     C_FORMAT:
000D1E 0E1E 3AB510          13      LD  A,(IS_MSX)
000D21 0E21 B7               4      OR  A
000D22 0E22 C8              11      RET Z
000D23 0E23 3AB610          13      LD  A,(MAJOR_VER)
000D26 0E26 FE02             7      CP  2
000D28 0E28 300B            12      JR  NC,FORMAT2
       0E2A                     FORMAT1:
000D2A 0E2A FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000D2E 0E2E DD214701        14      LD  IX,FORMAT
000D32 0E32 C31C00          10      JP  CALSLT
       0E35                     FORMAT2:
000D35 0E35 CD3708          17      CALL    SETFCB
000D38 0E38 3A5C00          13      LD  A,(FCB1)
000D3B 0E3B B7               4      OR  A
000D3C 0E3C 28EC            12      JR  Z,FORMAT1
000D3E 0E3E 47               4      LD  B,A
000D3F 0E3F AF               4      XOR A
000D40 0E40 0E67             7      LD  C,067H      ;(_FORMAT)ディスクのフォーマット
000D42 0E42 CD0500          17      CALL    SYSTEM
000D45 0E45 B7               4      OR  A
000D46 0E46 20E2            12      JR  NZ,FORMAT1
000D48 0E48 CD0D06          17      CALL    MSXSLT
000D4B 0E4B 21B210          10      LD  HL,PROMPT
000D4E 0E4E CD0406          17      CALL    MSX
       0E51                     FORMAT3:
000D51 0E51 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力(_INNOE)
000D53 0E53 CD0500          17      CALL    SYSTEM
000D56 0E56 D631             7      SUB '0'+1
000D58 0E58 38F7            12      JR  C,FORMAT3
000D5A 0E5A 3C               4      INC A
000D5B 0E5B FE0A             7      CP  10
000D5D 0E5D 30F2            12      JR  NC,FORMAT3
000D5F 0E5F F5              11      PUSH    AF
000D60 0E60 CD4206          17      CALL    LTNL
000D63 0E63 219A0F          10      LD  HL,PAUSE
000D66 0E66 CD0406          17      CALL    MSX
000D69 0E69 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力(_INNOE)
000D6B 0E6B CD0500          17      CALL    SYSTEM
000D6E 0E6E CD4206          17      CALL    LTNL
000D71 0E71 F1              10      POP AF
000D72 0E72 ED4B5B00        20      LD  BC,(FCB1-1)
000D76 0E76 210080          10      LD  HL,08000H
000D79 0E79 110040          10      LD  DE,04000H
000D7C 0E7C 0E67             7      LD  C,067H      ;(_FORMAT)ディスクのフォーマット
000D7E 0E7E C30500          10      JP  SYSTEM
                                
       0E81                     C_RAMDISK:
000D81 0E81 3AB510          13      LD  A,(IS_MSX)
000D84 0E84 B7               4      OR  A
000D85 0E85 C8              11      RET Z
000D86 0E86 3AB610          13      LD  A,(MAJOR_VER)
000D89 0E89 FE02             7      CP  2
000D8B 0E8B D8              11      RET C
000D8C 0E8C CDC70B          17      CALL    SPCUT
000D8F 0E8F 1A               7      LD  A,(DE)
000D90 0E90 FE30             7      CP  '0'
000D92 0E92 D8              11      RET C
000D93 0E93 FE3A             7      CP  '9'+1
000D95 0E95 3F               4      CCF
000D96 0E96 D8              11      RET C
000D97 0E97 CDB60E          17      CALL    GETNUM
000D9A 0E9A 110F00          10      LD  DE,15       ;切り上げの為
000D9D 0E9D 19              11      ADD HL,DE
000D9E 0E9E 7D               4      LD  A,L
000D9F 0E9F 0604             7      LD  B,4     ;16で割る
       0EA1                     RAMDISK1:
000DA1 0EA1 CB3C             8      SRL H   ;/2
000DA3 0EA3 1F               4      RRA
000DA4 0EA4 10FB            13      DJNZ    RAMDISK1
000DA6 0EA6 FEFF             7      CP  0FFH
000DA8 0EA8 2001            12      JR  NZ,RAMDISK2
000DAA 0EAA 3D               4      DEC A
       0EAB                     RAMDISK2:
000DAB 0EAB 47               4      LD  B,A
000DAC 0EAC 0E68             7      LD  C,068H      ;(_RAMD)RAMディスクの作成あるいは消去
000DAE 0EAE CD0500          17      CALL    SYSTEM
000DB1 0EB1 B7               4      OR  A
000DB2 0EB2 CC720D          17      CALL    Z,SHOW_OK
000DB5 0EB5 C9              10      RET
                                
       0EB6                     GETNUM:
000DB6 0EB6 CDC70B          17      CALL    SPCUT
000DB9 0EB9 210000          10      LD  HL,0
       0EBC                     GETNUM1:
000DBC 0EBC 1A               7      LD  A,(DE)
000DBD 0EBD 13               6      INC DE
000DBE 0EBE D630             7      SUB '0'
000DC0 0EC0 D8              11      RET C
000DC1 0EC1 FE0A             7      CP  10
000DC3 0EC3 D0              11      RET NC
000DC4 0EC4 4D               4      LD  C,L
000DC5 0EC5 44               4      LD  B,H
000DC6 0EC6 29              11      ADD HL,HL   ;*2
000DC7 0EC7 29              11      ADD HL,HL   ;*4
000DC8 0EC8 09              11      ADD HL,BC   ;*5
000DC9 0EC9 29              11      ADD HL,HL   ;*10
000DCA 0ECA 4F               4      LD  C,A
000DCB 0ECB 0600             7      LD  B,0
000DCD 0ECD 09              11      ADD HL,BC
000DCE 0ECE 18EC            12      JR  GETNUM1
                                
       0ED0                     CHDIR:
000DD0 0ED0 3AB610          13      LD  A,(MAJOR_VER)
000DD3 0ED3 FE02             7      CP  2
000DD5 0ED5 D8              11      RET C
000DD6 0ED6 C5              11      PUSH    BC
000DD7 0ED7 E5              11      PUSH    HL
000DD8 0ED8 0E5A             7      LD  C,05AH      ;(BDOS)_CHDIR カレントディレクトリの変更
000DDA 0EDA CD0500          17      CALL    SYSTEM
000DDD 0EDD E1              10      POP HL
000DDE 0EDE C1              10      POP BC
000DDF 0EDF C9              10      RET
                                
       0011                     COMS    EQU 17
       0EE0                     COMTB:
000DE0 0EE0 44202020202020          DB  "D      "   ;1
000DE7 0EE7 8305                    DW  C_DIR
000DE9 0EE9 44495220202020          DB  "DIR    "   ;2
000DF0 0EF0 8305                    DW  C_DIR
000DF2 0EF2 434F5059202020          DB  "COPY   "   ;3
000DF9 0EF9 8008                    DW  C_COPY
000DFB 0EFB 43442020202020          DB  "CD     "   ;4
000E02 0F02 7903                    DW  C_CD
000E04 0F04 44454C20202020          DB  "DEL    "   ;5
000E0B 0F0B 2205                    DW  C_DEL
000E0D 0F0D 50415448202020          DB  "PATH   "   ;6
000E14 0F14 4C06                    DW  C_PATH
000E16 0F16 52454E20202020          DB  "REN    "   ;7
000E1D 0F1D 5505                    DW  C_REN
000E1F 0F1F 54595045202020          DB  "TYPE   "   ;8
000E26 0F26 2E0A                    DW  C_TYPE
000E28 0F28 52454D20202020          DB  "REM    "   ;9
000E2F 0F2F 2005                    DW  C_REM
000E31 0F31 4D4F4445202020          DB  "MODE   "   ;10
000E38 0F38 EF0C                    DW  C_MODE
000E3A 0F3A 50415553452020          DB  "PAUSE  "   ;11
000E41 0F41 3C0D                    DW  C_PAUSE
000E43 0F43 53455420202020          DB  "SET    "   ;12
000E4A 0F4A 8B0D                    DW  C_SET
000E4C 0F4C 4543484F202020          DB  "ECHO   "   ;13
000E53 0F53 570D                    DW  C_ECHO
000E55 0F55 4D4B4449522020          DB  "MKDIR  "   ;14
000E5C 0F5C 610D                    DW  C_MKDIR
000E5E 0F5E 524D4449522020          DB  "RMDIR  "   ;15
000E65 0F65 7D0D                    DW  C_RMDIR
000E67 0F67 464F524D415420          DB  "FORMAT "   ;16
000E6E 0F6E 1E0E                    DW  C_FORMAT
000E70 0F70 52414D4449534B          DB  "RAMDISK"   ;17
000E77 0F77 810E                    DW  C_RAMDISK
                                
000E79 0F79 2062797465732066    FREE:   DB  " bytes free  $"
            726565202024        
000E87 0F87 2020203C4449523E    DIRMES: DB  "   <DIR>$"
            24                  
000E90 0F90 4F4B24              OK: DB  "OK$"
000E93 0F93 4572726F722124      COMERM: DB  "Error!$"
000E9A 0F9A 537472696B652061    PAUSE:  DB  "Strike any key when ready ",0
            6E79206B65792077    
            68656E2072656164    
            792000              
                                
       0FB5                     S_MONTH:
000EB5 0FB5 4A616E00                DB  "Jan",0
000EB9 0FB9 46656200                DB  "Feb",0
000EBD 0FBD 4D617200                DB  "Mar",0
000EC1 0FC1 41707200                DB  "Apr",0
000EC5 0FC5 4D617900                DB  "May",0
000EC9 0FC9 4A756E00                DB  "Jun",0
000ECD 0FCD 4A756C00                DB  "Jul",0
000ED1 0FD1 41756700                DB  "Aug",0
000ED5 0FD5 53657000                DB  "Sep",0
000ED9 0FD9 4F637400                DB  "Oct",0
000EDD 0FDD 4E6F7600                DB  "Nov",0
000EE1 0FE1 44656300                DB  "Dec",0
                                
       0FE5                     N_APPEND:
000EE5 0FE5 415050454E4400          DB  "APPEND",0
       0FEC                     V_APPEND:
000EEC 0FEC                         DS  64
       102C                     N_PATH:
000F2C 102C 5041544800              DB  "PATH",0
       1031                     V_PATH:
000F31 1031                         DS  PATHX
       1071                     N_DATE:
000F71 1071 4441544500              DB  "DATE",0
       1076                     V_DATE:
000F76 1076 79792D6D6D2D6464        DB  "yy-mm-dd"
000F7E 107E                         DS  8
       1086                     V_DATE1:
000F86 1086 6D6D2D64642D7979        DB  "mm-dd-yy"
       108E                     V_DATE2:
000F8E 108E 64642D6D6D2D7979        DB  "dd-mm-yy"
       1096                     N_TIME:
000F96 1096 54494D4500              DB  "TIME",0
       109B                     V_TIME:
000F9B 109B 323400                  DB  "24",0
       109E                     N_PROGRAM:
000F9E 109E 50524F4752414D00        DB  "PROGRAM",0
       10A6                     N_PARAMETERS:
000FA6 10A6 504152414D455445        DB  "PARAMETERS",0
            525300              
                                
       10B1                     F_TIME:
000FB1 10B1 00                      DB  0
       10B2                     PROMPT:
000FB2 10B2 3F2000                  DB  "? ",0
       10B5                     IS_MSX:
000FB5 10B5 00                      DB  0
       10B6                     MAJOR_VER:
000FB6 10B6 00                      DB  0
       10B7                     SEARCH_IX:
000FB7 10B7                         DS  64  ;DOS2用
       10F7                     HANDLE1:
000FF7 10F7 0000                    DW  0
       10F9                     PATH_POS:
000FF9 10F9 0000                    DW  0
       10FB                     PATH_DRV:
000FFB 10FB 413A5C                  DB  "A:\\"
       10FE                     PATH_CCP:
000FFE 10FE                         DS  64  ;DOS2用
       113E                     PATH_PAR:
00103E 113E                         DS  64  ;DOS2用
       117E                     PATH_FN1:
00107E 117E                         DS  64  ;DOS2用
       11BE                     PATH_FN2:
0010BE 11BE                         DS  64  ;DOS2用
       11FE                     CUR_DRV:
0010FE 11FE 413A5C                  DB  "A:\\"
       1201                     CUR_PATH:
001101 1201                         DS  64  ;DOS2用
       1241                     DOS2NAME:
001141 1241                         DS  2+8+3+1 ;DOS2用
       124F                     DTA_CCP:
00114F 124F                         DS  37
       1274                     DIR_CK:
001174 1274 0000                    DW  0
                                
       1276                     CPBUF:
001176 1276 0000                LEFTX:  DW  0
001178 1278 0000                DTAX:   DW  0
00117A 127A 20                      DB  020H    ;CPBUFで使う
00117B 127B 20                      DB  020H
00117C 127C 20                      DB  020H
00117D 127D 20                      DB  020H
00117E 127E 20                      DB  020H
00117F 127F 20                      DB  020H
001180 1280 20                      DB  020H
                                
       1281                     DECBF:
001181 1281                         DS  5
       1286                     FCB_BAT2:
001186 1286 00                      DB  0
       1287                     FDRV:
001187 1287 00                      DB  0
       1288                     FNAME:
001188 1288                         DS  37
       12AD                     ZERO:
0011AD 12AD 00                      DB  0
       12AE                     FCB_BAT:
0011AE 12AE 8612                    DW  FCB_BAT2
       12B0                     X_PATH:
0011B0 12B0 0000                    DW  0
       12B2                     CSET_DATA:
0011B2 12B2 00                      DB  0
       12B3                     PROCESS:
0011B3 12B3 00                      DB  0
                                
       12B4                     DATA_COM:
[EOF:COMMAND.ASM:SHIFT_JIS]
