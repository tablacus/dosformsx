                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                
                                ;   似非COMMAND.COM
                                
       0005                     SYSTEM  EQU 00005H
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
       000C                     RDSLT   EQU 0000CH
       001C                     CALSLT  EQU 0001CH
       006C                     INITXT  EQU 0006CH
       006F                     INIT32  EQU 0006FH
       0078                     SETTXT  EQU 00078H
       007B                     SETT32  EQU 0007BH
       0147                     FORMAT  EQU 00147H
                                
       F3AE                     LINL40  EQU 0F3AEH
       F3AF                     LINL32  EQU 0F3AFH
       F3B0                     LINLEN  EQU 0F3B0H
       F55E                     BUF EQU 0F55EH
       FAF8                     EXBRSA  EQU 0FAF8H
       FC9B                     INTFLG  EQU 0FC9BH
       FCC1                     EXPTBL  EQU 0FCC1H
                                
                                
       0040                     PATHX   EQU 64
                                
       8000                     DATA    EQU 08000H
                                
000000 0100                         ORG 0100H
000000 0100 C31501          10      JP  START
000003 0103 0D0A434F4D4D414E    VER:    DB  00DH,00AH,"COMMAND v0.14",00DH,00AH,'$'
            442076302E31340D    
            0A24                
       0115                     START:
000015 0115 ED7B0600        20      LD  SP,(SYSTEM+1)
000019 0119 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
00001B 011B CD0500          17      CALL    SYSTEM
00001E 011E D8              11      RET C
00001F 011F 211D01          10      LD  HL,0011DH
000022 0122 ED42            15      SBC HL,BC
000024 0124 78               4      LD  A,B
000025 0125 32EB0F          13      LD  (MAJOR_VER),A
000028 0128 B5               4      OR  L
000029 0129 32EA0F          13      LD  (IS_MSX),A
00002C 012C B7               4      OR  A
00002D 012D 2850            12      JR  Z,WSTART
                                
00002F 012F 3AE811          13      LD  A,(PROCESS)
000032 0132 0E61             7      LD  C,61H       ;(BDOS)親プロセスに戻る
000034 0134 47               4      LD  B,A
000035 0135 B7               4      OR  A
000036 0136 C40500          17      CALL    NZ,SYSTEM
000039 0139 AF               4      XOR A
00003A 013A 32E811          13      LD  (PROCESS),A
                                
00003D 013D 212B00          10      LD  HL,002BH    ;キャラクターセット・日時フォーマット・ビデオ信号の種別
000040 0140 CD0C00          17      CALL    RDSLT
000043 0143 0F               4      RRCA
000044 0144 0F               4      RRCA
000045 0145 0F               4      RRCA
000046 0146 0F               4      RRCA
000047 0147 E603             7      AND 3
000049 0149 2814            12      JR  Z,DATEOK
00004B 014B 3D               4      DEC A
00004C 014C 21CE0F          10      LD  HL,V_DATE1
00004F 014F 2806            12      JR  Z,DATECHG
000051 0151 3D               4      DEC A
000052 0152 21D60F          10      LD  HL,V_DATE2
000055 0155 2008            12      JR  NZ,DATEOK
       0157                     DATECHG:
000057 0157 11BE0F          10      LD  DE,V_DATE
00005A 015A 010800          10      LD  BC,8
00005D 015D EDB0                    LDIR
       015F                     DATEOK:
00005F 015F CDF00C          17      CALL    INIT_VAR
                                
000062 0162 2A0600          16      LD  HL,(SYSTEM+1)
000065 0165 2EDB             7      LD  L,256-37
000067 0167 24               4      INC H
000068 0168 22E311          16      LD  (FCB_BAT),HL
00006B 016B 3A8000          13      LD  A,(DTA1)
00006E 016E B7               4      OR  A
00006F 016F 280E            12      JR  Z,WSTART
000071 0171 110301          10      LD  DE,VER
000074 0174 0E09             7      LD  C,9
000076 0176 CD0500          17      CALL    SYSTEM
000079 0179 118100          10      LD  DE,DTA1+1
00007C 017C CDCC01          17      CALL    COMANL
       017F                     WSTART:
00007F 017F 212D0F          10      LD  HL,N_APPEND
000082 0182 11340F          10      LD  DE,V_APPEND
000085 0185 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000087 0187 CD0500          17      CALL    SYSTEM
                                
00008A 018A CD8A05          17      CALL    LTNL
       018D                     COMMAND:
00008D 018D E5              11      PUSH    HL
00008E 018E 2AE311          16      LD  HL,(FCB_BAT)
000091 0191 7E               7      LD  A,(HL)
000092 0192 E1              10      POP HL
000093 0193 B7               4      OR  A
000094 0194 C21704          10      JP  NZ,C_BAT1
000097 0197 CD2403          17      CALL    SETDTA1
00009A 019A D5              11      PUSH    DE
00009B 019B C5              11      PUSH    BC
00009C 019C E5              11      PUSH    HL
00009D 019D 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
00009F 019F CD0500          17      CALL    SYSTEM
0000A2 01A2 E1              10      POP HL
0000A3 01A3 C1              10      POP BC
0000A4 01A4 C641             7      ADD A,'A'
0000A6 01A6 CDF109          17      CALL    MSG_A
0000A9 01A9 1E3E             7      LD  E,'>'
0000AB 01AB CDE009          17      CALL    _PRINT
0000AE 01AE D1              10      POP DE      ;DE=DTA1
0000AF 01AF 3E50             7      LD  A,80
0000B1 01B1 12               7      LD  (DE),A
0000B2 01B2 0E0A             7      LD  C,0AH       ;(BDOS)文字列入力
0000B4 01B4 CD0500          17      CALL    SYSTEM
0000B7 01B7 CD8A05          17      CALL    LTNL
       01BA                     COMMAND2:
0000BA 01BA 118200          10      LD  DE,DTA1+2
0000BD 01BD CDCC01          17      CALL    COMANL
0000C0 01C0 30CB            12      JR  NC,COMMAND
0000C2 01C2 11DB0E          10      LD  DE,COMERM
0000C5 01C5 0E09             7      LD  C,9     ;(BDOS)文字列出力
0000C7 01C7 CD0500          17      CALL    SYSTEM
0000CA 01CA 18B3            12      JR  WSTART
                                
       01CC                     COMANL:
0000CC 01CC CD150B          17      CALL    TOZERO
0000CF 01CF CD320A          17      CALL    FILE
0000D2 01D2 D5              11      PUSH    DE
0000D3 01D3 11BD11          10      LD  DE,FNAME
0000D6 01D6 1A               7      LD  A,(DE)
0000D7 01D7 FE20             7      CP  020H
0000D9 01D9 285C            12      JR  Z,SDVSW
0000DB 01DB 1B               6      DEC DE
0000DC 01DC 1A               7      LD  A,(DE)
0000DD 01DD C6FF             7      ADD A,0FFH
0000DF 01DF 380A            12      JR  C,COMB
0000E1 01E1 13               6      INC DE
                                
0000E2 01E2 21280E          10      LD  HL,COMTB
0000E5 01E5 3E11             7      LD  A,COMS
0000E7 01E7 47               4      LD  B,A
0000E8 01E8 CD670B          17      CALL    CPNAME
       01EB                     COMB:
0000EB 01EB D1              10      POP DE
0000EC 01EC D2DF09          10      JP  NC,JP_HL
       01EF                     COMB2:
0000EF 01EF EB               4      EX  DE,HL
0000F0 01F0 22B703          16      LD  (COMPAT+1),HL
0000F3 01F3 CD7A03          17      CALL    CEXE4
                                
0000F6 01F6 21740F          10      LD  HL,N_PATH
0000F9 01F9 11790F          10      LD  DE,V_PATH
0000FC 01FC 0640             7      LD  B,PATHX
0000FE 01FE 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000100 0200 CD0500          17      CALL    SYSTEM
                                
000103 0203 21790F          10      LD  HL,V_PATH
000106 0206 22E511          16      LD  (X_PATH),HL
       0209                     CEX1:
000109 0209 2AE511          16      LD  HL,(X_PATH)
00010C 020C 7E               7      LD  A,(HL)
00010D 020D FE20             7      CP  020H
00010F 020F D8              11      RET C
       0210                     CEX2:
000110 0210 7E               7      LD  A,(HL)
000111 0211 FE20             7      CP  020H
000113 0213 3807            12      JR  C,CEX3
000115 0215 FE3B             7      CP  ';'
000117 0217 2803            12      JR  Z,CEX3
000119 0219 23               6      INC HL
00011A 021A 18F4            12      JR  CEX2
       021C                     CEX3:
00011C 021C 3600            10      LD  (HL),0
00011E 021E FE20             7      CP  020H
000120 0220 3801            12      JR  C,CEX4
000122 0222 23               6      INC HL
       0223                     CEX4:
000123 0223 ED5BE511        20      LD  DE,(X_PATH)
000127 0227 22E511          16      LD  (X_PATH),HL
00012A 022A 212D0F          10      LD  HL,N_APPEND
00012D 022D 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
00012F 022F CD0500          17      CALL    SYSTEM
                                
000132 0232 CD7A03          17      CALL    CEXE4
000135 0235 18D2            12      JR  CEX1
                                
       0237                     SDVSW:
000137 0237 F1              10      POP AF
000138 0238 3ABC11          13      LD  A,(FDRV)
00013B 023B 3D               4      DEC A
00013C 023C 5F               4      LD  E,A
00013D 023D 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
00013F 023F C32B03          10      JP  SYSTEM0
                                
       0242                     OPEN_D2:            ;DOS2対応
000142 0242 3AEB0F          13      LD  A,(MAJOR_VER)
000145 0245 FE02             7      CP  2
000147 0247 384F            12      JR  C,OPEN
000149 0249 11B310          10      LD  DE,PATH_FN1
00014C 024C 180A            12      JR  OPEN_D2X
       024E                     OPEN1_D2:           ;DOS2対応
00014E 024E 3AEB0F          13      LD  A,(MAJOR_VER)
000151 0251 FE02             7      CP  2
000153 0253 3840            12      JR  C,OPEN1
                                
000155 0255 113310          10      LD  DE,PATH_CCP
       0258                     OPEN_D2X:
000158 0258 DD21EC0F        14      LD  IX,SEARCH_IX
00015C 025C 014010          10      LD  BC,01040H   ;(BDOS)最初のエントリ検索
00015F 025F CD0500          17      CALL    SYSTEM
000162 0262 F5              11      PUSH    AF
000163 0263 117310          10      LD  DE,PATH_PAR
000166 0266 0E5E             7      LD  C,05EH      ;(BDOS)完全なパス文字列の獲得(_WPATH)
000168 0268 CD0500          17      CALL    SYSTEM
00016B 026B AF               4      XOR A
00016C 026C 77               7      LD  (HL),A
00016D 026D 117310          10      LD  DE,PATH_PAR
000170 0270 ED52            15      SBC HL,DE
000172 0272 222E10          16      LD  (PATH_POS),HL
000175 0275 F1              10      POP AF
       0276                     FIB2DIRENT:
000176 0276 B7               4      OR  A
000177 0277 C0              11      RET NZ
                                
000178 0278 11ED0F          10      LD  DE,SEARCH_IX+1  ;(FIB)ファイル名
00017B 027B 218511          10      LD  HL,DTA_CCP+1
00017E 027E 0E5C             7      LD  C,05CH      ;(BDOS)ファイル名の解析
000180 0280 CD0500          17      CALL    SYSTEM
                                
000183 0283 21FA0F          10      LD  HL,SEARCH_IX+14 ;(FIB)属性
000186 0286 119011          10      LD  DE,DTA_CCP+1+8+3
000189 0289 EDA0            16      LDI
00018B 028B 119B11          10      LD  DE,DTA_CCP+1+8+3+1+10
00018E 028E 010A00          10      LD  BC,2+2+2+4  ;最終変更時刻+最終変更日付+開始クラスタ+ファイルサイズ
000191 0291 EDB0                    LDIR
000193 0293 AF               4      XOR A
000194 0294 C9              10      RET
                                
       0295                     OPEN1:
000195 0295 21BC11          10      LD  HL,FDRV
       0298                     OPEN:
000198 0298 0E11             7      LD  C,011H      ;(BDOS)最初のファイルの検索
       029A                     OPEN3:
00019A 029A D5              11      PUSH    DE
00019B 029B 118411          10      LD  DE,DTA_CCP
00019E 029E CD1703          17      CALL    SETDTA
0001A1 02A1 EB               4      EX  DE,HL
0001A2 02A2 CD0500          17      CALL    SYSTEM
0001A5 02A5 D1              10      POP DE
0001A6 02A6 B7               4      OR  A
0001A7 02A7 C9              10      RET
                                
       02A8                     OPEN2_D2:           ;DOS2対応
0001A8 02A8 3AEB0F          13      LD  A,(MAJOR_VER)
0001AB 02AB FE02             7      CP  2
0001AD 02AD 380B            12      JR  C,OPEN2
0001AF 02AF DD21EC0F        14      LD  IX,SEARCH_IX
0001B3 02B3 0E41             7      LD  C,41H       ;(BDOS)次のエントリ検索
0001B5 02B5 CD0500          17      CALL    SYSTEM
0001B8 02B8 18BC            12      JR  FIB2DIRENT
       02BA                     OPEN2:
0001BA 02BA 0E12             7      LD  C,012H
0001BC 02BC 18DC            12      JR  OPEN3
                                
       02BE                     DEFCB_D2:           ;DOS2対応
0001BE 02BE 3AEB0F          13      LD  A,(MAJOR_VER)
0001C1 02C1 FE02             7      CP  2
0001C3 02C3 383A            12      JR  C,DEFCB
0001C5 02C5 217310          10      LD  HL,PATH_PAR
0001C8 02C8 113310          10      LD  DE,PATH_CCP
0001CB 02CB 014000          10      LD  BC,64
0001CE 02CE EDB0                    LDIR
0001D0 02D0 2A2E10          16      LD  HL,(PATH_POS)
0001D3 02D3 113310          10      LD  DE,PATH_CCP
0001D6 02D6 19              11      ADD HL,DE
0001D7 02D7 060D             7      LD  B,13
0001D9 02D9 11ED0F          10      LD  DE,SEARCH_IX+1  ;(FIB)ファイル名
       02DC                     DCB4:
0001DC 02DC 1A               7      LD  A,(DE)
0001DD 02DD B7               4      OR  A
0001DE 02DE 2805            12      JR  Z,DCB5
0001E0 02E0 13               6      INC DE
0001E1 02E1 77               7      LD  (HL),A
0001E2 02E2 23               6      INC HL
0001E3 02E3 18F7            12      JR  DCB4
       02E5                     DCB5:
0001E5 02E5 3600            10      LD  (HL),0
0001E7 02E7 3A0510          13      LD  A,(SEARCH_IX+25)    ;(FIB)ドライブ番号(1-8)
0001EA 02EA C640             7      ADD A,040H
0001EC 02EC 113010          10      LD  DE,PATH_DRV
0001EF 02EF 12               7      LD  (DE),A
0001F0 02F0 0E43             7      LD  C,043H      ;_OPEN ファイルハンドルのオープン
0001F2 02F2 3E01             7      LD  A,1     ;書き込み禁止
0001F4 02F4 CD0500          17      CALL    SYSTEM
0001F7 02F7 B7               4      OR  A
0001F8 02F8 C0              11      RET NZ
0001F9 02F9 ED432C10        20      LD  (HANDLE1),BC
0001FD 02FD 1815            12      JR  SETDTA100
       02FF                     DEFCB:              ;Z=Ok NZ=Error
0001FF 02FF 118411          10      LD  DE,DTA_CCP
000202 0302 CD2903          17      CALL    SYSC0F
000205 0305 B7               4      OR  A
000206 0306 C0              11      RET NZ
                                
000207 0307 210100          10      LD  HL,1
00020A 030A 229211          16      LD  (DTA_CCP+14),HL
00020D 030D 2D               4      DEC L
00020E 030E 22A511          16      LD  (DTA_CCP+33),HL
000211 0311 22A711          16      LD  (DTA_CCP+35),HL
       0314                     SETDTA100:
000214 0314 110080          10      LD  DE,DATA
       0317                     SETDTA:
000217 0317 C5              11      PUSH    BC
000218 0318 D5              11      PUSH    DE
000219 0319 E5              11      PUSH    HL
00021A 031A 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
00021C 031C CD0500          17      CALL    SYSTEM
00021F 031F E1              10      POP HL
000220 0320 D1              10      POP DE
000221 0321 C1              10      POP BC
000222 0322 AF               4      XOR A
000223 0323 C9              10      RET
                                
       0324                     SETDTA1:
000224 0324 118000          10      LD  DE,DTA1
000227 0327 18EE            12      JR  SETDTA
                                
       0329                     SYSC0F:
000229 0329 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       032B                     SYSTEM0:
00022B 032B CD0500          17      CALL    SYSTEM
00022E 032E B7               4      OR  A
00022F 032F C9              10      RET
                                
       0330                     C_CD:
000230 0330 CD040A          17      CALL    FILEC_D2
000233 0333 113310          10      LD  DE,PATH_CCP
000236 0336 1A               7      LD  A,(DE)
000237 0337 FE20             7      CP  020H
000239 0339 3805            12      JR  C,PWD
00023B 033B 0E5A             7      LD  C,5AH       ;(BDOS)_CHDIR カレントディレクトリの変更
00023D 033D C30500          10      JP  SYSTEM
       0340                     PWD:
000240 0340 CDD005          17      CALL    PUTDRV
000243 0343 3E5C             7      LD  A,05CH
000245 0345 CDF109          17      CALL    MSG_A
000248 0348 C33505          10      JP  PDSKF2
                                
       034B                     S27DTA_D2:      ;DOS2対応
00024B 034B 3AEB0F          13      LD  A,(MAJOR_VER)
00024E 034E FE02             7      CP  2
000250 0350 3817            12      JR  C,S27DTA
000252 0352 ED4B2C10        20      LD  BC,(HANDLE1)
000256 0356 110080          10      LD  DE,DATA
000259 0359 0E48             7      LD  C,048H      ;(BDOS)ファイルハンドルからの読み出し(_READ)
00025B 035B CD2B03          17      CALL    SYSTEM0
00025E 035E C8              11      RET Z
00025F 035F FEC7             7      CP  0C7H        ;.EOF
000261 0361 2803            12      JR  Z,S27EOF
000263 0363 37               4      SCF
000264 0364 9F               4      SBC A,A
000265 0365 C9              10      RET
       0366                     S27EOF:
000266 0366 3E01             7      LD  A,1
000268 0368 C9              10      RET
                                
       0369                     S27DTA:
000269 0369 110100          10      LD  DE,1
00026C 036C ED539211        20      LD  (DTA_CCP+14),DE
000270 0370 118411          10      LD  DE,DTA_CCP
       0373                     S27:
000273 0373 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
000275 0375 CD0500          17      CALL    SYSTEM
000278 0378 B7               4      OR  A
000279 0379 C9              10      RET
                                
       037A                     CEXE4:
00027A 037A 21BC11          10      LD  HL,FDRV
00027D 037D 118411          10      LD  DE,DTA_CCP
000280 0380 010900          10      LD  BC,1+8
000283 0383 EDB0                    LDIR
000285 0385 218D11          10      LD  HL,DTA_CCP+9
000288 0388 3643            10      LD  (HL),'C'
00028A 038A 23               6      INC HL
00028B 038B 364F            10      LD  (HL),'O'
00028D 038D 23               6      INC HL
00028E 038E 364D            10      LD  (HL),'M'
       0390                     C_EXE:
000290 0390 CDFF02          17      CALL    DEFCB
000293 0393 205A            12      JR  NZ,C_BAT
000295 0395 11E911          10      LD  DE,DATA_COM
000298 0398 CD1703          17      CALL    SETDTA
                                
00029B 039B 2A0600          16      LD  HL,(SYSTEM+1)
00029E 039E 11E911          10      LD  DE,DATA_COM
0002A1 03A1 ED52            15      SBC HL,DE
                                
0002A3 03A3 CD6903          17      CALL    S27DTA
0002A6 03A6 3D               4      DEC A
0002A7 03A7 37               4      SCF
0002A8 03A8 C0              11      RET NZ
0002A9 03A9 7C               4      LD  A,H
0002AA 03AA B5               4      OR  L
0002AB 03AB 37               4      SCF
0002AC 03AC C8              11      RET Z
0002AD 03AD 22E903          16      LD  (COMSIZ+1),HL
                                
0002B0 03B0 11E911          10      LD  DE,DATA_COM
0002B3 03B3 CD1703          17      CALL    SETDTA
0002B6 03B6 110000          10  COMPAT: LD  DE,0
0002B9 03B9 CD7F07          17      CALL    SETFCB
                                
0002BC 03BC 212D0F          10      LD  HL,N_APPEND
0002BF 03BF 11340F          10      LD  DE,V_APPEND
0002C2 03C2 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0002C4 03C4 CD0500          17      CALL    SYSTEM
                                
0002C7 03C7 0E60             7      LD  C,60H       ;(BDOS)子プロセスの起動
0002C9 03C9 CD0500          17      CALL    SYSTEM
0002CC 03CC B7               4      OR  A
0002CD 03CD 2004            12      JR  NZ,COMP1
0002CF 03CF 78               4      LD  A,B
0002D0 03D0 32E811          13      LD  (PROCESS),A
       03D3                     COMP1:
0002D3 03D3 AF               4      XOR A
0002D4 03D4 67               4      LD  H,A
0002D5 03D5 6F               4      LD  L,A ;HL=0x0000
0002D6 03D6 F3               4      DI
0002D7 03D7 ED7B0600        20  SPPAT:  LD  SP,(SYSTEM+1)
0002DB 03DB E5              11      PUSH    HL
0002DC 03DC 21EDB0          10      LD  HL,0B0EDH   ;LDIR
0002DF 03DF 22FE00          16      LD  (000FEH),HL
0002E2 03E2 21E911          10      LD  HL,DATA_COM
0002E5 03E5 110001          10      LD  DE,00100H
0002E8 03E8 010000          10  COMSIZ: LD  BC,0
0002EB 03EB FB               4      EI
0002EC 03EC C3FE00          10      JP  000FEH
                                
       03EF                     C_BAT:
0002EF 03EF 218D11          10      LD  HL,DTA_CCP+9
0002F2 03F2 3642            10      LD  (HL),'B'
0002F4 03F4 23               6      INC HL
0002F5 03F5 3641            10      LD  (HL),'A'
0002F7 03F7 23               6      INC HL
0002F8 03F8 3654            10      LD  (HL),'T'
                                
0002FA 03FA CDFF02          17      CALL    DEFCB
0002FD 03FD C0              11      RET NZ
                                
0002FE 03FE 218411          10      LD  HL,DTA_CCP
000301 0401 7E               7      LD  A,(HL)
000302 0402 B7               4      OR  A
000303 0403 2009            12      JR  NZ,CBAT_DS
000305 0405 E5              11      PUSH    HL
000306 0406 0E19             7      LD  C,019H      ;(BDOS)カレントドライブ番号の獲得(_CURDRV)
000308 0408 CD0500          17      CALL    SYSTEM
00030B 040B E1              10      POP HL
00030C 040C 3C               4      INC A
00030D 040D 77               7      LD  (HL),A
       040E                     CBAT_DS:
00030E 040E ED5BE311        20      LD  DE,(FCB_BAT)
000312 0412 012500          10      LD  BC,37
000315 0415 EDB0                    LDIR
       0417                     C_BAT1:
000317 0417 CD1403          17      CALL    SETDTA100
00031A 041A CD5804          17      CALL    FGETC_BAT
00031D 041D 218100          10      LD  HL,DTA1+1
000320 0420 202A            12      JR  NZ,END_BATCH
000322 0422 FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
000324 0424 38F1            12      JR  C,C_BAT1
000326 0426 3620            10      LD  (HL),' '
000328 0428 23               6      INC HL
       0429                     C_BAT2:
000329 0429 77               7      LD  (HL),A
00032A 042A 23               6      INC HL
00032B 042B 7D               4      LD  A,L
00032C 042C 3C               4      INC A       ;L==0FFH
00032D 042D 2809            12      JR  Z,RUN_BATCH
00032F 042F CD5804          17      CALL    FGETC_BAT
000332 0432 2004            12      JR  NZ,RUN_BATCH
000334 0434 FE20             7      CP  020H
000336 0436 30F1            12      JR  NC,C_BAT2
       0438                     RUN_BATCH:
000338 0438 7D               4      LD  A,L
000339 0439 D67F             7      SUB DTA1-1
00033B 043B 328000          13      LD  (DTA1),A
00033E 043E FE04             7      CP  4
000340 0440 380A            12      JR  C,END_BATCH
000342 0442 3600            10      LD  (HL),0
000344 0444 3A9BFC          13      LD  A,(INTFLG)
000347 0447 FE03             7      CP  3
000349 0449 C2BA01          10      JP  NZ,COMMAND2
       044C                     END_BATCH:      ;バッチファイルを閉じる
00034C 044C 2AE311          16      LD  HL,(FCB_BAT)
00034F 044F 3600            10      LD  (HL),0
000351 0451 ED7B0600        20      LD  SP,(SYSTEM+1)
000355 0455 C37F01          10      JP  WSTART
                                
       0458                     FGETC_BAT:
000358 0458 ED5BE311        20      LD  DE,(FCB_BAT)
       045C                     FGETC:              ;1文字ずつ読み込む
00035C 045C E5              11      PUSH    HL      ;Z:成功
00035D 045D 210100          10      LD  HL,1
000360 0460 CD7303          17      CALL    S27
000363 0463 E1              10      POP HL
000364 0464 3A0080          13      LD  A,(DATA)
000367 0467 C9              10      RET
                                
       0468                     C_REM:
000368 0468 AF               4      XOR A
000369 0469 C9              10      RET
                                
       046A                     C_DEL:
00036A 046A CD7F07          17      CALL    SETFCB
00036D 046D 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力
00036F 046F CD0500          17      CALL    SYSTEM
000372 0472 0600             7      LD  B,0
000374 0474 3AEB0F          13      LD  A,(MAJOR_VER)
000377 0477 FE02             7      CP  2
000379 0479 381E            12      JR  C,CDEL_DOS1
                                
00037B 047B 215C00          10      LD  HL,FCB1
00037E 047E CD4202          17      CALL    OPEN_D2
000381 0481 37               4      SCF
       0482                     DEL1:
000382 0482 C0              11      RET NZ
000383 0483 3AFA0F          13      LD  A,(SEARCH_IX+14);   (FIB)属性
000386 0486 CB67             8      BIT 4,A
000388 0488 200A            12      JR  NZ,DEL2
                                
00038A 048A 11EC0F          10      LD  DE,SEARCH_IX
00038D 048D 0E4D             7      LD  C,04DH      ;(BDOS)ファイル・サブディレクトリの削除(_DELETE)
00038F 048F CD2B03          17      CALL    SYSTEM0
000392 0492 37               4      SCF
000393 0493 C0              11      RET NZ
       0494                     DEL2:
000394 0494 CDA802          17      CALL    OPEN2_D2
000397 0497 18E9            12      JR  DEL1
                                
       0499                     CDEL_DOS1:
000399 0499 0E13             7      LD  C,013H
00039B 049B 1811            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       049D                     C_REN:
00039D 049D 3AEB0F          13      LD  A,(MAJOR_VER)
0003A0 04A0 FE02             7      CP  2
0003A2 04A2 3013            12      JR  NC,REN_DOS2
0003A4 04A4 CD7F07          17      CALL    SETFCB
0003A7 04A7 3E10             7      LD  A,010H      ;ディレクトリも対象にする(LSX-Dodgers)
0003A9 04A9 326900          13      LD  (FCB1+13),A ;属性
0003AC 04AC 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       04AE                     CDEL1:
0003AE 04AE 115C00          10      LD  DE,FCB1
       04B1                     REN2:
0003B1 04B1 CD0500          17      CALL    SYSTEM
0003B4 04B4 C6FF             7      ADD A,0FFH
0003B6 04B6 C9              10      RET
                                
       04B7                     REN_DOS2:           ;DOS2のリネーム(ディレクトリ対応)
0003B7 04B7 CD0F0B          17      CALL    SPCUT
0003BA 04BA 6B               4      LD  L,E
0003BB 04BB 62               4      LD  H,D
       04BC                     REN_D2_1:
0003BC 04BC 7E               7      LD  A,(HL)
0003BD 04BD FE21             7      CP  020H+1
0003BF 04BF 3803            12      JR  C,REN_D2_2
0003C1 04C1 23               6      INC HL
0003C2 04C2 18F8            12      JR  REN_D2_1
       04C4                     REN_D2_2:
0003C4 04C4 3600            10      LD  (HL),0
0003C6 04C6 23               6      INC HL
0003C7 04C7 0E4E             7      LD  C,04EH      ;(BDOS)ファイルあるいはサブディレクトリ名の変更(_RENAME)
0003C9 04C9 18E6            12      JR  REN2
                                
       04CB                     C_DIR:
0003CB 04CB CD040A          17      CALL    FILEC_D2
0003CE 04CE 21BD11          10      LD  HL,FDRV+1
0003D1 04D1 CDC509          17      CALL    CWILD1
0003D4 04D4 3EF1             7      LD  A,0F1H
0003D6 04D6 32C911          13      LD  (FDRV+13),A
0003D9 04D9 CD4E02          17      CALL    OPEN1_D2
       04DC                     CDIR1:
0003DC 04DC B7               4      OR  A
0003DD 04DD 2008            12      JR  NZ,PDSKF
0003DF 04DF CD6205          17      CALL    P_NAME
0003E2 04E2 CDA802          17      CALL    OPEN2_D2
0003E5 04E5 18F5            12      JR  CDIR1
                                
       04E7                     PDSKF:
0003E7 04E7 3ABC11          13      LD  A,(FDRV)
0003EA 04EA 5F               4      LD  E,A
0003EB 04EB 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0003ED 04ED CD0500          17      CALL    SYSTEM
0003F0 04F0 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0003F1 04F1 C601             7      ADD A,001H
0003F3 04F3 D8              11      RET C       ;Aが0FFHだった場合
0003F4 04F4 3E06             7      LD  A,8-2
       04F6                     PDS1:               ;HL=未使用クラスタの総数
0003F6 04F6 3C               4      INC A
0003F7 04F7 CB19             8      RR  C
0003F9 04F9 30FB            12      JR  NC,PDS1
       04FB                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0003FB 04FB 3C               4      INC A
0003FC 04FC CB18             8      RR  B
0003FE 04FE 30FB            12      JR  NC,PDS2
000400 0500 47               4      LD  B,A
                                
000401 0501 110000          10      LD  DE,0
       0504                     PDS3:
000404 0504 29              11      ADD HL,HL
000405 0505 EB               4      EX  DE,HL
000406 0506 ED6A            15      ADC HL,HL
000408 0508 EB               4      EX  DE,HL
000409 0509 10F9            13      DJNZ    PDS3
       050B                     PDSKF1:
00040B 050B CDF005          17      CALL    PRDEC_DEHL
00040E 050E 11C10E          10      LD  DE,FREE
000411 0511 0E09             7      LD  C,9     ;(BDOS)文字列出力
000413 0513 CD0500          17      CALL    SYSTEM
000416 0516 CDD005          17      CALL    PUTDRV
000419 0519 3E5C             7      LD  A,05CH      ;\
00041B 051B CDF109          17      CALL    MSG_A
00041E 051E 3AEB0F          13      LD  A,(MAJOR_VER)
000421 0521 FE01             7      CP  1
000423 0523 3865            12      JR  C,LTNL
000425 0525 200E            12      JR  NZ,PDSKF2
000427 0527 2ACA11          16      LD  HL,(FDRV+14)
00042A 052A AF               4      XOR A
00042B 052B 11FEFF          10      LD  DE,0-2
00042E 052E 19              11      ADD HL,DE
00042F 052F 23               6      INC HL
000430 0530 DCEC05          17      CALL    C,PRDEC_HL
000433 0533 1855            12      JR  LTNL
       0535                     PDSKF2:             ;MSX-DOS2
000435 0535 3ABC11          13      LD  A,(FDRV)
000438 0538 47               4      LD  B,A     ;ドライブ
000439 0539 110080          10      LD  DE,DATA
00043C 053C 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
00043E 053E CD0500          17      CALL    SYSTEM
000441 0541 210080          10      LD  HL,DATA
                                
000444 0544 CD4C05          17      CALL    MSX
000447 0547 1841            12      JR  LTNL
                                
       0549                     MSX1:
000449 0549 CDF109          17      CALL    MSG_A
       054C                     MSX:
00044C 054C 7E               7      LD  A,(HL)
00044D 054D 23               6      INC HL
00044E 054E B7               4      OR  A
00044F 054F 20F8            12      JR  NZ,MSX1
000451 0551 C9              10      RET
                                
       0552                     MSXSLT1:
000452 0552 CDF109          17      CALL    MSG_A
       0555                     MSXSLT:
000455 0555 C5              11      PUSH    BC
000456 0556 E5              11      PUSH    HL
000457 0557 78               4      LD  A,B
000458 0558 CD0C00          17      CALL    RDSLT
00045B 055B E1              10      POP HL
00045C 055C C1              10      POP BC
00045D 055D 23               6      INC HL
00045E 055E B7               4      OR  A
00045F 055F 20F1            12      JR  NZ,MSXSLT1
000461 0561 C9              10      RET
                                
       0562                     P_NAME:
000462 0562 218511          10      LD  HL,DTA_CCP+1
000465 0565 7E               7      LD  A,(HL)
000466 0566 FE2E             7      CP  '.'
000468 0568 C8              11      RET Z
000469 0569 CD4606          17      CALL    FPRNT
00046C 056C 3A9011          13      LD  A,(DTA_CCP+12)
00046F 056F CB67             8      BIT 4,A
000471 0571 280A            12      JR  Z,DIR3
000473 0573 11CF0E          10      LD  DE,DIRMES
000476 0576 0E09             7      LD  C,9     ;(BDOS)文字列出力
000478 0578 CD0500          17      CALL    SYSTEM
00047B 057B 180A            12      JR  DIR6
       057D                     DIR3:
00047D 057D ED5BA311        20      LD  DE,(DTA_CCP+1+01EH)
000481 0581 2AA111          16      LD  HL,(DTA_CCP+1+01CH)
000484 0584 CDF005          17      CALL    PRDEC_DEHL
       0587                     DIR6:
000487 0587 CD6806          17      CALL    PRTTMS
                                
       058A                     LTNL:
00048A 058A 1E0D             7      LD  E,00DH
00048C 058C CDE009          17      CALL    _PRINT
00048F 058F 1E0A             7      LD  E,00AH
000491 0591 C3E009          10      JP  _PRINT
                                
       0594                     C_PATH:
000494 0594 CD0F0B          17      CALL    SPCUT
000497 0597 FE21             7      CP  021H
000499 0599 301C            12      JR  NC,CPATH0
                                
00049B 059B 21740F          10      LD  HL,N_PATH
00049E 059E 11790F          10      LD  DE,V_PATH
0004A1 05A1 0640             7      LD  B,PATHX
0004A3 05A3 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
0004A5 05A5 CD0500          17      CALL    SYSTEM
0004A8 05A8 21790F          10      LD  HL,V_PATH
       05AB                     CPATHP:
0004AB 05AB 7E               7      LD  A,(HL)
0004AC 05AC 23               6      INC HL
0004AD 05AD FE20             7      CP  020H
0004AF 05AF 3F               4      CCF
0004B0 05B0 30D8            12      JR  NC,LTNL
0004B2 05B2 CDF109          17      CALL    MSG_A
0004B5 05B5 18F4            12      JR  CPATHP
       05B7                     CPATH0:
0004B7 05B7 21790F          10      LD  HL,V_PATH
0004BA 05BA FE3B             7      CP  ';'
0004BC 05BC 2001            12      JR  NZ,CPATH1
0004BE 05BE 13               6      INC DE
       05BF                     CPATH1:
0004BF 05BF EB               4      EX  DE,HL
0004C0 05C0 014000          10      LD  BC,PATHX
0004C3 05C3 EDB0                    LDIR
                                
0004C5 05C5 21740F          10      LD  HL,N_PATH
0004C8 05C8 11790F          10      LD  DE,V_PATH
0004CB 05CB 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0004CD 05CD C30500          10      JP  SYSTEM
                                
       05D0                     PUTDRV:
0004D0 05D0 3ABC11          13      LD  A,(FDRV)
0004D3 05D3 B7               4      OR  A
0004D4 05D4 200C            12      JR  NZ,PUTDRV1
0004D6 05D6 C5              11      PUSH    BC
0004D7 05D7 D5              11      PUSH    DE
0004D8 05D8 E5              11      PUSH    HL
0004D9 05D9 0E19             7      LD  C,019H
0004DB 05DB CD0500          17      CALL    SYSTEM
0004DE 05DE E1              10      POP HL
0004DF 05DF D1              10      POP DE
0004E0 05E0 C1              10      POP BC
0004E1 05E1 3C               4      INC A
       05E2                     PUTDRV1:
0004E2 05E2 C640             7      ADD A,'A'-1
0004E4 05E4 CDF109          17      CALL    MSG_A
0004E7 05E7 3E3A             7      LD  A,':'
       05E9                     MSG_AR:
0004E9 05E9 C3F109          10      JP  MSG_A
                                
       05EC                     PRDEC_HL:
0004EC 05EC AF               4      XOR A
       05ED                     PRDEC_AHL:
0004ED 05ED 5F               4      LD  E,A
0004EE 05EE 1600             7      LD  D,0
       05F0                     PRDEC_DEHL:
0004F0 05F0 3E02             7      LD  A,2
0004F2 05F2 323B06          13      LD  (DEC6+1),A
0004F5 05F5 AF               4      XOR A
0004F6 05F6 E5              11      PUSH    HL
0004F7 05F7 21B611          10      LD  HL,DECBF
0004FA 05FA 0605             7      LD  B,5
0004FC 05FC CDD60A          17      CALL    FILL_MEMORY
0004FF 05FF E1              10      POP HL
                                
000500 0600 0E20             7      LD  C,32
       0602                     DEC1:
000502 0602 29              11      ADD HL,HL
000503 0603 EB               4      EX  DE,HL
000504 0604 ED6A            15      ADC HL,HL
000506 0606 EB               4      EX  DE,HL
000507 0607 E5              11      PUSH    HL
000508 0608 21BA11          10      LD  HL,DECBF+4
00050B 060B 0605             7      LD  B,5
       060D                     DEC2:
00050D 060D 7E               7      LD  A,(HL)
00050E 060E 8F               4      ADC A,A
00050F 060F 27               4      DAA
000510 0610 77               7      LD  (HL),A
000511 0611 2B               6      DEC HL
000512 0612 10F9            13      DJNZ    DEC2
000514 0614 E1              10      POP HL
000515 0615 0D               4      DEC C
000516 0616 20EA            12      JR  NZ,DEC1
                                
000518 0618 21B611          10      LD  HL,DECBF
00051B 061B 3E20             7      LD  A,020H
00051D 061D 0604             7      LD  B,4
       061F                     DEC3:
00051F 061F CD2C06          17      CALL    DEC4
000522 0622 CD2C06          17      CALL    DEC4
000525 0625 23               6      INC HL
000526 0626 10F7            13      DJNZ    DEC3
       0628                     DECX:
000528 0628 CD2C06          17      CALL    DEC4
00052B 062B AF               4      XOR A
       062C                     DEC4:
00052C 062C ED6F            18      RLD
00052E 062E FE20             7      CP  020H
000530 0630 2808            12      JR  Z,DEC6
000532 0632 F630             7      OR  030H
       0634                     DEC5:
000534 0634 18B3            12      JR  MSG_AR
       0636                     DEC7:
000536 0636 3E20             7      LD  A,020H
000538 0638 18AF            12      JR  MSG_AR
       063A                     DEC6:
00053A 063A 3E02             7      LD  A,2
00053C 063C B7               4      OR  A
00053D 063D 28F7            12      JR  Z,DEC7
00053F 063F 3D               4      DEC A
000540 0640 323B06          13      LD  (DEC6+1),A
000543 0643 3E20             7      LD  A,020H
000545 0645 C9              10      RET
                                
       0646                     FPRNT:
000546 0646 0608             7      LD  B,8
000548 0648 CD5906          17      CALL    P_N1
00054B 064B 7E               7      LD  A,(HL)
00054C 064C C680             7      ADD A,0A0H-020H
00054E 064E FEA0             7      CP  0A0H
000550 0650 2802            12      JR  Z,FPR1
000552 0652 3E2E             7      LD  A,'.'
       0654                     FPR1:
000554 0654 CDF109          17      CALL    MSG_A
000557 0657 0603             7      LD  B,3
                                
       0659                     P_N1:
000559 0659 C5              11      PUSH    BC
00055A 065A E5              11      PUSH    HL
00055B 065B 7E               7      LD  A,(HL)
00055C 065C CD2E0B          17      CALL    CAP3
00055F 065F CDF109          17      CALL    MSG_A
000562 0662 E1              10      POP HL
000563 0663 C1              10      POP BC
000564 0664 23               6      INC HL
000565 0665 10F2            13      DJNZ    P_N1
000567 0667 C9              10      RET
                                
       0668                     PRTTMS:
000568 0668 3E20             7      LD  A,020H
00056A 066A CDF109          17      CALL    MSG_A
                                
00056D 066D 2A9D11          16      LD  HL,(DTA_CCP+1+24)
000570 0670 7D               4      LD  A,L
000571 0671 B7               4      OR  A
000572 0672 C8              11      RET Z
000573 0673 CB3C             8      SRL H
000575 0675 17               4      RLA
000576 0676 17               4      RLA
000577 0677 17               4      RLA
000578 0678 17               4      RLA
000579 0679 E60F             7      AND 00FH
00057B 067B 57               4      LD  D,A
00057C 067C DD21BE0F        14      LD  IX,V_DATE
       0680                     PRTTMS1:
000580 0680 DD7E00          19      LD  A,(IX+0)
000583 0683 B7               4      OR  A
000584 0684 2808            12      JR  Z,PRTTMS2
000586 0686 CD0907          17      CALL    PR_DATE
000589 0689 CD7407          17      CALL    PR_DATE_SPLITER
00058C 068C 18F2            12      JR  PRTTMS1
       068E                     PRTTMS2:
                                
00058E 068E CD0D0C          17      CALL    GET_WIDTH
000591 0691 FE21             7      CP  32+1
000593 0693 3005            12      JR  NC,SHOW_TIME
000595 0695 3E1D             7      LD  A,01DH
000597 0697 C3F109          10      JP  MSG_A
       069A                     SHOW_TIME:
00059A 069A 2A9B11          16      LD  HL,(DTA_CCP+1+22)
                                
00059D 069D 3E20             7      LD  A,020H
00059F 069F CDF109          17      CALL    MSG_A
0005A2 06A2 7C               4      LD  A,H
0005A3 06A3 65               4      LD  H,L
0005A4 06A4 1F               4      RRA
0005A5 06A5 CB1D             8      RR  L
0005A7 06A7 1F               4      RRA
0005A8 06A8 CB1D             8      RR  L
0005AA 06AA 1F               4      RRA
0005AB 06AB CB1D             8      RR  L
0005AD 06AD E61F             7      AND 01FH
0005AF 06AF 4F               4      LD  C,A
0005B0 06B0 3AE30F          13      LD  A,(V_TIME)
0005B3 06B3 FE31             7      CP  '1'
0005B5 06B5 79               4      LD  A,C
0005B6 06B6 200B            12      JR  NZ,TIME24
0005B8 06B8 FE0C             7      CP  12
0005BA 06BA 3802            12      JR  C,TIME12
0005BC 06BC D60C             7      SUB 12
       06BE                     TIME12:
0005BE 06BE B7               4      OR  A
0005BF 06BF 2002            12      JR  NZ,TIME24
0005C1 06C1 C60C             7      ADD A,12
       06C3                     TIME24:
0005C3 06C3 C5              11      PUSH    BC
0005C4 06C4 CDF406          17      CALL    PRDEC_A
0005C7 06C7 3E3A             7      LD  A,':'
0005C9 06C9 CDF109          17      CALL    MSG_A
0005CC 06CC 7D               4      LD  A,L
0005CD 06CD 0F               4      RRCA
0005CE 06CE 0F               4      RRCA
0005CF 06CF E63F             7      AND 03FH
0005D1 06D1 CDF406          17      CALL    PRDEC_A
                                
0005D4 06D4 3E3A             7      LD  A,':'
0005D6 06D6 CDF109          17      CALL    MSG_A
0005D9 06D9 7C               4      LD  A,H
0005DA 06DA E61F             7      AND 01FH
0005DC 06DC 87               4      ADD A,A
0005DD 06DD CDF406          17      CALL    PRDEC_A
                                
0005E0 06E0 3AE30F          13      LD  A,(V_TIME)
0005E3 06E3 FE31             7      CP  '1'
0005E5 06E5 C1              10      POP BC
0005E6 06E6 C0              11      RET NZ
0005E7 06E7 79               4      LD  A,C
0005E8 06E8 1E61             7      LD  E,'a'
0005EA 06EA FE0C             7      CP  12
0005EC 06EC DAE009          10      JP  C,_PRINT
0005EF 06EF 1E70             7      LD  E,'p'
0005F1 06F1 C3E009          10      JP  _PRINT
                                
                                ;   PRINT10
                                
       06F4                     PRDEC_A:
0005F4 06F4 E5              11      PUSH    HL
0005F5 06F5 0608             7      LD  B,8
0005F7 06F7 4F               4      LD  C,A
0005F8 06F8 AF               4      XOR A
       06F9                     PRTA1:
0005F9 06F9 CB01             4      RLC C
0005FB 06FB 8F               4      ADC A,A
0005FC 06FC 27               4      DAA
0005FD 06FD 10FA            13      DJNZ    PRTA1
0005FF 06FF 21B611          10      LD  HL,DECBF
000602 0702 77               7      LD  (HL),A
000603 0703 AF               4      XOR A
000604 0704 CD2806          17      CALL    DECX
000607 0707 E1              10      POP HL
000608 0708 C9              10      RET
                                
       0709                     PR_DATE:
000609 0709 DD7E00          19      LD  A,(IX+0)
00060C 070C FE20             7      CP  020H
00060E 070E D8              11      RET C
00060F 070F CD220B          17      CALL    CAP
000612 0712 FE44             7      CP  'D'
000614 0714 2848            12      JR  Z,PR_DAY
000616 0716 FE4D             7      CP  'M'
000618 0718 2820            12      JR  Z,PR_MONTH
00061A 071A FE59             7      CP  'Y'
00061C 071C 2046            12      JR  NZ,PR_DATE1
00061E 071E 4F               4      LD  C,A
00061F 071F DD7E02          19      LD  A,(IX+2)
000622 0722 CD220B          17      CALL    CAP
000625 0725 B9               4      CP  C
000626 0726 200A            12      JR  NZ,YEAR2
000628 0728 7C               4      LD  A,H     ;YEAR
000629 0729 C6EC             7      ADD A,80+256-100
00062B 072B 3E13             7      LD  A,19
00062D 072D CE00             7      ADC A,0
00062F 072F CDF406          17      CALL    PRDEC_A     ;年4桁
       0732                     YEAR2:
000632 0732 7C               4      LD  A,H     ;YEAR
000633 0733 C650             7      ADD A,80
000635 0735 CDF406          17      CALL    PRDEC_A
000638 0738 182A            12      JR  PR_DATE1
       073A                     PR_MONTH:
00063A 073A 4F               4      LD  C,A
00063B 073B DD7E02          19      LD  A,(IX+2)
00063E 073E CD220B          17      CALL    CAP
000641 0741 B9               4      CP  C
000642 0742 2014            12      JR  NZ,MONTH2
000644 0744 E5              11      PUSH    HL      ;月を文字列で表示 Jan等
000645 0745 D5              11      PUSH    DE
000646 0746 7A               4      LD  A,D
000647 0747 3D               4      DEC A
000648 0748 87               4      ADD A,A
000649 0749 87               4      ADD A,A
00064A 074A 21FD0E          10      LD  HL,S_MONTH
00064D 074D 1600             7      LD  D,0
00064F 074F 5F               4      LD  E,A
000650 0750 19              11      ADD HL,DE
000651 0751 CD4C05          17      CALL    MSX
000654 0754 D1              10      POP DE
000655 0755 E1              10      POP HL
000656 0756 180C            12      JR  PR_DATE1
       0758                     MONTH2:
000658 0758 7A               4      LD  A,D     ;月を数字で表示
000659 0759 CDF406          17      CALL    PRDEC_A
00065C 075C 1806            12      JR  PR_DATE1
       075E                     PR_DAY:
00065E 075E 7D               4      LD  A,L
00065F 075F E61F             7      AND 01FH
000661 0761 CDF406          17      CALL    PRDEC_A
       0764                     PR_DATE1:
000664 0764 DD23            10      INC IX
000666 0766 DD7E00          19      LD  A,(IX+0)
000669 0769 CD220B          17      CALL    CAP
00066C 076C FE41             7      CP  'A'
00066E 076E D8              11      RET C
00066F 076F FE5B             7      CP  'Z'+1
000671 0771 38F1            12      JR  C,PR_DATE1
000673 0773 C9              10      RET
       0774                     PR_DATE_SPLITER:
000674 0774 DD7E00          19      LD  A,(IX+0)
000677 0777 FE20             7      CP  020H
000679 0779 D8              11      RET C
00067A 077A DD23            10      INC IX
00067C 077C C3F109          10      JP  MSG_A
                                
       077F                     SETFCB:
00067F 077F CD0F0B          17      CALL    SPCUT
000682 0782 1A               7      LD  A,(DE)
000683 0783 FE20             7      CP  020H
000685 0785 3801            12      JR  C,SETFCBA
000687 0787 1B               6      DEC DE
       0788                     SETFCBA:
000688 0788 D5              11      PUSH    DE
000689 0789 215C00          10      LD  HL,FCB1
00068C 078C 115D00          10      LD  DE,FCB1+1
00068F 078F 012300          10      LD  BC,00023H
000692 0792 70               7      LD  (HL),B      ;B=0
000693 0793 EDB0                    LDIR
000695 0795 D1              10      POP DE
000696 0796 D5              11      PUSH    DE
000697 0797 215C00          10      LD  HL,FCB1
00069A 079A DD21B310        14      LD  IX,PATH_FN1
00069E 079E CDB30B          17      CALL    _SYS29      ;ファイル名の解析
0006A1 07A1 216C00          10      LD  HL,FCB2
0006A4 07A4 DD21F310        14      LD  IX,PATH_FN2
0006A8 07A8 CDB30B          17      CALL    _SYS29      ;ファイル名の解析
0006AB 07AB E1              10      POP HL
0006AC 07AC 010050          10      LD  BC,05000H
0006AF 07AF 118100          10      LD  DE,00081H
       07B2                     SETFCB1:
0006B2 07B2 7E               7      LD  A,(HL)
0006B3 07B3 23               6      INC HL
0006B4 07B4 FE20             7      CP  020H
0006B6 07B6 3805            12      JR  C,SETFCB2
0006B8 07B8 12               7      LD  (DE),A
0006B9 07B9 13               6      INC DE
0006BA 07BA 0C               4      INC C
0006BB 07BB 10F5            13      DJNZ    SETFCB1
       07BD                     SETFCB2:
0006BD 07BD 79               4      LD  A,C
0006BE 07BE 328000          13      LD  (DTA1),A
0006C1 07C1 04               4      INC B
0006C2 07C2 AF               4      XOR A
       07C3                     SETFCB3:
0006C3 07C3 12               7      LD  (DE),A
0006C4 07C4 13               6      INC DE
0006C5 07C5 10FC            13      DJNZ    SETFCB3
0006C7 07C7 C9              10      RET
                                
       07C8                     C_COPY:
0006C8 07C8 CD7F07          17      CALL    SETFCB
0006CB 07CB 3AEB0F          13      LD  A,(MAJOR_VER)
0006CE 07CE FE02             7      CP  2
0006D0 07D0 3810            12      JR  C,COPYI0
0006D2 07D2 11F310          10      LD  DE,PATH_FN2
0006D5 07D5 CD200C          17      CALL    IS_FOLDER
0006D8 07D8 3808            12      JR  C,COPYI0
0006DA 07DA 21BD11          10      LD  HL,FDRV+1
0006DD 07DD 060B             7      LD  B,8+3
0006DF 07DF CDD40A          17      CALL    FILE10
       07E2                     COPYI0:
0006E2 07E2 3ABC11          13      LD  A,(FDRV)
0006E5 07E5 47               4      LD  B,A
0006E6 07E6 B7               4      OR  A
0006E7 07E7 200B            12      JR  NZ,COPYI1
0006E9 07E9 C5              11      PUSH    BC
0006EA 07EA 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
0006EC 07EC CD0500          17      CALL    SYSTEM
0006EF 07EF 3C               4      INC A
0006F0 07F0 32BC11          13      LD  (FDRV),A
0006F3 07F3 C1              10      POP BC
       07F4                     COPYI1:
0006F4 07F4 C640             7      ADD A,040H
0006F6 07F6 323311          13      LD  (CUR_DRV),A
0006F9 07F9 113611          10      LD  DE,CUR_PATH
0006FC 07FC 0E59             7      LD  C,059H      ;(BDOS)カレントディレクトリの獲得(_GETCD)
0006FE 07FE CD0500          17      CALL    SYSTEM
000701 0801 CD1308          17      CALL    COPYSUB
       0804                     RES_CUR_PATH:
000704 0804 113311          10      LD  DE,CUR_DRV
       0807                     SET_CUR_PATH:
000707 0807 F5              11      PUSH    AF
000708 0808 3ABC11          13      LD  A,(FDRV)
00070B 080B 47               4      LD  B,A
00070C 080C 0E5A             7      LD  C,05AH      ;(BDOS)カレントディレクトリの変更(_CHDIR)
00070E 080E CD0500          17      CALL    SYSTEM
000711 0811 F1              10      POP AF
000712 0812 C9              10      RET
       0813                     COPYSUB:
000713 0813 11E211          10      LD  DE,ZERO
000716 0816 CD2A0A          17      CALL    FILEC2
000719 0819 216C00          10      LD  HL,FCB2
00071C 081C CDF70B          17      CALL    S29X1
                                
00071F 081F 3E10             7      LD  A,010H
000721 0821 326900          13      LD  (FCB1+13),A
000724 0824 216D00          10      LD  HL,FCB2+1
000727 0827 CDC509          17      CALL    CWILD1
       082A                     COPY0:
00072A 082A CDC209          17      CALL    CWILD
00072D 082D 215C00          10      LD  HL,FCB1
000730 0830 CD4202          17      CALL    OPEN_D2
000733 0833 37               4      SCF
       0834                     COPY1:
000734 0834 C0              11      RET NZ
000735 0835 CDBE02          17      CALL    DEFCB_D2
                                
000738 0838 3A9011          13      LD  A,(DTA_CCP+12)
00073B 083B CB67             8      BIT 4,A
00073D 083D 2821            12      JR  Z,COPY1A
                                
00073F 083F 215D00          10      LD  HL,FCB1+1
000742 0842 CD5B0B          17      CALL    CHKWILD
000745 0845 3811            12      JR  C,COPY9
                                
000747 0847 3E20             7      LD  A,020H
000749 0849 325D00          13      LD  (FCB1+1),A
00074C 084C 2A9E11          16      LD  HL,(DTA_CCP+26)
00074F 084F 23               6      INC HL
000750 0850 226A00          16      LD  (FCB1+14),HL
000753 0853 18D5            12      JR  COPY0
                                
       0855                     COPY8:
000755 0855 CDBA0C          17      CALL    SHOW_OK
       0858                     COPY9:
000758 0858 CD0408          17      CALL    RES_CUR_PATH
00075B 085B CDA802          17      CALL    OPEN2_D2
00075E 085E 18D4            12      JR  COPY1
                                
       0860                     COPY1A:
000760 0860 216C00          10      LD  HL,FCB2
000763 0863 11BC11          10      LD  DE,FDRV
000766 0866 018611          10      LD  BC,DTA_CCP+2
000769 0869 EDA0            16      LDI
00076B 086B 3E0B             7      LD  A,11
       086D                     COPY2:
00076D 086D F5              11      PUSH    AF
00076E 086E 7E               7      LD  A,(HL)
00076F 086F FE3F             7      CP  '?'
000771 0871 2001            12      JR  NZ,COPY3
000773 0873 0A               7      LD  A,(BC)
       0874                     COPY3:
000774 0874 12               7      LD  (DE),A
000775 0875 03               6      INC BC
000776 0876 13               6      INC DE
000777 0877 23               6      INC HL
000778 0878 F1              10      POP AF
000779 0879 3D               4      DEC A
00077A 087A 20F1            12      JR  NZ,COPY2
00077C 087C 010500          10      LD  BC,16-11
00077F 087F EDB0                    LDIR
       0881                     PUTNAME:
000781 0881 215D00          10      LD  HL,FCB1+1
000784 0884 CD5B0B          17      CALL    CHKWILD
000787 0887 300B            12      JR  NC,PUTN1
000789 0889 21BD11          10      LD  HL,FDRV+1
00078C 088C CD4606          17      CALL    FPRNT
00078F 088F 3E20             7      LD  A,020H
000791 0891 CDF109          17      CALL    MSG_A
       0894                     PUTN1:
000794 0894 11F310          10      LD  DE,PATH_FN2
000797 0897 CD0708          17      CALL    SET_CUR_PATH
                                
00079A 089A 11BC11          10      LD  DE,FDRV
00079D 089D 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
00079F 089F CD2B03          17      CALL    SYSTEM0
0007A2 08A2 C24309          10      JP  NZ,COPYE2
0007A5 08A5 67               4      LD  H,A     ;A=0
0007A6 08A6 6F               4      LD  L,A
0007A7 08A7 22DD11          16      LD  (FDRV+33),HL    ;(FCB)ランダム・レコード
0007AA 08AA 22DF11          16      LD  (FDRV+35),HL
0007AD 08AD 2C               4      INC L       ;HL=1
0007AE 08AE 22CA11          16      LD  (FDRV+14),HL    ;(FCB)レコード・サイズ
       08B1                     COPY6:
0007B1 08B1 CDD409          17      CALL    BUFSIZ
0007B4 08B4 CD4B03          17      CALL    S27DTA_D2
0007B7 08B7 3C               4      INC A
0007B8 08B8 CA3209          10      JP  Z,COPYE
0007BB 08BB 47               4      LD  B,A
0007BC 08BC 7C               4      LD  A,H
0007BD 08BD B5               4      OR  L
0007BE 08BE 280F            12      JR  Z,COPY7
0007C0 08C0 11BC11          10      LD  DE,FDRV
0007C3 08C3 C5              11      PUSH    BC
0007C4 08C4 0E26             7      LD  C,026H      ;(BDOS)ランダム・ブロック・ライト
0007C6 08C6 CD0500          17      CALL    SYSTEM
0007C9 08C9 C1              10      POP BC
0007CA 08CA B7               4      OR  A
0007CB 08CB 2065            12      JR  NZ,COPYE
0007CD 08CD 10E2            13      DJNZ    COPY6
       08CF                     COPY7:
0007CF 08CF 3AEB0F          13      LD  A,(MAJOR_VER)
0007D2 08D2 FE02             7      CP  2
0007D4 08D4 3011            12      JR  NC,COPY7_MSX2   ;DOS2はFCBの仕様が違う
0007D6 08D6 3A9111          13      LD  A,(DTA_CCP+13)  ;(FCB)属性(アトリビュート)
0007D9 08D9 32C911          13      LD  (FDRV+13),A ;(FCB)属性(アトリビュート)
0007DC 08DC 219811          10      LD  HL,DTA_CCP+20
0007DF 08DF 11D011          10      LD  DE,FDRV+20  ;(FCB)更新日時
0007E2 08E2 010400          10      LD  BC,4
0007E5 08E5 EDB0                    LDIR
       08E7                     COPY7_MSX2:
0007E7 08E7 11BC11          10      LD  DE,FDRV
0007EA 08EA 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0007EC 08EC CD2B03          17      CALL    SYSTEM0
                                
0007EF 08EF 2041            12      JR  NZ,COPYE
0007F1 08F1 3AEB0F          13      LD  A,(MAJOR_VER)
0007F4 08F4 FE02             7      CP  2
0007F6 08F6 3837            12      JR  C,COPY_DOS2DT
                                
0007F8 08F8 ED4B2C10        20      LD  BC,(HANDLE1)
0007FC 08FC 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
0007FE 08FE CD0500          17      CALL    SYSTEM
                                
000801 0901 11F310          10      LD  DE,PATH_FN2
000804 0904 CD0708          17      CALL    SET_CUR_PATH
                                
000807 0907 11BC11          10      LD  DE,FDRV
00080A 090A 217611          10      LD  HL,DOS2NAME
00080D 090D CD4509          17      CALL    FCB2FNAME
                                
000810 0910 3AFA0F          13      LD  A,(SEARCH_IX+14);   (FIB)属性
000813 0913 6F               4      LD  L,A
000814 0914 117611          10      LD  DE,DOS2NAME
000817 0917 3E01             7      LD  A,1
000819 0919 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
00081B 091B CD2B03          17      CALL    SYSTEM0
                                
00081E 091E DD2AFB0F        20      LD  IX,(SEARCH_IX+15)   ;(FIB)更新時間
000822 0922 2AFD0F          16      LD  HL,(SEARCH_IX+17)   ;(FIB)更新日
000825 0925 117611          10      LD  DE,DOS2NAME
000828 0928 3E01             7      LD  A,1
00082A 092A 0E51             7      LD  C,51H       ;(BDOS)_FTIME ファイルの日付および時刻の獲得・設定
00082C 092C CD2B03          17      CALL    SYSTEM0
       092F                     COPY_DOS2DT:
00082F 092F C35508          10      JP  COPY8
                                
       0932                     COPYE:
000832 0932 ED4B2C10        20      LD  BC,(HANDLE1)
000836 0936 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
000838 0938 CD0500          17      CALL    SYSTEM
00083B 093B 11BC11          10      LD  DE,FDRV
00083E 093E 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
000840 0940 CD0500          17      CALL    SYSTEM
       0943                     COPYE2:
000843 0943 37               4      SCF
000844 0944 C9              10      RET
                                
       0945                     FCB2FNAME:
000845 0945 1A               7      LD  A,(DE)
000846 0946 13               6      INC DE
000847 0947 C640             7      ADD A,040H
000849 0949 77               7      LD  (HL),A
00084A 094A 23               6      INC HL
00084B 094B 363A            10      LD  (HL),':'
00084D 094D 23               6      INC HL
                                
00084E 094E 0608             7      LD  B,8
       0950                     FCB2FNAME1:
000850 0950 1A               7      LD  A,(DE)
000851 0951 FE21             7      CP  020H+1
000853 0953 3807            12      JR  C,FCB2FNAME2
000855 0955 13               6      INC DE
000856 0956 77               7      LD  (HL),A
000857 0957 23               6      INC HL
000858 0958 10F6            13      DJNZ    FCB2FNAME1
00085A 095A 1803            12      JR  FCB2FNAME3
       095C                     FCB2FNAME2:
00085C 095C 13               6      INC DE
00085D 095D 10FD            13      DJNZ    FCB2FNAME2
       095F                     FCB2FNAME3:
00085F 095F 1A               7      LD  A,(DE)
000860 0960 FE21             7      CP  020H+1
000862 0962 380F            12      JR  C,FCB2FNAME5
000864 0964 362E            10      LD  (HL),'.'
000866 0966 23               6      INC HL
000867 0967 0603             7      LD  B,3
       0969                     FCB2FNAME4:
000869 0969 1A               7      LD  A,(DE)
00086A 096A 13               6      INC DE
00086B 096B FE21             7      CP  020H+1
00086D 096D 3804            12      JR  C,FCB2FNAME5
00086F 096F 77               7      LD  (HL),A
000870 0970 23               6      INC HL
000871 0971 10F6            13      DJNZ    FCB2FNAME4
       0973                     FCB2FNAME5:
000873 0973 3600            10      LD  (HL),0
000875 0975 C9              10      RET
                                
       0976                     C_TYPE:
000876 0976 CD7F07          17      CALL    SETFCB
000879 0979 215C00          10      LD  HL,FCB1
00087C 097C CD4202          17      CALL    OPEN_D2
00087F 097F 37               4      SCF
       0980                     TYPE1:
000880 0980 C0              11      RET NZ
000881 0981 CDBE02          17      CALL    DEFCB_D2
000884 0984 3E1A             7      LD  A,01AH
000886 0986 CDF109          17      CALL    MSG_A
       0989                     TYPE2:
000889 0989 CDD409          17      CALL    BUFSIZ
00088C 098C CD4B03          17      CALL    S27DTA_D2
00088F 098F C6FE             7      ADD A,0FEH
000891 0991 D8              11      RET C
000892 0992 7C               4      LD  A,H
000893 0993 B5               4      OR  L
000894 0994 281A            12      JR  Z,TYPEE
000896 0996 010080          10      LD  BC,DATA
       0999                     TYPE3:
000899 0999 0A               7      LD  A,(BC)
00089A 099A 03               6      INC BC
00089B 099B FE1A             7      CP  01AH
00089D 099D 2811            12      JR  Z,TYPEE
00089F 099F 5F               4      LD  E,A
0008A0 09A0 C5              11      PUSH    BC
0008A1 09A1 E5              11      PUSH    HL
0008A2 09A2 0E02             7      LD  C,2     ;(BDOS)コンソール出力
0008A4 09A4 CD0500          17      CALL    SYSTEM
0008A7 09A7 E1              10      POP HL
0008A8 09A8 C1              10      POP BC
0008A9 09A9 2B               6      DEC HL
0008AA 09AA 7C               4      LD  A,H
0008AB 09AB B5               4      OR  L
0008AC 09AC 20EB            12      JR  NZ,TYPE3
0008AE 09AE 18D9            12      JR  TYPE2
       09B0                     TYPEE:
0008B0 09B0 3AEB0F          13      LD  A,(MAJOR_VER)   ;DOS2対応
0008B3 09B3 FE02             7      CP  2
0008B5 09B5 3806            12      JR  C,TYPEE2
0008B7 09B7 ED4B2C10        20      LD  BC,(HANDLE1)
0008BB 09BB 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
       09BD                     TYPEE2:
0008BD 09BD CDA802          17      CALL    OPEN2_D2
0008C0 09C0 18BE            12      JR  TYPE1
                                
       09C2                     CWILD:
0008C2 09C2 215D00          10      LD  HL,FCB1+1
       09C5                     CWILD1:
0008C5 09C5 7E               7      LD  A,(HL)
0008C6 09C6 FE20             7      CP  020H
0008C8 09C8 C0              11      RET NZ
       09C9                     CWILD2:
0008C9 09C9 54               4      LD  D,H
0008CA 09CA 5D               4      LD  E,L
0008CB 09CB 13               6      INC DE
0008CC 09CC 010A00          10      LD  BC,10
0008CF 09CF 363F            10      LD  (HL),'?'
0008D1 09D1 EDB0                    LDIR
0008D3 09D3 C9              10      RET
                                
       09D4                     BUFSIZ:
0008D4 09D4 3A0700          13      LD  A,(SYSTEM+2)
0008D7 09D7 D681             7      SUB (DATA/256)+1
0008D9 09D9 E6F8             7      AND 0F8H
0008DB 09DB 67               4      LD  H,A
0008DC 09DC 2E00             7      LD  L,0
0008DE 09DE C9              10      RET
                                
0008DF 09DF E9               4  JP_HL:  JP  (HL)
                                
       09E0                     _PRINT:
0008E0 09E0 C5              11      PUSH    BC
0008E1 09E1 D5              11      PUSH    DE
0008E2 09E2 E5              11      PUSH    HL
0008E3 09E3 DDE5            15      PUSH    IX
0008E5 09E5 0E06             7      LD  C,6
0008E7 09E7 CD0500          17      CALL    SYSTEM
0008EA 09EA DDE1            14      POP IX
0008EC 09EC E1              10      POP HL
0008ED 09ED D1              10      POP DE
0008EE 09EE C1              10      POP BC
0008EF 09EF B7               4      OR  A
0008F0 09F0 C9              10      RET
                                
       09F1                     MSG_A:
0008F1 09F1 F5              11      PUSH    AF
0008F2 09F2 C5              11      PUSH    BC
0008F3 09F3 D5              11      PUSH    DE
0008F4 09F4 E5              11      PUSH    HL
0008F5 09F5 DDE5            15      PUSH    IX
0008F7 09F7 5F               4      LD  E,A
0008F8 09F8 0E02             7      LD  C,2
0008FA 09FA CD0500          17      CALL    SYSTEM
0008FD 09FD DDE1            14      POP IX
0008FF 09FF E1              10      POP HL
000900 0A00 D1              10      POP DE
000901 0A01 C1              10      POP BC
000902 0A02 F1              10      POP AF
000903 0A03 C9              10      RET
                                ;       FILE
       0A04                     FILEC_D2:       ;DOS2対応
000904 0A04 3AEB0F          13      LD  A,(MAJOR_VER)
000907 0A07 FE02             7      CP  2
000909 0A09 381C            12      JR  C,FILEC
00090B 0A0B C5              11      PUSH    BC
00090C 0A0C D5              11      PUSH    DE
00090D 0A0D E5              11      PUSH    HL
00090E 0A0E CD0F0B          17      CALL    SPCUT
000911 0A11 213310          10      LD  HL,PATH_CCP
000914 0A14 0640             7      LD  B,64
       0A16                     PATHCD1:
000916 0A16 1A               7      LD  A,(DE)
000917 0A17 13               6      INC DE
000918 0A18 FE20             7      CP  020H
00091A 0A1A 3002            12      JR  NC,PATHCD2
00091C 0A1C 3E00             7      LD  A,0
       0A1E                     PATHCD2:
00091E 0A1E 77               7      LD  (HL),A
00091F 0A1F 3803            12      JR  C,PATHCD3
000921 0A21 23               6      INC HL
000922 0A22 10F2            13      DJNZ    PATHCD1
       0A24                     PATHCD3:
000924 0A24 E1              10      POP HL
000925 0A25 D1              10      POP DE
000926 0A26 C1              10      POP BC
       0A27                     FILEC:
000927 0A27 CD320A          17      CALL    FILE
       0A2A                     FILEC2:
00092A 0A2A 3ABD11          13      LD  A,(FDRV+1)
00092D 0A2D FE20             7      CP  020H
00092F 0A2F C8              11      RET Z
000930 0A30 1839            12      JR  SETDIR1
                                
       0A32                     FILE:
000932 0A32 AF               4      XOR A
000933 0A33 32BC11          13      LD  (FDRV),A
000936 0A36 67               4      LD  H,A
000937 0A37 6F               4      LD  L,A
000938 0A38 22CA11          16      LD  (FDRV+14),HL
00093B 0A3B CD0F0B          17      CALL    SPCUT
00093E 0A3E CDF40A          17      CALL    CCHK3
000941 0A41 2812            12      JR  Z,DEVI1
000943 0A43 13               6      INC DE
000944 0A44 1A               7      LD  A,(DE)
000945 0A45 1B               6      DEC DE
000946 0A46 FE3A             7      CP  ':'
000948 0A48 200B            12      JR  NZ,DEVI1
00094A 0A4A 1A               7      LD  A,(DE)      ;DRIVE
00094B 0A4B CD220B          17      CALL    CAP
00094E 0A4E D640             7      SUB '@'
000950 0A50 13               6      INC DE
000951 0A51 13               6      INC DE
000952 0A52 32BC11          13      LD  (FDRV),A
       0A55                     DEVI1:
000955 0A55 1A               7      LD  A,(DE)
000956 0A56 D65C             7      SUB 05CH        ;\
000958 0A58 2009            12      JR  NZ,NOROOT
00095A 0A5A 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
00095B 0A5B 22D611          16      LD  (FDRV+26),HL
00095E 0A5E 2C               4      INC L
00095F 0A5F 22CA11          16      LD  (FDRV+14),HL
000962 0A62 13               6      INC DE
       0A63                     NOROOT:
                                
       0A63                     SETDIR:
000963 0A63 CD940A          17      CALL    FILED
000966 0A66 1A               7      LD  A,(DE)
000967 0A67 FE5C             7      CP  05CH        ;\
000969 0A69 C0              11      RET NZ
00096A 0A6A 13               6      INC DE
       0A6B                     SETDIR1:
00096B 0A6B 3AEB0F          13      LD  A,(MAJOR_VER)
00096E 0A6E FE01             7      CP  1
000970 0A70 C0              11      RET NZ
                                                ;for LSX-Dodgers
000971 0A71 3E10             7      LD  A,010H      ;Directory
000973 0A73 32C911          13      LD  (FDRV+13),A
000976 0A76 D5              11      PUSH    DE
000977 0A77 11BC11          10      LD  DE,FDRV
00097A 0A7A 0E0F             7      LD  C,00FH
00097C 0A7C CD0500          17      CALL    SYSTEM
00097F 0A7F D1              10      POP DE
000980 0A80 B7               4      OR  A
000981 0A81 C0              11      RET NZ
                                
000982 0A82 3AC911          13      LD  A,(FDRV+13)
000985 0A85 CB67             8      BIT 4,A
000987 0A87 C8              11      RET Z
                                
000988 0A88 CDDB0A          17      CALL    FILEI
00098B 0A8B 2AD611          16      LD  HL,(FDRV+26)
00098E 0A8E 23               6      INC HL
00098F 0A8F 22CA11          16      LD  (FDRV+14),HL
000992 0A92 18CF            12      JR  SETDIR
                                
       0A94                     FILED:
000994 0A94 CDDB0A          17      CALL    FILEI
                                
000997 0A97 0608             7      LD  B,8
       0A99                     FILE2:
000999 0A99 CDE90A          17      CALL    CCHKF
00099C 0A9C C8              11      RET Z
00099D 0A9D FE2A             7      CP  '*'
00099F 0A9F 282E            12      JR  Z,FILE9
0009A1 0AA1 FE2E             7      CP  '.'
0009A3 0AA3 280C            12      JR  Z,FILE4
0009A5 0AA5 77               7      LD  (HL),A
0009A6 0AA6 23               6      INC HL
0009A7 0AA7 10F0            13      DJNZ    FILE2
                                
       0AA9                     FILE3:
0009A9 0AA9 CDE90A          17      CALL    CCHKF
0009AC 0AAC C8              11      RET Z
0009AD 0AAD FE2E             7      CP  '.'
0009AF 0AAF 20F8            12      JR  NZ,FILE3
                                
       0AB1                     FILE4:
0009B1 0AB1 21C511          10      LD  HL,FNAME+8
0009B4 0AB4 0603             7      LD  B,3
                                
       0AB6                     FILE4L:
0009B6 0AB6 CDE90A          17      CALL    CCHKF
0009B9 0AB9 C8              11      RET Z
0009BA 0ABA FE2E             7      CP  '.'
0009BC 0ABC 2008            12      JR  NZ,FILE12
0009BE 0ABE 32BD11          13      LD  (FNAME),A   ;Parent directory(..)
0009C1 0AC1 32BE11          13      LD  (FNAME+1),A
0009C4 0AC4 3E20             7      LD  A,020H
       0AC6                     FILE12:
0009C6 0AC6 FE2A             7      CP  '*'
0009C8 0AC8 280A            12      JR  Z,FILE10
0009CA 0ACA 77               7      LD  (HL),A
0009CB 0ACB 23               6      INC HL
0009CC 0ACC 10E8            13      DJNZ    FILE4L
0009CE 0ACE C9              10      RET
                                
       0ACF                     FILE9:              ;名前の*処理、名前の残りを?で埋める
0009CF 0ACF CDD40A          17      CALL    FILE10
0009D2 0AD2 18D5            12      JR  FILE3
                                
       0AD4                     FILE10:
0009D4 0AD4 3E3F             7      LD  A,'?'
                                
       0AD6                     FILL_MEMORY:                ;HLからBバイトAで埋める
0009D6 0AD6 77               7      LD  (HL),A
0009D7 0AD7 23               6      INC HL
0009D8 0AD8 10FC            13      DJNZ    FILL_MEMORY
0009DA 0ADA C9              10      RET
                                
       0ADB                     FILEI:              ;名前＋拡張子をスペースで初期化
0009DB 0ADB 3E20             7      LD  A,020H
0009DD 0ADD 01000B          10      LD  BC,11*256
0009E0 0AE0 21BD11          10      LD  HL,FNAME
0009E3 0AE3 E5              11      PUSH    HL
0009E4 0AE4 CDD60A          17      CALL    FILL_MEMORY
0009E7 0AE7 E1              10      POP HL
0009E8 0AE8 C9              10      RET
                                
       0AE9                     CCHKF:
0009E9 0AE9 1A               7      LD  A,(DE)
0009EA 0AEA CDF10A          17      CALL    CCHK2
0009ED 0AED C8              11      RET Z
0009EE 0AEE C3440B          10      JP  FKAN
                                
       0AF1                     CCHK2:
0009F1 0AF1 0C               4      INC C
0009F2 0AF2 0D               4      DEC C
0009F3 0AF3 C0              11      RET NZ
       0AF4                     CCHK3:              ;ZF=1 で使えない文字
0009F4 0AF4 FE2B             7      CP  '+'
0009F6 0AF6 C8              11      RET Z
0009F7 0AF7 FE2C             7      CP  ','
0009F9 0AF9 C8              11      RET Z
0009FA 0AFA FE2F             7      CP  '/'
0009FC 0AFC C8              11      RET Z
0009FD 0AFD FE3A             7      CP  ':'
0009FF 0AFF C8              11      RET Z
000A00 0B00 FE3B             7      CP  ';'
000A02 0B02 C8              11      RET Z
000A03 0B03 FE3D             7      CP  '='
000A05 0B05 C8              11      RET Z
000A06 0B06 FE5C             7      CP  05CH    ;\
000A08 0B08 C8              11      RET Z
000A09 0B09 FE20             7      CP  020H
000A0B 0B0B D0              11      RET NC
000A0C 0B0C BF               4      CP  A       ;Z=1
000A0D 0B0D C9              10      RET
                                
       0B0E                     SS1:
000A0E 0B0E 13               6      INC DE
       0B0F                     SPCUT:              ;スペースをカット
000A0F 0B0F 1A               7      LD  A,(DE)
000A10 0B10 FE20             7      CP  020H
000A12 0B12 28FA            12      JR  Z,SS1
000A14 0B14 C9              10      RET
                                
       0B15                     TOZERO:
000A15 0B15 D5              11      PUSH    DE
       0B16                     TZ1:
000A16 0B16 1A               7      LD  A,(DE)
000A17 0B17 FE20             7      CP  20H
000A19 0B19 3803            12      JR  C,TZ2
000A1B 0B1B 13               6      INC DE
000A1C 0B1C 18F8            12      JR  TZ1
       0B1E                     TZ2:
000A1E 0B1E AF               4      XOR A
000A1F 0B1F 12               7      LD  (DE),A
000A20 0B20 D1              10      POP DE
000A21 0B21 C9              10      RET
                                
       0B22                     CAP:
000A22 0B22 FE61             7      CP  'a'
000A24 0B24 D8              11      RET C
000A25 0B25 FE7B             7      CP  'z'+1
000A27 0B27 D0              11      RET NC
000A28 0B28 D620             7      SUB 020H
000A2A 0B2A C9              10      RET
       0B2B                     CAP2:
000A2B 0B2B CD220B          17      CALL    CAP
       0B2E                     CAP3:
000A2E 0B2E CD370B          17      CALL    CAP4
000A31 0B31 FE21             7      CP  021H
000A33 0B33 D0              11      RET NC
000A34 0B34 3E20             7      LD  A,020H
000A36 0B36 C9              10      RET
       0B37                     CAP4:
000A37 0B37 FE05             7      CP  5
000A39 0B39 C0              11      RET NZ
000A3A 0B3A 3EE5             7      LD  A,0E5H
000A3C 0B3C C9              10      RET
                                
       0B3D                     FKANC:
000A3D 0B3D CB41             8      BIT 0,C
000A3F 0B3F CC2B0B          17      CALL    Z,CAP2
000A42 0B42 1801            12      JR  FKANX
       0B44                     FKAN:           ;漢字チェック
000A44 0B44 13               6      INC DE
       0B45                     FKANX:
000A45 0B45 CB41             8      BIT 0,C
000A47 0B47 CB81             8      RES 0,C
000A49 0B49 C0              11      RET NZ
000A4A 0B4A FE80             7      CP  080H
000A4C 0B4C D8              11      RET C
000A4D 0B4D FEA0             7      CP  0A0H
000A4F 0B4F 3803            12      JR  C,FKAN1
000A51 0B51 FEE0             7      CP  0E0H
000A53 0B53 D8              11      RET C
       0B54                     FKAN1:
000A54 0B54 0C               4      INC C
000A55 0B55 A7               4      AND A
000A56 0B56 C9              10      RET
                                
       0B57                     CHKWILDX:
000A57 0B57 FDE5            15      PUSH    IY
000A59 0B59 E1              10      POP HL
000A5A 0B5A 23               6      INC HL
       0B5B                     CHKWILD:
000A5B 0B5B 060B             7      LD  B,11
000A5D 0B5D 3E3F             7      LD  A,'?'
       0B5F                     CHKWIL1:
000A5F 0B5F BE               7      CP  (HL)
000A60 0B60 23               6      INC HL
000A61 0B61 37               4      SCF
000A62 0B62 C8              11      RET Z
000A63 0B63 10FA            13      DJNZ    CHKWIL1
000A65 0B65 AF               4      XOR A
000A66 0B66 C9              10      RET
                                
       0B67                     CPNAME:
000A67 0B67 C5              11      PUSH    BC
000A68 0B68 D5              11      PUSH    DE
000A69 0B69 11AB11          10      LD  DE,CPBUF
000A6C 0B6C 010700          10      LD  BC,7
000A6F 0B6F EDB0                    LDIR
000A71 0B71 D1              10      POP DE
000A72 0B72 D5              11      PUSH    DE
000A73 0B73 E5              11      PUSH    HL
000A74 0B74 21AB11          10      LD  HL,CPBUF
000A77 0B77 CD8A0B          17      CALL    CPFILE
000A7A 0B7A E1              10      POP HL
000A7B 0B7B D1              10      POP DE
000A7C 0B7C C1              10      POP BC
000A7D 0B7D 2005            12      JR  NZ,CPNAME1
000A7F 0B7F 7E               7      LD  A,(HL)
000A80 0B80 23               6      INC HL
000A81 0B81 66               7      LD  H,(HL)
000A82 0B82 6F               4      LD  L,A
000A83 0B83 C9              10      RET
       0B84                     CPNAME1:
000A84 0B84 23               6      INC HL
000A85 0B85 23               6      INC HL
000A86 0B86 10DF            13      DJNZ    CPNAME
000A88 0B88 37               4      SCF
000A89 0B89 C9              10      RET
                                
       0B8A                     CPFILE:
000A8A 0B8A C5              11      PUSH    BC
000A8B 0B8B 01000B          10      LD  BC,00B00H
       0B8E                     CPSTR1:
000A8E 0B8E 1A               7      LD  A,(DE)
000A8F 0B8F FE3F             7      CP  '?'     ;Wild card
000A91 0B91 2812            12      JR  Z,CPSTR2
000A93 0B93 7E               7      LD  A,(HL)
000A94 0B94 CD3D0B          17      CALL    FKANC
000A97 0B97 E5              11      PUSH    HL
000A98 0B98 67               4      LD  H,A
000A99 0B99 1A               7      LD  A,(DE)
000A9A 0B9A CB01             4      RLC C
000A9C 0B9C CD3D0B          17      CALL    FKANC
000A9F 0B9F CB09             4      RRC C
000AA1 0BA1 BC               4      CP  H       ;CP (HL),(DE)
000AA2 0BA2 E1              10      POP HL
000AA3 0BA3 2004            12      JR  NZ,CPSTR3
       0BA5                     CPSTR2:
000AA5 0BA5 13               6      INC DE
000AA6 0BA6 23               6      INC HL
000AA7 0BA7 10E5            13      DJNZ    CPSTR1
       0BA9                     CPSTR3:
000AA9 0BA9 C1              10      POP BC
000AAA 0BAA C9              10      RET
                                
       0BAB                     CPFILE2:
000AAB 0BAB FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
000AAE 0BAE F6E1             7      OR  0E1H
000AB0 0BB0 2F               4      CPL
000AB1 0BB1 A6               7      AND (HL)
000AB2 0BB2 C9              10      RET
                                
       0BB3                     _SYS29:     ;(BDOS)ファイル名の解析
000AB3 0BB3 C5              11      PUSH    BC
000AB4 0BB4 D5              11      PUSH    DE
000AB5 0BB5 0640             7      LD  B,64
000AB7 0BB7 CD0F0B          17      CALL    SPCUT
000ABA 0BBA DD22A911        20      LD  (DIR_CK),IX
       0BBE                     D2FN1:
000ABE 0BBE 1A               7      LD  A,(DE)
000ABF 0BBF FE21             7      CP  020H+1
000AC1 0BC1 3808            12      JR  C,D2FN2
000AC3 0BC3 13               6      INC DE
000AC4 0BC4 DD7700          19      LD  (IX+0),A
000AC7 0BC7 DD23            10      INC IX
000AC9 0BC9 10F3            13      DJNZ    D2FN1
       0BCB                     D2FN2:
000ACB 0BCB DD360000        19      LD  (IX+0),0
000ACF 0BCF DD7EFF          19      LD  A,(IX-1)
000AD2 0BD2 FE5C             7      CP  05CH        ;\
000AD4 0BD4 2018            12      JR  NZ,D2FN3
000AD6 0BD6 DD7EFE          19      LD  A,(IX-2)
000AD9 0BD9 FE3A             7      CP  ':'
000ADB 0BDB 2811            12      JR  Z,D2FN3
                                
000ADD 0BDD DD36FF00        19      LD  (IX-1),0
000AE1 0BE1 ED5BA911        20      LD  DE,(DIR_CK)
000AE5 0BE5 CD200C          17      CALL    IS_FOLDER
000AE8 0BE8 3804            12      JR  C,D2FN3
       0BEA                     D2FN4:
000AEA 0BEA DD36FF5C        19      LD  (IX-1),05CH ;\
       0BEE                     D2FN3:
000AEE 0BEE D1              10      POP DE
000AEF 0BEF C1              10      POP BC
000AF0 0BF0 C5              11      PUSH    BC
000AF1 0BF1 E5              11      PUSH    HL
000AF2 0BF2 CD320A          17      CALL    FILE
000AF5 0BF5 E1              10      POP HL
000AF6 0BF6 C1              10      POP BC
       0BF7                     S29X1:
000AF7 0BF7 C5              11      PUSH    BC
000AF8 0BF8 D5              11      PUSH    DE
000AF9 0BF9 E5              11      PUSH    HL
000AFA 0BFA EB               4      EX  DE,HL
000AFB 0BFB 21BC11          10      LD  HL,FDRV
000AFE 0BFE 010D00          10      LD  BC,13
000B01 0C01 EDB0                    LDIR
000B03 0C03 70               7      LD  (HL),B      ;B=0
000B04 0C04 0E03             7      LD  C,3
000B06 0C06 EDB0                    LDIR
000B08 0C08 E1              10      POP HL
000B09 0C09 D1              10      POP DE
000B0A 0C0A C1              10      POP BC
000B0B 0C0B AF               4      XOR A
000B0C 0C0C C9              10      RET
       0C0D                     GET_WIDTH:
000B0D 0C0D 3AEA0F          13      LD  A,(IS_MSX)
000B10 0C10 B7               4      OR  A
000B11 0C11 2804            12      JR  Z,NOT_MSX
000B13 0C13 3AB0F3          13      LD  A,(LINLEN)
000B16 0C16 C9              10      RET
       0C17                     NOT_MSX:
000B17 0C17 E5              11      PUSH    HL
000B18 0C18 2A0100          16      LD  HL,(1)
000B1B 0C1B 2EB1             7      LD  L,0B1H
000B1D 0C1D 7E               7      LD  A,(HL)
000B1E 0C1E E1              10      POP HL
000B1F 0C1F C9              10      RET
                                
       0C20                     IS_FOLDER:          ;out CF=0:Folder
000B20 0C20 CD0F0B          17      CALL    SPCUT
000B23 0C23 1A               7      LD  A,(DE)
000B24 0C24 C6FF             7      ADD A,0FFH
000B26 0C26 D0              11      RET NC
000B27 0C27 AF               4      XOR A
000B28 0C28 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
000B2A 0C2A D5              11      PUSH    DE
000B2B 0C2B CD2B03          17      CALL    SYSTEM0
000B2E 0C2E D1              10      POP DE
000B2F 0C2F 37               4      SCF
000B30 0C30 C0              11      RET NZ
000B31 0C31 7D               4      LD  A,L
000B32 0C32 E610             7      AND 010H
000B34 0C34 D601             7      SUB 1
000B36 0C36 C9              10      RET
                                
       0C37                     C_MODE:
000B37 0C37 3AEA0F          13      LD  A,(IS_MSX)
000B3A 0C3A B7               4      OR  A
000B3B 0C3B C8              11      RET Z
000B3C 0C3C 0E29             7      LD  C,41
000B3E 0C3E 3AF8FA          13      LD  A,(EXBRSA)
000B41 0C41 B7               4      OR  A
000B42 0C42 2802            12      JR  Z,MODE_MSX1
000B44 0C44 0E51             7      LD  C,81
       0C46                     MODE_MSX1:
000B46 0C46 C5              11      PUSH    BC
000B47 0C47 CDFE0D          17      CALL    GETNUM
000B4A 0C4A C1              10      POP BC
000B4B 0C4B 7D               4      LD  A,L
000B4C 0C4C B9               4      CP  C
000B4D 0C4D 301C            12      JR  NC,MODE1
000B4F 0C4F B7               4      OR  A
000B50 0C50 2819            12      JR  Z,MODE1
000B52 0C52 FE21             7      CP  33
000B54 0C54 381E            12      JR  C,MODE32
000B56 0C56 32AEF3          13      LD  (LINL40),A
000B59 0C59 DD216C00        14      LD  IX,INITXT
000B5D 0C5D CD640C          17      CALL    CALLROM
000B60 0C60 DD217800        14      LD  IX,SETTXT
       0C64                     CALLROM:
000B64 0C64 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000B68 0C68 C31C00          10      JP  CALSLT
       0C6B                     MODE1:
000B6B 0C6B 3AB0F3          13      LD  A,(LINLEN)
000B6E 0C6E CDF406          17      CALL    PRDEC_A
000B71 0C71 C38A05          10      JP  LTNL
       0C74                     MODE32:
000B74 0C74 32AFF3          13      LD  (LINL32),A
000B77 0C77 DD216F00        14      LD  IX,INIT32
000B7B 0C7B CD640C          17      CALL    CALLROM
000B7E 0C7E DD217B00        14      LD  IX,SETT32
000B82 0C82 18E0            12      JR  CALLROM
                                
       0C84                     C_PAUSE:
000B84 0C84 CD0F0B          17      CALL    SPCUT
000B87 0C87 EB               4      EX  DE,HL
000B88 0C88 7E               7      LD  A,(HL)
000B89 0C89 B7               4      OR  A
000B8A 0C8A 2003            12      JR  NZ,C_PAUSE1
000B8C 0C8C 21E20E          10      LD  HL,PAUSE
       0C8F                     C_PAUSE1:
000B8F 0C8F CD4C05          17      CALL    MSX
000B92 0C92 0E07             7      LD  C,7     ;(BDOS)コンソール直接入力(_DIRIN)
000B94 0C94 CD0500          17      CALL    SYSTEM
000B97 0C97 FE03             7      CP  3
000B99 0C99 CA4C04          10      JP  Z,END_BATCH
000B9C 0C9C C38A05          10      JP  LTNL
                                
       0C9F                     C_ECHO:
000B9F 0C9F CD0F0B          17      CALL    SPCUT
000BA2 0CA2 EB               4      EX  DE,HL
000BA3 0CA3 CD4C05          17      CALL    MSX
000BA6 0CA6 C38A05          10      JP  LTNL
                                
       0CA9                     C_MKDIR:
000BA9 0CA9 CD0F0B          17      CALL    SPCUT
000BAC 0CAC 014490          10      LD  BC,09044H   ;B=新規作成+ディレクトリ/C=(BDOS)ファイルハンドルの作成(_CREATE)
000BAF 0CAF CD0500          17      CALL    SYSTEM
000BB2 0CB2 C6FF             7      ADD A,0FFH
000BB4 0CB4 D8              11      RET C
000BB5 0CB5 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
000BB7 0CB7 CD0500          17      CALL    SYSTEM
       0CBA                     SHOW_OK:
000BBA 0CBA 11D80E          10      LD  DE,OK
000BBD 0CBD 0E09             7      LD  C,9     ;(BDOS)文字列出力
000BBF 0CBF CD0500          17      CALL    SYSTEM
000BC2 0CC2 C38A05          10      JP  LTNL
                                
       0CC5                     C_RMDIR:
000BC5 0CC5 CD200C          17      CALL    IS_FOLDER
000BC8 0CC8 D8              11      RET C
000BC9 0CC9 0E4D             7      LD  C,04DH      ;(BDOS)ファイル・サブディレクトリの削除
000BCB 0CCB CD0500          17      CALL    SYSTEM
000BCE 0CCE C6FF             7      ADD A,0FFH
000BD0 0CD0 D8              11      RET C
000BD1 0CD1 18E7            12      JR  SHOW_OK
                                
       0CD3                     C_SET:
000BD3 0CD3 CD0F0B          17      CALL    SPCUT
000BD6 0CD6 ED53E90C        20      LD  (CSET_PARAM),DE
       0CDA                     CSET2:
000BDA 0CDA 1A               7      LD  A,(DE)
000BDB 0CDB FE20             7      CP  020H
000BDD 0CDD 3838            12      JR  C,CSET_LIST
000BDF 0CDF D63D             7      SUB '='
000BE1 0CE1 2803            12      JR  Z,CSET_SET
000BE3 0CE3 13               6      INC DE
000BE4 0CE4 18F4            12      JR  CSET2
       0CE6                     CSET_SET:
000BE6 0CE6 12               7      LD  (DE),A
000BE7 0CE7 13               6      INC DE
       0CE9                     CSET_PARAM  EQU $+1
000BE8 0CE8 210000          10      LD  HL,0
000BEB 0CEB 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000BED 0CED CD0500          17      CALL    SYSTEM
       0CF0                     INIT_VAR:           ;環境変数の初期化
000BF0 0CF0 21B90F          10      LD  HL,N_DATE
000BF3 0CF3 11BE0F          10      LD  DE,V_DATE
000BF6 0CF6 0610             7      LD  B,16
000BF8 0CF8 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000BFA 0CFA CD0500          17      CALL    SYSTEM
                                
000BFD 0CFD 21DE0F          10      LD  HL,N_TIME
000C00 0D00 11E30F          10      LD  DE,V_TIME
000C03 0D03 0603             7      LD  B,3
000C05 0D05 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000C07 0D07 CD0500          17      CALL    SYSTEM
                                
000C0A 0D0A 212D0F          10      LD  HL,N_APPEND
000C0D 0D0D 11340F          10      LD  DE,V_APPEND
000C10 0D10 0640             7      LD  B,PATHX
000C12 0D12 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000C14 0D14 C30500          10      JP  SYSTEM
                                
       0D17                     CSET_LIST:
000C17 0D17 3E0A             7      LD  A,10
000C19 0D19 32E711          13      LD  (CSET_DATA),A
000C1C 0D1C 110100          10      LD  DE,1
       0D1F                     CSET1:
000C1F 0D1F D5              11      PUSH    DE
000C20 0D20 016DFF          10      LD  BC,0FF6DH   ;_FENV 環境変数の検索
000C23 0D23 21E911          10      LD  HL,DATA_COM
000C26 0D26 3600            10      LD  (HL),0
000C28 0D28 CD0500          17      CALL    SYSTEM
000C2B 0D2B B7               4      OR  A
000C2C 0D2C 2030            12      JR  NZ,CSET_ERROR
000C2E 0D2E 21E911          10      LD  HL,DATA_COM
000C31 0D31 7E               7      LD  A,(HL)
000C32 0D32 B7               4      OR  A
000C33 0D33 2829            12      JR  Z,CSET_ERROR
000C35 0D35 CD4C05          17      CALL    MSX
000C38 0D38 1E3D             7      LD  E,'='
000C3A 0D3A CDE009          17      CALL    _PRINT
000C3D 0D3D 21E911          10      LD  HL,DATA_COM
000C40 0D40 11E912          10      LD  DE,DATA_COM+256
000C43 0D43 016BFF          10      LD  BC,0FF6BH   ;_GENV 環境変数の獲得
000C46 0D46 CD0500          17      CALL    SYSTEM
000C49 0D49 21E912          10      LD  HL,DATA_COM+256
000C4C 0D4C CD4C05          17      CALL    MSX
000C4F 0D4F CD8A05          17      CALL    LTNL
000C52 0D52 3E0A             7      LD  A,10
000C54 0D54 32E711          13      LD  (CSET_DATA),A
       0D57                     CSET_NEXT:
000C57 0D57 D1              10      POP DE
000C58 0D58 13               6      INC DE
000C59 0D59 7A               4      LD  A,D
000C5A 0D5A B3               4      OR  E
000C5B 0D5B 20C2            12      JR  NZ,CSET1
000C5D 0D5D C9              10      RET
       0D5E                     CSET_ERROR:
000C5E 0D5E 21E711          10      LD  HL,CSET_DATA
000C61 0D61 35              11      DEC (HL)
000C62 0D62 20F3            12      JR  NZ,CSET_NEXT
       0D64                     CSET_END:
000C64 0D64 D1              10      POP DE
000C65 0D65 C9              10      RET
                                
       0D66                     C_FORMAT:
000C66 0D66 3AEA0F          13      LD  A,(IS_MSX)
000C69 0D69 B7               4      OR  A
000C6A 0D6A C8              11      RET Z
000C6B 0D6B 3AEB0F          13      LD  A,(MAJOR_VER)
000C6E 0D6E FE02             7      CP  2
000C70 0D70 300B            12      JR  NC,FORMAT2
       0D72                     FORMAT1:
000C72 0D72 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000C76 0D76 DD214701        14      LD  IX,FORMAT
000C7A 0D7A C31C00          10      JP  CALSLT
       0D7D                     FORMAT2:
000C7D 0D7D CD7F07          17      CALL    SETFCB
000C80 0D80 3A5C00          13      LD  A,(FCB1)
000C83 0D83 B7               4      OR  A
000C84 0D84 28EC            12      JR  Z,FORMAT1
000C86 0D86 47               4      LD  B,A
000C87 0D87 AF               4      XOR A
000C88 0D88 0E67             7      LD  C,067H      ;(_FORMAT)ディスクのフォーマット
000C8A 0D8A CD0500          17      CALL    SYSTEM
000C8D 0D8D B7               4      OR  A
000C8E 0D8E 20E2            12      JR  NZ,FORMAT1
000C90 0D90 CD5505          17      CALL    MSXSLT
000C93 0D93 21E70F          10      LD  HL,PROMPT
000C96 0D96 CD4C05          17      CALL    MSX
       0D99                     FORMAT3:
000C99 0D99 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力(_INNOE)
000C9B 0D9B CD0500          17      CALL    SYSTEM
000C9E 0D9E D631             7      SUB '0'+1
000CA0 0DA0 38F7            12      JR  C,FORMAT3
000CA2 0DA2 3C               4      INC A
000CA3 0DA3 FE0A             7      CP  10
000CA5 0DA5 30F2            12      JR  NC,FORMAT3
000CA7 0DA7 F5              11      PUSH    AF
000CA8 0DA8 CD8A05          17      CALL    LTNL
000CAB 0DAB 21E20E          10      LD  HL,PAUSE
000CAE 0DAE CD4C05          17      CALL    MSX
000CB1 0DB1 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力(_INNOE)
000CB3 0DB3 CD0500          17      CALL    SYSTEM
000CB6 0DB6 CD8A05          17      CALL    LTNL
000CB9 0DB9 F1              10      POP AF
000CBA 0DBA ED4B5B00        20      LD  BC,(FCB1-1)
000CBE 0DBE 210080          10      LD  HL,08000H
000CC1 0DC1 110040          10      LD  DE,04000H
000CC4 0DC4 0E67             7      LD  C,067H      ;(_FORMAT)ディスクのフォーマット
000CC6 0DC6 C30500          10      JP  SYSTEM
                                
       0DC9                     C_RAMDISK:
000CC9 0DC9 3AEA0F          13      LD  A,(IS_MSX)
000CCC 0DCC B7               4      OR  A
000CCD 0DCD C8              11      RET Z
000CCE 0DCE 3AEB0F          13      LD  A,(MAJOR_VER)
000CD1 0DD1 FE02             7      CP  2
000CD3 0DD3 D8              11      RET C
000CD4 0DD4 CD0F0B          17      CALL    SPCUT
000CD7 0DD7 1A               7      LD  A,(DE)
000CD8 0DD8 FE30             7      CP  '0'
000CDA 0DDA D8              11      RET C
000CDB 0DDB FE3A             7      CP  '9'+1
000CDD 0DDD 3F               4      CCF
000CDE 0DDE D8              11      RET C
000CDF 0DDF CDFE0D          17      CALL    GETNUM
000CE2 0DE2 110F00          10      LD  DE,15       ;切り上げの為
000CE5 0DE5 19              11      ADD HL,DE
000CE6 0DE6 7D               4      LD  A,L
000CE7 0DE7 0604             7      LD  B,4     ;16で割る
       0DE9                     RAMDISK1:
000CE9 0DE9 CB3C             8      SRL H   ;/2
000CEB 0DEB 1F               4      RRA
000CEC 0DEC 10FB            13      DJNZ    RAMDISK1
000CEE 0DEE FEFF             7      CP  0FFH
000CF0 0DF0 2001            12      JR  NZ,RAMDISK2
000CF2 0DF2 3D               4      DEC A
       0DF3                     RAMDISK2:
000CF3 0DF3 47               4      LD  B,A
000CF4 0DF4 0E68             7      LD  C,068H      ;(_RAMD)RAMディスクの作成あるいは消去
000CF6 0DF6 CD0500          17      CALL    SYSTEM
000CF9 0DF9 B7               4      OR  A
000CFA 0DFA CCBA0C          17      CALL    Z,SHOW_OK
000CFD 0DFD C9              10      RET
                                
       0DFE                     GETNUM:
000CFE 0DFE CD0F0B          17      CALL    SPCUT
000D01 0E01 210000          10      LD  HL,0
       0E04                     GETNUM1:
000D04 0E04 1A               7      LD  A,(DE)
000D05 0E05 13               6      INC DE
000D06 0E06 D630             7      SUB '0'
000D08 0E08 D8              11      RET C
000D09 0E09 FE0A             7      CP  10
000D0B 0E0B D0              11      RET NC
000D0C 0E0C 4D               4      LD  C,L
000D0D 0E0D 44               4      LD  B,H
000D0E 0E0E 29              11      ADD HL,HL   ;*2
000D0F 0E0F 29              11      ADD HL,HL   ;*4
000D10 0E10 09              11      ADD HL,BC   ;*5
000D11 0E11 29              11      ADD HL,HL   ;*10
000D12 0E12 4F               4      LD  C,A
000D13 0E13 0600             7      LD  B,0
000D15 0E15 09              11      ADD HL,BC
000D16 0E16 18EC            12      JR  GETNUM1
                                
       0E18                     CHDIR:
000D18 0E18 3AEB0F          13      LD  A,(MAJOR_VER)
000D1B 0E1B FE02             7      CP  2
000D1D 0E1D D8              11      RET C
000D1E 0E1E C5              11      PUSH    BC
000D1F 0E1F E5              11      PUSH    HL
000D20 0E20 0E5A             7      LD  C,05AH      ;(BDOS)_CHDIR カレントディレクトリの変更
000D22 0E22 CD0500          17      CALL    SYSTEM
000D25 0E25 E1              10      POP HL
000D26 0E26 C1              10      POP BC
000D27 0E27 C9              10      RET
                                
       0011                     COMS    EQU 17
       0E28                     COMTB:
000D28 0E28 44202020202020          DB  "D      "   ;1
000D2F 0E2F CB04                    DW  C_DIR
000D31 0E31 44495220202020          DB  "DIR    "   ;2
000D38 0E38 CB04                    DW  C_DIR
000D3A 0E3A 434F5059202020          DB  "COPY   "   ;3
000D41 0E41 C807                    DW  C_COPY
000D43 0E43 43442020202020          DB  "CD     "   ;4
000D4A 0E4A 3003                    DW  C_CD
000D4C 0E4C 44454C20202020          DB  "DEL    "   ;5
000D53 0E53 6A04                    DW  C_DEL
000D55 0E55 50415448202020          DB  "PATH   "   ;6
000D5C 0E5C 9405                    DW  C_PATH
000D5E 0E5E 52454E20202020          DB  "REN    "   ;7
000D65 0E65 9D04                    DW  C_REN
000D67 0E67 54595045202020          DB  "TYPE   "   ;8
000D6E 0E6E 7609                    DW  C_TYPE
000D70 0E70 52454D20202020          DB  "REM    "   ;9
000D77 0E77 6804                    DW  C_REM
000D79 0E79 4D4F4445202020          DB  "MODE   "   ;10
000D80 0E80 370C                    DW  C_MODE
000D82 0E82 50415553452020          DB  "PAUSE  "   ;11
000D89 0E89 840C                    DW  C_PAUSE
000D8B 0E8B 53455420202020          DB  "SET    "   ;12
000D92 0E92 D30C                    DW  C_SET
000D94 0E94 4543484F202020          DB  "ECHO   "   ;13
000D9B 0E9B 9F0C                    DW  C_ECHO
000D9D 0E9D 4D4B4449522020          DB  "MKDIR  "   ;14
000DA4 0EA4 A90C                    DW  C_MKDIR
000DA6 0EA6 524D4449522020          DB  "RMDIR  "   ;15
000DAD 0EAD C50C                    DW  C_RMDIR
000DAF 0EAF 464F524D415420          DB  "FORMAT "   ;16
000DB6 0EB6 660D                    DW  C_FORMAT
000DB8 0EB8 52414D4449534B          DB  "RAMDISK"   ;17
000DBF 0EBF C90D                    DW  C_RAMDISK
                                
000DC1 0EC1 2062797465732066    FREE:   DB  " bytes free  $"
            726565202024        
000DCF 0ECF 2020203C4449523E    DIRMES: DB  "   <DIR>$"
            24                  
000DD8 0ED8 4F4B24              OK: DB  "OK$"
000DDB 0EDB 4572726F722124      COMERM: DB  "Error!$"
000DE2 0EE2 537472696B652061    PAUSE:  DB  "Strike any key when ready ",0
            6E79206B65792077    
            68656E2072656164    
            792000              
                                
       0EFD                     S_MONTH:
000DFD 0EFD 4A616E00                DB  "Jan",0
000E01 0F01 46656200                DB  "Feb",0
000E05 0F05 4D617200                DB  "Mar",0
000E09 0F09 41707200                DB  "Apr",0
000E0D 0F0D 4D617900                DB  "May",0
000E11 0F11 4A756E00                DB  "Jun",0
000E15 0F15 4A756C00                DB  "Jul",0
000E19 0F19 41756700                DB  "Aug",0
000E1D 0F1D 53657000                DB  "Sep",0
000E21 0F21 4F637400                DB  "Oct",0
000E25 0F25 4E6F7600                DB  "Nov",0
000E29 0F29 44656300                DB  "Dec",0
                                
       0F2D                     N_APPEND:
000E2D 0F2D 415050454E4400          DB  "APPEND",0
       0F34                     V_APPEND:
000E34 0F34                         DS  64
       0F74                     N_PATH:
000E74 0F74 5041544800              DB  "PATH",0
       0F79                     V_PATH:
000E79 0F79                         DS  PATHX
       0FB9                     N_DATE:
000EB9 0FB9 4441544500              DB  "DATE",0
       0FBE                     V_DATE:
000EBE 0FBE 79792D6D6D2D6464        DB  "yy-mm-dd"
000EC6 0FC6                         DS  8
       0FCE                     V_DATE1:
000ECE 0FCE 6D6D2D64642D7979        DB  "mm-dd-yy"
       0FD6                     V_DATE2:
000ED6 0FD6 64642D6D6D2D7979        DB  "dd-mm-yy"
       0FDE                     N_TIME:
000EDE 0FDE 54494D4500              DB  "TIME",0
       0FE3                     V_TIME:
000EE3 0FE3 323400                  DB  "24",0
       0FE6                     F_TIME:
000EE6 0FE6 00                      DB  0
       0FE7                     PROMPT:
000EE7 0FE7 3F2000                  DB  "? ",0
       0FEA                     IS_MSX:
000EEA 0FEA 00                      DB  0
       0FEB                     MAJOR_VER:
000EEB 0FEB 00                      DB  0
       0FEC                     SEARCH_IX:
000EEC 0FEC                         DS  64  ;DOS2用
       102C                     HANDLE1:
000F2C 102C 0000                    DW  0
       102E                     PATH_POS:
000F2E 102E 0000                    DW  0
       1030                     PATH_DRV:
000F30 1030 413A5C                  DB  "A:\\"
       1033                     PATH_CCP:
000F33 1033                         DS  64  ;DOS2用
       1073                     PATH_PAR:
000F73 1073                         DS  64  ;DOS2用
       10B3                     PATH_FN1:
000FB3 10B3                         DS  64  ;DOS2用
       10F3                     PATH_FN2:
000FF3 10F3                         DS  64  ;DOS2用
       1133                     CUR_DRV:
001033 1133 413A5C                  DB  "A:\\"
       1136                     CUR_PATH:
001036 1136                         DS  64  ;DOS2用
       1176                     DOS2NAME:
001076 1176                         DS  2+8+3+1 ;DOS2用
       1184                     DTA_CCP:
001084 1184                         DS  37
       11A9                     DIR_CK:
0010A9 11A9 0000                    DW  0
                                
       11AB                     CPBUF:
0010AB 11AB 0000                LEFTX:  DW  0
0010AD 11AD 0000                DTAX:   DW  0
0010AF 11AF 20                      DB  020H    ;CPBUFで使う
0010B0 11B0 20                      DB  020H
0010B1 11B1 20                      DB  020H
0010B2 11B2 20                      DB  020H
0010B3 11B3 20                      DB  020H
0010B4 11B4 20                      DB  020H
0010B5 11B5 20                      DB  020H
                                
       11B6                     DECBF:
0010B6 11B6                         DS  5
       11BB                     FCB_BAT2:
0010BB 11BB 00                      DB  0
       11BC                     FDRV:
0010BC 11BC 00                      DB  0
       11BD                     FNAME:
0010BD 11BD                         DS  37
       11E2                     ZERO:
0010E2 11E2 00                      DB  0
       11E3                     FCB_BAT:
0010E3 11E3 BB11                    DW  FCB_BAT2
       11E5                     X_PATH:
0010E5 11E5 0000                    DW  0
       11E7                     CSET_DATA:
0010E7 11E7 00                      DB  0
       11E8                     PROCESS:
0010E8 11E8 00                      DB  0
                                
       11E9                     DATA_COM:
[EOF:COMMAND.ASM:SHIFT_JIS]
