                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.21.0, LST:Full:4
                                
                                ;   似非COMMAND.COM
                                
       0005                     SYSTEM  EQU 00005H
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
       000C                     RDSLT   EQU 0000CH
       001C                     CALSLT  EQU 0001CH
       006C                     INITXT  EQU 0006CH
       006F                     INIT32  EQU 0006FH
       0078                     SETTXT  EQU 00078H
       007B                     SETT32  EQU 0007BH
       0147                     FORMAT  EQU 00147H
                                
       F3AE                     LINL40  EQU 0F3AEH
       F3AF                     LINL32  EQU 0F3AFH
       F3B0                     LINLEN  EQU 0F3B0H
       F55E                     BUF EQU 0F55EH
       F7C4                     TRCFLG  EQU 0F7C4H
       FAF8                     EXBRSA  EQU 0FAF8H
       FC9B                     INTFLG  EQU 0FC9BH
       FCC1                     EXPTBL  EQU 0FCC1H
                                
                                
       0040                     PATHX   EQU 64
                                
       8000                     DATA    EQU 08000H
                                
000000 0100                         ORG 0100H
000000 0100 C31501          10      JP  START
       0103                     VER:
000003 0103 0D0A434F4D4D414E        DB  00DH,00AH,"COMMAND v0.17",00DH,00AH,'$'
            442076302E31370D    
            0A24                
       0115                     START:
000015 0115 ED7B0600        20      LD  SP,(SYSTEM+1)
000019 0119 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
00001B 011B CD0500          17      CALL    SYSTEM
00001E 011E D8              11      RET C
00001F 011F 211D01          10      LD  HL,0011DH
000022 0122 ED42            15      SBC HL,BC
000024 0124 78               4      LD  A,B
000025 0125 32D310          13      LD  (MAJOR_VER),A
000028 0128 B5               4      OR  L
000029 0129 32D210          13      LD  (IS_MSX),A
00002C 012C B7               4      OR  A
00002D 012D 286A            12      JR  Z,WSTART
                                
00002F 012F 3AD012          13      LD  A,(PROCESS)
000032 0132 0E61             7      LD  C,61H       ;(BDOS)親プロセスに戻る
000034 0134 47               4      LD  B,A
000035 0135 B7               4      OR  A
000036 0136 C40500          17      CALL    NZ,SYSTEM
000039 0139 AF               4      XOR A
00003A 013A 32D012          13      LD  (PROCESS),A
                                
00003D 013D 212B00          10      LD  HL,002BH    ;キャラクターセット・日時フォーマット・ビデオ信号の種別
000040 0140 CD0C00          17      CALL    RDSLT
000043 0143 0F               4      RRCA
000044 0144 0F               4      RRCA
000045 0145 0F               4      RRCA
000046 0146 0F               4      RRCA
000047 0147 E603             7      AND 3
000049 0149 2814            12      JR  Z,DATEOK
00004B 014B 3D               4      DEC A
00004C 014C 21A310          10      LD  HL,V_DATE1
00004F 014F 2806            12      JR  Z,DATECHG
000051 0151 3D               4      DEC A
000052 0152 21AB10          10      LD  HL,V_DATE2
000055 0155 2008            12      JR  NZ,DATEOK
       0157                     DATECHG:
000057 0157 119310          10      LD  DE,V_DATE
00005A 015A 010800          10      LD  BC,8
00005D 015D EDB0                    LDIR
       015F                     DATEOK:
00005F 015F CDC50D          17      CALL    INIT_VAR
000062 0162 3AC4F7          13      LD  A,(TRCFLG)
000065 0165 B7               4      OR  A
000066 0166 2814            12      JR  Z,WSTART0
000068 0168 11B00F          10      LD  DE,COMERM
00006B 016B 0E09             7      LD  C,9     ;(BDOS)文字列出力
00006D 016D CD0500          17      CALL    SYSTEM
000070 0170 2AC4F7          16      LD  HL,(TRCFLG)
000073 0173 2600             7      LD  H,0
000075 0175 CDC106          17      CALL    PRDEC_HL
000078 0178 AF               4      XOR A
000079 0179 32C4F7          13      LD  (TRCFLG),A
       017C                     WSTART0:
00007C 017C 2A0600          16      LD  HL,(SYSTEM+1)
00007F 017F 2EDB             7      LD  L,256-37
000081 0181 24               4      INC H
000082 0182 22CB12          16      LD  (FCB_BAT),HL
000085 0185 3A8000          13      LD  A,(DTA1)
000088 0188 B7               4      OR  A
000089 0189 280E            12      JR  Z,WSTART
00008B 018B 110301          10      LD  DE,VER
00008E 018E 0E09             7      LD  C,9
000090 0190 CD0500          17      CALL    SYSTEM
000093 0193 118100          10      LD  DE,DTA1+1
000096 0196 CDFC01          17      CALL    COMANL
       0199                     WSTART:
000099 0199 210210          10      LD  HL,N_APPEND
00009C 019C 110910          10      LD  DE,V_APPEND
00009F 019F 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0000A1 01A1 CD0500          17      CALL    SYSTEM
                                
0000A4 01A4 21BB10          10      LD  HL,N_PROGRAM
0000A7 01A7 11CA12          10      LD  DE,ZERO
0000AA 01AA 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0000AC 01AC CD0500          17      CALL    SYSTEM
                                
0000AF 01AF 21C310          10      LD  HL,N_PARAMETERS
0000B2 01B2 11CA12          10      LD  DE,ZERO
0000B5 01B5 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0000B7 01B7 CD0500          17      CALL    SYSTEM
                                
0000BA 01BA CD5F06          17      CALL    LTNL
       01BD                     COMMAND:
0000BD 01BD E5              11      PUSH    HL
0000BE 01BE 2ACB12          16      LD  HL,(FCB_BAT)
0000C1 01C1 7E               7      LD  A,(HL)
0000C2 01C2 E1              10      POP HL
0000C3 01C3 B7               4      OR  A
0000C4 01C4 C2EC04          10      JP  NZ,C_BAT1
0000C7 01C7 CD8703          17      CALL    SETDTA1
0000CA 01CA D5              11      PUSH    DE
0000CB 01CB C5              11      PUSH    BC
0000CC 01CC E5              11      PUSH    HL
0000CD 01CD 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
0000CF 01CF CD0500          17      CALL    SYSTEM
0000D2 01D2 E1              10      POP HL
0000D3 01D3 C1              10      POP BC
0000D4 01D4 C641             7      ADD A,'A'
0000D6 01D6 CDC60A          17      CALL    MSG_A
0000D9 01D9 1E3E             7      LD  E,'>'
0000DB 01DB CDB50A          17      CALL    _PRINT
0000DE 01DE D1              10      POP DE      ;DE=DTA1
0000DF 01DF 3E50             7      LD  A,80
0000E1 01E1 12               7      LD  (DE),A
0000E2 01E2 0E0A             7      LD  C,0AH       ;(BDOS)文字列入力
0000E4 01E4 CD0500          17      CALL    SYSTEM
0000E7 01E7 CD5F06          17      CALL    LTNL
       01EA                     COMMAND2:
0000EA 01EA 118200          10      LD  DE,DTA1+2
0000ED 01ED CDFC01          17      CALL    COMANL
0000F0 01F0 30CB            12      JR  NC,COMMAND
0000F2 01F2 11B00F          10      LD  DE,COMERM
0000F5 01F5 0E09             7      LD  C,9     ;(BDOS)文字列出力
0000F7 01F7 CD0500          17      CALL    SYSTEM
0000FA 01FA 189D            12      JR  WSTART
                                
       01FC                     COMANL:
0000FC 01FC CDEA0B          17      CALL    TOZERO
0000FF 01FF ED532902        20      LD  (COMST),DE
000103 0203 CD070B          17      CALL    FILE
000106 0206 D5              11      PUSH    DE
000107 0207 11A512          10      LD  DE,FNAME
00010A 020A 1A               7      LD  A,(DE)
00010B 020B FE20             7      CP  020H
00010D 020D CA9A02          10      JP  Z,SDVSW
000110 0210 1B               6      DEC DE
000111 0211 1A               7      LD  A,(DE)
000112 0212 C6FF             7      ADD A,0FFH
000114 0214 380A            12      JR  C,COMB
000116 0216 13               6      INC DE
                                
000117 0217 21FD0E          10      LD  HL,COMTB
00011A 021A 3E11             7      LD  A,COMS
00011C 021C 47               4      LD  B,A
00011D 021D CD3C0C          17      CALL    CPNAME
       0220                     COMB:
000120 0220 D1              10      POP DE
000121 0221 D2B40A          10      JP  NC,JP_HL
       0224                     COMB2:
000124 0224 EB               4      EX  DE,HL
000125 0225 221B04          16      LD  (COMPAT),HL
                                
000128 0228 110000          10      LD  DE,0
       0229                     COMST   EQU $-2
00012B 022B 21D112          10      LD  HL,DATA_COM
00012E 022E 3600            10      LD  (HL),0
       0230                     COMPR1:
000130 0230 1A               7      LD  A,(DE)
000131 0231 13               6      INC DE
000132 0232 23               6      INC HL
000133 0233 77               7      LD  (HL),A
000134 0234 FE20             7      CP  020H
000136 0236 30F8            12      JR  NC,COMPR1
       0238                     COMPR2:
000138 0238 2B               6      DEC HL
000139 0239 7E               7      LD  A,(HL)
00013A 023A FE5C             7      CP  05CH
00013C 023C 2014            12      JR  NZ,COMPR3
00013E 023E 3600            10      LD  (HL),0
000140 0240 23               6      INC HL
000141 0241 EB               4      EX  DE,HL
000142 0242 CD070B          17      CALL    FILE
000145 0245 210210          10      LD  HL,N_APPEND
000148 0248 11D212          10      LD  DE,DATA_COM+1
00014B 024B 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
00014D 024D CD0500          17      CALL    SYSTEM
000150 0250 1804            12      JR  COMPR4
       0252                     COMPR3:
000152 0252 FE20             7      CP  020H
000154 0254 30E2            12      JR  NC,COMPR2
       0256                     COMPR4:
000156 0256 CDDD03          17      CALL    CEXE4
                                
000159 0259 214910          10      LD  HL,N_PATH
00015C 025C 114E10          10      LD  DE,V_PATH
00015F 025F 0640             7      LD  B,PATHX
000161 0261 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000163 0263 CD0500          17      CALL    SYSTEM
                                
000166 0266 214E10          10      LD  HL,V_PATH
000169 0269 22CD12          16      LD  (X_PATH),HL
       026C                     CEX1:
00016C 026C 2ACD12          16      LD  HL,(X_PATH)
00016F 026F 7E               7      LD  A,(HL)
000170 0270 FE20             7      CP  020H
000172 0272 D8              11      RET C
       0273                     CEX2:
000173 0273 7E               7      LD  A,(HL)
000174 0274 FE20             7      CP  020H
000176 0276 3807            12      JR  C,CEX3
000178 0278 FE3B             7      CP  ';'
00017A 027A 2803            12      JR  Z,CEX3
00017C 027C 23               6      INC HL
00017D 027D 18F4            12      JR  CEX2
       027F                     CEX3:
00017F 027F 3600            10      LD  (HL),0
000181 0281 FE20             7      CP  020H
000183 0283 3801            12      JR  C,CEX4
000185 0285 23               6      INC HL
       0286                     CEX4:
000186 0286 ED5BCD12        20      LD  DE,(X_PATH)
00018A 028A 22CD12          16      LD  (X_PATH),HL
00018D 028D 210210          10      LD  HL,N_APPEND
000190 0290 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000192 0292 CD0500          17      CALL    SYSTEM
                                
000195 0295 CDDD03          17      CALL    CEXE4
000198 0298 18D2            12      JR  CEX1
                                
       029A                     SDVSW:
00019A 029A F1              10      POP AF
00019B 029B 3AA412          13      LD  A,(FDRV)
00019E 029E 3D               4      DEC A
00019F 029F 5F               4      LD  E,A
0001A0 02A0 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
0001A2 02A2 C38E03          10      JP  SYSTEM0
                                
       02A5                     OPEN_D2:            ;DOS2対応
0001A5 02A5 3AD310          13      LD  A,(MAJOR_VER)
0001A8 02A8 FE02             7      CP  2
0001AA 02AA 384F            12      JR  C,OPEN
0001AC 02AC 119B11          10      LD  DE,PATH_FN1
0001AF 02AF 180A            12      JR  OPEN_D2X
       02B1                     OPEN1_D2:           ;DOS2対応
0001B1 02B1 3AD310          13      LD  A,(MAJOR_VER)
0001B4 02B4 FE02             7      CP  2
0001B6 02B6 3840            12      JR  C,OPEN1
                                
0001B8 02B8 111B11          10      LD  DE,PATH_CCP
       02BB                     OPEN_D2X:
0001BB 02BB DD21D410        14      LD  IX,SEARCH_IX
0001BF 02BF 014010          10      LD  BC,01040H   ;(BDOS)最初のエントリ検索
0001C2 02C2 CD0500          17      CALL    SYSTEM
0001C5 02C5 F5              11      PUSH    AF
0001C6 02C6 115B11          10      LD  DE,PATH_PAR
0001C9 02C9 0E5E             7      LD  C,05EH      ;(BDOS)完全なパス文字列の獲得(_WPATH)
0001CB 02CB CD0500          17      CALL    SYSTEM
0001CE 02CE AF               4      XOR A
0001CF 02CF 77               7      LD  (HL),A
0001D0 02D0 115B11          10      LD  DE,PATH_PAR
0001D3 02D3 ED52            15      SBC HL,DE
0001D5 02D5 221611          16      LD  (PATH_POS),HL
0001D8 02D8 F1              10      POP AF
       02D9                     FIB2DIRENT:
0001D9 02D9 B7               4      OR  A
0001DA 02DA C0              11      RET NZ
                                
0001DB 02DB 11D510          10      LD  DE,SEARCH_IX+1  ;(FIB)ファイル名
0001DE 02DE 216D12          10      LD  HL,DTA_CCP+1
0001E1 02E1 0E5C             7      LD  C,05CH      ;(BDOS)ファイル名の解析
0001E3 02E3 CD0500          17      CALL    SYSTEM
                                
0001E6 02E6 21E210          10      LD  HL,SEARCH_IX+14 ;(FIB)属性
0001E9 02E9 117812          10      LD  DE,DTA_CCP+1+8+3
0001EC 02EC EDA0            16      LDI
0001EE 02EE 118312          10      LD  DE,DTA_CCP+1+8+3+1+10
0001F1 02F1 010A00          10      LD  BC,2+2+2+4  ;最終変更時刻+最終変更日付+開始クラスタ+ファイルサイズ
0001F4 02F4 EDB0                    LDIR
0001F6 02F6 AF               4      XOR A
0001F7 02F7 C9              10      RET
                                
       02F8                     OPEN1:
0001F8 02F8 21A412          10      LD  HL,FDRV
       02FB                     OPEN:
0001FB 02FB 0E11             7      LD  C,011H      ;(BDOS)最初のファイルの検索
       02FD                     OPEN3:
0001FD 02FD D5              11      PUSH    DE
0001FE 02FE 116C12          10      LD  DE,DTA_CCP
000201 0301 CD7A03          17      CALL    SETDTA
000204 0304 EB               4      EX  DE,HL
000205 0305 CD0500          17      CALL    SYSTEM
000208 0308 D1              10      POP DE
000209 0309 B7               4      OR  A
00020A 030A C9              10      RET
                                
       030B                     OPEN2_D2:           ;DOS2対応
00020B 030B 3AD310          13      LD  A,(MAJOR_VER)
00020E 030E FE02             7      CP  2
000210 0310 380B            12      JR  C,OPEN2
000212 0312 DD21D410        14      LD  IX,SEARCH_IX
000216 0316 0E41             7      LD  C,41H       ;(BDOS)次のエントリ検索
000218 0318 CD0500          17      CALL    SYSTEM
00021B 031B 18BC            12      JR  FIB2DIRENT
       031D                     OPEN2:
00021D 031D 0E12             7      LD  C,012H
00021F 031F 18DC            12      JR  OPEN3
                                
       0321                     DEFCB_D2:           ;DOS2対応
000221 0321 3AD310          13      LD  A,(MAJOR_VER)
000224 0324 FE02             7      CP  2
000226 0326 383A            12      JR  C,DEFCB
000228 0328 215B11          10      LD  HL,PATH_PAR
00022B 032B 111B11          10      LD  DE,PATH_CCP
00022E 032E 014000          10      LD  BC,64
000231 0331 EDB0                    LDIR
000233 0333 2A1611          16      LD  HL,(PATH_POS)
000236 0336 111B11          10      LD  DE,PATH_CCP
000239 0339 19              11      ADD HL,DE
00023A 033A 060D             7      LD  B,13
00023C 033C 11D510          10      LD  DE,SEARCH_IX+1  ;(FIB)ファイル名
       033F                     DCB4:
00023F 033F 1A               7      LD  A,(DE)
000240 0340 B7               4      OR  A
000241 0341 2805            12      JR  Z,DCB5
000243 0343 13               6      INC DE
000244 0344 77               7      LD  (HL),A
000245 0345 23               6      INC HL
000246 0346 18F7            12      JR  DCB4
       0348                     DCB5:
000248 0348 3600            10      LD  (HL),0
00024A 034A 3AED10          13      LD  A,(SEARCH_IX+25)    ;(FIB)ドライブ番号(1-8)
00024D 034D C640             7      ADD A,040H
00024F 034F 111811          10      LD  DE,PATH_DRV
000252 0352 12               7      LD  (DE),A
000253 0353 0E43             7      LD  C,043H      ;_OPEN ファイルハンドルのオープン
000255 0355 3E01             7      LD  A,1     ;書き込み禁止
000257 0357 CD0500          17      CALL    SYSTEM
00025A 035A B7               4      OR  A
00025B 035B C0              11      RET NZ
00025C 035C ED431411        20      LD  (HANDLE1),BC
000260 0360 1815            12      JR  SETDTA100
       0362                     DEFCB:              ;Z=Ok NZ=Error
000262 0362 116C12          10      LD  DE,DTA_CCP
000265 0365 CD8C03          17      CALL    SYSC0F
000268 0368 B7               4      OR  A
000269 0369 C0              11      RET NZ
                                
00026A 036A 210100          10      LD  HL,1
00026D 036D 227A12          16      LD  (DTA_CCP+14),HL
000270 0370 2D               4      DEC L
000271 0371 228D12          16      LD  (DTA_CCP+33),HL
000274 0374 228F12          16      LD  (DTA_CCP+35),HL
       0377                     SETDTA100:
000277 0377 110080          10      LD  DE,DATA
       037A                     SETDTA:
00027A 037A C5              11      PUSH    BC
00027B 037B D5              11      PUSH    DE
00027C 037C E5              11      PUSH    HL
00027D 037D 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
00027F 037F CD0500          17      CALL    SYSTEM
000282 0382 E1              10      POP HL
000283 0383 D1              10      POP DE
000284 0384 C1              10      POP BC
000285 0385 AF               4      XOR A
000286 0386 C9              10      RET
                                
       0387                     SETDTA1:
000287 0387 118000          10      LD  DE,DTA1
00028A 038A 18EE            12      JR  SETDTA
                                
       038C                     SYSC0F:
00028C 038C 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       038E                     SYSTEM0:
00028E 038E CD0500          17      CALL    SYSTEM
000291 0391 B7               4      OR  A
000292 0392 C9              10      RET
                                
       0393                     C_CD:
000293 0393 CDD90A          17      CALL    FILEC_D2
000296 0396 111B11          10      LD  DE,PATH_CCP
000299 0399 1A               7      LD  A,(DE)
00029A 039A FE20             7      CP  020H
00029C 039C 3805            12      JR  C,PWD
00029E 039E 0E5A             7      LD  C,5AH       ;(BDOS)_CHDIR カレントディレクトリの変更
0002A0 03A0 C30500          10      JP  SYSTEM
       03A3                     PWD:
0002A3 03A3 CDA506          17      CALL    PUTDRV
0002A6 03A6 3E5C             7      LD  A,05CH
0002A8 03A8 CDC60A          17      CALL    MSG_A
0002AB 03AB C30A06          10      JP  PDSKF2
                                
       03AE                     S27DTA_D2:      ;DOS2対応
0002AE 03AE 3AD310          13      LD  A,(MAJOR_VER)
0002B1 03B1 FE02             7      CP  2
0002B3 03B3 3817            12      JR  C,S27DTA
0002B5 03B5 ED4B1411        20      LD  BC,(HANDLE1)
0002B9 03B9 110080          10      LD  DE,DATA
0002BC 03BC 0E48             7      LD  C,048H      ;(BDOS)ファイルハンドルからの読み出し(_READ)
0002BE 03BE CD8E03          17      CALL    SYSTEM0
0002C1 03C1 C8              11      RET Z
0002C2 03C2 FEC7             7      CP  0C7H        ;.EOF
0002C4 03C4 2803            12      JR  Z,S27EOF
0002C6 03C6 37               4      SCF
0002C7 03C7 9F               4      SBC A,A
0002C8 03C8 C9              10      RET
       03C9                     S27EOF:
0002C9 03C9 3E01             7      LD  A,1
0002CB 03CB C9              10      RET
                                
       03CC                     S27DTA:
0002CC 03CC 110100          10      LD  DE,1
0002CF 03CF ED537A12        20      LD  (DTA_CCP+14),DE
0002D3 03D3 116C12          10      LD  DE,DTA_CCP
       03D6                     S27:
0002D6 03D6 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
0002D8 03D8 CD0500          17      CALL    SYSTEM
0002DB 03DB B7               4      OR  A
0002DC 03DC C9              10      RET
                                
       03DD                     CEXE4:
0002DD 03DD 21A412          10      LD  HL,FDRV
0002E0 03E0 116C12          10      LD  DE,DTA_CCP
0002E3 03E3 010900          10      LD  BC,1+8
0002E6 03E6 EDB0                    LDIR
0002E8 03E8 217512          10      LD  HL,DTA_CCP+9
0002EB 03EB 3643            10      LD  (HL),'C'
0002ED 03ED 23               6      INC HL
0002EE 03EE 364F            10      LD  (HL),'O'
0002F0 03F0 23               6      INC HL
0002F1 03F1 364D            10      LD  (HL),'M'
       03F3                     C_EXE:
0002F3 03F3 CD6203          17      CALL    DEFCB
0002F6 03F6 C2C404          10      JP  NZ,C_BAT
0002F9 03F9 11D112          10      LD  DE,DATA_COM
0002FC 03FC CD7A03          17      CALL    SETDTA
                                
0002FF 03FF 2A0600          16      LD  HL,(SYSTEM+1)
000302 0402 11D112          10      LD  DE,DATA_COM
000305 0405 ED52            15      SBC HL,DE
                                
000307 0407 CDCC03          17      CALL    S27DTA
00030A 040A 3D               4      DEC A
00030B 040B 37               4      SCF
00030C 040C C0              11      RET NZ
00030D 040D 7C               4      LD  A,H
00030E 040E B5               4      OR  L
00030F 040F 37               4      SCF
000310 0410 C8              11      RET Z
000311 0411 22BE04          16      LD  (COMSIZ),HL
                                
000314 0414 11D112          10      LD  DE,DATA_COM
000317 0417 CD7A03          17      CALL    SETDTA
00031A 041A 110000          10      LD  DE,0
       041B                     COMPAT  EQU $-2
00031D 041D CD5408          17      CALL    SETFCB
                                
000320 0420 210210          10      LD  HL,N_APPEND
000323 0423 111B11          10      LD  DE,PATH_CCP
000326 0426 0640             7      LD  B,PATHX
000328 0428 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
00032A 042A CD0500          17      CALL    SYSTEM
00032D 042D 3A1B11          13      LD  A,(PATH_CCP)
000330 0430 B7               4      OR  A
000331 0431 201D            12      JR  NZ,COM_ENV1
000333 0433 0E19             7      LD  C,019H      ;(BDOS)カレントドライブ番号の獲得(_CURDRV)
000335 0435 CD0500          17      CALL    SYSTEM
000338 0438 C641             7      ADD A,'A'
00033A 043A 321B11          13      LD  (PATH_CCP),A
00033D 043D 3E3A             7      LD  A,':'
00033F 043F 321C11          13      LD  (PATH_CCP+1),A
000342 0442 3E5C             7      LD  A,05CH      ;\
000344 0444 321D11          13      LD  (PATH_CCP+2),A
000347 0447 47               4      LD  B,A     ;ドライブ
000348 0448 111D11          10      LD  DE,PATH_CCP+2
00034B 044B 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
00034D 044D CD0500          17      CALL    SYSTEM
       0450                     COM_ENV1:
000350 0450 116C12          10      LD  DE,DTA_CCP
000353 0453 215E12          10      LD  HL,DOS2NAME
000356 0456 CD1A0A          17      CALL    FCB2FNAME
000359 0459 111B11          10      LD  DE,PATH_CCP
00035C 045C 216012          10      LD  HL,DOS2NAME+2
       045F                     COM_ENV2:
00035F 045F 1A               7      LD  A,(DE)
000360 0460 B7               4      OR  A
000361 0461 2803            12      JR  Z,COM_ENV3
000363 0463 13               6      INC DE
000364 0464 18F9            12      JR  COM_ENV2
       0466                     COM_ENV3:
000366 0466 1B               6      DEC DE
000367 0467 1A               7      LD  A,(DE)
000368 0468 13               6      INC DE
000369 0469 FE5C             7      CP  05CH
00036B 046B 2804            12      JR  Z,COM_ENV4
00036D 046D 3E5C             7      LD  A,05CH
00036F 046F 12               7      LD  (DE),A
000370 0470 13               6      INC DE
       0471                     COM_ENV4:
000371 0471 7E               7      LD  A,(HL)
000372 0472 23               6      INC HL
000373 0473 12               7      LD  (DE),A
000374 0474 13               6      INC DE
000375 0475 B7               4      OR  A
000376 0476 20F9            12      JR  NZ,COM_ENV4
                                
000378 0478 21BB10          10      LD  HL,N_PROGRAM
00037B 047B 111B11          10      LD  DE,PATH_CCP
00037E 047E 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000380 0480 CD0500          17      CALL    SYSTEM
                                
000383 0483 21C310          10      LD  HL,N_PARAMETERS
000386 0486 118100          10      LD  DE,DTA1+1
000389 0489 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
00038B 048B CD0500          17      CALL    SYSTEM
                                
00038E 048E 210210          10      LD  HL,N_APPEND
000391 0491 110910          10      LD  DE,V_APPEND
000394 0494 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000396 0496 CD0500          17      CALL    SYSTEM
                                
000399 0499 0E60             7      LD  C,60H       ;(BDOS)子プロセスの起動
00039B 049B CD0500          17      CALL    SYSTEM
00039E 049E B7               4      OR  A
00039F 049F 2004            12      JR  NZ,COMP1
0003A1 04A1 78               4      LD  A,B
0003A2 04A2 32D012          13      LD  (PROCESS),A
       04A5                     COMP1:
0003A5 04A5 AF               4      XOR A
0003A6 04A6 67               4      LD  H,A
0003A7 04A7 6F               4      LD  L,A ;HL=0x0000
0003A8 04A8 32C4F7          13      LD  (TRCFLG),A
0003AB 04AB F3               4      DI
0003AC 04AC ED7B0600        20      LD  SP,(SYSTEM+1)
0003B0 04B0 E5              11      PUSH    HL
0003B1 04B1 21EDB0          10      LD  HL,0B0EDH   ;LDIR
0003B4 04B4 22FE00          16      LD  (000FEH),HL
0003B7 04B7 21D112          10      LD  HL,DATA_COM
0003BA 04BA 110001          10      LD  DE,00100H
0003BD 04BD 010000          10      LD  BC,0
       04BE                     COMSIZ  EQU $-2
0003C0 04C0 FB               4      EI
0003C1 04C1 C3FE00          10      JP  000FEH
                                
       04C4                     C_BAT:
0003C4 04C4 217512          10      LD  HL,DTA_CCP+9
0003C7 04C7 3642            10      LD  (HL),'B'
0003C9 04C9 23               6      INC HL
0003CA 04CA 3641            10      LD  (HL),'A'
0003CC 04CC 23               6      INC HL
0003CD 04CD 3654            10      LD  (HL),'T'
                                
0003CF 04CF CD6203          17      CALL    DEFCB
0003D2 04D2 C0              11      RET NZ
                                
0003D3 04D3 216C12          10      LD  HL,DTA_CCP
0003D6 04D6 7E               7      LD  A,(HL)
0003D7 04D7 B7               4      OR  A
0003D8 04D8 2009            12      JR  NZ,CBAT_DS
0003DA 04DA E5              11      PUSH    HL
0003DB 04DB 0E19             7      LD  C,019H      ;(BDOS)カレントドライブ番号の獲得(_CURDRV)
0003DD 04DD CD0500          17      CALL    SYSTEM
0003E0 04E0 E1              10      POP HL
0003E1 04E1 3C               4      INC A
0003E2 04E2 77               7      LD  (HL),A
       04E3                     CBAT_DS:
0003E3 04E3 ED5BCB12        20      LD  DE,(FCB_BAT)
0003E7 04E7 012500          10      LD  BC,37
0003EA 04EA EDB0                    LDIR
       04EC                     C_BAT1:
0003EC 04EC CD7703          17      CALL    SETDTA100
0003EF 04EF CD2D05          17      CALL    FGETC_BAT
0003F2 04F2 218100          10      LD  HL,DTA1+1
0003F5 04F5 202A            12      JR  NZ,END_BATCH
0003F7 04F7 FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
0003F9 04F9 38F1            12      JR  C,C_BAT1
0003FB 04FB 3620            10      LD  (HL),' '
0003FD 04FD 23               6      INC HL
       04FE                     C_BAT2:
0003FE 04FE 77               7      LD  (HL),A
0003FF 04FF 23               6      INC HL
000400 0500 7D               4      LD  A,L
000401 0501 3C               4      INC A       ;L==0FFH
000402 0502 2809            12      JR  Z,RUN_BATCH
000404 0504 CD2D05          17      CALL    FGETC_BAT
000407 0507 2004            12      JR  NZ,RUN_BATCH
000409 0509 FE20             7      CP  020H
00040B 050B 30F1            12      JR  NC,C_BAT2
       050D                     RUN_BATCH:
00040D 050D 7D               4      LD  A,L
00040E 050E D67F             7      SUB DTA1-1
000410 0510 328000          13      LD  (DTA1),A
000413 0513 FE04             7      CP  4
000415 0515 380A            12      JR  C,END_BATCH
000417 0517 3600            10      LD  (HL),0
000419 0519 3A9BFC          13      LD  A,(INTFLG)
00041C 051C FE03             7      CP  3
00041E 051E C2EA01          10      JP  NZ,COMMAND2
       0521                     END_BATCH:      ;バッチファイルを閉じる
000421 0521 2ACB12          16      LD  HL,(FCB_BAT)
000424 0524 3600            10      LD  (HL),0
000426 0526 ED7B0600        20      LD  SP,(SYSTEM+1)
00042A 052A C39901          10      JP  WSTART
                                
       052D                     FGETC_BAT:
00042D 052D ED5BCB12        20      LD  DE,(FCB_BAT)
       0531                     FGETC:              ;1文字ずつ読み込む
000431 0531 E5              11      PUSH    HL      ;Z:成功
000432 0532 210100          10      LD  HL,1
000435 0535 CDD603          17      CALL    S27
000438 0538 E1              10      POP HL
000439 0539 3A0080          13      LD  A,(DATA)
00043C 053C C9              10      RET
                                
       053D                     C_REM:
00043D 053D AF               4      XOR A
00043E 053E C9              10      RET
                                
       053F                     C_DEL:
00043F 053F CD5408          17      CALL    SETFCB
000442 0542 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力
000444 0544 CD0500          17      CALL    SYSTEM
000447 0547 0600             7      LD  B,0
000449 0549 3AD310          13      LD  A,(MAJOR_VER)
00044C 054C FE02             7      CP  2
00044E 054E 381E            12      JR  C,CDEL_DOS1
                                
000450 0550 215C00          10      LD  HL,FCB1
000453 0553 CDA502          17      CALL    OPEN_D2
000456 0556 37               4      SCF
       0557                     DEL1:
000457 0557 C0              11      RET NZ
000458 0558 3AE210          13      LD  A,(SEARCH_IX+14);   (FIB)属性
00045B 055B CB67             8      BIT 4,A
00045D 055D 200A            12      JR  NZ,DEL2
                                
00045F 055F 11D410          10      LD  DE,SEARCH_IX
000462 0562 0E4D             7      LD  C,04DH      ;(BDOS)ファイル・サブディレクトリの削除(_DELETE)
000464 0564 CD8E03          17      CALL    SYSTEM0
000467 0567 37               4      SCF
000468 0568 C0              11      RET NZ
       0569                     DEL2:
000469 0569 CD0B03          17      CALL    OPEN2_D2
00046C 056C 18E9            12      JR  DEL1
                                
       056E                     CDEL_DOS1:
00046E 056E 0E13             7      LD  C,013H
000470 0570 1811            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       0572                     C_REN:
000472 0572 3AD310          13      LD  A,(MAJOR_VER)
000475 0575 FE02             7      CP  2
000477 0577 3013            12      JR  NC,REN_DOS2
000479 0579 CD5408          17      CALL    SETFCB
00047C 057C 3E10             7      LD  A,010H      ;ディレクトリも対象にする(LSX-Dodgers)
00047E 057E 326900          13      LD  (FCB1+13),A ;属性
000481 0581 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       0583                     CDEL1:
000483 0583 115C00          10      LD  DE,FCB1
       0586                     REN2:
000486 0586 CD0500          17      CALL    SYSTEM
000489 0589 C6FF             7      ADD A,0FFH
00048B 058B C9              10      RET
                                
       058C                     REN_DOS2:           ;DOS2のリネーム(ディレクトリ対応)
00048C 058C CDE40B          17      CALL    SPCUT
00048F 058F 6B               4      LD  L,E
000490 0590 62               4      LD  H,D
       0591                     REN_D2_1:
000491 0591 7E               7      LD  A,(HL)
000492 0592 FE21             7      CP  020H+1
000494 0594 3803            12      JR  C,REN_D2_2
000496 0596 23               6      INC HL
000497 0597 18F8            12      JR  REN_D2_1
       0599                     REN_D2_2:
000499 0599 3600            10      LD  (HL),0
00049B 059B 23               6      INC HL
00049C 059C 0E4E             7      LD  C,04EH      ;(BDOS)ファイルあるいはサブディレクトリ名の変更(_RENAME)
00049E 059E 18E6            12      JR  REN2
                                
       05A0                     C_DIR:
0004A0 05A0 CDD90A          17      CALL    FILEC_D2
0004A3 05A3 21A512          10      LD  HL,FDRV+1
0004A6 05A6 CD9A0A          17      CALL    CWILD1
0004A9 05A9 3EF1             7      LD  A,0F1H
0004AB 05AB 32B112          13      LD  (FDRV+13),A
0004AE 05AE CDB102          17      CALL    OPEN1_D2
       05B1                     CDIR1:
0004B1 05B1 B7               4      OR  A
0004B2 05B2 2008            12      JR  NZ,PDSKF
0004B4 05B4 CD3706          17      CALL    P_NAME
0004B7 05B7 CD0B03          17      CALL    OPEN2_D2
0004BA 05BA 18F5            12      JR  CDIR1
                                
       05BC                     PDSKF:
0004BC 05BC 3AA412          13      LD  A,(FDRV)
0004BF 05BF 5F               4      LD  E,A
0004C0 05C0 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0004C2 05C2 CD0500          17      CALL    SYSTEM
0004C5 05C5 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0004C6 05C6 C601             7      ADD A,001H
0004C8 05C8 D8              11      RET C       ;Aが0FFHだった場合
0004C9 05C9 3E06             7      LD  A,8-2
       05CB                     PDS1:               ;HL=未使用クラスタの総数
0004CB 05CB 3C               4      INC A
0004CC 05CC CB19             8      RR  C
0004CE 05CE 30FB            12      JR  NC,PDS1
       05D0                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0004D0 05D0 3C               4      INC A
0004D1 05D1 CB18             8      RR  B
0004D3 05D3 30FB            12      JR  NC,PDS2
0004D5 05D5 47               4      LD  B,A
                                
0004D6 05D6 110000          10      LD  DE,0
       05D9                     PDS3:
0004D9 05D9 29              11      ADD HL,HL
0004DA 05DA EB               4      EX  DE,HL
0004DB 05DB ED6A            15      ADC HL,HL
0004DD 05DD EB               4      EX  DE,HL
0004DE 05DE 10F9            13      DJNZ    PDS3
       05E0                     PDSKF1:
0004E0 05E0 CDC506          17      CALL    PRDEC_DEHL
0004E3 05E3 11960F          10      LD  DE,FREE
0004E6 05E6 0E09             7      LD  C,9     ;(BDOS)文字列出力
0004E8 05E8 CD0500          17      CALL    SYSTEM
0004EB 05EB CDA506          17      CALL    PUTDRV
0004EE 05EE 3E5C             7      LD  A,05CH      ;\
0004F0 05F0 CDC60A          17      CALL    MSG_A
0004F3 05F3 3AD310          13      LD  A,(MAJOR_VER)
0004F6 05F6 FE01             7      CP  1
0004F8 05F8 3865            12      JR  C,LTNL
0004FA 05FA 200E            12      JR  NZ,PDSKF2
0004FC 05FC 2AB212          16      LD  HL,(FDRV+14)
0004FF 05FF AF               4      XOR A
000500 0600 11FEFF          10      LD  DE,0-2
000503 0603 19              11      ADD HL,DE
000504 0604 23               6      INC HL
000505 0605 DCC106          17      CALL    C,PRDEC_HL
000508 0608 1855            12      JR  LTNL
       060A                     PDSKF2:             ;MSX-DOS2
00050A 060A 3AA412          13      LD  A,(FDRV)
00050D 060D 47               4      LD  B,A     ;ドライブ
00050E 060E 110080          10      LD  DE,DATA
000511 0611 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
000513 0613 CD0500          17      CALL    SYSTEM
000516 0616 210080          10      LD  HL,DATA
                                
000519 0619 CD2106          17      CALL    MSX
00051C 061C 1841            12      JR  LTNL
                                
       061E                     MSX1:
00051E 061E CDC60A          17      CALL    MSG_A
       0621                     MSX:
000521 0621 7E               7      LD  A,(HL)
000522 0622 23               6      INC HL
000523 0623 B7               4      OR  A
000524 0624 20F8            12      JR  NZ,MSX1
000526 0626 C9              10      RET
                                
       0627                     MSXSLT1:
000527 0627 CDC60A          17      CALL    MSG_A
       062A                     MSXSLT:
00052A 062A C5              11      PUSH    BC
00052B 062B E5              11      PUSH    HL
00052C 062C 78               4      LD  A,B
00052D 062D CD0C00          17      CALL    RDSLT
000530 0630 E1              10      POP HL
000531 0631 C1              10      POP BC
000532 0632 23               6      INC HL
000533 0633 B7               4      OR  A
000534 0634 20F1            12      JR  NZ,MSXSLT1
000536 0636 C9              10      RET
                                
       0637                     P_NAME:
000537 0637 216D12          10      LD  HL,DTA_CCP+1
00053A 063A 7E               7      LD  A,(HL)
00053B 063B FE2E             7      CP  '.'
00053D 063D C8              11      RET Z
00053E 063E CD1B07          17      CALL    FPRNT
000541 0641 3A7812          13      LD  A,(DTA_CCP+12)
000544 0644 CB67             8      BIT 4,A
000546 0646 280A            12      JR  Z,DIR3
000548 0648 11A40F          10      LD  DE,DIRMES
00054B 064B 0E09             7      LD  C,9     ;(BDOS)文字列出力
00054D 064D CD0500          17      CALL    SYSTEM
000550 0650 180A            12      JR  DIR6
       0652                     DIR3:
000552 0652 ED5B8B12        20      LD  DE,(DTA_CCP+1+01EH)
000556 0656 2A8912          16      LD  HL,(DTA_CCP+1+01CH)
000559 0659 CDC506          17      CALL    PRDEC_DEHL
       065C                     DIR6:
00055C 065C CD3D07          17      CALL    PRTTMS
                                
       065F                     LTNL:
00055F 065F 1E0D             7      LD  E,00DH
000561 0661 CDB50A          17      CALL    _PRINT
000564 0664 1E0A             7      LD  E,00AH
000566 0666 C3B50A          10      JP  _PRINT
                                
       0669                     C_PATH:
000569 0669 CDE40B          17      CALL    SPCUT
00056C 066C FE21             7      CP  021H
00056E 066E 301C            12      JR  NC,CPATH0
                                
000570 0670 214910          10      LD  HL,N_PATH
000573 0673 114E10          10      LD  DE,V_PATH
000576 0676 0640             7      LD  B,PATHX
000578 0678 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
00057A 067A CD0500          17      CALL    SYSTEM
00057D 067D 214E10          10      LD  HL,V_PATH
       0680                     CPATHP:
000580 0680 7E               7      LD  A,(HL)
000581 0681 23               6      INC HL
000582 0682 FE20             7      CP  020H
000584 0684 3F               4      CCF
000585 0685 30D8            12      JR  NC,LTNL
000587 0687 CDC60A          17      CALL    MSG_A
00058A 068A 18F4            12      JR  CPATHP
       068C                     CPATH0:
00058C 068C 214E10          10      LD  HL,V_PATH
00058F 068F FE3B             7      CP  ';'
000591 0691 2001            12      JR  NZ,CPATH1
000593 0693 13               6      INC DE
       0694                     CPATH1:
000594 0694 EB               4      EX  DE,HL
000595 0695 014000          10      LD  BC,PATHX
000598 0698 EDB0                    LDIR
                                
00059A 069A 214910          10      LD  HL,N_PATH
00059D 069D 114E10          10      LD  DE,V_PATH
0005A0 06A0 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0005A2 06A2 C30500          10      JP  SYSTEM
                                
       06A5                     PUTDRV:
0005A5 06A5 3AA412          13      LD  A,(FDRV)
0005A8 06A8 B7               4      OR  A
0005A9 06A9 200C            12      JR  NZ,PUTDRV1
0005AB 06AB C5              11      PUSH    BC
0005AC 06AC D5              11      PUSH    DE
0005AD 06AD E5              11      PUSH    HL
0005AE 06AE 0E19             7      LD  C,019H
0005B0 06B0 CD0500          17      CALL    SYSTEM
0005B3 06B3 E1              10      POP HL
0005B4 06B4 D1              10      POP DE
0005B5 06B5 C1              10      POP BC
0005B6 06B6 3C               4      INC A
       06B7                     PUTDRV1:
0005B7 06B7 C640             7      ADD A,'A'-1
0005B9 06B9 CDC60A          17      CALL    MSG_A
0005BC 06BC 3E3A             7      LD  A,':'
       06BE                     MSG_AR:
0005BE 06BE C3C60A          10      JP  MSG_A
                                
       06C1                     PRDEC_HL:
0005C1 06C1 AF               4      XOR A
       06C2                     PRDEC_AHL:
0005C2 06C2 5F               4      LD  E,A
0005C3 06C3 1600             7      LD  D,0
       06C5                     PRDEC_DEHL:
0005C5 06C5 3E02             7      LD  A,2
0005C7 06C7 321007          13      LD  (DEC6+1),A
0005CA 06CA AF               4      XOR A
0005CB 06CB E5              11      PUSH    HL
0005CC 06CC 219E12          10      LD  HL,DECBF
0005CF 06CF 0605             7      LD  B,5
0005D1 06D1 CDAB0B          17      CALL    FILL_MEMORY
0005D4 06D4 E1              10      POP HL
                                
0005D5 06D5 0E20             7      LD  C,32
       06D7                     DEC1:
0005D7 06D7 29              11      ADD HL,HL
0005D8 06D8 EB               4      EX  DE,HL
0005D9 06D9 ED6A            15      ADC HL,HL
0005DB 06DB EB               4      EX  DE,HL
0005DC 06DC E5              11      PUSH    HL
0005DD 06DD 21A212          10      LD  HL,DECBF+4
0005E0 06E0 0605             7      LD  B,5
       06E2                     DEC2:
0005E2 06E2 7E               7      LD  A,(HL)
0005E3 06E3 8F               4      ADC A,A
0005E4 06E4 27               4      DAA
0005E5 06E5 77               7      LD  (HL),A
0005E6 06E6 2B               6      DEC HL
0005E7 06E7 10F9            13      DJNZ    DEC2
0005E9 06E9 E1              10      POP HL
0005EA 06EA 0D               4      DEC C
0005EB 06EB 20EA            12      JR  NZ,DEC1
                                
0005ED 06ED 219E12          10      LD  HL,DECBF
0005F0 06F0 3E20             7      LD  A,020H
0005F2 06F2 0604             7      LD  B,4
       06F4                     DEC3:
0005F4 06F4 CD0107          17      CALL    DEC4
0005F7 06F7 CD0107          17      CALL    DEC4
0005FA 06FA 23               6      INC HL
0005FB 06FB 10F7            13      DJNZ    DEC3
       06FD                     DECX:
0005FD 06FD CD0107          17      CALL    DEC4
000600 0700 AF               4      XOR A
       0701                     DEC4:
000601 0701 ED6F            18      RLD
000603 0703 FE20             7      CP  020H
000605 0705 2808            12      JR  Z,DEC6
000607 0707 F630             7      OR  030H
       0709                     DEC5:
000609 0709 18B3            12      JR  MSG_AR
       070B                     DEC7:
00060B 070B 3E20             7      LD  A,020H
00060D 070D 18AF            12      JR  MSG_AR
       070F                     DEC6:
00060F 070F 3E02             7      LD  A,2
000611 0711 B7               4      OR  A
000612 0712 28F7            12      JR  Z,DEC7
000614 0714 3D               4      DEC A
000615 0715 321007          13      LD  (DEC6+1),A
000618 0718 3E20             7      LD  A,020H
00061A 071A C9              10      RET
                                
       071B                     FPRNT:
00061B 071B 0608             7      LD  B,8
00061D 071D CD2E07          17      CALL    P_N1
000620 0720 7E               7      LD  A,(HL)
000621 0721 C680             7      ADD A,0A0H-020H
000623 0723 FEA0             7      CP  0A0H
000625 0725 2802            12      JR  Z,FPR1
000627 0727 3E2E             7      LD  A,'.'
       0729                     FPR1:
000629 0729 CDC60A          17      CALL    MSG_A
00062C 072C 0603             7      LD  B,3
                                
       072E                     P_N1:
00062E 072E C5              11      PUSH    BC
00062F 072F E5              11      PUSH    HL
000630 0730 7E               7      LD  A,(HL)
000631 0731 CD030C          17      CALL    CAP3
000634 0734 CDC60A          17      CALL    MSG_A
000637 0737 E1              10      POP HL
000638 0738 C1              10      POP BC
000639 0739 23               6      INC HL
00063A 073A 10F2            13      DJNZ    P_N1
00063C 073C C9              10      RET
                                
       073D                     PRTTMS:
00063D 073D 3E20             7      LD  A,020H
00063F 073F CDC60A          17      CALL    MSG_A
                                
000642 0742 2A8512          16      LD  HL,(DTA_CCP+1+24)
000645 0745 7D               4      LD  A,L
000646 0746 B7               4      OR  A
000647 0747 C8              11      RET Z
000648 0748 CB3C             8      SRL H
00064A 074A 17               4      RLA
00064B 074B 17               4      RLA
00064C 074C 17               4      RLA
00064D 074D 17               4      RLA
00064E 074E E60F             7      AND 00FH
000650 0750 57               4      LD  D,A
000651 0751 DD219310        14      LD  IX,V_DATE
       0755                     PRTTMS1:
000655 0755 DD7E00          19      LD  A,(IX+0)
000658 0758 B7               4      OR  A
000659 0759 2808            12      JR  Z,PRTTMS2
00065B 075B CDDE07          17      CALL    PR_DATE
00065E 075E CD4908          17      CALL    PR_DATE_SPLITER
000661 0761 18F2            12      JR  PRTTMS1
       0763                     PRTTMS2:
                                
000663 0763 CDE20C          17      CALL    GET_WIDTH
000666 0766 FE21             7      CP  32+1
000668 0768 3005            12      JR  NC,SHOW_TIME
00066A 076A 3E1D             7      LD  A,01DH
00066C 076C C3C60A          10      JP  MSG_A
       076F                     SHOW_TIME:
00066F 076F 2A8312          16      LD  HL,(DTA_CCP+1+22)
                                
000672 0772 3E20             7      LD  A,020H
000674 0774 CDC60A          17      CALL    MSG_A
000677 0777 7C               4      LD  A,H
000678 0778 65               4      LD  H,L
000679 0779 1F               4      RRA
00067A 077A CB1D             8      RR  L
00067C 077C 1F               4      RRA
00067D 077D CB1D             8      RR  L
00067F 077F 1F               4      RRA
000680 0780 CB1D             8      RR  L
000682 0782 E61F             7      AND 01FH
000684 0784 4F               4      LD  C,A
000685 0785 3AB810          13      LD  A,(V_TIME)
000688 0788 FE31             7      CP  '1'
00068A 078A 79               4      LD  A,C
00068B 078B 200B            12      JR  NZ,TIME24
00068D 078D FE0C             7      CP  12
00068F 078F 3802            12      JR  C,TIME12
000691 0791 D60C             7      SUB 12
       0793                     TIME12:
000693 0793 B7               4      OR  A
000694 0794 2002            12      JR  NZ,TIME24
000696 0796 C60C             7      ADD A,12
       0798                     TIME24:
000698 0798 C5              11      PUSH    BC
000699 0799 CDC907          17      CALL    PRDEC_A
00069C 079C 3E3A             7      LD  A,':'
00069E 079E CDC60A          17      CALL    MSG_A
0006A1 07A1 7D               4      LD  A,L
0006A2 07A2 0F               4      RRCA
0006A3 07A3 0F               4      RRCA
0006A4 07A4 E63F             7      AND 03FH
0006A6 07A6 CDC907          17      CALL    PRDEC_A
                                
0006A9 07A9 3E3A             7      LD  A,':'
0006AB 07AB CDC60A          17      CALL    MSG_A
0006AE 07AE 7C               4      LD  A,H
0006AF 07AF E61F             7      AND 01FH
0006B1 07B1 87               4      ADD A,A
0006B2 07B2 CDC907          17      CALL    PRDEC_A
                                
0006B5 07B5 3AB810          13      LD  A,(V_TIME)
0006B8 07B8 FE31             7      CP  '1'
0006BA 07BA C1              10      POP BC
0006BB 07BB C0              11      RET NZ
0006BC 07BC 79               4      LD  A,C
0006BD 07BD 1E61             7      LD  E,'a'
0006BF 07BF FE0C             7      CP  12
0006C1 07C1 DAB50A          10      JP  C,_PRINT
0006C4 07C4 1E70             7      LD  E,'p'
0006C6 07C6 C3B50A          10      JP  _PRINT
                                
                                ;   PRINT10
                                
       07C9                     PRDEC_A:
0006C9 07C9 E5              11      PUSH    HL
0006CA 07CA 0608             7      LD  B,8
0006CC 07CC 4F               4      LD  C,A
0006CD 07CD AF               4      XOR A
       07CE                     PRTA1:
0006CE 07CE CB01             8      RLC C
0006D0 07D0 8F               4      ADC A,A
0006D1 07D1 27               4      DAA
0006D2 07D2 10FA            13      DJNZ    PRTA1
0006D4 07D4 219E12          10      LD  HL,DECBF
0006D7 07D7 77               7      LD  (HL),A
0006D8 07D8 AF               4      XOR A
0006D9 07D9 CDFD06          17      CALL    DECX
0006DC 07DC E1              10      POP HL
0006DD 07DD C9              10      RET
                                
       07DE                     PR_DATE:
0006DE 07DE DD7E00          19      LD  A,(IX+0)
0006E1 07E1 FE20             7      CP  020H
0006E3 07E3 D8              11      RET C
0006E4 07E4 CDF70B          17      CALL    CAP
0006E7 07E7 FE44             7      CP  'D'
0006E9 07E9 2848            12      JR  Z,PR_DAY
0006EB 07EB FE4D             7      CP  'M'
0006ED 07ED 2820            12      JR  Z,PR_MONTH
0006EF 07EF FE59             7      CP  'Y'
0006F1 07F1 2046            12      JR  NZ,PR_DATE1
0006F3 07F3 4F               4      LD  C,A
0006F4 07F4 DD7E02          19      LD  A,(IX+2)
0006F7 07F7 CDF70B          17      CALL    CAP
0006FA 07FA B9               4      CP  C
0006FB 07FB 200A            12      JR  NZ,YEAR2
0006FD 07FD 7C               4      LD  A,H     ;YEAR
0006FE 07FE C6EC             7      ADD A,80+256-100
000700 0800 3E13             7      LD  A,19
000702 0802 CE00             7      ADC A,0
000704 0804 CDC907          17      CALL    PRDEC_A     ;年4桁
       0807                     YEAR2:
000707 0807 7C               4      LD  A,H     ;YEAR
000708 0808 C650             7      ADD A,80
00070A 080A CDC907          17      CALL    PRDEC_A
00070D 080D 182A            12      JR  PR_DATE1
       080F                     PR_MONTH:
00070F 080F 4F               4      LD  C,A
000710 0810 DD7E02          19      LD  A,(IX+2)
000713 0813 CDF70B          17      CALL    CAP
000716 0816 B9               4      CP  C
000717 0817 2014            12      JR  NZ,MONTH2
000719 0819 E5              11      PUSH    HL      ;月を文字列で表示 Jan等
00071A 081A D5              11      PUSH    DE
00071B 081B 7A               4      LD  A,D
00071C 081C 3D               4      DEC A
00071D 081D 87               4      ADD A,A
00071E 081E 87               4      ADD A,A
00071F 081F 21D20F          10      LD  HL,S_MONTH
000722 0822 1600             7      LD  D,0
000724 0824 5F               4      LD  E,A
000725 0825 19              11      ADD HL,DE
000726 0826 CD2106          17      CALL    MSX
000729 0829 D1              10      POP DE
00072A 082A E1              10      POP HL
00072B 082B 180C            12      JR  PR_DATE1
       082D                     MONTH2:
00072D 082D 7A               4      LD  A,D     ;月を数字で表示
00072E 082E CDC907          17      CALL    PRDEC_A
000731 0831 1806            12      JR  PR_DATE1
       0833                     PR_DAY:
000733 0833 7D               4      LD  A,L
000734 0834 E61F             7      AND 01FH
000736 0836 CDC907          17      CALL    PRDEC_A
       0839                     PR_DATE1:
000739 0839 DD23            10      INC IX
00073B 083B DD7E00          19      LD  A,(IX+0)
00073E 083E CDF70B          17      CALL    CAP
000741 0841 FE41             7      CP  'A'
000743 0843 D8              11      RET C
000744 0844 FE5B             7      CP  'Z'+1
000746 0846 38F1            12      JR  C,PR_DATE1
000748 0848 C9              10      RET
       0849                     PR_DATE_SPLITER:
000749 0849 DD7E00          19      LD  A,(IX+0)
00074C 084C FE20             7      CP  020H
00074E 084E D8              11      RET C
00074F 084F DD23            10      INC IX
000751 0851 C3C60A          10      JP  MSG_A
                                
       0854                     SETFCB:
000754 0854 CDE40B          17      CALL    SPCUT
000757 0857 1A               7      LD  A,(DE)
000758 0858 FE20             7      CP  020H
00075A 085A 3801            12      JR  C,SETFCBA
00075C 085C 1B               6      DEC DE
       085D                     SETFCBA:
00075D 085D D5              11      PUSH    DE
00075E 085E 215C00          10      LD  HL,FCB1
000761 0861 115D00          10      LD  DE,FCB1+1
000764 0864 012300          10      LD  BC,00023H
000767 0867 70               7      LD  (HL),B      ;B=0
000768 0868 EDB0                    LDIR
00076A 086A D1              10      POP DE
00076B 086B D5              11      PUSH    DE
00076C 086C 215C00          10      LD  HL,FCB1
00076F 086F DD219B11        14      LD  IX,PATH_FN1
000773 0873 CD880C          17      CALL    _SYS29      ;ファイル名の解析
000776 0876 216C00          10      LD  HL,FCB2
000779 0879 DD21DB11        14      LD  IX,PATH_FN2
00077D 087D CD880C          17      CALL    _SYS29      ;ファイル名の解析
000780 0880 E1              10      POP HL
000781 0881 010050          10      LD  BC,05000H
000784 0884 118100          10      LD  DE,00081H
       0887                     SETFCB1:
000787 0887 7E               7      LD  A,(HL)
000788 0888 23               6      INC HL
000789 0889 FE20             7      CP  020H
00078B 088B 3805            12      JR  C,SETFCB2
00078D 088D 12               7      LD  (DE),A
00078E 088E 13               6      INC DE
00078F 088F 0C               4      INC C
000790 0890 10F5            13      DJNZ    SETFCB1
       0892                     SETFCB2:
000792 0892 79               4      LD  A,C
000793 0893 328000          13      LD  (DTA1),A
000796 0896 04               4      INC B
000797 0897 AF               4      XOR A
       0898                     SETFCB3:
000798 0898 12               7      LD  (DE),A
000799 0899 13               6      INC DE
00079A 089A 10FC            13      DJNZ    SETFCB3
00079C 089C C9              10      RET
                                
       089D                     C_COPY:
00079D 089D CD5408          17      CALL    SETFCB
0007A0 08A0 3AD310          13      LD  A,(MAJOR_VER)
0007A3 08A3 FE02             7      CP  2
0007A5 08A5 3810            12      JR  C,COPYI0
0007A7 08A7 11DB11          10      LD  DE,PATH_FN2
0007AA 08AA CDF50C          17      CALL    IS_FOLDER
0007AD 08AD 3808            12      JR  C,COPYI0
0007AF 08AF 21A512          10      LD  HL,FDRV+1
0007B2 08B2 060B             7      LD  B,8+3
0007B4 08B4 CDA90B          17      CALL    FILE10
       08B7                     COPYI0:
0007B7 08B7 3AA412          13      LD  A,(FDRV)
0007BA 08BA 47               4      LD  B,A
0007BB 08BB B7               4      OR  A
0007BC 08BC 200B            12      JR  NZ,COPYI1
0007BE 08BE C5              11      PUSH    BC
0007BF 08BF 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
0007C1 08C1 CD0500          17      CALL    SYSTEM
0007C4 08C4 3C               4      INC A
0007C5 08C5 32A412          13      LD  (FDRV),A
0007C8 08C8 C1              10      POP BC
       08C9                     COPYI1:
0007C9 08C9 C640             7      ADD A,040H
0007CB 08CB 321B12          13      LD  (CUR_DRV),A
0007CE 08CE 111E12          10      LD  DE,CUR_PATH
0007D1 08D1 0E59             7      LD  C,059H      ;(BDOS)カレントディレクトリの獲得(_GETCD)
0007D3 08D3 CD0500          17      CALL    SYSTEM
0007D6 08D6 CDE808          17      CALL    COPYSUB
       08D9                     RES_CUR_PATH:
0007D9 08D9 111B12          10      LD  DE,CUR_DRV
       08DC                     SET_CUR_PATH:
0007DC 08DC F5              11      PUSH    AF
0007DD 08DD 3AA412          13      LD  A,(FDRV)
0007E0 08E0 47               4      LD  B,A
0007E1 08E1 0E5A             7      LD  C,05AH      ;(BDOS)カレントディレクトリの変更(_CHDIR)
0007E3 08E3 CD0500          17      CALL    SYSTEM
0007E6 08E6 F1              10      POP AF
0007E7 08E7 C9              10      RET
       08E8                     COPYSUB:
0007E8 08E8 11CA12          10      LD  DE,ZERO
0007EB 08EB CDFF0A          17      CALL    FILEC2
0007EE 08EE 216C00          10      LD  HL,FCB2
0007F1 08F1 CDCC0C          17      CALL    S29X1
                                
0007F4 08F4 3E10             7      LD  A,010H
0007F6 08F6 326900          13      LD  (FCB1+13),A
0007F9 08F9 216D00          10      LD  HL,FCB2+1
0007FC 08FC CD9A0A          17      CALL    CWILD1
       08FF                     COPY0:
0007FF 08FF CD970A          17      CALL    CWILD
000802 0902 215C00          10      LD  HL,FCB1
000805 0905 CDA502          17      CALL    OPEN_D2
000808 0908 37               4      SCF
       0909                     COPY1:
000809 0909 C0              11      RET NZ
00080A 090A CD2103          17      CALL    DEFCB_D2
                                
00080D 090D 3A7812          13      LD  A,(DTA_CCP+12)
000810 0910 CB67             8      BIT 4,A
000812 0912 2821            12      JR  Z,COPY1A
                                
000814 0914 215D00          10      LD  HL,FCB1+1
000817 0917 CD300C          17      CALL    CHKWILD
00081A 091A 3811            12      JR  C,COPY9
                                
00081C 091C 3E20             7      LD  A,020H
00081E 091E 325D00          13      LD  (FCB1+1),A
000821 0921 2A8612          16      LD  HL,(DTA_CCP+26)
000824 0924 23               6      INC HL
000825 0925 226A00          16      LD  (FCB1+14),HL
000828 0928 18D5            12      JR  COPY0
                                
       092A                     COPY8:
00082A 092A CD8F0D          17      CALL    SHOW_OK
       092D                     COPY9:
00082D 092D CDD908          17      CALL    RES_CUR_PATH
000830 0930 CD0B03          17      CALL    OPEN2_D2
000833 0933 18D4            12      JR  COPY1
                                
       0935                     COPY1A:
000835 0935 216C00          10      LD  HL,FCB2
000838 0938 11A412          10      LD  DE,FDRV
00083B 093B 016E12          10      LD  BC,DTA_CCP+2
00083E 093E EDA0            16      LDI
000840 0940 3E0B             7      LD  A,11
       0942                     COPY2:
000842 0942 F5              11      PUSH    AF
000843 0943 7E               7      LD  A,(HL)
000844 0944 FE3F             7      CP  '?'
000846 0946 2001            12      JR  NZ,COPY3
000848 0948 0A               7      LD  A,(BC)
       0949                     COPY3:
000849 0949 12               7      LD  (DE),A
00084A 094A 03               6      INC BC
00084B 094B 13               6      INC DE
00084C 094C 23               6      INC HL
00084D 094D F1              10      POP AF
00084E 094E 3D               4      DEC A
00084F 094F 20F1            12      JR  NZ,COPY2
000851 0951 010500          10      LD  BC,16-11
000854 0954 EDB0                    LDIR
       0956                     PUTNAME:
000856 0956 215D00          10      LD  HL,FCB1+1
000859 0959 CD300C          17      CALL    CHKWILD
00085C 095C 300B            12      JR  NC,PUTN1
00085E 095E 21A512          10      LD  HL,FDRV+1
000861 0961 CD1B07          17      CALL    FPRNT
000864 0964 3E20             7      LD  A,020H
000866 0966 CDC60A          17      CALL    MSG_A
       0969                     PUTN1:
000869 0969 11DB11          10      LD  DE,PATH_FN2
00086C 096C CDDC08          17      CALL    SET_CUR_PATH
                                
00086F 096F 11A412          10      LD  DE,FDRV
000872 0972 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000874 0974 CD8E03          17      CALL    SYSTEM0
000877 0977 C2180A          10      JP  NZ,COPYE2
00087A 097A 67               4      LD  H,A     ;A=0
00087B 097B 6F               4      LD  L,A
00087C 097C 22C512          16      LD  (FDRV+33),HL    ;(FCB)ランダム・レコード
00087F 097F 22C712          16      LD  (FDRV+35),HL
000882 0982 2C               4      INC L       ;HL=1
000883 0983 22B212          16      LD  (FDRV+14),HL    ;(FCB)レコード・サイズ
       0986                     COPY6:
000886 0986 CDA90A          17      CALL    BUFSIZ
000889 0989 CDAE03          17      CALL    S27DTA_D2
00088C 098C 47               4      LD  B,A
00088D 098D 3C               4      INC A
00088E 098E CA070A          10      JP  Z,COPYE
000891 0991 7C               4      LD  A,H
000892 0992 B5               4      OR  L
000893 0993 280F            12      JR  Z,COPY7
000895 0995 11A412          10      LD  DE,FDRV
000898 0998 C5              11      PUSH    BC
000899 0999 0E26             7      LD  C,026H      ;(BDOS)ランダム・ブロック・ライト
00089B 099B CD0500          17      CALL    SYSTEM
00089E 099E C1              10      POP BC
00089F 099F B7               4      OR  A
0008A0 09A0 2065            12      JR  NZ,COPYE
0008A2 09A2 10E2            13      DJNZ    COPY6
       09A4                     COPY7:
0008A4 09A4 3AD310          13      LD  A,(MAJOR_VER)
0008A7 09A7 FE02             7      CP  2
0008A9 09A9 3011            12      JR  NC,COPY7_MSX2   ;DOS2はFCBの仕様が違う
0008AB 09AB 3A7912          13      LD  A,(DTA_CCP+13)  ;(FCB)属性(アトリビュート)
0008AE 09AE 32B112          13      LD  (FDRV+13),A ;(FCB)属性(アトリビュート)
0008B1 09B1 218012          10      LD  HL,DTA_CCP+20
0008B4 09B4 11B812          10      LD  DE,FDRV+20  ;(FCB)更新日時
0008B7 09B7 010400          10      LD  BC,4
0008BA 09BA EDB0                    LDIR
       09BC                     COPY7_MSX2:
0008BC 09BC 11A412          10      LD  DE,FDRV
0008BF 09BF 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0008C1 09C1 CD8E03          17      CALL    SYSTEM0
                                
0008C4 09C4 2041            12      JR  NZ,COPYE
0008C6 09C6 3AD310          13      LD  A,(MAJOR_VER)
0008C9 09C9 FE02             7      CP  2
0008CB 09CB 3837            12      JR  C,COPY_DOS2DT
                                
0008CD 09CD ED4B1411        20      LD  BC,(HANDLE1)
0008D1 09D1 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
0008D3 09D3 CD0500          17      CALL    SYSTEM
                                
0008D6 09D6 11DB11          10      LD  DE,PATH_FN2
0008D9 09D9 CDDC08          17      CALL    SET_CUR_PATH
                                
0008DC 09DC 11A412          10      LD  DE,FDRV
0008DF 09DF 215E12          10      LD  HL,DOS2NAME
0008E2 09E2 CD1A0A          17      CALL    FCB2FNAME
                                
0008E5 09E5 3AE210          13      LD  A,(SEARCH_IX+14);   (FIB)属性
0008E8 09E8 6F               4      LD  L,A
0008E9 09E9 115E12          10      LD  DE,DOS2NAME
0008EC 09EC 3E01             7      LD  A,1
0008EE 09EE 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
0008F0 09F0 CD8E03          17      CALL    SYSTEM0
                                
0008F3 09F3 DD2AE310        20      LD  IX,(SEARCH_IX+15)   ;(FIB)更新時間
0008F7 09F7 2AE510          16      LD  HL,(SEARCH_IX+17)   ;(FIB)更新日
0008FA 09FA 115E12          10      LD  DE,DOS2NAME
0008FD 09FD 3E01             7      LD  A,1
0008FF 09FF 0E51             7      LD  C,51H       ;(BDOS)_FTIME ファイルの日付および時刻の獲得・設定
000901 0A01 CD8E03          17      CALL    SYSTEM0
       0A04                     COPY_DOS2DT:
000904 0A04 C32A09          10      JP  COPY8
                                
       0A07                     COPYE:
000907 0A07 ED4B1411        20      LD  BC,(HANDLE1)
00090B 0A0B 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
00090D 0A0D CD0500          17      CALL    SYSTEM
000910 0A10 11A412          10      LD  DE,FDRV
000913 0A13 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
000915 0A15 CD0500          17      CALL    SYSTEM
       0A18                     COPYE2:
000918 0A18 37               4      SCF
000919 0A19 C9              10      RET
                                
       0A1A                     FCB2FNAME:
00091A 0A1A 1A               7      LD  A,(DE)
00091B 0A1B 13               6      INC DE
00091C 0A1C C640             7      ADD A,040H
00091E 0A1E 77               7      LD  (HL),A
00091F 0A1F 23               6      INC HL
000920 0A20 363A            10      LD  (HL),':'
000922 0A22 23               6      INC HL
                                
000923 0A23 0608             7      LD  B,8
       0A25                     FCB2FNAME1:
000925 0A25 1A               7      LD  A,(DE)
000926 0A26 FE21             7      CP  020H+1
000928 0A28 3807            12      JR  C,FCB2FNAME2
00092A 0A2A 13               6      INC DE
00092B 0A2B 77               7      LD  (HL),A
00092C 0A2C 23               6      INC HL
00092D 0A2D 10F6            13      DJNZ    FCB2FNAME1
00092F 0A2F 1803            12      JR  FCB2FNAME3
       0A31                     FCB2FNAME2:
000931 0A31 13               6      INC DE
000932 0A32 10FD            13      DJNZ    FCB2FNAME2
       0A34                     FCB2FNAME3:
000934 0A34 1A               7      LD  A,(DE)
000935 0A35 FE21             7      CP  020H+1
000937 0A37 380F            12      JR  C,FCB2FNAME5
000939 0A39 362E            10      LD  (HL),'.'
00093B 0A3B 23               6      INC HL
00093C 0A3C 0603             7      LD  B,3
       0A3E                     FCB2FNAME4:
00093E 0A3E 1A               7      LD  A,(DE)
00093F 0A3F 13               6      INC DE
000940 0A40 FE21             7      CP  020H+1
000942 0A42 3804            12      JR  C,FCB2FNAME5
000944 0A44 77               7      LD  (HL),A
000945 0A45 23               6      INC HL
000946 0A46 10F6            13      DJNZ    FCB2FNAME4
       0A48                     FCB2FNAME5:
000948 0A48 3600            10      LD  (HL),0
00094A 0A4A C9              10      RET
                                
       0A4B                     C_TYPE:
00094B 0A4B CD5408          17      CALL    SETFCB
00094E 0A4E 215C00          10      LD  HL,FCB1
000951 0A51 CDA502          17      CALL    OPEN_D2
000954 0A54 37               4      SCF
       0A55                     TYPE1:
000955 0A55 C0              11      RET NZ
000956 0A56 CD2103          17      CALL    DEFCB_D2
000959 0A59 3E1A             7      LD  A,01AH
00095B 0A5B CDC60A          17      CALL    MSG_A
       0A5E                     TYPE2:
00095E 0A5E CDA90A          17      CALL    BUFSIZ
000961 0A61 CDAE03          17      CALL    S27DTA_D2
000964 0A64 C6FE             7      ADD A,0FEH
000966 0A66 D8              11      RET C
000967 0A67 7C               4      LD  A,H
000968 0A68 B5               4      OR  L
000969 0A69 281A            12      JR  Z,TYPEE
00096B 0A6B 010080          10      LD  BC,DATA
       0A6E                     TYPE3:
00096E 0A6E 0A               7      LD  A,(BC)
00096F 0A6F 03               6      INC BC
000970 0A70 FE1A             7      CP  01AH
000972 0A72 2811            12      JR  Z,TYPEE
000974 0A74 5F               4      LD  E,A
000975 0A75 C5              11      PUSH    BC
000976 0A76 E5              11      PUSH    HL
000977 0A77 0E02             7      LD  C,2     ;(BDOS)コンソール出力
000979 0A79 CD0500          17      CALL    SYSTEM
00097C 0A7C E1              10      POP HL
00097D 0A7D C1              10      POP BC
00097E 0A7E 2B               6      DEC HL
00097F 0A7F 7C               4      LD  A,H
000980 0A80 B5               4      OR  L
000981 0A81 20EB            12      JR  NZ,TYPE3
000983 0A83 18D9            12      JR  TYPE2
       0A85                     TYPEE:
000985 0A85 3AD310          13      LD  A,(MAJOR_VER)   ;DOS2対応
000988 0A88 FE02             7      CP  2
00098A 0A8A 3806            12      JR  C,TYPEE2
00098C 0A8C ED4B1411        20      LD  BC,(HANDLE1)
000990 0A90 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
       0A92                     TYPEE2:
000992 0A92 CD0B03          17      CALL    OPEN2_D2
000995 0A95 18BE            12      JR  TYPE1
                                
       0A97                     CWILD:
000997 0A97 215D00          10      LD  HL,FCB1+1
       0A9A                     CWILD1:
00099A 0A9A 7E               7      LD  A,(HL)
00099B 0A9B FE20             7      CP  020H
00099D 0A9D C0              11      RET NZ
       0A9E                     CWILD2:
00099E 0A9E 54               4      LD  D,H
00099F 0A9F 5D               4      LD  E,L
0009A0 0AA0 13               6      INC DE
0009A1 0AA1 010A00          10      LD  BC,10
0009A4 0AA4 363F            10      LD  (HL),'?'
0009A6 0AA6 EDB0                    LDIR
0009A8 0AA8 C9              10      RET
                                
       0AA9                     BUFSIZ:
0009A9 0AA9 3A0700          13      LD  A,(SYSTEM+2)
0009AC 0AAC D681             7      SUB (DATA/256)+1
0009AE 0AAE E6F8             7      AND 0F8H
0009B0 0AB0 67               4      LD  H,A
0009B1 0AB1 2E00             7      LD  L,0
0009B3 0AB3 C9              10      RET
                                
0009B4 0AB4 E9               4  JP_HL:  JP  (HL)
                                
       0AB5                     _PRINT:
0009B5 0AB5 C5              11      PUSH    BC
0009B6 0AB6 D5              11      PUSH    DE
0009B7 0AB7 E5              11      PUSH    HL
0009B8 0AB8 DDE5            15      PUSH    IX
0009BA 0ABA 0E06             7      LD  C,6
0009BC 0ABC CD0500          17      CALL    SYSTEM
0009BF 0ABF DDE1            14      POP IX
0009C1 0AC1 E1              10      POP HL
0009C2 0AC2 D1              10      POP DE
0009C3 0AC3 C1              10      POP BC
0009C4 0AC4 B7               4      OR  A
0009C5 0AC5 C9              10      RET
                                
       0AC6                     MSG_A:
0009C6 0AC6 F5              11      PUSH    AF
0009C7 0AC7 C5              11      PUSH    BC
0009C8 0AC8 D5              11      PUSH    DE
0009C9 0AC9 E5              11      PUSH    HL
0009CA 0ACA DDE5            15      PUSH    IX
0009CC 0ACC 5F               4      LD  E,A
0009CD 0ACD 0E02             7      LD  C,2
0009CF 0ACF CD0500          17      CALL    SYSTEM
0009D2 0AD2 DDE1            14      POP IX
0009D4 0AD4 E1              10      POP HL
0009D5 0AD5 D1              10      POP DE
0009D6 0AD6 C1              10      POP BC
0009D7 0AD7 F1              10      POP AF
0009D8 0AD8 C9              10      RET
                                ;       FILE
       0AD9                     FILEC_D2:       ;DOS2対応
0009D9 0AD9 3AD310          13      LD  A,(MAJOR_VER)
0009DC 0ADC FE02             7      CP  2
0009DE 0ADE 381C            12      JR  C,FILEC
0009E0 0AE0 C5              11      PUSH    BC
0009E1 0AE1 D5              11      PUSH    DE
0009E2 0AE2 E5              11      PUSH    HL
0009E3 0AE3 CDE40B          17      CALL    SPCUT
0009E6 0AE6 211B11          10      LD  HL,PATH_CCP
0009E9 0AE9 0640             7      LD  B,64
       0AEB                     PATHCD1:
0009EB 0AEB 1A               7      LD  A,(DE)
0009EC 0AEC 13               6      INC DE
0009ED 0AED FE20             7      CP  020H
0009EF 0AEF 3002            12      JR  NC,PATHCD2
0009F1 0AF1 3E00             7      LD  A,0
       0AF3                     PATHCD2:
0009F3 0AF3 77               7      LD  (HL),A
0009F4 0AF4 3803            12      JR  C,PATHCD3
0009F6 0AF6 23               6      INC HL
0009F7 0AF7 10F2            13      DJNZ    PATHCD1
       0AF9                     PATHCD3:
0009F9 0AF9 E1              10      POP HL
0009FA 0AFA D1              10      POP DE
0009FB 0AFB C1              10      POP BC
       0AFC                     FILEC:
0009FC 0AFC CD070B          17      CALL    FILE
       0AFF                     FILEC2:
0009FF 0AFF 3AA512          13      LD  A,(FDRV+1)
000A02 0B02 FE20             7      CP  020H
000A04 0B04 C8              11      RET Z
000A05 0B05 1839            12      JR  SETDIR1
                                
       0B07                     FILE:
000A07 0B07 AF               4      XOR A
000A08 0B08 32A412          13      LD  (FDRV),A
000A0B 0B0B 67               4      LD  H,A
000A0C 0B0C 6F               4      LD  L,A
000A0D 0B0D 22B212          16      LD  (FDRV+14),HL
000A10 0B10 CDE40B          17      CALL    SPCUT
000A13 0B13 CDC90B          17      CALL    CCHK3
000A16 0B16 2812            12      JR  Z,DEVI1
000A18 0B18 13               6      INC DE
000A19 0B19 1A               7      LD  A,(DE)
000A1A 0B1A 1B               6      DEC DE
000A1B 0B1B FE3A             7      CP  ':'
000A1D 0B1D 200B            12      JR  NZ,DEVI1
000A1F 0B1F 1A               7      LD  A,(DE)      ;DRIVE
000A20 0B20 CDF70B          17      CALL    CAP
000A23 0B23 D640             7      SUB '@'
000A25 0B25 13               6      INC DE
000A26 0B26 13               6      INC DE
000A27 0B27 32A412          13      LD  (FDRV),A
       0B2A                     DEVI1:
000A2A 0B2A 1A               7      LD  A,(DE)
000A2B 0B2B D65C             7      SUB 05CH        ;\
000A2D 0B2D 2009            12      JR  NZ,NOROOT
000A2F 0B2F 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000A30 0B30 22BE12          16      LD  (FDRV+26),HL
000A33 0B33 2C               4      INC L
000A34 0B34 22B212          16      LD  (FDRV+14),HL
000A37 0B37 13               6      INC DE
       0B38                     NOROOT:
                                
       0B38                     SETDIR:
000A38 0B38 CD690B          17      CALL    FILED
000A3B 0B3B 1A               7      LD  A,(DE)
000A3C 0B3C FE5C             7      CP  05CH        ;\
000A3E 0B3E C0              11      RET NZ
000A3F 0B3F 13               6      INC DE
       0B40                     SETDIR1:
000A40 0B40 3AD310          13      LD  A,(MAJOR_VER)
000A43 0B43 FE01             7      CP  1
000A45 0B45 C0              11      RET NZ
                                                ;for LSX-Dodgers
000A46 0B46 3E10             7      LD  A,010H      ;Directory
000A48 0B48 32B112          13      LD  (FDRV+13),A
000A4B 0B4B D5              11      PUSH    DE
000A4C 0B4C 11A412          10      LD  DE,FDRV
000A4F 0B4F 0E0F             7      LD  C,00FH
000A51 0B51 CD0500          17      CALL    SYSTEM
000A54 0B54 D1              10      POP DE
000A55 0B55 B7               4      OR  A
000A56 0B56 C0              11      RET NZ
                                
000A57 0B57 3AB112          13      LD  A,(FDRV+13)
000A5A 0B5A CB67             8      BIT 4,A
000A5C 0B5C C8              11      RET Z
                                
000A5D 0B5D CDB00B          17      CALL    FILEI
000A60 0B60 2ABE12          16      LD  HL,(FDRV+26)
000A63 0B63 23               6      INC HL
000A64 0B64 22B212          16      LD  (FDRV+14),HL
000A67 0B67 18CF            12      JR  SETDIR
                                
       0B69                     FILED:
000A69 0B69 CDB00B          17      CALL    FILEI
                                
000A6C 0B6C 0608             7      LD  B,8
       0B6E                     FILE2:
000A6E 0B6E CDBE0B          17      CALL    CCHKF
000A71 0B71 C8              11      RET Z
000A72 0B72 FE2A             7      CP  '*'
000A74 0B74 282E            12      JR  Z,FILE9
000A76 0B76 FE2E             7      CP  '.'
000A78 0B78 280C            12      JR  Z,FILE4
000A7A 0B7A 77               7      LD  (HL),A
000A7B 0B7B 23               6      INC HL
000A7C 0B7C 10F0            13      DJNZ    FILE2
                                
       0B7E                     FILE3:
000A7E 0B7E CDBE0B          17      CALL    CCHKF
000A81 0B81 C8              11      RET Z
000A82 0B82 FE2E             7      CP  '.'
000A84 0B84 20F8            12      JR  NZ,FILE3
                                
       0B86                     FILE4:
000A86 0B86 21AD12          10      LD  HL,FNAME+8
000A89 0B89 0603             7      LD  B,3
                                
       0B8B                     FILE4L:
000A8B 0B8B CDBE0B          17      CALL    CCHKF
000A8E 0B8E C8              11      RET Z
000A8F 0B8F FE2E             7      CP  '.'
000A91 0B91 2008            12      JR  NZ,FILE12
000A93 0B93 32A512          13      LD  (FNAME),A   ;Parent directory(..)
000A96 0B96 32A612          13      LD  (FNAME+1),A
000A99 0B99 3E20             7      LD  A,020H
       0B9B                     FILE12:
000A9B 0B9B FE2A             7      CP  '*'
000A9D 0B9D 280A            12      JR  Z,FILE10
000A9F 0B9F 77               7      LD  (HL),A
000AA0 0BA0 23               6      INC HL
000AA1 0BA1 10E8            13      DJNZ    FILE4L
000AA3 0BA3 C9              10      RET
                                
       0BA4                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000AA4 0BA4 CDA90B          17      CALL    FILE10
000AA7 0BA7 18D5            12      JR  FILE3
                                
       0BA9                     FILE10:
000AA9 0BA9 3E3F             7      LD  A,'?'
                                
       0BAB                     FILL_MEMORY:                ;HLからBバイトAで埋める
000AAB 0BAB 77               7      LD  (HL),A
000AAC 0BAC 23               6      INC HL
000AAD 0BAD 10FC            13      DJNZ    FILL_MEMORY
000AAF 0BAF C9              10      RET
                                
       0BB0                     FILEI:              ;名前＋拡張子をスペースで初期化
000AB0 0BB0 3E20             7      LD  A,020H
000AB2 0BB2 01000B          10      LD  BC,11*256
000AB5 0BB5 21A512          10      LD  HL,FNAME
000AB8 0BB8 E5              11      PUSH    HL
000AB9 0BB9 CDAB0B          17      CALL    FILL_MEMORY
000ABC 0BBC E1              10      POP HL
000ABD 0BBD C9              10      RET
                                
       0BBE                     CCHKF:
000ABE 0BBE 1A               7      LD  A,(DE)
000ABF 0BBF CDC60B          17      CALL    CCHK2
000AC2 0BC2 C8              11      RET Z
000AC3 0BC3 C3190C          10      JP  FKAN
                                
       0BC6                     CCHK2:
000AC6 0BC6 0C               4      INC C
000AC7 0BC7 0D               4      DEC C
000AC8 0BC8 C0              11      RET NZ
       0BC9                     CCHK3:              ;ZF=1 で使えない文字
000AC9 0BC9 FE2B             7      CP  '+'
000ACB 0BCB C8              11      RET Z
000ACC 0BCC FE2C             7      CP  ','
000ACE 0BCE C8              11      RET Z
000ACF 0BCF FE2F             7      CP  '/'
000AD1 0BD1 C8              11      RET Z
000AD2 0BD2 FE3A             7      CP  ':'
000AD4 0BD4 C8              11      RET Z
000AD5 0BD5 FE3B             7      CP  ';'
000AD7 0BD7 C8              11      RET Z
000AD8 0BD8 FE3D             7      CP  '='
000ADA 0BDA C8              11      RET Z
000ADB 0BDB FE5C             7      CP  05CH    ;\
000ADD 0BDD C8              11      RET Z
000ADE 0BDE FE20             7      CP  020H
000AE0 0BE0 D0              11      RET NC
000AE1 0BE1 BF               4      CP  A       ;Z=1
000AE2 0BE2 C9              10      RET
                                
       0BE3                     SS1:
000AE3 0BE3 13               6      INC DE
       0BE4                     SPCUT:              ;スペースをカット
000AE4 0BE4 1A               7      LD  A,(DE)
000AE5 0BE5 FE20             7      CP  020H
000AE7 0BE7 28FA            12      JR  Z,SS1
000AE9 0BE9 C9              10      RET
                                
       0BEA                     TOZERO:
000AEA 0BEA D5              11      PUSH    DE
       0BEB                     TZ1:
000AEB 0BEB 1A               7      LD  A,(DE)
000AEC 0BEC FE20             7      CP  20H
000AEE 0BEE 3803            12      JR  C,TZ2
000AF0 0BF0 13               6      INC DE
000AF1 0BF1 18F8            12      JR  TZ1
       0BF3                     TZ2:
000AF3 0BF3 AF               4      XOR A
000AF4 0BF4 12               7      LD  (DE),A
000AF5 0BF5 D1              10      POP DE
000AF6 0BF6 C9              10      RET
                                
       0BF7                     CAP:
000AF7 0BF7 FE61             7      CP  'a'
000AF9 0BF9 D8              11      RET C
000AFA 0BFA FE7B             7      CP  'z'+1
000AFC 0BFC D0              11      RET NC
000AFD 0BFD D620             7      SUB 020H
000AFF 0BFF C9              10      RET
       0C00                     CAP2:
000B00 0C00 CDF70B          17      CALL    CAP
       0C03                     CAP3:
000B03 0C03 CD0C0C          17      CALL    CAP4
000B06 0C06 FE21             7      CP  021H
000B08 0C08 D0              11      RET NC
000B09 0C09 3E20             7      LD  A,020H
000B0B 0C0B C9              10      RET
       0C0C                     CAP4:
000B0C 0C0C FE05             7      CP  5
000B0E 0C0E C0              11      RET NZ
000B0F 0C0F 3EE5             7      LD  A,0E5H
000B11 0C11 C9              10      RET
                                
       0C12                     FKANC:
000B12 0C12 CB41             8      BIT 0,C
000B14 0C14 CC000C          17      CALL    Z,CAP2
000B17 0C17 1801            12      JR  FKANX
       0C19                     FKAN:           ;漢字チェック
000B19 0C19 13               6      INC DE
       0C1A                     FKANX:
000B1A 0C1A CB41             8      BIT 0,C
000B1C 0C1C CB81             8      RES 0,C
000B1E 0C1E C0              11      RET NZ
000B1F 0C1F FE80             7      CP  080H
000B21 0C21 D8              11      RET C
000B22 0C22 FEA0             7      CP  0A0H
000B24 0C24 3803            12      JR  C,FKAN1
000B26 0C26 FEE0             7      CP  0E0H
000B28 0C28 D8              11      RET C
       0C29                     FKAN1:
000B29 0C29 0C               4      INC C
000B2A 0C2A A7               4      AND A
000B2B 0C2B C9              10      RET
                                
       0C2C                     CHKWILDX:
000B2C 0C2C FDE5            15      PUSH    IY
000B2E 0C2E E1              10      POP HL
000B2F 0C2F 23               6      INC HL
       0C30                     CHKWILD:
000B30 0C30 060B             7      LD  B,11
000B32 0C32 3E3F             7      LD  A,'?'
       0C34                     CHKWIL1:
000B34 0C34 BE               7      CP  (HL)
000B35 0C35 23               6      INC HL
000B36 0C36 37               4      SCF
000B37 0C37 C8              11      RET Z
000B38 0C38 10FA            13      DJNZ    CHKWIL1
000B3A 0C3A AF               4      XOR A
000B3B 0C3B C9              10      RET
                                
       0C3C                     CPNAME:
000B3C 0C3C C5              11      PUSH    BC
000B3D 0C3D D5              11      PUSH    DE
000B3E 0C3E 119312          10      LD  DE,CPBUF
000B41 0C41 010700          10      LD  BC,7
000B44 0C44 EDB0                    LDIR
000B46 0C46 D1              10      POP DE
000B47 0C47 D5              11      PUSH    DE
000B48 0C48 E5              11      PUSH    HL
000B49 0C49 219312          10      LD  HL,CPBUF
000B4C 0C4C CD5F0C          17      CALL    CPFILE
000B4F 0C4F E1              10      POP HL
000B50 0C50 D1              10      POP DE
000B51 0C51 C1              10      POP BC
000B52 0C52 2005            12      JR  NZ,CPNAME1
000B54 0C54 7E               7      LD  A,(HL)
000B55 0C55 23               6      INC HL
000B56 0C56 66               7      LD  H,(HL)
000B57 0C57 6F               4      LD  L,A
000B58 0C58 C9              10      RET
       0C59                     CPNAME1:
000B59 0C59 23               6      INC HL
000B5A 0C5A 23               6      INC HL
000B5B 0C5B 10DF            13      DJNZ    CPNAME
000B5D 0C5D 37               4      SCF
000B5E 0C5E C9              10      RET
                                
       0C5F                     CPFILE:
000B5F 0C5F C5              11      PUSH    BC
000B60 0C60 01000B          10      LD  BC,00B00H
       0C63                     CPSTR1:
000B63 0C63 1A               7      LD  A,(DE)
000B64 0C64 FE3F             7      CP  '?'     ;Wild card
000B66 0C66 2812            12      JR  Z,CPSTR2
000B68 0C68 7E               7      LD  A,(HL)
000B69 0C69 CD120C          17      CALL    FKANC
000B6C 0C6C E5              11      PUSH    HL
000B6D 0C6D 67               4      LD  H,A
000B6E 0C6E 1A               7      LD  A,(DE)
000B6F 0C6F CB01             8      RLC C
000B71 0C71 CD120C          17      CALL    FKANC
000B74 0C74 CB09             8      RRC C
000B76 0C76 BC               4      CP  H       ;CP (HL),(DE)
000B77 0C77 E1              10      POP HL
000B78 0C78 2004            12      JR  NZ,CPSTR3
       0C7A                     CPSTR2:
000B7A 0C7A 13               6      INC DE
000B7B 0C7B 23               6      INC HL
000B7C 0C7C 10E5            13      DJNZ    CPSTR1
       0C7E                     CPSTR3:
000B7E 0C7E C1              10      POP BC
000B7F 0C7F C9              10      RET
                                
       0C80                     CPFILE2:
000B80 0C80 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
000B83 0C83 F6E1             7      OR  0E1H
000B85 0C85 2F               4      CPL
000B86 0C86 A6               7      AND (HL)
000B87 0C87 C9              10      RET
                                
       0C88                     _SYS29:     ;(BDOS)ファイル名の解析
000B88 0C88 C5              11      PUSH    BC
000B89 0C89 D5              11      PUSH    DE
000B8A 0C8A 0640             7      LD  B,64
000B8C 0C8C CDE40B          17      CALL    SPCUT
000B8F 0C8F DD229112        20      LD  (DIR_CK),IX
       0C93                     D2FN1:
000B93 0C93 1A               7      LD  A,(DE)
000B94 0C94 FE21             7      CP  020H+1
000B96 0C96 3808            12      JR  C,D2FN2
000B98 0C98 13               6      INC DE
000B99 0C99 DD7700          19      LD  (IX+0),A
000B9C 0C9C DD23            10      INC IX
000B9E 0C9E 10F3            13      DJNZ    D2FN1
       0CA0                     D2FN2:
000BA0 0CA0 DD360000        19      LD  (IX+0),0
000BA4 0CA4 DD7EFF          19      LD  A,(IX-1)
000BA7 0CA7 FE5C             7      CP  05CH        ;\
000BA9 0CA9 2018            12      JR  NZ,D2FN3
000BAB 0CAB DD7EFE          19      LD  A,(IX-2)
000BAE 0CAE FE3A             7      CP  ':'
000BB0 0CB0 2811            12      JR  Z,D2FN3
                                
000BB2 0CB2 DD36FF00        19      LD  (IX-1),0
000BB6 0CB6 ED5B9112        20      LD  DE,(DIR_CK)
000BBA 0CBA CDF50C          17      CALL    IS_FOLDER
000BBD 0CBD 3804            12      JR  C,D2FN3
       0CBF                     D2FN4:
000BBF 0CBF DD36FF5C        19      LD  (IX-1),05CH ;\
       0CC3                     D2FN3:
000BC3 0CC3 D1              10      POP DE
000BC4 0CC4 C1              10      POP BC
000BC5 0CC5 C5              11      PUSH    BC
000BC6 0CC6 E5              11      PUSH    HL
000BC7 0CC7 CD070B          17      CALL    FILE
000BCA 0CCA E1              10      POP HL
000BCB 0CCB C1              10      POP BC
       0CCC                     S29X1:
000BCC 0CCC C5              11      PUSH    BC
000BCD 0CCD D5              11      PUSH    DE
000BCE 0CCE E5              11      PUSH    HL
000BCF 0CCF EB               4      EX  DE,HL
000BD0 0CD0 21A412          10      LD  HL,FDRV
000BD3 0CD3 010D00          10      LD  BC,13
000BD6 0CD6 EDB0                    LDIR
000BD8 0CD8 70               7      LD  (HL),B      ;B=0
000BD9 0CD9 0E03             7      LD  C,3
000BDB 0CDB EDB0                    LDIR
000BDD 0CDD E1              10      POP HL
000BDE 0CDE D1              10      POP DE
000BDF 0CDF C1              10      POP BC
000BE0 0CE0 AF               4      XOR A
000BE1 0CE1 C9              10      RET
       0CE2                     GET_WIDTH:
000BE2 0CE2 3AD210          13      LD  A,(IS_MSX)
000BE5 0CE5 B7               4      OR  A
000BE6 0CE6 2804            12      JR  Z,NOT_MSX
000BE8 0CE8 3AB0F3          13      LD  A,(LINLEN)
000BEB 0CEB C9              10      RET
       0CEC                     NOT_MSX:
000BEC 0CEC E5              11      PUSH    HL
000BED 0CED 2A0100          16      LD  HL,(1)
000BF0 0CF0 2EB1             7      LD  L,0B1H
000BF2 0CF2 7E               7      LD  A,(HL)
000BF3 0CF3 E1              10      POP HL
000BF4 0CF4 C9              10      RET
                                
       0CF5                     IS_FOLDER:          ;out CF=0:Folder
000BF5 0CF5 CDE40B          17      CALL    SPCUT
000BF8 0CF8 1A               7      LD  A,(DE)
000BF9 0CF9 C6FF             7      ADD A,0FFH
000BFB 0CFB D0              11      RET NC
000BFC 0CFC AF               4      XOR A
000BFD 0CFD 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
000BFF 0CFF D5              11      PUSH    DE
000C00 0D00 CD8E03          17      CALL    SYSTEM0
000C03 0D03 D1              10      POP DE
000C04 0D04 37               4      SCF
000C05 0D05 C0              11      RET NZ
000C06 0D06 7D               4      LD  A,L
000C07 0D07 E610             7      AND 010H
000C09 0D09 D601             7      SUB 1
000C0B 0D0B C9              10      RET
                                
       0D0C                     C_MODE:
000C0C 0D0C 3AD210          13      LD  A,(IS_MSX)
000C0F 0D0F B7               4      OR  A
000C10 0D10 C8              11      RET Z
000C11 0D11 0E29             7      LD  C,41
000C13 0D13 3AF8FA          13      LD  A,(EXBRSA)
000C16 0D16 B7               4      OR  A
000C17 0D17 2802            12      JR  Z,MODE_MSX1
000C19 0D19 0E51             7      LD  C,81
       0D1B                     MODE_MSX1:
000C1B 0D1B C5              11      PUSH    BC
000C1C 0D1C CDD30E          17      CALL    GETNUM
000C1F 0D1F C1              10      POP BC
000C20 0D20 7D               4      LD  A,L
000C21 0D21 B9               4      CP  C
000C22 0D22 301C            12      JR  NC,MODE1
000C24 0D24 B7               4      OR  A
000C25 0D25 2819            12      JR  Z,MODE1
000C27 0D27 FE21             7      CP  33
000C29 0D29 381E            12      JR  C,MODE32
000C2B 0D2B 32AEF3          13      LD  (LINL40),A
000C2E 0D2E DD216C00        14      LD  IX,INITXT
000C32 0D32 CD390D          17      CALL    CALLROM
000C35 0D35 DD217800        14      LD  IX,SETTXT
       0D39                     CALLROM:
000C39 0D39 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000C3D 0D3D C31C00          10      JP  CALSLT
       0D40                     MODE1:
000C40 0D40 3AB0F3          13      LD  A,(LINLEN)
000C43 0D43 CDC907          17      CALL    PRDEC_A
000C46 0D46 C35F06          10      JP  LTNL
       0D49                     MODE32:
000C49 0D49 32AFF3          13      LD  (LINL32),A
000C4C 0D4C DD216F00        14      LD  IX,INIT32
000C50 0D50 CD390D          17      CALL    CALLROM
000C53 0D53 DD217B00        14      LD  IX,SETT32
000C57 0D57 18E0            12      JR  CALLROM
                                
       0D59                     C_PAUSE:
000C59 0D59 CDE40B          17      CALL    SPCUT
000C5C 0D5C EB               4      EX  DE,HL
000C5D 0D5D 7E               7      LD  A,(HL)
000C5E 0D5E B7               4      OR  A
000C5F 0D5F 2003            12      JR  NZ,C_PAUSE1
000C61 0D61 21B70F          10      LD  HL,PAUSE
       0D64                     C_PAUSE1:
000C64 0D64 CD2106          17      CALL    MSX
000C67 0D67 0E07             7      LD  C,7     ;(BDOS)コンソール直接入力(_DIRIN)
000C69 0D69 CD0500          17      CALL    SYSTEM
000C6C 0D6C FE03             7      CP  3
000C6E 0D6E CA2105          10      JP  Z,END_BATCH
000C71 0D71 C35F06          10      JP  LTNL
                                
       0D74                     C_ECHO:
000C74 0D74 CDE40B          17      CALL    SPCUT
000C77 0D77 EB               4      EX  DE,HL
000C78 0D78 CD2106          17      CALL    MSX
000C7B 0D7B C35F06          10      JP  LTNL
                                
       0D7E                     C_MKDIR:
000C7E 0D7E CDE40B          17      CALL    SPCUT
000C81 0D81 014490          10      LD  BC,09044H   ;B=新規作成+ディレクトリ/C=(BDOS)ファイルハンドルの作成(_CREATE)
000C84 0D84 CD0500          17      CALL    SYSTEM
000C87 0D87 C6FF             7      ADD A,0FFH
000C89 0D89 D8              11      RET C
000C8A 0D8A 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
000C8C 0D8C CD0500          17      CALL    SYSTEM
       0D8F                     SHOW_OK:
000C8F 0D8F 11AD0F          10      LD  DE,OK
000C92 0D92 0E09             7      LD  C,9     ;(BDOS)文字列出力
000C94 0D94 CD0500          17      CALL    SYSTEM
000C97 0D97 C35F06          10      JP  LTNL
                                
       0D9A                     C_RMDIR:
000C9A 0D9A CDF50C          17      CALL    IS_FOLDER
000C9D 0D9D D8              11      RET C
000C9E 0D9E 0E4D             7      LD  C,04DH      ;(BDOS)ファイル・サブディレクトリの削除
000CA0 0DA0 CD0500          17      CALL    SYSTEM
000CA3 0DA3 C6FF             7      ADD A,0FFH
000CA5 0DA5 D8              11      RET C
000CA6 0DA6 18E7            12      JR  SHOW_OK
                                
       0DA8                     C_SET:
000CA8 0DA8 CDE40B          17      CALL    SPCUT
000CAB 0DAB ED53BE0D        20      LD  (CSET_PARAM),DE
       0DAF                     CSET2:
000CAF 0DAF 1A               7      LD  A,(DE)
000CB0 0DB0 FE20             7      CP  020H
000CB2 0DB2 3838            12      JR  C,CSET_LIST
000CB4 0DB4 D63D             7      SUB '='
000CB6 0DB6 2803            12      JR  Z,CSET_SET
000CB8 0DB8 13               6      INC DE
000CB9 0DB9 18F4            12      JR  CSET2
       0DBB                     CSET_SET:
000CBB 0DBB 12               7      LD  (DE),A
000CBC 0DBC 13               6      INC DE
       0DBE                     CSET_PARAM  EQU $+1
000CBD 0DBD 210000          10      LD  HL,0
000CC0 0DC0 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000CC2 0DC2 CD0500          17      CALL    SYSTEM
       0DC5                     INIT_VAR:           ;環境変数の初期化
000CC5 0DC5 218E10          10      LD  HL,N_DATE
000CC8 0DC8 119310          10      LD  DE,V_DATE
000CCB 0DCB 0610             7      LD  B,16
000CCD 0DCD 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000CCF 0DCF CD0500          17      CALL    SYSTEM
                                
000CD2 0DD2 21B310          10      LD  HL,N_TIME
000CD5 0DD5 11B810          10      LD  DE,V_TIME
000CD8 0DD8 0603             7      LD  B,3
000CDA 0DDA 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000CDC 0DDC CD0500          17      CALL    SYSTEM
                                
000CDF 0DDF 210210          10      LD  HL,N_APPEND
000CE2 0DE2 110910          10      LD  DE,V_APPEND
000CE5 0DE5 0640             7      LD  B,PATHX
000CE7 0DE7 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000CE9 0DE9 C30500          10      JP  SYSTEM
                                
       0DEC                     CSET_LIST:
000CEC 0DEC 3E0A             7      LD  A,10
000CEE 0DEE 32CF12          13      LD  (CSET_DATA),A
000CF1 0DF1 110100          10      LD  DE,1
       0DF4                     CSET1:
000CF4 0DF4 D5              11      PUSH    DE
000CF5 0DF5 016DFF          10      LD  BC,0FF6DH   ;_FENV 環境変数の検索
000CF8 0DF8 21D112          10      LD  HL,DATA_COM
000CFB 0DFB 3600            10      LD  (HL),0
000CFD 0DFD CD0500          17      CALL    SYSTEM
000D00 0E00 B7               4      OR  A
000D01 0E01 2030            12      JR  NZ,CSET_ERROR
000D03 0E03 21D112          10      LD  HL,DATA_COM
000D06 0E06 7E               7      LD  A,(HL)
000D07 0E07 B7               4      OR  A
000D08 0E08 2829            12      JR  Z,CSET_ERROR
000D0A 0E0A CD2106          17      CALL    MSX
000D0D 0E0D 1E3D             7      LD  E,'='
000D0F 0E0F CDB50A          17      CALL    _PRINT
000D12 0E12 21D112          10      LD  HL,DATA_COM
000D15 0E15 11D113          10      LD  DE,DATA_COM+256
000D18 0E18 016BFF          10      LD  BC,0FF6BH   ;_GENV 環境変数の獲得
000D1B 0E1B CD0500          17      CALL    SYSTEM
000D1E 0E1E 21D113          10      LD  HL,DATA_COM+256
000D21 0E21 CD2106          17      CALL    MSX
000D24 0E24 CD5F06          17      CALL    LTNL
000D27 0E27 3E0A             7      LD  A,10
000D29 0E29 32CF12          13      LD  (CSET_DATA),A
       0E2C                     CSET_NEXT:
000D2C 0E2C D1              10      POP DE
000D2D 0E2D 13               6      INC DE
000D2E 0E2E 7A               4      LD  A,D
000D2F 0E2F B3               4      OR  E
000D30 0E30 20C2            12      JR  NZ,CSET1
000D32 0E32 C9              10      RET
       0E33                     CSET_ERROR:
000D33 0E33 21CF12          10      LD  HL,CSET_DATA
000D36 0E36 35              11      DEC (HL)
000D37 0E37 20F3            12      JR  NZ,CSET_NEXT
       0E39                     CSET_END:
000D39 0E39 D1              10      POP DE
000D3A 0E3A C9              10      RET
                                
       0E3B                     C_FORMAT:
000D3B 0E3B 3AD210          13      LD  A,(IS_MSX)
000D3E 0E3E B7               4      OR  A
000D3F 0E3F C8              11      RET Z
000D40 0E40 3AD310          13      LD  A,(MAJOR_VER)
000D43 0E43 FE02             7      CP  2
000D45 0E45 300B            12      JR  NC,FORMAT2
       0E47                     FORMAT1:
000D47 0E47 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000D4B 0E4B DD214701        14      LD  IX,FORMAT
000D4F 0E4F C31C00          10      JP  CALSLT
       0E52                     FORMAT2:
000D52 0E52 CD5408          17      CALL    SETFCB
000D55 0E55 3A5C00          13      LD  A,(FCB1)
000D58 0E58 B7               4      OR  A
000D59 0E59 28EC            12      JR  Z,FORMAT1
000D5B 0E5B 47               4      LD  B,A
000D5C 0E5C AF               4      XOR A
000D5D 0E5D 0E67             7      LD  C,067H      ;(_FORMAT)ディスクのフォーマット
000D5F 0E5F CD0500          17      CALL    SYSTEM
000D62 0E62 B7               4      OR  A
000D63 0E63 20E2            12      JR  NZ,FORMAT1
000D65 0E65 CD2A06          17      CALL    MSXSLT
000D68 0E68 21CF10          10      LD  HL,PROMPT
000D6B 0E6B CD2106          17      CALL    MSX
       0E6E                     FORMAT3:
000D6E 0E6E 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力(_INNOE)
000D70 0E70 CD0500          17      CALL    SYSTEM
000D73 0E73 D631             7      SUB '0'+1
000D75 0E75 38F7            12      JR  C,FORMAT3
000D77 0E77 3C               4      INC A
000D78 0E78 FE0A             7      CP  10
000D7A 0E7A 30F2            12      JR  NC,FORMAT3
000D7C 0E7C F5              11      PUSH    AF
000D7D 0E7D CD5F06          17      CALL    LTNL
000D80 0E80 21B70F          10      LD  HL,PAUSE
000D83 0E83 CD2106          17      CALL    MSX
000D86 0E86 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力(_INNOE)
000D88 0E88 CD0500          17      CALL    SYSTEM
000D8B 0E8B CD5F06          17      CALL    LTNL
000D8E 0E8E F1              10      POP AF
000D8F 0E8F ED4B5B00        20      LD  BC,(FCB1-1)
000D93 0E93 210080          10      LD  HL,08000H
000D96 0E96 110040          10      LD  DE,04000H
000D99 0E99 0E67             7      LD  C,067H      ;(_FORMAT)ディスクのフォーマット
000D9B 0E9B C30500          10      JP  SYSTEM
                                
       0E9E                     C_RAMDISK:
000D9E 0E9E 3AD210          13      LD  A,(IS_MSX)
000DA1 0EA1 B7               4      OR  A
000DA2 0EA2 C8              11      RET Z
000DA3 0EA3 3AD310          13      LD  A,(MAJOR_VER)
000DA6 0EA6 FE02             7      CP  2
000DA8 0EA8 D8              11      RET C
000DA9 0EA9 CDE40B          17      CALL    SPCUT
000DAC 0EAC 1A               7      LD  A,(DE)
000DAD 0EAD FE30             7      CP  '0'
000DAF 0EAF D8              11      RET C
000DB0 0EB0 FE3A             7      CP  '9'+1
000DB2 0EB2 3F               4      CCF
000DB3 0EB3 D8              11      RET C
000DB4 0EB4 CDD30E          17      CALL    GETNUM
000DB7 0EB7 110F00          10      LD  DE,15       ;切り上げの為
000DBA 0EBA 19              11      ADD HL,DE
000DBB 0EBB 7D               4      LD  A,L
000DBC 0EBC 0604             7      LD  B,4     ;16で割る
       0EBE                     RAMDISK1:
000DBE 0EBE CB3C             8      SRL H   ;/2
000DC0 0EC0 1F               4      RRA
000DC1 0EC1 10FB            13      DJNZ    RAMDISK1
000DC3 0EC3 FEFF             7      CP  0FFH
000DC5 0EC5 2001            12      JR  NZ,RAMDISK2
000DC7 0EC7 3D               4      DEC A
       0EC8                     RAMDISK2:
000DC8 0EC8 47               4      LD  B,A
000DC9 0EC9 0E68             7      LD  C,068H      ;(_RAMD)RAMディスクの作成あるいは消去
000DCB 0ECB CD0500          17      CALL    SYSTEM
000DCE 0ECE B7               4      OR  A
000DCF 0ECF CC8F0D          17      CALL    Z,SHOW_OK
000DD2 0ED2 C9              10      RET
                                
       0ED3                     GETNUM:
000DD3 0ED3 CDE40B          17      CALL    SPCUT
000DD6 0ED6 210000          10      LD  HL,0
       0ED9                     GETNUM1:
000DD9 0ED9 1A               7      LD  A,(DE)
000DDA 0EDA 13               6      INC DE
000DDB 0EDB D630             7      SUB '0'
000DDD 0EDD D8              11      RET C
000DDE 0EDE FE0A             7      CP  10
000DE0 0EE0 D0              11      RET NC
000DE1 0EE1 4D               4      LD  C,L
000DE2 0EE2 44               4      LD  B,H
000DE3 0EE3 29              11      ADD HL,HL   ;*2
000DE4 0EE4 29              11      ADD HL,HL   ;*4
000DE5 0EE5 09              11      ADD HL,BC   ;*5
000DE6 0EE6 29              11      ADD HL,HL   ;*10
000DE7 0EE7 4F               4      LD  C,A
000DE8 0EE8 0600             7      LD  B,0
000DEA 0EEA 09              11      ADD HL,BC
000DEB 0EEB 18EC            12      JR  GETNUM1
                                
       0EED                     CHDIR:
000DED 0EED 3AD310          13      LD  A,(MAJOR_VER)
000DF0 0EF0 FE02             7      CP  2
000DF2 0EF2 D8              11      RET C
000DF3 0EF3 C5              11      PUSH    BC
000DF4 0EF4 E5              11      PUSH    HL
000DF5 0EF5 0E5A             7      LD  C,05AH      ;(BDOS)_CHDIR カレントディレクトリの変更
000DF7 0EF7 CD0500          17      CALL    SYSTEM
000DFA 0EFA E1              10      POP HL
000DFB 0EFB C1              10      POP BC
000DFC 0EFC C9              10      RET
                                
       0011                     COMS    EQU 17
       0EFD                     COMTB:
000DFD 0EFD 44202020202020          DB  "D      "   ;1
000E04 0F04 A005                    DW  C_DIR
000E06 0F06 44495220202020          DB  "DIR    "   ;2
000E0D 0F0D A005                    DW  C_DIR
000E0F 0F0F 434F5059202020          DB  "COPY   "   ;3
000E16 0F16 9D08                    DW  C_COPY
000E18 0F18 43442020202020          DB  "CD     "   ;4
000E1F 0F1F 9303                    DW  C_CD
000E21 0F21 44454C20202020          DB  "DEL    "   ;5
000E28 0F28 3F05                    DW  C_DEL
000E2A 0F2A 50415448202020          DB  "PATH   "   ;6
000E31 0F31 6906                    DW  C_PATH
000E33 0F33 52454E20202020          DB  "REN    "   ;7
000E3A 0F3A 7205                    DW  C_REN
000E3C 0F3C 54595045202020          DB  "TYPE   "   ;8
000E43 0F43 4B0A                    DW  C_TYPE
000E45 0F45 52454D20202020          DB  "REM    "   ;9
000E4C 0F4C 3D05                    DW  C_REM
000E4E 0F4E 4D4F4445202020          DB  "MODE   "   ;10
000E55 0F55 0C0D                    DW  C_MODE
000E57 0F57 50415553452020          DB  "PAUSE  "   ;11
000E5E 0F5E 590D                    DW  C_PAUSE
000E60 0F60 53455420202020          DB  "SET    "   ;12
000E67 0F67 A80D                    DW  C_SET
000E69 0F69 4543484F202020          DB  "ECHO   "   ;13
000E70 0F70 740D                    DW  C_ECHO
000E72 0F72 4D4B4449522020          DB  "MKDIR  "   ;14
000E79 0F79 7E0D                    DW  C_MKDIR
000E7B 0F7B 524D4449522020          DB  "RMDIR  "   ;15
000E82 0F82 9A0D                    DW  C_RMDIR
000E84 0F84 464F524D415420          DB  "FORMAT "   ;16
000E8B 0F8B 3B0E                    DW  C_FORMAT
000E8D 0F8D 52414D4449534B          DB  "RAMDISK"   ;17
000E94 0F94 9E0E                    DW  C_RAMDISK
                                
000E96 0F96 2062797465732066    FREE:   DB  " bytes free  $"
            726565202024        
000EA4 0FA4 2020203C4449523E    DIRMES: DB  "   <DIR>$"
            24                  
000EAD 0FAD 4F4B24              OK: DB  "OK$"
000EB0 0FB0 4572726F722124      COMERM: DB  "Error!$"
000EB7 0FB7 537472696B652061    PAUSE:  DB  "Strike any key when ready ",0
            6E79206B65792077    
            68656E2072656164    
            792000              
                                
       0FD2                     S_MONTH:
000ED2 0FD2 4A616E00                DB  "Jan",0
000ED6 0FD6 46656200                DB  "Feb",0
000EDA 0FDA 4D617200                DB  "Mar",0
000EDE 0FDE 41707200                DB  "Apr",0
000EE2 0FE2 4D617900                DB  "May",0
000EE6 0FE6 4A756E00                DB  "Jun",0
000EEA 0FEA 4A756C00                DB  "Jul",0
000EEE 0FEE 41756700                DB  "Aug",0
000EF2 0FF2 53657000                DB  "Sep",0
000EF6 0FF6 4F637400                DB  "Oct",0
000EFA 0FFA 4E6F7600                DB  "Nov",0
000EFE 0FFE 44656300                DB  "Dec",0
                                
       1002                     N_APPEND:
000F02 1002 415050454E4400          DB  "APPEND",0
       1009                     V_APPEND:
000F09 1009                         DS  64
       1049                     N_PATH:
000F49 1049 5041544800              DB  "PATH",0
       104E                     V_PATH:
000F4E 104E                         DS  PATHX
       108E                     N_DATE:
000F8E 108E 4441544500              DB  "DATE",0
       1093                     V_DATE:
000F93 1093 79792D6D6D2D6464        DB  "yy-mm-dd"
000F9B 109B                         DS  8
       10A3                     V_DATE1:
000FA3 10A3 6D6D2D64642D7979        DB  "mm-dd-yy"
       10AB                     V_DATE2:
000FAB 10AB 64642D6D6D2D7979        DB  "dd-mm-yy"
       10B3                     N_TIME:
000FB3 10B3 54494D4500              DB  "TIME",0
       10B8                     V_TIME:
000FB8 10B8 323400                  DB  "24",0
       10BB                     N_PROGRAM:
000FBB 10BB 50524F4752414D00        DB  "PROGRAM",0
       10C3                     N_PARAMETERS:
000FC3 10C3 504152414D455445        DB  "PARAMETERS",0
            525300              
                                
       10CE                     F_TIME:
000FCE 10CE 00                      DB  0
       10CF                     PROMPT:
000FCF 10CF 3F2000                  DB  "? ",0
       10D2                     IS_MSX:
000FD2 10D2 00                      DB  0
       10D3                     MAJOR_VER:
000FD3 10D3 00                      DB  0
       10D4                     SEARCH_IX:
000FD4 10D4                         DS  64  ;DOS2用
       1114                     HANDLE1:
001014 1114 0000                    DW  0
       1116                     PATH_POS:
001016 1116 0000                    DW  0
       1118                     PATH_DRV:
001018 1118 413A5C                  DB  "A:\\"
       111B                     PATH_CCP:
00101B 111B                         DS  64  ;DOS2用
       115B                     PATH_PAR:
00105B 115B                         DS  64  ;DOS2用
       119B                     PATH_FN1:
00109B 119B                         DS  64  ;DOS2用
       11DB                     PATH_FN2:
0010DB 11DB                         DS  64  ;DOS2用
       121B                     CUR_DRV:
00111B 121B 413A5C                  DB  "A:\\"
       121E                     CUR_PATH:
00111E 121E                         DS  64  ;DOS2用
       125E                     DOS2NAME:
00115E 125E                         DS  2+8+3+1 ;DOS2用
       126C                     DTA_CCP:
00116C 126C                         DS  37
       1291                     DIR_CK:
001191 1291 0000                    DW  0
                                
       1293                     CPBUF:
001193 1293 0000                LEFTX:  DW  0
001195 1295 0000                DTAX:   DW  0
001197 1297 20                      DB  020H    ;CPBUFで使う
001198 1298 20                      DB  020H
001199 1299 20                      DB  020H
00119A 129A 20                      DB  020H
00119B 129B 20                      DB  020H
00119C 129C 20                      DB  020H
00119D 129D 20                      DB  020H
                                
       129E                     DECBF:
00119E 129E                         DS  5
       12A3                     FCB_BAT2:
0011A3 12A3 00                      DB  0
       12A4                     FDRV:
0011A4 12A4 00                      DB  0
       12A5                     FNAME:
0011A5 12A5                         DS  37
       12CA                     ZERO:
0011CA 12CA 00                      DB  0
       12CB                     FCB_BAT:
0011CB 12CB A312                    DW  FCB_BAT2
       12CD                     X_PATH:
0011CD 12CD 0000                    DW  0
       12CF                     CSET_DATA:
0011CF 12CF 00                      DB  0
       12D0                     PROCESS:
0011D0 12D0 00                      DB  0
                                
       12D1                     DATA_COM:
[EOF:COMMAND.ASM:SHIFT_JIS]
