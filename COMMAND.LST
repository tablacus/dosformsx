                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                
                                ;   似非COMMAND.COM
                                
       0005                     SYSTEM  EQU 00005H
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
       001C                     CALSLT  EQU 0001CH
       006C                     INITXT  EQU 0006CH
       006F                     INIT32  EQU 0006FH
       0078                     SETTXT  EQU 00078H
       007B                     SETT32  EQU 0007BH
                                
       F3AE                     LINL40  EQU 0F3AEH
       F3AF                     LINL32  EQU 0F3AFH
       F3B0                     LINLEN  EQU 0F3B0H
       F55E                     BUF EQU 0F55EH
       FAF8                     EXBRSA  EQU 0FAF8H
       FC9B                     INTFLG  EQU 0FC9BH
       FCC1                     EXPTBL  EQU 0FCC1H
                                
                                
       0040                     PATHX   EQU 64
                                
       8000                     DATA    EQU 08000H
                                
000000 0100                         ORG 0100H
000000 0100 C31501          10      JP  START
000003 0103 0D0A434F4D4D414E    VER:    DB  00DH,00AH,"COMMAND v0.10",00DH,00AH,'$'
            442076302E31300D    
            0A24                
       0115                     START:
000015 0115 ED7B0600        20      LD  SP,(SYSTEM+1)
000019 0119 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
00001B 011B CD0500          17      CALL    SYSTEM
00001E 011E D8              11      RET C
00001F 011F 211D01          10      LD  HL,0011DH
000022 0122 ED42            15      SBC HL,BC
000024 0124 78               4      LD  A,B
000025 0125 326D0D          13      LD  (MAJOR_VER),A
000028 0128 B5               4      OR  L
000029 0129 326C0D          13      LD  (IS_MSX),A
00002C 012C B7               4      OR  A
00002D 012D 2820            12      JR  Z,WSTART
                                
00002F 012F CD4D0B          17      CALL    INIT_VAR
                                
000032 0132 2A0600          16      LD  HL,(SYSTEM+1)
000035 0135 2EDB             7      LD  L,256-37
000037 0137 24               4      INC H
000038 0138 22670E          16      LD  (FCB_BAT),HL
00003B 013B 3A8000          13      LD  A,(DTA1)
00003E 013E B7               4      OR  A
00003F 013F 280E            12      JR  Z,WSTART
000041 0141 110301          10      LD  DE,VER
000044 0144 0E09             7      LD  C,9
000046 0146 CD0500          17      CALL    SYSTEM
000049 0149 118100          10      LD  DE,DTA1+1
00004C 014C CD9D01          17      CALL    COMANL
       014F                     WSTART:
00004F 014F 21C20C          10      LD  HL,N_APPEND
000052 0152 11C90C          10      LD  DE,V_APPEND
000055 0155 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000057 0157 CD0500          17      CALL    SYSTEM
                                
00005A 015A CD9A04          17      CALL    LTNL
       015D                     COMMAND:
00005D 015D E5              11      PUSH    HL
00005E 015E 2A670E          16      LD  HL,(FCB_BAT)
000061 0161 7E               7      LD  A,(HL)
000062 0162 E1              10      POP HL
000063 0163 B7               4      OR  A
000064 0164 C25D03          10      JP  NZ,C_BAT1
000067 0167 CD9402          17      CALL    SETDTA1
00006A 016A D5              11      PUSH    DE
00006B 016B C5              11      PUSH    BC
00006C 016C E5              11      PUSH    HL
00006D 016D 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
00006F 016F CD0500          17      CALL    SYSTEM
000072 0172 E1              10      POP HL
000073 0173 C1              10      POP BC
000074 0174 C641             7      ADD A,'A'
000076 0176 5F               4      LD  E,A
000077 0177 CD8408          17      CALL    _PRINT
00007A 017A 1E3E             7      LD  E,'>'
00007C 017C CD8408          17      CALL    _PRINT
00007F 017F D1              10      POP DE      ;DE=DTA1
000080 0180 3E50             7      LD  A,80
000082 0182 12               7      LD  (DE),A
000083 0183 0E0A             7      LD  C,0AH       ;(BDOS)文字列入力
000085 0185 CD0500          17      CALL    SYSTEM
000088 0188 CD9A04          17      CALL    LTNL
       018B                     COMMAND2:
00008B 018B 118200          10      LD  DE,DTA1+2
00008E 018E CD9D01          17      CALL    COMANL
000091 0191 30CA            12      JR  NC,COMMAND
000093 0193 11700C          10      LD  DE,COMERM
000096 0196 0E09             7      LD  C,9     ;(BDOS)文字列出力
000098 0198 CD0500          17      CALL    SYSTEM
00009B 019B 18B2            12      JR  WSTART
                                
       019D                     COMANL:
00009D 019D CDB909          17      CALL    TOZERO
0000A0 01A0 CDD608          17      CALL    FILE
0000A3 01A3 D5              11      PUSH    DE
0000A4 01A4 11410E          10      LD  DE,FNAME
0000A7 01A7 1A               7      LD  A,(DE)
0000A8 01A8 FE20             7      CP  020H
0000AA 01AA 285C            12      JR  Z,SDVSW
0000AC 01AC 1B               6      DEC DE
0000AD 01AD 1A               7      LD  A,(DE)
0000AE 01AE C6FF             7      ADD A,0FFH
0000B0 01B0 380A            12      JR  C,COMB
0000B2 01B2 13               6      INC DE
                                
0000B3 01B3 21ED0B          10      LD  HL,COMTB
0000B6 01B6 3E0F             7      LD  A,COMS
0000B8 01B8 47               4      LD  B,A
0000B9 01B9 CD0B0A          17      CALL    CPNAME
       01BC                     COMB:
0000BC 01BC D1              10      POP DE
0000BD 01BD D28308          10      JP  NC,JP_HL
       01C0                     COMB2:
0000C0 01C0 EB               4      EX  DE,HL
0000C1 01C1 220903          16      LD  (COMPAT+1),HL
0000C4 01C4 CDCC02          17      CALL    CEXE4
                                
0000C7 01C7 21090D          10      LD  HL,N_PATH
0000CA 01CA 110E0D          10      LD  DE,V_PATH
0000CD 01CD 0640             7      LD  B,PATHX
0000CF 01CF 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
0000D1 01D1 CD0500          17      CALL    SYSTEM
                                
0000D4 01D4 210E0D          10      LD  HL,V_PATH
0000D7 01D7 22690E          16      LD  (X_PATH),HL
       01DA                     CEX1:
0000DA 01DA 2A690E          16      LD  HL,(X_PATH)
0000DD 01DD 7E               7      LD  A,(HL)
0000DE 01DE FE20             7      CP  020H
0000E0 01E0 D8              11      RET C
       01E1                     CEX2:
0000E1 01E1 7E               7      LD  A,(HL)
0000E2 01E2 FE20             7      CP  020H
0000E4 01E4 3807            12      JR  C,CEX3
0000E6 01E6 FE3B             7      CP  ';'
0000E8 01E8 2803            12      JR  Z,CEX3
0000EA 01EA 23               6      INC HL
0000EB 01EB 18F4            12      JR  CEX2
       01ED                     CEX3:
0000ED 01ED 3600            10      LD  (HL),0
0000EF 01EF FE20             7      CP  020H
0000F1 01F1 3801            12      JR  C,CEX4
0000F3 01F3 23               6      INC HL
       01F4                     CEX4:
0000F4 01F4 ED5B690E        20      LD  DE,(X_PATH)
0000F8 01F8 22690E          16      LD  (X_PATH),HL
0000FB 01FB 21C20C          10      LD  HL,N_APPEND
0000FE 01FE 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000100 0200 CD0500          17      CALL    SYSTEM
                                
000103 0203 CDCC02          17      CALL    CEXE4
000106 0206 18D2            12      JR  CEX1
                                
       0208                     SDVSW:
000108 0208 F1              10      POP AF
000109 0209 3A400E          13      LD  A,(FDRV)
00010C 020C 3D               4      DEC A
00010D 020D 5F               4      LD  E,A
00010E 020E 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
000110 0210 C39B02          10      JP  SYSTEM0
                                
       0213                     OPEN1_D2:           ;DOS2対応
000113 0213 3A6D0D          13      LD  A,(MAJOR_VER)
000116 0216 FE02             7      CP  2
000118 0218 382C            12      JR  C,OPEN1
                                
00011A 021A 11AE0D          10      LD  DE,PATH_CCP
00011D 021D DD216E0D        14      LD  IX,SEARCH_IX
000121 0221 014010          10      LD  BC,01040H   ;(BDOS)最初のエントリ検索
000124 0224 CD0500          17      CALL    SYSTEM
       0227                     FIB2DIRENT:
000127 0227 B7               4      OR  A
000128 0228 C0              11      RET NZ
                                
000129 0229 116F0D          10      LD  DE,SEARCH_IX+1
00012C 022C 210B0E          10      LD  HL,DTA_CCP+1
00012F 022F 0E5C             7      LD  C,05CH      ;(BDOS)ファイル名の解析
000131 0231 CD0500          17      CALL    SYSTEM
                                
000134 0234 217C0D          10      LD  HL,SEARCH_IX+14
000137 0237 11160E          10      LD  DE,DTA_CCP+1+8+3
00013A 023A EDA0            16      LDI
00013C 023C 11210E          10      LD  DE,DTA_CCP+1+8+3+1+10
00013F 023F 010A00          10      LD  BC,2+2+2+4  ;最終変更時刻+最終変更日付+開始クラスタ+ファイルサイズ
000142 0242 EDB0                    LDIR
000144 0244 AF               4      XOR A
000145 0245 C9              10      RET
                                
       0246                     OPEN1:
000146 0246 21400E          10      LD  HL,FDRV
       0249                     OPEN:
000149 0249 0E11             7      LD  C,011H      ;(BDOS)最初のファイルの検索
       024B                     OPEN3:
00014B 024B D5              11      PUSH    DE
00014C 024C 110A0E          10      LD  DE,DTA_CCP
00014F 024F CD8702          17      CALL    SETDTA
000152 0252 EB               4      EX  DE,HL
000153 0253 CD0500          17      CALL    SYSTEM
000156 0256 D1              10      POP DE
000157 0257 B7               4      OR  A
000158 0258 C9              10      RET
                                
       0259                     OPEN2_D2:           ;DOS2対応
000159 0259 3A6D0D          13      LD  A,(MAJOR_VER)
00015C 025C FE02             7      CP  2
00015E 025E 380B            12      JR  C,OPEN2
000160 0260 DD216E0D        14      LD  IX,SEARCH_IX
000164 0264 0E41             7      LD  C,41H       ;(BDOS)次のエントリ検索
000166 0266 CD0500          17      CALL    SYSTEM
000169 0269 18BC            12      JR  FIB2DIRENT
       026B                     OPEN2:
00016B 026B 0E12             7      LD  C,012H
00016D 026D 18DC            12      JR  OPEN3
                                
       026F                     DEFCB:              ;Z=Ok NZ=Error
00016F 026F 110A0E          10      LD  DE,DTA_CCP
000172 0272 CD9902          17      CALL    SYSC0F
000175 0275 B7               4      OR  A
000176 0276 C0              11      RET NZ
                                
000177 0277 210100          10      LD  HL,1
00017A 027A 22180E          16      LD  (DTA_CCP+14),HL
00017D 027D 2D               4      DEC L
00017E 027E 222B0E          16      LD  (DTA_CCP+33),HL
000181 0281 222D0E          16      LD  (DTA_CCP+35),HL
       0284                     SETDTA100:
000184 0284 110080          10      LD  DE,DATA
       0287                     SETDTA:
000187 0287 C5              11      PUSH    BC
000188 0288 D5              11      PUSH    DE
000189 0289 E5              11      PUSH    HL
00018A 028A 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
00018C 028C CD0500          17      CALL    SYSTEM
00018F 028F E1              10      POP HL
000190 0290 D1              10      POP DE
000191 0291 C1              10      POP BC
000192 0292 AF               4      XOR A
000193 0293 C9              10      RET
                                
       0294                     SETDTA1:
000194 0294 118000          10      LD  DE,DTA1
000197 0297 18EE            12      JR  SETDTA
                                
       0299                     SYSC0F:
000199 0299 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       029B                     SYSTEM0:
00019B 029B CD0500          17      CALL    SYSTEM
00019E 029E B7               4      OR  A
00019F 029F C9              10      RET
                                
       02A0                     C_CD:
0001A0 02A0 CDA808          17      CALL    FILEC_D2
0001A3 02A3 11AE0D          10      LD  DE,PATH_CCP
0001A6 02A6 1A               7      LD  A,(DE)
0001A7 02A7 FE20             7      CP  020H
0001A9 02A9 3805            12      JR  C,PWD
0001AB 02AB 0E5A             7      LD  C,5AH       ;(BDOS)_CHDIR カレントディレクトリの変更
0001AD 02AD C30500          10      JP  SYSTEM
       02B0                     PWD:
0001B0 02B0 CDE004          17      CALL    PUTDRV
0001B3 02B3 3E5C             7      LD  A,05CH
0001B5 02B5 CD9508          17      CALL    MSG_A
0001B8 02B8 C35404          10      JP  PDSKF2
                                
       02BB                     S27DTA:
0001BB 02BB 110100          10      LD  DE,1
0001BE 02BE ED53180E        20      LD  (DTA_CCP+14),DE
0001C2 02C2 110A0E          10      LD  DE,DTA_CCP
       02C5                     S27:
0001C5 02C5 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
0001C7 02C7 CD0500          17      CALL    SYSTEM
0001CA 02CA B7               4      OR  A
0001CB 02CB C9              10      RET
                                
       02CC                     CEXE4:
0001CC 02CC 21400E          10      LD  HL,FDRV
0001CF 02CF 110A0E          10      LD  DE,DTA_CCP
0001D2 02D2 010900          10      LD  BC,1+8
0001D5 02D5 EDB0                    LDIR
0001D7 02D7 21130E          10      LD  HL,DTA_CCP+9
0001DA 02DA 3643            10      LD  (HL),'C'
0001DC 02DC 23               6      INC HL
0001DD 02DD 364F            10      LD  (HL),'O'
0001DF 02DF 23               6      INC HL
0001E0 02E0 364D            10      LD  (HL),'M'
       02E2                     C_EXE:
0001E2 02E2 CD6F02          17      CALL    DEFCB
0001E5 02E5 204E            12      JR  NZ,C_BAT
0001E7 02E7 116C0E          10      LD  DE,DATA_COM
0001EA 02EA CD8702          17      CALL    SETDTA
                                
0001ED 02ED 2A0600          16      LD  HL,(SYSTEM+1)
0001F0 02F0 116C0E          10      LD  DE,DATA_COM
0001F3 02F3 ED52            15      SBC HL,DE
                                
0001F5 02F5 CDBB02          17      CALL    S27DTA
0001F8 02F8 3D               4      DEC A
0001F9 02F9 37               4      SCF
0001FA 02FA C0              11      RET NZ
0001FB 02FB 7C               4      LD  A,H
0001FC 02FC B5               4      OR  L
0001FD 02FD 37               4      SCF
0001FE 02FE C8              11      RET Z
0001FF 02FF 222F03          16      LD  (COMSIZ+1),HL
                                
000202 0302 116C0E          10      LD  DE,DATA_COM
000205 0305 CD8702          17      CALL    SETDTA
000208 0308 110000          10  COMPAT: LD  DE,0
00020B 030B CD8F06          17      CALL    SETFCB
                                
00020E 030E 21C20C          10      LD  HL,N_APPEND
000211 0311 11C90C          10      LD  DE,V_APPEND
000214 0314 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000216 0316 CD0500          17      CALL    SYSTEM
                                
000219 0319 AF               4      XOR A
00021A 031A 67               4      LD  H,A
00021B 031B 6F               4      LD  L,A ;HL=0x0000
00021C 031C F3               4      DI
00021D 031D ED7B0600        20  SPPAT:  LD  SP,(SYSTEM+1)
000221 0321 E5              11      PUSH    HL
000222 0322 21EDB0          10      LD  HL,0B0EDH   ;LDIR
000225 0325 22FE00          16      LD  (000FEH),HL
000228 0328 216C0E          10      LD  HL,DATA_COM
00022B 032B 110001          10      LD  DE,00100H
00022E 032E 010000          10  COMSIZ: LD  BC,0
000231 0331 FB               4      EI
000232 0332 C3FE00          10      JP  000FEH
                                
       0335                     C_BAT:
000235 0335 21130E          10      LD  HL,DTA_CCP+9
000238 0338 3642            10      LD  (HL),'B'
00023A 033A 23               6      INC HL
00023B 033B 3641            10      LD  (HL),'A'
00023D 033D 23               6      INC HL
00023E 033E 3654            10      LD  (HL),'T'
                                
000240 0340 CD6F02          17      CALL    DEFCB
000243 0343 C0              11      RET NZ
                                
000244 0344 210A0E          10      LD  HL,DTA_CCP
000247 0347 7E               7      LD  A,(HL)
000248 0348 B7               4      OR  A
000249 0349 2009            12      JR  NZ,CBAT_DS
00024B 034B E5              11      PUSH    HL
00024C 034C 0E19             7      LD  C,019H      ;(BDOS)カレントドライブ番号の獲得(_CURDRV)
00024E 034E CD0500          17      CALL    SYSTEM
000251 0351 E1              10      POP HL
000252 0352 3C               4      INC A
000253 0353 77               7      LD  (HL),A
       0354                     CBAT_DS:
000254 0354 ED5B670E        20      LD  DE,(FCB_BAT)
000258 0358 012500          10      LD  BC,37
00025B 035B EDB0                    LDIR
       035D                     C_BAT1:
00025D 035D CD8402          17      CALL    SETDTA100
000260 0360 CD9E03          17      CALL    FGETC_BAT
000263 0363 218100          10      LD  HL,DTA1+1
000266 0366 202A            12      JR  NZ,END_BATCH
000268 0368 FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
00026A 036A 38F1            12      JR  C,C_BAT1
00026C 036C 3620            10      LD  (HL),' '
00026E 036E 23               6      INC HL
       036F                     C_BAT2:
00026F 036F 77               7      LD  (HL),A
000270 0370 23               6      INC HL
000271 0371 7D               4      LD  A,L
000272 0372 3C               4      INC A       ;L==0FFH
000273 0373 2809            12      JR  Z,RUN_BATCH
000275 0375 CD9E03          17      CALL    FGETC_BAT
000278 0378 2004            12      JR  NZ,RUN_BATCH
00027A 037A FE20             7      CP  020H
00027C 037C 30F1            12      JR  NC,C_BAT2
       037E                     RUN_BATCH:
00027E 037E 7D               4      LD  A,L
00027F 037F D67F             7      SUB DTA1-1
000281 0381 328000          13      LD  (DTA1),A
000284 0384 FE04             7      CP  4
000286 0386 380A            12      JR  C,END_BATCH
000288 0388 3600            10      LD  (HL),0
00028A 038A 3A9BFC          13      LD  A,(INTFLG)
00028D 038D FE03             7      CP  3
00028F 038F C28B01          10      JP  NZ,COMMAND2
       0392                     END_BATCH:      ;バッチファイルを閉じる
000292 0392 2A670E          16      LD  HL,(FCB_BAT)
000295 0395 3600            10      LD  (HL),0
000297 0397 ED7B0600        20      LD  SP,(SYSTEM+1)
00029B 039B C34F01          10      JP  WSTART
                                
       039E                     FGETC_BAT:
00029E 039E ED5B670E        20      LD  DE,(FCB_BAT)
       03A2                     FGETC:              ;1文字ずつ読み込む
0002A2 03A2 E5              11      PUSH    HL      ;Z:成功
0002A3 03A3 210100          10      LD  HL,1
0002A6 03A6 CDC502          17      CALL    S27
0002A9 03A9 E1              10      POP HL
0002AA 03AA 3A0080          13      LD  A,(DATA)
0002AD 03AD C9              10      RET
                                
       03AE                     C_REM:
0002AE 03AE AF               4      XOR A
0002AF 03AF C9              10      RET
                                
       03B0                     C_DEL:
0002B0 03B0 CD8F06          17      CALL    SETFCB
0002B3 03B3 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力
0002B5 03B5 CD0500          17      CALL    SYSTEM
                                
0002B8 03B8 0E13             7      LD  C,013H
0002BA 03BA 1811            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       03BC                     C_REN:
0002BC 03BC 3A6D0D          13      LD  A,(MAJOR_VER)
0002BF 03BF FE02             7      CP  2
0002C1 03C1 3013            12      JR  NC,REN_DOS2
0002C3 03C3 CD8F06          17      CALL    SETFCB
0002C6 03C6 3E10             7      LD  A,010H      ;ディレクトリも対象にする(LSX-Dodgers)
0002C8 03C8 326900          13      LD  (FCB1+13),A ;属性
0002CB 03CB 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       03CD                     CDEL1:
0002CD 03CD 115C00          10      LD  DE,FCB1
       03D0                     REN2:
0002D0 03D0 CD0500          17      CALL    SYSTEM
0002D3 03D3 C6FF             7      ADD A,0FFH
0002D5 03D5 C9              10      RET
                                
       03D6                     REN_DOS2:           ;DOS2のリネーム(ディレクトリ対応)
0002D6 03D6 CDB309          17      CALL    SPCUT
0002D9 03D9 6B               4      LD  L,E
0002DA 03DA 62               4      LD  H,D
       03DB                     REN_D2_1:
0002DB 03DB 7E               7      LD  A,(HL)
0002DC 03DC FE21             7      CP  020H+1
0002DE 03DE 3803            12      JR  C,REN_D2_2
0002E0 03E0 23               6      INC HL
0002E1 03E1 18F8            12      JR  REN_D2_1
       03E3                     REN_D2_2:
0002E3 03E3 3600            10      LD  (HL),0
0002E5 03E5 23               6      INC HL
0002E6 03E6 0E4E             7      LD  C,04EH      ;(BDOS)ファイルあるいはサブディレクトリ名の変更(_RENAME)
0002E8 03E8 18E6            12      JR  REN2
                                
       03EA                     C_DIR:
0002EA 03EA CDA808          17      CALL    FILEC_D2
0002ED 03ED 21410E          10      LD  HL,FDRV+1
0002F0 03F0 CD6908          17      CALL    CWILD1
0002F3 03F3 3EF1             7      LD  A,0F1H
0002F5 03F5 324D0E          13      LD  (FDRV+13),A
0002F8 03F8 CD1302          17      CALL    OPEN1_D2
       03FB                     CDIR1:
0002FB 03FB B7               4      OR  A
0002FC 03FC 2008            12      JR  NZ,PDSKF
0002FE 03FE CD7204          17      CALL    P_NAME
000301 0401 CD5902          17      CALL    OPEN2_D2
000304 0404 18F5            12      JR  CDIR1
                                
       0406                     PDSKF:
000306 0406 3A400E          13      LD  A,(FDRV)
000309 0409 5F               4      LD  E,A
00030A 040A 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
00030C 040C CD0500          17      CALL    SYSTEM
00030F 040F 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
000310 0410 C601             7      ADD A,001H
000312 0412 D8              11      RET C       ;Aが0FFHだった場合
000313 0413 3E06             7      LD  A,8-2
       0415                     PDS1:               ;HL=未使用クラスタの総数
000315 0415 3C               4      INC A
000316 0416 CB19             8      RR  C
000318 0418 30FB            12      JR  NC,PDS1
       041A                     PDS2:               ;B←論理セクタのサイズの上位8ビット
00031A 041A 3C               4      INC A
00031B 041B CB18             8      RR  B
00031D 041D 30FB            12      JR  NC,PDS2
00031F 041F 47               4      LD  B,A
                                
000320 0420 110000          10      LD  DE,0
       0423                     PDS3:
000323 0423 29              11      ADD HL,HL
000324 0424 EB               4      EX  DE,HL
000325 0425 ED6A            15      ADC HL,HL
000327 0427 EB               4      EX  DE,HL
000328 0428 10F9            13      DJNZ    PDS3
       042A                     PDSKF1:
00032A 042A CD0005          17      CALL    PRDEC_DEHL
00032D 042D 11560C          10      LD  DE,FREE
000330 0430 0E09             7      LD  C,9     ;(BDOS)文字列出力
000332 0432 CD0500          17      CALL    SYSTEM
000335 0435 CDE004          17      CALL    PUTDRV
000338 0438 3E5C             7      LD  A,05CH
00033A 043A CD9508          17      CALL    MSG_A
00033D 043D 3A6D0D          13      LD  A,(MAJOR_VER)
000340 0440 FE01             7      CP  1
000342 0442 3856            12      JR  C,LTNL
000344 0444 200E            12      JR  NZ,PDSKF2
000346 0446 2A4E0E          16      LD  HL,(FDRV+14)
000349 0449 AF               4      XOR A
00034A 044A 11FEFF          10      LD  DE,0-2
00034D 044D 19              11      ADD HL,DE
00034E 044E 23               6      INC HL
00034F 044F DCFC04          17      CALL    C,PRDEC_HL
000352 0452 1846            12      JR  LTNL
       0454                     PDSKF2:             ;MSX-DOS2
000354 0454 3A400E          13      LD  A,(FDRV)
000357 0457 47               4      LD  B,A     ;ドライブ
000358 0458 110080          10      LD  DE,DATA
00035B 045B 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
00035D 045D CD0500          17      CALL    SYSTEM
000360 0460 210080          10      LD  HL,DATA
                                
000363 0463 CD6C04          17      CALL    MSX
000366 0466 1832            12      JR  LTNL
                                
       0468                     MSX1:
000368 0468 5F               4      LD  E,A
000369 0469 CD8408          17      CALL    _PRINT
       046C                     MSX:
00036C 046C 7E               7      LD  A,(HL)
00036D 046D 23               6      INC HL
00036E 046E B7               4      OR  A
00036F 046F 20F7            12      JR  NZ,MSX1
000371 0471 C9              10      RET
                                
       0472                     P_NAME:
000372 0472 210B0E          10      LD  HL,DTA_CCP+1
000375 0475 7E               7      LD  A,(HL)
000376 0476 FE2E             7      CP  '.'
000378 0478 C8              11      RET Z
000379 0479 CD5605          17      CALL    FPRNT
00037C 047C 3A160E          13      LD  A,(DTA_CCP+12)
00037F 047F CB67             8      BIT 4,A
000381 0481 280A            12      JR  Z,DIR3
000383 0483 11640C          10      LD  DE,DIRMES
000386 0486 0E09             7      LD  C,9     ;(BDOS)文字列出力
000388 0488 CD0500          17      CALL    SYSTEM
00038B 048B 180A            12      JR  DIR6
       048D                     DIR3:
00038D 048D ED5B290E        20      LD  DE,(DTA_CCP+1+01EH)
000391 0491 2A270E          16      LD  HL,(DTA_CCP+1+01CH)
000394 0494 CD0005          17      CALL    PRDEC_DEHL
       0497                     DIR6:
000397 0497 CD7805          17      CALL    PRTTMS
                                
       049A                     LTNL:
00039A 049A 1E0D             7      LD  E,00DH
00039C 049C CD8408          17      CALL    _PRINT
00039F 049F 1E0A             7      LD  E,00AH
0003A1 04A1 C38408          10      JP  _PRINT
                                
       04A4                     C_PATH:
0003A4 04A4 CDB309          17      CALL    SPCUT
0003A7 04A7 FE21             7      CP  021H
0003A9 04A9 301C            12      JR  NC,CPATH0
                                
0003AB 04AB 21090D          10      LD  HL,N_PATH
0003AE 04AE 110E0D          10      LD  DE,V_PATH
0003B1 04B1 0640             7      LD  B,PATHX
0003B3 04B3 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
0003B5 04B5 CD0500          17      CALL    SYSTEM
0003B8 04B8 210E0D          10      LD  HL,V_PATH
       04BB                     CPATHP:
0003BB 04BB 7E               7      LD  A,(HL)
0003BC 04BC 23               6      INC HL
0003BD 04BD FE20             7      CP  020H
0003BF 04BF 3F               4      CCF
0003C0 04C0 30D8            12      JR  NC,LTNL
0003C2 04C2 CD9508          17      CALL    MSG_A
0003C5 04C5 18F4            12      JR  CPATHP
       04C7                     CPATH0:
0003C7 04C7 210E0D          10      LD  HL,V_PATH
0003CA 04CA FE3B             7      CP  ';'
0003CC 04CC 2001            12      JR  NZ,CPATH1
0003CE 04CE 13               6      INC DE
       04CF                     CPATH1:
0003CF 04CF EB               4      EX  DE,HL
0003D0 04D0 014000          10      LD  BC,PATHX
0003D3 04D3 EDB0                    LDIR
                                
0003D5 04D5 21090D          10      LD  HL,N_PATH
0003D8 04D8 110E0D          10      LD  DE,V_PATH
0003DB 04DB 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0003DD 04DD C30500          10      JP  SYSTEM
                                
       04E0                     PUTDRV:
0003E0 04E0 3A400E          13      LD  A,(FDRV)
0003E3 04E3 B7               4      OR  A
0003E4 04E4 200C            12      JR  NZ,PUTDRV1
0003E6 04E6 C5              11      PUSH    BC
0003E7 04E7 D5              11      PUSH    DE
0003E8 04E8 E5              11      PUSH    HL
0003E9 04E9 0E19             7      LD  C,019H
0003EB 04EB CD0500          17      CALL    SYSTEM
0003EE 04EE E1              10      POP HL
0003EF 04EF D1              10      POP DE
0003F0 04F0 C1              10      POP BC
0003F1 04F1 3C               4      INC A
       04F2                     PUTDRV1:
0003F2 04F2 C640             7      ADD A,'A'-1
0003F4 04F4 CD9508          17      CALL    MSG_A
0003F7 04F7 3E3A             7      LD  A,':'
       04F9                     MSG_AR:
0003F9 04F9 C39508          10      JP  MSG_A
                                
       04FC                     PRDEC_HL:
0003FC 04FC AF               4      XOR A
       04FD                     PRDEC_AHL:
0003FD 04FD 5F               4      LD  E,A
0003FE 04FE 1600             7      LD  D,0
       0500                     PRDEC_DEHL:
000400 0500 3E02             7      LD  A,2
000402 0502 324B05          13      LD  (DEC6+1),A
000405 0505 AF               4      XOR A
000406 0506 E5              11      PUSH    HL
000407 0507 213A0E          10      LD  HL,DECBF
00040A 050A 0605             7      LD  B,5
00040C 050C CD7A09          17      CALL    FILL_MEMORY
00040F 050F E1              10      POP HL
                                
000410 0510 0E20             7      LD  C,32
       0512                     DEC1:
000412 0512 29              11      ADD HL,HL
000413 0513 EB               4      EX  DE,HL
000414 0514 ED6A            15      ADC HL,HL
000416 0516 EB               4      EX  DE,HL
000417 0517 E5              11      PUSH    HL
000418 0518 213E0E          10      LD  HL,DECBF+4
00041B 051B 0605             7      LD  B,5
       051D                     DEC2:
00041D 051D 7E               7      LD  A,(HL)
00041E 051E 8F               4      ADC A,A
00041F 051F 27               4      DAA
000420 0520 77               7      LD  (HL),A
000421 0521 2B               6      DEC HL
000422 0522 10F9            13      DJNZ    DEC2
000424 0524 E1              10      POP HL
000425 0525 0D               4      DEC C
000426 0526 20EA            12      JR  NZ,DEC1
                                
000428 0528 213A0E          10      LD  HL,DECBF
00042B 052B 3E20             7      LD  A,020H
00042D 052D 0604             7      LD  B,4
       052F                     DEC3:
00042F 052F CD3C05          17      CALL    DEC4
000432 0532 CD3C05          17      CALL    DEC4
000435 0535 23               6      INC HL
000436 0536 10F7            13      DJNZ    DEC3
       0538                     DECX:
000438 0538 CD3C05          17      CALL    DEC4
00043B 053B AF               4      XOR A
       053C                     DEC4:
00043C 053C ED6F            18      RLD
00043E 053E FE20             7      CP  020H
000440 0540 2808            12      JR  Z,DEC6
000442 0542 F630             7      OR  030H
       0544                     DEC5:
000444 0544 18B3            12      JR  MSG_AR
       0546                     DEC7:
000446 0546 3E20             7      LD  A,020H
000448 0548 18AF            12      JR  MSG_AR
       054A                     DEC6:
00044A 054A 3E02             7      LD  A,2
00044C 054C B7               4      OR  A
00044D 054D 28F7            12      JR  Z,DEC7
00044F 054F 3D               4      DEC A
000450 0550 324B05          13      LD  (DEC6+1),A
000453 0553 3E20             7      LD  A,020H
000455 0555 C9              10      RET
                                
       0556                     FPRNT:
000456 0556 0608             7      LD  B,8
000458 0558 CD6905          17      CALL    P_N1
00045B 055B 7E               7      LD  A,(HL)
00045C 055C C680             7      ADD A,0A0H-020H
00045E 055E FEA0             7      CP  0A0H
000460 0560 2802            12      JR  Z,FPR1
000462 0562 3E2E             7      LD  A,'.'
       0564                     FPR1:
000464 0564 CD9508          17      CALL    MSG_A
000467 0567 0603             7      LD  B,3
                                
       0569                     P_N1:
000469 0569 C5              11      PUSH    BC
00046A 056A E5              11      PUSH    HL
00046B 056B 7E               7      LD  A,(HL)
00046C 056C CDD209          17      CALL    CAP3
00046F 056F CD9508          17      CALL    MSG_A
000472 0572 E1              10      POP HL
000473 0573 C1              10      POP BC
000474 0574 23               6      INC HL
000475 0575 10F2            13      DJNZ    P_N1
000477 0577 C9              10      RET
                                
       0578                     PRTTMS:
000478 0578 3E20             7      LD  A,020H
00047A 057A CD9508          17      CALL    MSG_A
                                
00047D 057D 2A230E          16      LD  HL,(DTA_CCP+1+24)
000480 0580 7D               4      LD  A,L
000481 0581 B7               4      OR  A
000482 0582 C8              11      RET Z
000483 0583 CB3C             8      SRL H
000485 0585 17               4      RLA
000486 0586 17               4      RLA
000487 0587 17               4      RLA
000488 0588 17               4      RLA
000489 0589 E60F             7      AND 00FH
00048B 058B 57               4      LD  D,A
00048C 058C DD21530D        14      LD  IX,V_DATE
       0590                     PRTTMS1:
000490 0590 DD7E00          19      LD  A,(IX+0)
000493 0593 B7               4      OR  A
000494 0594 2808            12      JR  Z,PRTTMS2
000496 0596 CD1906          17      CALL    PR_DATE
000499 0599 CD8406          17      CALL    PR_DATE_SPLITER
00049C 059C 18F2            12      JR  PRTTMS1
       059E                     PRTTMS2:
                                
00049E 059E CD740A          17      CALL    GET_WIDTH
0004A1 05A1 FE21             7      CP  32+1
0004A3 05A3 3005            12      JR  NC,SHOW_TIME
0004A5 05A5 3E1D             7      LD  A,01DH
0004A7 05A7 C39508          10      JP  MSG_A
       05AA                     SHOW_TIME:
0004AA 05AA 2A210E          16      LD  HL,(DTA_CCP+1+22)
                                
0004AD 05AD 3E20             7      LD  A,020H
0004AF 05AF CD9508          17      CALL    MSG_A
0004B2 05B2 7C               4      LD  A,H
0004B3 05B3 65               4      LD  H,L
0004B4 05B4 1F               4      RRA
0004B5 05B5 CB1D             8      RR  L
0004B7 05B7 1F               4      RRA
0004B8 05B8 CB1D             8      RR  L
0004BA 05BA 1F               4      RRA
0004BB 05BB CB1D             8      RR  L
0004BD 05BD E61F             7      AND 01FH
0004BF 05BF 4F               4      LD  C,A
0004C0 05C0 3A680D          13      LD  A,(V_TIME)
0004C3 05C3 FE31             7      CP  '1'
0004C5 05C5 79               4      LD  A,C
0004C6 05C6 200B            12      JR  NZ,TIME24
0004C8 05C8 FE0C             7      CP  12
0004CA 05CA 3802            12      JR  C,TIME12
0004CC 05CC D60C             7      SUB 12
       05CE                     TIME12:
0004CE 05CE B7               4      OR  A
0004CF 05CF 2002            12      JR  NZ,TIME24
0004D1 05D1 C60C             7      ADD A,12
       05D3                     TIME24:
0004D3 05D3 C5              11      PUSH    BC
0004D4 05D4 CD0406          17      CALL    PRDEC_A
0004D7 05D7 3E3A             7      LD  A,':'
0004D9 05D9 CD9508          17      CALL    MSG_A
0004DC 05DC 7D               4      LD  A,L
0004DD 05DD 0F               4      RRCA
0004DE 05DE 0F               4      RRCA
0004DF 05DF E63F             7      AND 03FH
0004E1 05E1 CD0406          17      CALL    PRDEC_A
                                
0004E4 05E4 3E3A             7      LD  A,':'
0004E6 05E6 CD9508          17      CALL    MSG_A
0004E9 05E9 7C               4      LD  A,H
0004EA 05EA E61F             7      AND 01FH
0004EC 05EC 87               4      ADD A,A
0004ED 05ED CD0406          17      CALL    PRDEC_A
                                
0004F0 05F0 3A680D          13      LD  A,(V_TIME)
0004F3 05F3 FE31             7      CP  '1'
0004F5 05F5 C1              10      POP BC
0004F6 05F6 C0              11      RET NZ
0004F7 05F7 79               4      LD  A,C
0004F8 05F8 1E61             7      LD  E,'a'
0004FA 05FA FE0C             7      CP  12
0004FC 05FC DA8408          10      JP  C,_PRINT
0004FF 05FF 1E70             7      LD  E,'p'
000501 0601 C38408          10      JP  _PRINT
                                
                                ;   PRINT10
                                
       0604                     PRDEC_A:
000504 0604 E5              11      PUSH    HL
000505 0605 0608             7      LD  B,8
000507 0607 4F               4      LD  C,A
000508 0608 AF               4      XOR A
       0609                     PRTA1:
000509 0609 CB01             4      RLC C
00050B 060B 8F               4      ADC A,A
00050C 060C 27               4      DAA
00050D 060D 10FA            13      DJNZ    PRTA1
00050F 060F 213A0E          10      LD  HL,DECBF
000512 0612 77               7      LD  (HL),A
000513 0613 AF               4      XOR A
000514 0614 CD3805          17      CALL    DECX
000517 0617 E1              10      POP HL
000518 0618 C9              10      RET
                                
       0619                     PR_DATE:
000519 0619 DD7E00          19      LD  A,(IX+0)
00051C 061C FE20             7      CP  020H
00051E 061E D8              11      RET C
00051F 061F CDC609          17      CALL    CAP
000522 0622 FE44             7      CP  'D'
000524 0624 2848            12      JR  Z,PR_DAY
000526 0626 FE4D             7      CP  'M'
000528 0628 2820            12      JR  Z,PR_MONTH
00052A 062A FE59             7      CP  'Y'
00052C 062C 2046            12      JR  NZ,PR_DATE1
00052E 062E 4F               4      LD  C,A
00052F 062F DD7E02          19      LD  A,(IX+2)
000532 0632 CDC609          17      CALL    CAP
000535 0635 B9               4      CP  C
000536 0636 200A            12      JR  NZ,YEAR2
000538 0638 7C               4      LD  A,H     ;YEAR
000539 0639 C6EC             7      ADD A,80+256-100
00053B 063B 3E13             7      LD  A,19
00053D 063D CE00             7      ADC A,0
00053F 063F CD0406          17      CALL    PRDEC_A     ;年4桁
       0642                     YEAR2:
000542 0642 7C               4      LD  A,H     ;YEAR
000543 0643 C650             7      ADD A,80
000545 0645 CD0406          17      CALL    PRDEC_A
000548 0648 182A            12      JR  PR_DATE1
       064A                     PR_MONTH:
00054A 064A 4F               4      LD  C,A
00054B 064B DD7E02          19      LD  A,(IX+2)
00054E 064E CDC609          17      CALL    CAP
000551 0651 B9               4      CP  C
000552 0652 2014            12      JR  NZ,MONTH2
000554 0654 E5              11      PUSH    HL      ;月を文字列で表示 Jan等
000555 0655 D5              11      PUSH    DE
000556 0656 7A               4      LD  A,D
000557 0657 3D               4      DEC A
000558 0658 87               4      ADD A,A
000559 0659 87               4      ADD A,A
00055A 065A 21920C          10      LD  HL,S_MONTH
00055D 065D 1600             7      LD  D,0
00055F 065F 5F               4      LD  E,A
000560 0660 19              11      ADD HL,DE
000561 0661 CD6C04          17      CALL    MSX
000564 0664 D1              10      POP DE
000565 0665 E1              10      POP HL
000566 0666 180C            12      JR  PR_DATE1
       0668                     MONTH2:
000568 0668 7A               4      LD  A,D     ;月を数字で表示
000569 0669 CD0406          17      CALL    PRDEC_A
00056C 066C 1806            12      JR  PR_DATE1
       066E                     PR_DAY:
00056E 066E 7D               4      LD  A,L
00056F 066F E61F             7      AND 01FH
000571 0671 CD0406          17      CALL    PRDEC_A
       0674                     PR_DATE1:
000574 0674 DD23            10      INC IX
000576 0676 DD7E00          19      LD  A,(IX+0)
000579 0679 CDC609          17      CALL    CAP
00057C 067C FE41             7      CP  'A'
00057E 067E D8              11      RET C
00057F 067F FE5B             7      CP  'Z'+1
000581 0681 38F1            12      JR  C,PR_DATE1
000583 0683 C9              10      RET
       0684                     PR_DATE_SPLITER:
000584 0684 DD7E00          19      LD  A,(IX+0)
000587 0687 FE20             7      CP  020H
000589 0689 D8              11      RET C
00058A 068A DD23            10      INC IX
00058C 068C C39508          10      JP  MSG_A
                                
       068F                     SETFCB:
00058F 068F CDB309          17      CALL    SPCUT
000592 0692 1A               7      LD  A,(DE)
000593 0693 FE20             7      CP  020H
000595 0695 3801            12      JR  C,SETFCBA
000597 0697 1B               6      DEC DE
       0698                     SETFCBA:
000598 0698 D5              11      PUSH    DE
000599 0699 215C00          10      LD  HL,FCB1
00059C 069C 115D00          10      LD  DE,FCB1+1
00059F 069F 012300          10      LD  BC,00023H
0005A2 06A2 70               7      LD  (HL),B      ;B=0
0005A3 06A3 EDB0                    LDIR
0005A5 06A5 D1              10      POP DE
0005A6 06A6 D5              11      PUSH    DE
0005A7 06A7 215C00          10      LD  HL,FCB1
0005AA 06AA CD570A          17      CALL    _SYS29      ;ファイル名の解析
0005AD 06AD 216C00          10      LD  HL,FCB2
0005B0 06B0 CD570A          17      CALL    _SYS29      ;ファイル名の解析
0005B3 06B3 E1              10      POP HL
0005B4 06B4 010050          10      LD  BC,05000H
0005B7 06B7 118100          10      LD  DE,00081H
       06BA                     SETFCB1:
0005BA 06BA 7E               7      LD  A,(HL)
0005BB 06BB 23               6      INC HL
0005BC 06BC FE20             7      CP  020H
0005BE 06BE 3805            12      JR  C,SETFCB2
0005C0 06C0 12               7      LD  (DE),A
0005C1 06C1 13               6      INC DE
0005C2 06C2 0C               4      INC C
0005C3 06C3 10F5            13      DJNZ    SETFCB1
       06C5                     SETFCB2:
0005C5 06C5 79               4      LD  A,C
0005C6 06C6 328000          13      LD  (DTA1),A
0005C9 06C9 04               4      INC B
0005CA 06CA AF               4      XOR A
       06CB                     SETFCB3:
0005CB 06CB 12               7      LD  (DE),A
0005CC 06CC 13               6      INC DE
0005CD 06CD 10FC            13      DJNZ    SETFCB3
0005CF 06CF C9              10      RET
                                
       06D0                     C_COPY:
0005D0 06D0 CD8F06          17      CALL    SETFCB
                                
0005D3 06D3 11660E          10      LD  DE,ZERO
0005D6 06D6 CDCE08          17      CALL    FILEC2
0005D9 06D9 216C00          10      LD  HL,FCB2
0005DC 06DC CD5E0A          17      CALL    S29X1
                                
0005DF 06DF 3E10             7      LD  A,010H
0005E1 06E1 326900          13      LD  (FCB1+13),A
0005E4 06E4 216D00          10      LD  HL,FCB2+1
0005E7 06E7 CD6908          17      CALL    CWILD1
       06EA                     COPY0:
0005EA 06EA CD6608          17      CALL    CWILD
0005ED 06ED 215C00          10      LD  HL,FCB1
0005F0 06F0 CD4902          17      CALL    OPEN
0005F3 06F3 37               4      SCF
       06F4                     COPY1:
0005F4 06F4 C0              11      RET NZ
0005F5 06F5 CD6F02          17      CALL    DEFCB
                                
0005F8 06F8 3A170E          13      LD  A,(DTA_CCP+13)
0005FB 06FB CB67             8      BIT 4,A
0005FD 06FD 281E            12      JR  Z,COPY1A
                                
0005FF 06FF 215D00          10      LD  HL,FCB1+1
000602 0702 CDFF09          17      CALL    CHKWILD
000605 0705 3811            12      JR  C,COPY9
                                
000607 0707 3E20             7      LD  A,020H
000609 0709 325D00          13      LD  (FCB1+1),A
00060C 070C 2A240E          16      LD  HL,(DTA_CCP+26)
00060F 070F 23               6      INC HL
000610 0710 226A00          16      LD  (FCB1+14),HL
000613 0713 18D5            12      JR  COPY0
                                
       0715                     COPY8:
000615 0715 CD0A0B          17      CALL    SHOW_OK
       0718                     COPY9:
000618 0718 CD6B02          17      CALL    OPEN2
00061B 071B 18D7            12      JR  COPY1
                                
       071D                     COPY1A:
00061D 071D 216C00          10      LD  HL,FCB2
000620 0720 11400E          10      LD  DE,FDRV
000623 0723 010C0E          10      LD  BC,DTA_CCP+2
000626 0726 EDA0            16      LDI
000628 0728 3E0B             7      LD  A,11
       072A                     COPY2:
00062A 072A F5              11      PUSH    AF
00062B 072B 7E               7      LD  A,(HL)
00062C 072C FE3F             7      CP  '?'
00062E 072E 2001            12      JR  NZ,COPY3
000630 0730 0A               7      LD  A,(BC)
       0731                     COPY3:
000631 0731 12               7      LD  (DE),A
000632 0732 03               6      INC BC
000633 0733 13               6      INC DE
000634 0734 23               6      INC HL
000635 0735 F1              10      POP AF
000636 0736 3D               4      DEC A
000637 0737 20F1            12      JR  NZ,COPY2
000639 0739 010500          10      LD  BC,16-11
00063C 073C EDB0                    LDIR
       073E                     PUTNAME:
00063E 073E 215D00          10      LD  HL,FCB1+1
000641 0741 CDFF09          17      CALL    CHKWILD
000644 0744 300B            12      JR  NC,PUTN1
000646 0746 21410E          10      LD  HL,FDRV+1
000649 0749 CD5605          17      CALL    FPRNT
00064C 074C 3E20             7      LD  A,020H
00064E 074E CD9508          17      CALL    MSG_A
       0751                     PUTN1:
000651 0751 11400E          10      LD  DE,FDRV
000654 0754 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000656 0756 CD9B02          17      CALL    SYSTEM0
000659 0759 C2F407          10      JP  NZ,COPYE2
00065C 075C 67               4      LD  H,A     ;A=0
00065D 075D 6F               4      LD  L,A
00065E 075E 22610E          16      LD  (FDRV+33),HL    ;(FCB)ランダム・レコード
000661 0761 22630E          16      LD  (FDRV+35),HL
000664 0764 2C               4      INC L       ;HL=1
000665 0765 224E0E          16      LD  (FDRV+14),HL    ;(FCB)レコード・サイズ
       0768                     COPY6:
000668 0768 CD7808          17      CALL    BUFSIZ
00066B 076B CDBB02          17      CALL    S27DTA
00066E 076E 3C               4      INC A
00066F 076F 287B            12      JR  Z,COPYE
000671 0771 47               4      LD  B,A
000672 0772 7C               4      LD  A,H
000673 0773 B5               4      OR  L
000674 0774 280F            12      JR  Z,COPY7
000676 0776 11400E          10      LD  DE,FDRV
000679 0779 C5              11      PUSH    BC
00067A 077A 0E26             7      LD  C,026H      ;(BDOS)ランダム・ブロック・ライト
00067C 077C CD0500          17      CALL    SYSTEM
00067F 077F C1              10      POP BC
000680 0780 B7               4      OR  A
000681 0781 2069            12      JR  NZ,COPYE
000683 0783 10E3            13      DJNZ    COPY6
       0785                     COPY7:
000685 0785 3A6D0D          13      LD  A,(MAJOR_VER)
000688 0788 FE02             7      CP  2
00068A 078A 3011            12      JR  NC,COPY7_MSX2   ;DOS2はFCBの仕様が違う
00068C 078C 3A170E          13      LD  A,(DTA_CCP+13)  ;(FCB)属性(アトリビュート)
00068F 078F 324D0E          13      LD  (FDRV+13),A ;(FCB)属性(アトリビュート)
000692 0792 211E0E          10      LD  HL,DTA_CCP+20
000695 0795 11540E          10      LD  DE,FDRV+20  ;(FCB)更新日時
000698 0798 010400          10      LD  BC,4
00069B 079B EDB0                    LDIR
       079D                     COPY7_MSX2:
00069D 079D 11400E          10      LD  DE,FDRV
0006A0 07A0 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0006A2 07A2 CD9B02          17      CALL    SYSTEM0
                                
0006A5 07A5 2045            12      JR  NZ,COPYE
0006A7 07A7 3A6D0D          13      LD  A,(MAJOR_VER)
0006AA 07AA FE02             7      CP  2
0006AC 07AC 383B            12      JR  C,COPY_DOS2DT
                                
0006AE 07AE 110A0E          10      LD  DE,DTA_CCP
0006B1 07B1 21EE0D          10      LD  HL,DOS2NAME
0006B4 07B4 CDF607          17      CALL    FCB2FNAME
                                
0006B7 07B7 11400E          10      LD  DE,FDRV
0006BA 07BA 21FC0D          10      LD  HL,DOS2NAME2
0006BD 07BD CDF607          17      CALL    FCB2FNAME
                                
0006C0 07C0 11EE0D          10      LD  DE,DOS2NAME
0006C3 07C3 AF               4      XOR A
0006C4 07C4 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
0006C6 07C6 CD9B02          17      CALL    SYSTEM0
                                
0006C9 07C9 11FC0D          10      LD  DE,DOS2NAME2
0006CC 07CC 3E01             7      LD  A,1
0006CE 07CE 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
0006D0 07D0 CD9B02          17      CALL    SYSTEM0
                                
0006D3 07D3 11EE0D          10      LD  DE,DOS2NAME
0006D6 07D6 AF               4      XOR A
0006D7 07D7 0E51             7      LD  C,51H       ;(BDOS)_FTIME ファイルの日付および時刻の獲得・設定
0006D9 07D9 CD9B02          17      CALL    SYSTEM0
                                
0006DC 07DC D5              11      PUSH    DE
0006DD 07DD DDE1            14      POP IX
                                
0006DF 07DF 11FC0D          10      LD  DE,DOS2NAME2
0006E2 07E2 3E01             7      LD  A,1
0006E4 07E4 0E51             7      LD  C,51H       ;(BDOS)_FTIME ファイルの日付および時刻の獲得・設定
0006E6 07E6 CD9B02          17      CALL    SYSTEM0
       07E9                     COPY_DOS2DT:
0006E9 07E9 C31507          10      JP  COPY8
                                
       07EC                     COPYE:
0006EC 07EC 11400E          10      LD  DE,FDRV
0006EF 07EF 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0006F1 07F1 CD0500          17      CALL    SYSTEM
       07F4                     COPYE2:
0006F4 07F4 37               4      SCF
0006F5 07F5 C9              10      RET
                                
       07F6                     FCB2FNAME:
0006F6 07F6 1A               7      LD  A,(DE)
0006F7 07F7 13               6      INC DE
0006F8 07F8 C640             7      ADD A,'@'
0006FA 07FA 77               7      LD  (HL),A
0006FB 07FB 23               6      INC HL
0006FC 07FC 363A            10      LD  (HL),':'
0006FE 07FE 23               6      INC HL
                                
0006FF 07FF 0608             7      LD  B,8
       0801                     FCB2FNAME1:
000701 0801 1A               7      LD  A,(DE)
000702 0802 FE21             7      CP  020H+1
000704 0804 3807            12      JR  C,FCB2FNAME2
000706 0806 13               6      INC DE
000707 0807 77               7      LD  (HL),A
000708 0808 23               6      INC HL
000709 0809 10F6            13      DJNZ    FCB2FNAME1
00070B 080B 1803            12      JR  FCB2FNAME3
       080D                     FCB2FNAME2:
00070D 080D 13               6      INC DE
00070E 080E 10FD            13      DJNZ    FCB2FNAME2
       0810                     FCB2FNAME3:
000710 0810 1A               7      LD  A,(DE)
000711 0811 FE21             7      CP  020H+1
000713 0813 380F            12      JR  C,FCB2FNAME5
000715 0815 362E            10      LD  (HL),'.'
000717 0817 23               6      INC HL
000718 0818 0603             7      LD  B,3
       081A                     FCB2FNAME4:
00071A 081A 1A               7      LD  A,(DE)
00071B 081B 13               6      INC DE
00071C 081C FE21             7      CP  020H+1
00071E 081E 3804            12      JR  C,FCB2FNAME5
000720 0820 77               7      LD  (HL),A
000721 0821 23               6      INC HL
000722 0822 10F6            13      DJNZ    FCB2FNAME4
       0824                     FCB2FNAME5:
000724 0824 3600            10      LD  (HL),0
000726 0826 C9              10      RET
                                
       0827                     C_TYPE:
000727 0827 CD8F06          17      CALL    SETFCB
00072A 082A 215C00          10      LD  HL,FCB1
00072D 082D CD4902          17      CALL    OPEN
000730 0830 37               4      SCF
       0831                     TYPE1:
000731 0831 C0              11      RET NZ
000732 0832 CD6F02          17      CALL    DEFCB
000735 0835 3E1A             7      LD  A,01AH
000737 0837 CD9508          17      CALL    MSG_A
       083A                     TYPE2:
00073A 083A CD7808          17      CALL    BUFSIZ
00073D 083D CDBB02          17      CALL    S27DTA
000740 0840 C6FE             7      ADD A,0FEH
000742 0842 D8              11      RET C
000743 0843 7C               4      LD  A,H
000744 0844 B5               4      OR  L
000745 0845 281A            12      JR  Z,TYPEE
000747 0847 010080          10      LD  BC,DATA
       084A                     TYPE3:
00074A 084A 0A               7      LD  A,(BC)
00074B 084B 03               6      INC BC
00074C 084C FE1A             7      CP  01AH
00074E 084E 2811            12      JR  Z,TYPEE
000750 0850 5F               4      LD  E,A
000751 0851 C5              11      PUSH    BC
000752 0852 E5              11      PUSH    HL
000753 0853 0E02             7      LD  C,2     ;(BDOS)コンソール出力
000755 0855 CD0500          17      CALL    SYSTEM
000758 0858 E1              10      POP HL
000759 0859 C1              10      POP BC
00075A 085A 2B               6      DEC HL
00075B 085B 7C               4      LD  A,H
00075C 085C B5               4      OR  L
00075D 085D 20EB            12      JR  NZ,TYPE3
00075F 085F 18D9            12      JR  TYPE2
       0861                     TYPEE:
000761 0861 CD6B02          17      CALL    OPEN2
000764 0864 18CB            12      JR  TYPE1
                                
       0866                     CWILD:
000766 0866 215D00          10      LD  HL,FCB1+1
       0869                     CWILD1:
000769 0869 7E               7      LD  A,(HL)
00076A 086A FE20             7      CP  020H
00076C 086C C0              11      RET NZ
       086D                     CWILD2:
00076D 086D 54               4      LD  D,H
00076E 086E 5D               4      LD  E,L
00076F 086F 13               6      INC DE
000770 0870 010A00          10      LD  BC,10
000773 0873 363F            10      LD  (HL),'?'
000775 0875 EDB0                    LDIR
000777 0877 C9              10      RET
                                
       0878                     BUFSIZ:
000778 0878 3A0700          13      LD  A,(SYSTEM+2)
00077B 087B D681             7      SUB (DATA/256)+1
00077D 087D E6F8             7      AND 0F8H
00077F 087F 67               4      LD  H,A
000780 0880 2E00             7      LD  L,0
000782 0882 C9              10      RET
                                
000783 0883 E9               4  JP_HL:  JP  (HL)
                                
       0884                     _PRINT:
000784 0884 C5              11      PUSH    BC
000785 0885 D5              11      PUSH    DE
000786 0886 E5              11      PUSH    HL
000787 0887 DDE5            15      PUSH    IX
000789 0889 0E06             7      LD  C,6
00078B 088B CD0500          17      CALL    SYSTEM
00078E 088E DDE1            14      POP IX
000790 0890 E1              10      POP HL
000791 0891 D1              10      POP DE
000792 0892 C1              10      POP BC
000793 0893 B7               4      OR  A
000794 0894 C9              10      RET
                                
       0895                     MSG_A:
000795 0895 F5              11      PUSH    AF
000796 0896 C5              11      PUSH    BC
000797 0897 D5              11      PUSH    DE
000798 0898 E5              11      PUSH    HL
000799 0899 DDE5            15      PUSH    IX
00079B 089B 5F               4      LD  E,A
00079C 089C 0E02             7      LD  C,2
00079E 089E CD0500          17      CALL    SYSTEM
0007A1 08A1 DDE1            14      POP IX
0007A3 08A3 E1              10      POP HL
0007A4 08A4 D1              10      POP DE
0007A5 08A5 C1              10      POP BC
0007A6 08A6 F1              10      POP AF
0007A7 08A7 C9              10      RET
                                ;       FILE
       08A8                     FILEC_D2:       ;DOS2対応
0007A8 08A8 3A6D0D          13      LD  A,(MAJOR_VER)
0007AB 08AB FE02             7      CP  2
0007AD 08AD 381C            12      JR  C,FILEC
0007AF 08AF C5              11      PUSH    BC
0007B0 08B0 D5              11      PUSH    DE
0007B1 08B1 E5              11      PUSH    HL
0007B2 08B2 CDB309          17      CALL    SPCUT
0007B5 08B5 21AE0D          10      LD  HL,PATH_CCP
0007B8 08B8 0640             7      LD  B,64
       08BA                     PATHCD1:
0007BA 08BA 1A               7      LD  A,(DE)
0007BB 08BB 13               6      INC DE
0007BC 08BC FE20             7      CP  020H
0007BE 08BE 3002            12      JR  NC,PATHCD2
0007C0 08C0 3E00             7      LD  A,0
       08C2                     PATHCD2:
0007C2 08C2 77               7      LD  (HL),A
0007C3 08C3 3803            12      JR  C,PATHCD3
0007C5 08C5 23               6      INC HL
0007C6 08C6 10F2            13      DJNZ    PATHCD1
       08C8                     PATHCD3:
0007C8 08C8 E1              10      POP HL
0007C9 08C9 D1              10      POP DE
0007CA 08CA C1              10      POP BC
       08CB                     FILEC:
0007CB 08CB CDD608          17      CALL    FILE
       08CE                     FILEC2:
0007CE 08CE 3A410E          13      LD  A,(FDRV+1)
0007D1 08D1 FE20             7      CP  020H
0007D3 08D3 C8              11      RET Z
0007D4 08D4 1839            12      JR  SETDIR1
                                
       08D6                     FILE:
0007D6 08D6 AF               4      XOR A
0007D7 08D7 32400E          13      LD  (FDRV),A
0007DA 08DA 67               4      LD  H,A
0007DB 08DB 6F               4      LD  L,A
0007DC 08DC 224E0E          16      LD  (FDRV+14),HL
0007DF 08DF CDB309          17      CALL    SPCUT
0007E2 08E2 CD9809          17      CALL    CCHK3
0007E5 08E5 2812            12      JR  Z,DEVI1
0007E7 08E7 13               6      INC DE
0007E8 08E8 1A               7      LD  A,(DE)
0007E9 08E9 1B               6      DEC DE
0007EA 08EA FE3A             7      CP  ':'
0007EC 08EC 200B            12      JR  NZ,DEVI1
0007EE 08EE 1A               7      LD  A,(DE)      ;DRIVE
0007EF 08EF CDC609          17      CALL    CAP
0007F2 08F2 D640             7      SUB '@'
0007F4 08F4 13               6      INC DE
0007F5 08F5 13               6      INC DE
0007F6 08F6 32400E          13      LD  (FDRV),A
       08F9                     DEVI1:
0007F9 08F9 1A               7      LD  A,(DE)
0007FA 08FA D65C             7      SUB 05CH        ;\
0007FC 08FC 2009            12      JR  NZ,NOROOT
0007FE 08FE 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
0007FF 08FF 225A0E          16      LD  (FDRV+26),HL
000802 0902 2C               4      INC L
000803 0903 224E0E          16      LD  (FDRV+14),HL
000806 0906 13               6      INC DE
       0907                     NOROOT:
                                
       0907                     SETDIR:
000807 0907 CD3809          17      CALL    FILED
00080A 090A 1A               7      LD  A,(DE)
00080B 090B FE5C             7      CP  05CH        ;\
00080D 090D C0              11      RET NZ
00080E 090E 13               6      INC DE
       090F                     SETDIR1:
00080F 090F 3A6D0D          13      LD  A,(MAJOR_VER)
000812 0912 FE01             7      CP  1
000814 0914 C0              11      RET NZ
                                                ;for LSX-Dodgers
000815 0915 3E10             7      LD  A,010H      ;Directory
000817 0917 324D0E          13      LD  (FDRV+13),A
00081A 091A D5              11      PUSH    DE
00081B 091B 11400E          10      LD  DE,FDRV
00081E 091E 0E0F             7      LD  C,00FH
000820 0920 CD0500          17      CALL    SYSTEM
000823 0923 D1              10      POP DE
000824 0924 B7               4      OR  A
000825 0925 C0              11      RET NZ
                                
000826 0926 3A4D0E          13      LD  A,(FDRV+13)
000829 0929 CB67             8      BIT 4,A
00082B 092B C8              11      RET Z
                                
00082C 092C CD7F09          17      CALL    FILEI
00082F 092F 2A5A0E          16      LD  HL,(FDRV+26)
000832 0932 23               6      INC HL
000833 0933 224E0E          16      LD  (FDRV+14),HL
000836 0936 18CF            12      JR  SETDIR
                                
       0938                     FILED:
000838 0938 CD7F09          17      CALL    FILEI
                                
00083B 093B 0608             7      LD  B,8
       093D                     FILE2:
00083D 093D CD8D09          17      CALL    CCHKF
000840 0940 C8              11      RET Z
000841 0941 FE2A             7      CP  '*'
000843 0943 282E            12      JR  Z,FILE9
000845 0945 FE2E             7      CP  '.'
000847 0947 280C            12      JR  Z,FILE4
000849 0949 77               7      LD  (HL),A
00084A 094A 23               6      INC HL
00084B 094B 10F0            13      DJNZ    FILE2
                                
       094D                     FILE3:
00084D 094D CD8D09          17      CALL    CCHKF
000850 0950 C8              11      RET Z
000851 0951 FE2E             7      CP  '.'
000853 0953 20F8            12      JR  NZ,FILE3
                                
       0955                     FILE4:
000855 0955 21490E          10      LD  HL,FNAME+8
000858 0958 0603             7      LD  B,3
                                
       095A                     FILE4L:
00085A 095A CD8D09          17      CALL    CCHKF
00085D 095D C8              11      RET Z
00085E 095E FE2E             7      CP  '.'
000860 0960 2008            12      JR  NZ,FILE12
000862 0962 32410E          13      LD  (FNAME),A   ;Parent directory(..)
000865 0965 32420E          13      LD  (FNAME+1),A
000868 0968 3E20             7      LD  A,020H
       096A                     FILE12:
00086A 096A FE2A             7      CP  '*'
00086C 096C 280A            12      JR  Z,FILE10
00086E 096E 77               7      LD  (HL),A
00086F 096F 23               6      INC HL
000870 0970 10E8            13      DJNZ    FILE4L
000872 0972 C9              10      RET
                                
       0973                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000873 0973 CD7809          17      CALL    FILE10
000876 0976 18D5            12      JR  FILE3
                                
       0978                     FILE10:
000878 0978 3E3F             7      LD  A,'?'
                                
       097A                     FILL_MEMORY:                ;HLからBバイトAで埋める
00087A 097A 77               7      LD  (HL),A
00087B 097B 23               6      INC HL
00087C 097C 10FC            13      DJNZ    FILL_MEMORY
00087E 097E C9              10      RET
                                
       097F                     FILEI:              ;名前＋拡張子をスペースで初期化
00087F 097F 3E20             7      LD  A,020H
000881 0981 01000B          10      LD  BC,11*256
000884 0984 21410E          10      LD  HL,FNAME
000887 0987 E5              11      PUSH    HL
000888 0988 CD7A09          17      CALL    FILL_MEMORY
00088B 098B E1              10      POP HL
00088C 098C C9              10      RET
                                
       098D                     CCHKF:
00088D 098D 1A               7      LD  A,(DE)
00088E 098E CD9509          17      CALL    CCHK2
000891 0991 C8              11      RET Z
000892 0992 C3E809          10      JP  FKAN
                                
       0995                     CCHK2:
000895 0995 0C               4      INC C
000896 0996 0D               4      DEC C
000897 0997 C0              11      RET NZ
       0998                     CCHK3:              ;ZF=1 で使えない文字
000898 0998 FE2B             7      CP  '+'
00089A 099A C8              11      RET Z
00089B 099B FE2C             7      CP  ','
00089D 099D C8              11      RET Z
00089E 099E FE2F             7      CP  '/'
0008A0 09A0 C8              11      RET Z
0008A1 09A1 FE3A             7      CP  ':'
0008A3 09A3 C8              11      RET Z
0008A4 09A4 FE3B             7      CP  ';'
0008A6 09A6 C8              11      RET Z
0008A7 09A7 FE3D             7      CP  '='
0008A9 09A9 C8              11      RET Z
0008AA 09AA FE5C             7      CP  05CH    ;\
0008AC 09AC C8              11      RET Z
0008AD 09AD FE20             7      CP  020H
0008AF 09AF D0              11      RET NC
0008B0 09B0 BF               4      CP  A       ;Z=1
0008B1 09B1 C9              10      RET
                                
       09B2                     SS1:
0008B2 09B2 13               6      INC DE
       09B3                     SPCUT:              ;スペースをカット
0008B3 09B3 1A               7      LD  A,(DE)
0008B4 09B4 FE20             7      CP  020H
0008B6 09B6 28FA            12      JR  Z,SS1
0008B8 09B8 C9              10      RET
                                
       09B9                     TOZERO:
0008B9 09B9 D5              11      PUSH    DE
       09BA                     TZ1:
0008BA 09BA 1A               7      LD  A,(DE)
0008BB 09BB FE20             7      CP  20H
0008BD 09BD 3803            12      JR  C,TZ2
0008BF 09BF 13               6      INC DE
0008C0 09C0 18F8            12      JR  TZ1
       09C2                     TZ2:
0008C2 09C2 AF               4      XOR A
0008C3 09C3 12               7      LD  (DE),A
0008C4 09C4 D1              10      POP DE
0008C5 09C5 C9              10      RET
                                
       09C6                     CAP:
0008C6 09C6 FE61             7      CP  'a'
0008C8 09C8 D8              11      RET C
0008C9 09C9 FE7B             7      CP  'z'+1
0008CB 09CB D0              11      RET NC
0008CC 09CC D620             7      SUB 020H
0008CE 09CE C9              10      RET
       09CF                     CAP2:
0008CF 09CF CDC609          17      CALL    CAP
       09D2                     CAP3:
0008D2 09D2 CDDB09          17      CALL    CAP4
0008D5 09D5 FE21             7      CP  021H
0008D7 09D7 D0              11      RET NC
0008D8 09D8 3E20             7      LD  A,020H
0008DA 09DA C9              10      RET
       09DB                     CAP4:
0008DB 09DB FE05             7      CP  5
0008DD 09DD C0              11      RET NZ
0008DE 09DE 3EE5             7      LD  A,0E5H
0008E0 09E0 C9              10      RET
                                
       09E1                     FKANC:
0008E1 09E1 CB41             8      BIT 0,C
0008E3 09E3 CCCF09          17      CALL    Z,CAP2
0008E6 09E6 1801            12      JR  FKANX
       09E8                     FKAN:           ;漢字チェック
0008E8 09E8 13               6      INC DE
       09E9                     FKANX:
0008E9 09E9 CB41             8      BIT 0,C
0008EB 09EB CB81             8      RES 0,C
0008ED 09ED C0              11      RET NZ
0008EE 09EE FE80             7      CP  080H
0008F0 09F0 D8              11      RET C
0008F1 09F1 FEA0             7      CP  0A0H
0008F3 09F3 3803            12      JR  C,FKAN1
0008F5 09F5 FEE0             7      CP  0E0H
0008F7 09F7 D8              11      RET C
       09F8                     FKAN1:
0008F8 09F8 0C               4      INC C
0008F9 09F9 A7               4      AND A
0008FA 09FA C9              10      RET
                                
       09FB                     CHKWILDX:
0008FB 09FB FDE5            15      PUSH    IY
0008FD 09FD E1              10      POP HL
0008FE 09FE 23               6      INC HL
       09FF                     CHKWILD:
0008FF 09FF 060B             7      LD  B,11
000901 0A01 3E3F             7      LD  A,'?'
       0A03                     CHKWIL1:
000903 0A03 BE               7      CP  (HL)
000904 0A04 23               6      INC HL
000905 0A05 37               4      SCF
000906 0A06 C8              11      RET Z
000907 0A07 10FA            13      DJNZ    CHKWIL1
000909 0A09 AF               4      XOR A
00090A 0A0A C9              10      RET
                                
       0A0B                     CPNAME:
00090B 0A0B C5              11      PUSH    BC
00090C 0A0C D5              11      PUSH    DE
00090D 0A0D 112F0E          10      LD  DE,CPBUF
000910 0A10 010500          10      LD  BC,5
000913 0A13 EDB0                    LDIR
000915 0A15 D1              10      POP DE
000916 0A16 D5              11      PUSH    DE
000917 0A17 E5              11      PUSH    HL
000918 0A18 212F0E          10      LD  HL,CPBUF
00091B 0A1B CD2E0A          17      CALL    CPFILE
00091E 0A1E E1              10      POP HL
00091F 0A1F D1              10      POP DE
000920 0A20 C1              10      POP BC
000921 0A21 2005            12      JR  NZ,CPNAME1
000923 0A23 7E               7      LD  A,(HL)
000924 0A24 23               6      INC HL
000925 0A25 66               7      LD  H,(HL)
000926 0A26 6F               4      LD  L,A
000927 0A27 C9              10      RET
       0A28                     CPNAME1:
000928 0A28 23               6      INC HL
000929 0A29 23               6      INC HL
00092A 0A2A 10DF            13      DJNZ    CPNAME
00092C 0A2C 37               4      SCF
00092D 0A2D C9              10      RET
                                
       0A2E                     CPFILE:
00092E 0A2E C5              11      PUSH    BC
00092F 0A2F 01000B          10      LD  BC,00B00H
       0A32                     CPSTR1:
000932 0A32 1A               7      LD  A,(DE)
000933 0A33 FE3F             7      CP  '?'     ;Wild card
000935 0A35 2812            12      JR  Z,CPSTR2
000937 0A37 7E               7      LD  A,(HL)
000938 0A38 CDE109          17      CALL    FKANC
00093B 0A3B E5              11      PUSH    HL
00093C 0A3C 67               4      LD  H,A
00093D 0A3D 1A               7      LD  A,(DE)
00093E 0A3E CB01             4      RLC C
000940 0A40 CDE109          17      CALL    FKANC
000943 0A43 CB09             4      RRC C
000945 0A45 BC               4      CP  H       ;CP (HL),(DE)
000946 0A46 E1              10      POP HL
000947 0A47 2004            12      JR  NZ,CPSTR3
       0A49                     CPSTR2:
000949 0A49 13               6      INC DE
00094A 0A4A 23               6      INC HL
00094B 0A4B 10E5            13      DJNZ    CPSTR1
       0A4D                     CPSTR3:
00094D 0A4D C1              10      POP BC
00094E 0A4E C9              10      RET
                                
       0A4F                     CPFILE2:
00094F 0A4F FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
000952 0A52 F6E1             7      OR  0E1H
000954 0A54 2F               4      CPL
000955 0A55 A6               7      AND (HL)
000956 0A56 C9              10      RET
                                
       0A57                     _SYS29:     ;(BDOS)ファイル名の解析
000957 0A57 C5              11      PUSH    BC
000958 0A58 E5              11      PUSH    HL
000959 0A59 CDD608          17      CALL    FILE
00095C 0A5C E1              10      POP HL
00095D 0A5D C1              10      POP BC
       0A5E                     S29X1:
00095E 0A5E C5              11      PUSH    BC
00095F 0A5F D5              11      PUSH    DE
000960 0A60 E5              11      PUSH    HL
000961 0A61 EB               4      EX  DE,HL
000962 0A62 21400E          10      LD  HL,FDRV
000965 0A65 010D00          10      LD  BC,13
000968 0A68 EDB0                    LDIR
00096A 0A6A 70               7      LD  (HL),B      ;B=0
00096B 0A6B 0E03             7      LD  C,3
00096D 0A6D EDB0                    LDIR
00096F 0A6F E1              10      POP HL
000970 0A70 D1              10      POP DE
000971 0A71 C1              10      POP BC
000972 0A72 AF               4      XOR A
000973 0A73 C9              10      RET
       0A74                     GET_WIDTH:
000974 0A74 3A6C0D          13      LD  A,(IS_MSX)
000977 0A77 B7               4      OR  A
000978 0A78 2804            12      JR  Z,NOT_MSX
00097A 0A7A 3AB0F3          13      LD  A,(LINLEN)
00097D 0A7D C9              10      RET
       0A7E                     NOT_MSX:
00097E 0A7E E5              11      PUSH    HL
00097F 0A7F 2A0100          16      LD  HL,(1)
000982 0A82 2EB1             7      LD  L,0B1H
000984 0A84 7E               7      LD  A,(HL)
000985 0A85 E1              10      POP HL
000986 0A86 C9              10      RET
                                
       0A87                     C_MODE:
000987 0A87 3A6C0D          13      LD  A,(IS_MSX)
00098A 0A8A B7               4      OR  A
00098B 0A8B C8              11      RET Z
00098C 0A8C 0E29             7      LD  C,41
00098E 0A8E 3AF8FA          13      LD  A,(EXBRSA)
000991 0A91 B7               4      OR  A
000992 0A92 2802            12      JR  Z,MODE_MSX1
000994 0A94 0E51             7      LD  C,81
       0A96                     MODE_MSX1:
000996 0A96 C5              11      PUSH    BC
000997 0A97 CDC30B          17      CALL    GETNUM
00099A 0A9A C1              10      POP BC
00099B 0A9B 7D               4      LD  A,L
00099C 0A9C B9               4      CP  C
00099D 0A9D 301C            12      JR  NC,MODE1
00099F 0A9F B7               4      OR  A
0009A0 0AA0 2819            12      JR  Z,MODE1
0009A2 0AA2 FE21             7      CP  33
0009A4 0AA4 381E            12      JR  C,MODE32
0009A6 0AA6 32AEF3          13      LD  (LINL40),A
0009A9 0AA9 DD216C00        14      LD  IX,INITXT
0009AD 0AAD CDB40A          17      CALL    CALLROM
0009B0 0AB0 DD217800        14      LD  IX,SETTXT
       0AB4                     CALLROM:
0009B4 0AB4 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
0009B8 0AB8 C31C00          10      JP  CALSLT
       0ABB                     MODE1:
0009BB 0ABB 3AB0F3          13      LD  A,(LINLEN)
0009BE 0ABE CD0406          17      CALL    PRDEC_A
0009C1 0AC1 C39A04          10      JP  LTNL
       0AC4                     MODE32:
0009C4 0AC4 32AFF3          13      LD  (LINL32),A
0009C7 0AC7 DD216F00        14      LD  IX,INIT32
0009CB 0ACB CDB40A          17      CALL    CALLROM
0009CE 0ACE DD217B00        14      LD  IX,SETT32
0009D2 0AD2 18E0            12      JR  CALLROM
                                
       0AD4                     C_PAUSE:
0009D4 0AD4 CDB309          17      CALL    SPCUT
0009D7 0AD7 EB               4      EX  DE,HL
0009D8 0AD8 7E               7      LD  A,(HL)
0009D9 0AD9 B7               4      OR  A
0009DA 0ADA 2003            12      JR  NZ,C_PAUSE1
0009DC 0ADC 21770C          10      LD  HL,PAUSE
       0ADF                     C_PAUSE1:
0009DF 0ADF CD6C04          17      CALL    MSX
0009E2 0AE2 0E07             7      LD  C,7     ;(BDOS)コンソール直接入力(_DIRIN)
0009E4 0AE4 CD0500          17      CALL    SYSTEM
0009E7 0AE7 FE03             7      CP  3
0009E9 0AE9 CA9203          10      JP  Z,END_BATCH
0009EC 0AEC C39A04          10      JP  LTNL
                                
       0AEF                     C_ECHO:
0009EF 0AEF CDB309          17      CALL    SPCUT
0009F2 0AF2 EB               4      EX  DE,HL
0009F3 0AF3 CD6C04          17      CALL    MSX
0009F6 0AF6 C39A04          10      JP  LTNL
                                
       0AF9                     C_MKDIR:
0009F9 0AF9 CDB309          17      CALL    SPCUT
0009FC 0AFC 014490          10      LD  BC,09044H   ;B=新規作成+ディレクトリ/C=(BDOS)ファイルハンドルの作成(_CREATE)
0009FF 0AFF CD0500          17      CALL    SYSTEM
000A02 0B02 C6FF             7      ADD A,0FFH
000A04 0B04 D8              11      RET C
000A05 0B05 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
000A07 0B07 CD0500          17      CALL    SYSTEM
       0B0A                     SHOW_OK:
000A0A 0B0A 116D0C          10      LD  DE,OK
000A0D 0B0D 0E09             7      LD  C,9     ;(BDOS)文字列出力
000A0F 0B0F CD0500          17      CALL    SYSTEM
000A12 0B12 C39A04          10      JP  LTNL
                                
       0B15                     C_RMDIR:
000A15 0B15 CDB309          17      CALL    SPCUT
000A18 0B18 AF               4      XOR A
000A19 0B19 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
000A1B 0B1B D5              11      PUSH    DE
000A1C 0B1C CD0500          17      CALL    SYSTEM
000A1F 0B1F D1              10      POP DE
000A20 0B20 C6FF             7      ADD A,0FFH
000A22 0B22 D8              11      RET C
000A23 0B23 CB65             8      BIT 4,L
000A25 0B25 C8              11      RET Z
000A26 0B26 0E4D             7      LD  C,04DH      ;(BDOS)ファイル・サブディレクトリの削除
000A28 0B28 CD0500          17      CALL    SYSTEM
000A2B 0B2B C6FF             7      ADD A,0FFH
000A2D 0B2D D8              11      RET C
000A2E 0B2E 18DA            12      JR  SHOW_OK
                                
       0B30                     C_SET:
000A30 0B30 CDB309          17      CALL    SPCUT
000A33 0B33 ED53460B        20      LD  (CSET_PARAM),DE
       0B37                     CSET2:
000A37 0B37 1A               7      LD  A,(DE)
000A38 0B38 FE20             7      CP  020H
000A3A 0B3A 3838            12      JR  C,CSET_LIST
000A3C 0B3C D63D             7      SUB '='
000A3E 0B3E 2803            12      JR  Z,CSET_SET
000A40 0B40 13               6      INC DE
000A41 0B41 18F4            12      JR  CSET2
       0B43                     CSET_SET:
000A43 0B43 12               7      LD  (DE),A
000A44 0B44 13               6      INC DE
       0B46                     CSET_PARAM  EQU $+1
000A45 0B45 210000          10      LD  HL,0
000A48 0B48 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000A4A 0B4A CD0500          17      CALL    SYSTEM
       0B4D                     INIT_VAR:           ;環境変数の初期化
000A4D 0B4D 214E0D          10      LD  HL,N_DATE
000A50 0B50 11530D          10      LD  DE,V_DATE
000A53 0B53 0610             7      LD  B,16
000A55 0B55 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000A57 0B57 CD0500          17      CALL    SYSTEM
                                
000A5A 0B5A 21630D          10      LD  HL,N_TIME
000A5D 0B5D 11680D          10      LD  DE,V_TIME
000A60 0B60 0603             7      LD  B,3
000A62 0B62 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000A64 0B64 CD0500          17      CALL    SYSTEM
                                
000A67 0B67 21C20C          10      LD  HL,N_APPEND
000A6A 0B6A 11C90C          10      LD  DE,V_APPEND
000A6D 0B6D 0640             7      LD  B,PATHX
000A6F 0B6F 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000A71 0B71 C30500          10      JP  SYSTEM
                                
       0B74                     CSET_LIST:
000A74 0B74 3E0A             7      LD  A,10
000A76 0B76 326B0E          13      LD  (CSET_DATA),A
000A79 0B79 110100          10      LD  DE,1
       0B7C                     CSET1:
000A7C 0B7C D5              11      PUSH    DE
000A7D 0B7D 016DFF          10      LD  BC,0FF6DH   ;_FENV 環境変数の検索
000A80 0B80 216C0E          10      LD  HL,DATA_COM
000A83 0B83 3600            10      LD  (HL),0
000A85 0B85 CD0500          17      CALL    SYSTEM
000A88 0B88 B7               4      OR  A
000A89 0B89 2030            12      JR  NZ,CSET_ERROR
000A8B 0B8B 216C0E          10      LD  HL,DATA_COM
000A8E 0B8E 7E               7      LD  A,(HL)
000A8F 0B8F B7               4      OR  A
000A90 0B90 2829            12      JR  Z,CSET_ERROR
000A92 0B92 CD6C04          17      CALL    MSX
000A95 0B95 1E3D             7      LD  E,'='
000A97 0B97 CD8408          17      CALL    _PRINT
000A9A 0B9A 216C0E          10      LD  HL,DATA_COM
000A9D 0B9D 116C0F          10      LD  DE,DATA_COM+256
000AA0 0BA0 016BFF          10      LD  BC,0FF6BH   ;_GENV 環境変数の獲得
000AA3 0BA3 CD0500          17      CALL    SYSTEM
000AA6 0BA6 216C0F          10      LD  HL,DATA_COM+256
000AA9 0BA9 CD6C04          17      CALL    MSX
000AAC 0BAC CD9A04          17      CALL    LTNL
000AAF 0BAF 3E0A             7      LD  A,10
000AB1 0BB1 326B0E          13      LD  (CSET_DATA),A
       0BB4                     CSET_NEXT:
000AB4 0BB4 D1              10      POP DE
000AB5 0BB5 13               6      INC DE
000AB6 0BB6 7A               4      LD  A,D
000AB7 0BB7 B3               4      OR  E
000AB8 0BB8 20C2            12      JR  NZ,CSET1
000ABA 0BBA C9              10      RET
       0BBB                     CSET_ERROR:
000ABB 0BBB 216B0E          10      LD  HL,CSET_DATA
000ABE 0BBE 35              11      DEC (HL)
000ABF 0BBF 20F3            12      JR  NZ,CSET_NEXT
       0BC1                     CSET_END:
000AC1 0BC1 D1              10      POP DE
000AC2 0BC2 C9              10      RET
                                
       0BC3                     GETNUM:
000AC3 0BC3 CDB309          17      CALL    SPCUT
000AC6 0BC6 210000          10      LD  HL,0
       0BC9                     GETNUM1:
000AC9 0BC9 1A               7      LD  A,(DE)
000ACA 0BCA 13               6      INC DE
000ACB 0BCB D630             7      SUB '0'
000ACD 0BCD D8              11      RET C
000ACE 0BCE FE0A             7      CP  10
000AD0 0BD0 D0              11      RET NC
000AD1 0BD1 4D               4      LD  C,L
000AD2 0BD2 44               4      LD  B,H
000AD3 0BD3 29              11      ADD HL,HL   ;*2
000AD4 0BD4 29              11      ADD HL,HL   ;*4
000AD5 0BD5 09              11      ADD HL,BC   ;*5
000AD6 0BD6 29              11      ADD HL,HL   ;*10
000AD7 0BD7 4F               4      LD  C,A
000AD8 0BD8 0600             7      LD  B,0
000ADA 0BDA 09              11      ADD HL,BC
000ADB 0BDB 18EC            12      JR  GETNUM1
                                
       0BDD                     CHDIR:
000ADD 0BDD 3A6D0D          13      LD  A,(MAJOR_VER)
000AE0 0BE0 FE02             7      CP  2
000AE2 0BE2 D8              11      RET C
000AE3 0BE3 C5              11      PUSH    BC
000AE4 0BE4 E5              11      PUSH    HL
000AE5 0BE5 0E5A             7      LD  C,05AH      ;(BDOS)_CHDIR カレントディレクトリの変更
000AE7 0BE7 CD0500          17      CALL    SYSTEM
000AEA 0BEA E1              10      POP HL
000AEB 0BEB C1              10      POP BC
000AEC 0BEC C9              10      RET
                                
       000F                     COMS    EQU 15
       0BED                     COMTB:
000AED 0BED 4420202020              DB  "D    " ;1
000AF2 0BF2 EA03                    DW  C_DIR
000AF4 0BF4 4449522020              DB  "DIR  " ;2
000AF9 0BF9 EA03                    DW  C_DIR
000AFB 0BFB 434F505920              DB  "COPY " ;3
000B00 0C00 D006                    DW  C_COPY
000B02 0C02 4344202020              DB  "CD   " ;4
000B07 0C07 A002                    DW  C_CD
000B09 0C09 44454C2020              DB  "DEL  " ;5
000B0E 0C0E B003                    DW  C_DEL
000B10 0C10 5041544820              DB  "PATH " ;6
000B15 0C15 A404                    DW  C_PATH
000B17 0C17 52454E2020              DB  "REN  " ;7
000B1C 0C1C BC03                    DW  C_REN
000B1E 0C1E 5459504520              DB  "TYPE " ;8
000B23 0C23 2708                    DW  C_TYPE
000B25 0C25 52454D2020              DB  "REM  " ;9
000B2A 0C2A AE03                    DW  C_REM
000B2C 0C2C 4D4F444520              DB  "MODE " ;10
000B31 0C31 870A                    DW  C_MODE
000B33 0C33 5041555345              DB  "PAUSE" ;11
000B38 0C38 D40A                    DW  C_PAUSE
000B3A 0C3A 5345542020              DB  "SET  " ;12
000B3F 0C3F 300B                    DW  C_SET
000B41 0C41 4543484F20              DB  "ECHO " ;13
000B46 0C46 EF0A                    DW  C_ECHO
000B48 0C48 4D4B444952              DB  "MKDIR" ;14
000B4D 0C4D F90A                    DW  C_MKDIR
000B4F 0C4F 524D444952              DB  "RMDIR" ;15
000B54 0C54 150B                    DW  C_RMDIR
                                
000B56 0C56 2062797465732066    FREE:   DB  " bytes free  $"
            726565202024        
000B64 0C64 2020203C4449523E    DIRMES: DB  "   <DIR>$"
            24                  
000B6D 0C6D 4F4B24              OK: DB  "OK$"
000B70 0C70 4572726F722124      COMERM: DB  "Error!$"
000B77 0C77 537472696B652061    PAUSE:  DB  "Strike any key when ready ",0
            6E79206B65792077    
            68656E2072656164    
            792000              
                                
       0C92                     S_MONTH:
000B92 0C92 4A616E00                DB  "Jan",0
000B96 0C96 46656200                DB  "Feb",0
000B9A 0C9A 4D617200                DB  "Mar",0
000B9E 0C9E 41707200                DB  "Apr",0
000BA2 0CA2 4D617900                DB  "May",0
000BA6 0CA6 4A756E00                DB  "Jun",0
000BAA 0CAA 4A756C00                DB  "Jul",0
000BAE 0CAE 41756700                DB  "Aug",0
000BB2 0CB2 53657000                DB  "Sep",0
000BB6 0CB6 4F637400                DB  "Oct",0
000BBA 0CBA 4E6F7600                DB  "Nov",0
000BBE 0CBE 44656300                DB  "Dec",0
                                
       0CC2                     N_APPEND:
000BC2 0CC2 415050454E4400          DB  "APPEND",0
       0CC9                     V_APPEND:
000BC9 0CC9                         DS  64
       0D09                     N_PATH:
000C09 0D09 5041544800              DB  "PATH",0
       0D0E                     V_PATH:
000C0E 0D0E                         DS  PATHX
       0D4E                     N_DATE:
000C4E 0D4E 4441544500              DB  "DATE",0
       0D53                     V_DATE:
000C53 0D53 79792D6D6D2D6464        DB  "yy-mm-dd"
000C5B 0D5B                         DS  8
       0D63                     N_TIME:
000C63 0D63 54494D4500              DB  "TIME",0
       0D68                     V_TIME:
000C68 0D68 323400                  DB  "24",0
       0D6B                     F_TIME:
000C6B 0D6B 00                      DB  0
                                
       0D6C                     IS_MSX:
000C6C 0D6C 00                      DB  0
       0D6D                     MAJOR_VER:
000C6D 0D6D 00                      DB  0
                                
       0D6E                     SEARCH_IX:; EQU $4000
000C6E 0D6E                         DS  64  ;DOS2用
                                
       0DAE                     PATH_CCP:;  EQU $5000
000CAE 0DAE                         DS  64  ;DOS2用
                                
       0DEE                     DOS2NAME:
000CEE 0DEE                         DS  2+8+3+1
       0DFC                     DOS2NAME2:
000CFC 0DFC                         DS  2+8+3+1
                                
       0E0A                     DTA_CCP:;       EQU $6000
000D0A 0E0A                         DS  37
       0E2F                     CPBUF:
000D2F 0E2F 0000                LEFTX:  DW  0
000D31 0E31 0000                DTAX:   DW  0
000D33 0E33 20                      DB  020H    ;CPBUFで使う
000D34 0E34 20                      DB  020H
000D35 0E35 20                      DB  020H
000D36 0E36 20                      DB  020H
000D37 0E37 20                      DB  020H
000D38 0E38 20                      DB  020H
000D39 0E39 20                      DB  020H
                                
       0E3A                     DECBF:
000D3A 0E3A                         DS  5
       0E3F                     FCB_BAT2:
000D3F 0E3F 00                      DB  0
       0E40                     FDRV:
000D40 0E40 00                      DB  0
       0E41                     FNAME:
000D41 0E41                         DS  37
       0E66                     ZERO:
000D66 0E66 00                      DB  0
       0E67                     FCB_BAT:
000D67 0E67 3F0E                    DW  FCB_BAT2
       0E69                     X_PATH:
000D69 0E69 0000                    DW  0
       0E6B                     CSET_DATA:
000D6B 0E6B 00                      DB  0
                                
       0E6C                     DATA_COM:
[EOF:COMMAND.ASM:SHIFT_JIS]
