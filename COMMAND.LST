                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                
                                ;   似非COMMAND.COM
                                
       0005                     SYSTEM  EQU 00005H
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
       000C                     RDSLT   EQU 0000CH
       001C                     CALSLT  EQU 0001CH
       006C                     INITXT  EQU 0006CH
       006F                     INIT32  EQU 0006FH
       0078                     SETTXT  EQU 00078H
       007B                     SETT32  EQU 0007BH
       0147                     FORMAT  EQU 00147H
                                
       F3AE                     LINL40  EQU 0F3AEH
       F3AF                     LINL32  EQU 0F3AFH
       F3B0                     LINLEN  EQU 0F3B0H
       F55E                     BUF EQU 0F55EH
       FAF8                     EXBRSA  EQU 0FAF8H
       FC9B                     INTFLG  EQU 0FC9BH
       FCC1                     EXPTBL  EQU 0FCC1H
                                
                                
       0040                     PATHX   EQU 64
                                
       8000                     DATA    EQU 08000H
                                
000000 0100                         ORG 0100H
000000 0100 C31501          10      JP  START
000003 0103 0D0A434F4D4D414E    VER:    DB  00DH,00AH,"COMMAND v0.13",00DH,00AH,'$'
            442076302E31330D    
            0A24                
       0115                     START:
000015 0115 ED7B0600        20      LD  SP,(SYSTEM+1)
000019 0119 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
00001B 011B CD0500          17      CALL    SYSTEM
00001E 011E D8              11      RET C
00001F 011F 211D01          10      LD  HL,0011DH
000022 0122 ED42            15      SBC HL,BC
000024 0124 78               4      LD  A,B
000025 0125 32E60F          13      LD  (MAJOR_VER),A
000028 0128 B5               4      OR  L
000029 0129 32E50F          13      LD  (IS_MSX),A
00002C 012C B7               4      OR  A
00002D 012D 2850            12      JR  Z,WSTART
                                
00002F 012F 3AE311          13      LD  A,(PROCESS)
000032 0132 0E61             7      LD  C,61H       ;(BDOS)親プロセスに戻る
000034 0134 47               4      LD  B,A
000035 0135 B7               4      OR  A
000036 0136 C40500          17      CALL    NZ,SYSTEM
000039 0139 AF               4      XOR A
00003A 013A 32E311          13      LD  (PROCESS),A
                                
00003D 013D 212B00          10      LD  HL,002BH    ;キャラクターセット・日時フォーマット・ビデオ信号の種別
000040 0140 CD0C00          17      CALL    RDSLT
000043 0143 0F               4      RRCA
000044 0144 0F               4      RRCA
000045 0145 0F               4      RRCA
000046 0146 0F               4      RRCA
000047 0147 E603             7      AND 3
000049 0149 2814            12      JR  Z,DATEOK
00004B 014B 3D               4      DEC A
00004C 014C 21C90F          10      LD  HL,V_DATE1
00004F 014F 2806            12      JR  Z,DATECHG
000051 0151 3D               4      DEC A
000052 0152 21D10F          10      LD  HL,V_DATE2
000055 0155 2008            12      JR  NZ,DATEOK
       0157                     DATECHG:
000057 0157 11B90F          10      LD  DE,V_DATE
00005A 015A 010800          10      LD  BC,8
00005D 015D EDB0                    LDIR
       015F                     DATEOK:
00005F 015F CDEB0C          17      CALL    INIT_VAR
                                
000062 0162 2A0600          16      LD  HL,(SYSTEM+1)
000065 0165 2EDB             7      LD  L,256-37
000067 0167 24               4      INC H
000068 0168 22DE11          16      LD  (FCB_BAT),HL
00006B 016B 3A8000          13      LD  A,(DTA1)
00006E 016E B7               4      OR  A
00006F 016F 280E            12      JR  Z,WSTART
000071 0171 110301          10      LD  DE,VER
000074 0174 0E09             7      LD  C,9
000076 0176 CD0500          17      CALL    SYSTEM
000079 0179 118100          10      LD  DE,DTA1+1
00007C 017C CDCC01          17      CALL    COMANL
       017F                     WSTART:
00007F 017F 21280F          10      LD  HL,N_APPEND
000082 0182 112F0F          10      LD  DE,V_APPEND
000085 0185 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000087 0187 CD0500          17      CALL    SYSTEM
                                
00008A 018A CD8005          17      CALL    LTNL
       018D                     COMMAND:
00008D 018D E5              11      PUSH    HL
00008E 018E 2ADE11          16      LD  HL,(FCB_BAT)
000091 0191 7E               7      LD  A,(HL)
000092 0192 E1              10      POP HL
000093 0193 B7               4      OR  A
000094 0194 C20D04          10      JP  NZ,C_BAT1
000097 0197 CD2103          17      CALL    SETDTA1
00009A 019A D5              11      PUSH    DE
00009B 019B C5              11      PUSH    BC
00009C 019C E5              11      PUSH    HL
00009D 019D 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
00009F 019F CD0500          17      CALL    SYSTEM
0000A2 01A2 E1              10      POP HL
0000A3 01A3 C1              10      POP BC
0000A4 01A4 C641             7      ADD A,'A'
0000A6 01A6 CDEF09          17      CALL    MSG_A
0000A9 01A9 1E3E             7      LD  E,'>'
0000AB 01AB CDDE09          17      CALL    _PRINT
0000AE 01AE D1              10      POP DE      ;DE=DTA1
0000AF 01AF 3E50             7      LD  A,80
0000B1 01B1 12               7      LD  (DE),A
0000B2 01B2 0E0A             7      LD  C,0AH       ;(BDOS)文字列入力
0000B4 01B4 CD0500          17      CALL    SYSTEM
0000B7 01B7 CD8005          17      CALL    LTNL
       01BA                     COMMAND2:
0000BA 01BA 118200          10      LD  DE,DTA1+2
0000BD 01BD CDCC01          17      CALL    COMANL
0000C0 01C0 30CB            12      JR  NC,COMMAND
0000C2 01C2 11D60E          10      LD  DE,COMERM
0000C5 01C5 0E09             7      LD  C,9     ;(BDOS)文字列出力
0000C7 01C7 CD0500          17      CALL    SYSTEM
0000CA 01CA 18B3            12      JR  WSTART
                                
       01CC                     COMANL:
0000CC 01CC CD130B          17      CALL    TOZERO
0000CF 01CF CD300A          17      CALL    FILE
0000D2 01D2 D5              11      PUSH    DE
0000D3 01D3 11B811          10      LD  DE,FNAME
0000D6 01D6 1A               7      LD  A,(DE)
0000D7 01D7 FE20             7      CP  020H
0000D9 01D9 285C            12      JR  Z,SDVSW
0000DB 01DB 1B               6      DEC DE
0000DC 01DC 1A               7      LD  A,(DE)
0000DD 01DD C6FF             7      ADD A,0FFH
0000DF 01DF 380A            12      JR  C,COMB
0000E1 01E1 13               6      INC DE
                                
0000E2 01E2 21230E          10      LD  HL,COMTB
0000E5 01E5 3E11             7      LD  A,COMS
0000E7 01E7 47               4      LD  B,A
0000E8 01E8 CD650B          17      CALL    CPNAME
       01EB                     COMB:
0000EB 01EB D1              10      POP DE
0000EC 01EC D2DD09          10      JP  NC,JP_HL
       01EF                     COMB2:
0000EF 01EF EB               4      EX  DE,HL
0000F0 01F0 22AD03          16      LD  (COMPAT+1),HL
0000F3 01F3 CD7003          17      CALL    CEXE4
                                
0000F6 01F6 216F0F          10      LD  HL,N_PATH
0000F9 01F9 11740F          10      LD  DE,V_PATH
0000FC 01FC 0640             7      LD  B,PATHX
0000FE 01FE 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000100 0200 CD0500          17      CALL    SYSTEM
                                
000103 0203 21740F          10      LD  HL,V_PATH
000106 0206 22E011          16      LD  (X_PATH),HL
       0209                     CEX1:
000109 0209 2AE011          16      LD  HL,(X_PATH)
00010C 020C 7E               7      LD  A,(HL)
00010D 020D FE20             7      CP  020H
00010F 020F D8              11      RET C
       0210                     CEX2:
000110 0210 7E               7      LD  A,(HL)
000111 0211 FE20             7      CP  020H
000113 0213 3807            12      JR  C,CEX3
000115 0215 FE3B             7      CP  ';'
000117 0217 2803            12      JR  Z,CEX3
000119 0219 23               6      INC HL
00011A 021A 18F4            12      JR  CEX2
       021C                     CEX3:
00011C 021C 3600            10      LD  (HL),0
00011E 021E FE20             7      CP  020H
000120 0220 3801            12      JR  C,CEX4
000122 0222 23               6      INC HL
       0223                     CEX4:
000123 0223 ED5BE011        20      LD  DE,(X_PATH)
000127 0227 22E011          16      LD  (X_PATH),HL
00012A 022A 21280F          10      LD  HL,N_APPEND
00012D 022D 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
00012F 022F CD0500          17      CALL    SYSTEM
                                
000132 0232 CD7003          17      CALL    CEXE4
000135 0235 18D2            12      JR  CEX1
                                
       0237                     SDVSW:
000137 0237 F1              10      POP AF
000138 0238 3AB711          13      LD  A,(FDRV)
00013B 023B 3D               4      DEC A
00013C 023C 5F               4      LD  E,A
00013D 023D 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
00013F 023F C32803          10      JP  SYSTEM0
                                
       0242                     OPEN_D2:            ;DOS2対応
000142 0242 3AE60F          13      LD  A,(MAJOR_VER)
000145 0245 FE02             7      CP  2
000147 0247 384F            12      JR  C,OPEN
000149 0249 11AE10          10      LD  DE,PATH_FN1
00014C 024C 180A            12      JR  OPEN_D2X
       024E                     OPEN1_D2:           ;DOS2対応
00014E 024E 3AE60F          13      LD  A,(MAJOR_VER)
000151 0251 FE02             7      CP  2
000153 0253 3840            12      JR  C,OPEN1
                                
000155 0255 112E10          10      LD  DE,PATH_CCP
       0258                     OPEN_D2X:
000158 0258 DD21E70F        14      LD  IX,SEARCH_IX
00015C 025C 014010          10      LD  BC,01040H   ;(BDOS)最初のエントリ検索
00015F 025F CD0500          17      CALL    SYSTEM
000162 0262 F5              11      PUSH    AF
000163 0263 116E10          10      LD  DE,PATH_PAR
000166 0266 0E5E             7      LD  C,05EH      ;(BDOS)完全なパス文字列の獲得(_WPATH)
000168 0268 CD0500          17      CALL    SYSTEM
00016B 026B AF               4      XOR A
00016C 026C 77               7      LD  (HL),A
00016D 026D 116E10          10      LD  DE,PATH_PAR
000170 0270 ED52            15      SBC HL,DE
000172 0272 222910          16      LD  (PATH_POS),HL
000175 0275 F1              10      POP AF
       0276                     FIB2DIRENT:
000176 0276 B7               4      OR  A
000177 0277 C0              11      RET NZ
                                
000178 0278 11E80F          10      LD  DE,SEARCH_IX+1  ;(FIB)ファイル名
00017B 027B 218011          10      LD  HL,DTA_CCP+1
00017E 027E 0E5C             7      LD  C,05CH      ;(BDOS)ファイル名の解析
000180 0280 CD0500          17      CALL    SYSTEM
                                
000183 0283 21F50F          10      LD  HL,SEARCH_IX+14 ;(FIB)属性
000186 0286 118B11          10      LD  DE,DTA_CCP+1+8+3
000189 0289 EDA0            16      LDI
00018B 028B 119611          10      LD  DE,DTA_CCP+1+8+3+1+10
00018E 028E 010A00          10      LD  BC,2+2+2+4  ;最終変更時刻+最終変更日付+開始クラスタ+ファイルサイズ
000191 0291 EDB0                    LDIR
000193 0293 AF               4      XOR A
000194 0294 C9              10      RET
                                
       0295                     OPEN1:
000195 0295 21B711          10      LD  HL,FDRV
       0298                     OPEN:
000198 0298 0E11             7      LD  C,011H      ;(BDOS)最初のファイルの検索
       029A                     OPEN3:
00019A 029A D5              11      PUSH    DE
00019B 029B 117F11          10      LD  DE,DTA_CCP
00019E 029E CD1403          17      CALL    SETDTA
0001A1 02A1 EB               4      EX  DE,HL
0001A2 02A2 CD0500          17      CALL    SYSTEM
0001A5 02A5 D1              10      POP DE
0001A6 02A6 B7               4      OR  A
0001A7 02A7 C9              10      RET
                                
       02A8                     OPEN2_D2:           ;DOS2対応
0001A8 02A8 3AE60F          13      LD  A,(MAJOR_VER)
0001AB 02AB FE02             7      CP  2
0001AD 02AD 380B            12      JR  C,OPEN2
0001AF 02AF DD21E70F        14      LD  IX,SEARCH_IX
0001B3 02B3 0E41             7      LD  C,41H       ;(BDOS)次のエントリ検索
0001B5 02B5 CD0500          17      CALL    SYSTEM
0001B8 02B8 18BC            12      JR  FIB2DIRENT
       02BA                     OPEN2:
0001BA 02BA 0E12             7      LD  C,012H
0001BC 02BC 18DC            12      JR  OPEN3
                                
       02BE                     DEFCB_D2:           ;DOS2対応
0001BE 02BE 3AE60F          13      LD  A,(MAJOR_VER)
0001C1 02C1 FE02             7      CP  2
0001C3 02C3 3837            12      JR  C,DEFCB
0001C5 02C5 216E10          10      LD  HL,PATH_PAR
0001C8 02C8 112E10          10      LD  DE,PATH_CCP
0001CB 02CB 014000          10      LD  BC,64
0001CE 02CE EDB0                    LDIR
0001D0 02D0 2A2910          16      LD  HL,(PATH_POS)
0001D3 02D3 112E10          10      LD  DE,PATH_CCP
0001D6 02D6 19              11      ADD HL,DE
0001D7 02D7 060D             7      LD  B,13
0001D9 02D9 11E80F          10      LD  DE,SEARCH_IX+1  ;(FIB)ファイル名
       02DC                     DCB4:
0001DC 02DC 1A               7      LD  A,(DE)
0001DD 02DD B7               4      OR  A
0001DE 02DE 2805            12      JR  Z,DCB5
0001E0 02E0 13               6      INC DE
0001E1 02E1 77               7      LD  (HL),A
0001E2 02E2 23               6      INC HL
0001E3 02E3 18F7            12      JR  DCB4
       02E5                     DCB5:
0001E5 02E5 3600            10      LD  (HL),0
0001E7 02E7 3A0010          13      LD  A,(SEARCH_IX+25);   (FIB)ドライブ番号(1-8)
0001EA 02EA C640             7      ADD A,040H
0001EC 02EC 112B10          10      LD  DE,PATH_DRV
0001EF 02EF 12               7      LD  (DE),A
0001F0 02F0 0E43             7      LD  C,043H      ;_OPEN ファイルハンドルのオープン
0001F2 02F2 3E01             7      LD  A,1     ;書き込み禁止
0001F4 02F4 CD0500          17      CALL    SYSTEM
0001F7 02F7 ED432710        20      LD  (HANDLE1),BC
0001FB 02FB C9              10      RET
       02FC                     DEFCB:              ;Z=Ok NZ=Error
0001FC 02FC 117F11          10      LD  DE,DTA_CCP
0001FF 02FF CD2603          17      CALL    SYSC0F
000202 0302 B7               4      OR  A
000203 0303 C0              11      RET NZ
                                
000204 0304 210100          10      LD  HL,1
000207 0307 228D11          16      LD  (DTA_CCP+14),HL
00020A 030A 2D               4      DEC L
00020B 030B 22A011          16      LD  (DTA_CCP+33),HL
00020E 030E 22A211          16      LD  (DTA_CCP+35),HL
       0311                     SETDTA100:
000211 0311 110080          10      LD  DE,DATA
       0314                     SETDTA:
000214 0314 C5              11      PUSH    BC
000215 0315 D5              11      PUSH    DE
000216 0316 E5              11      PUSH    HL
000217 0317 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
000219 0319 CD0500          17      CALL    SYSTEM
00021C 031C E1              10      POP HL
00021D 031D D1              10      POP DE
00021E 031E C1              10      POP BC
00021F 031F AF               4      XOR A
000220 0320 C9              10      RET
                                
       0321                     SETDTA1:
000221 0321 118000          10      LD  DE,DTA1
000224 0324 18EE            12      JR  SETDTA
                                
       0326                     SYSC0F:
000226 0326 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       0328                     SYSTEM0:
000228 0328 CD0500          17      CALL    SYSTEM
00022B 032B B7               4      OR  A
00022C 032C C9              10      RET
                                
       032D                     C_CD:
00022D 032D CD020A          17      CALL    FILEC_D2
000230 0330 112E10          10      LD  DE,PATH_CCP
000233 0333 1A               7      LD  A,(DE)
000234 0334 FE20             7      CP  020H
000236 0336 3805            12      JR  C,PWD
000238 0338 0E5A             7      LD  C,5AH       ;(BDOS)_CHDIR カレントディレクトリの変更
00023A 033A C30500          10      JP  SYSTEM
       033D                     PWD:
00023D 033D CDC605          17      CALL    PUTDRV
000240 0340 3E5C             7      LD  A,05CH
000242 0342 CDEF09          17      CALL    MSG_A
000245 0345 C32B05          10      JP  PDSKF2
                                
       0348                     S27DTA_D2:      ;DOS2対応
000248 0348 3AE60F          13      LD  A,(MAJOR_VER)
00024B 034B FE02             7      CP  2
00024D 034D 3810            12      JR  C,S27DTA
00024F 034F ED4B2710        20      LD  BC,(HANDLE1)
000253 0353 110080          10      LD  DE,DATA
000256 0356 0E48             7      LD  C,048H      ;(BDOS)ファイルハンドルからの読み出し(_READ)
000258 0358 CD2803          17      CALL    SYSTEM0
00025B 035B C8              11      RET Z
00025C 035C 37               4      SCF
00025D 035D 9F               4      SBC A,A
00025E 035E C9              10      RET
                                
       035F                     S27DTA:
00025F 035F 110100          10      LD  DE,1
000262 0362 ED538D11        20      LD  (DTA_CCP+14),DE
000266 0366 117F11          10      LD  DE,DTA_CCP
       0369                     S27:
000269 0369 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
00026B 036B CD0500          17      CALL    SYSTEM
00026E 036E B7               4      OR  A
00026F 036F C9              10      RET
                                
       0370                     CEXE4:
000270 0370 21B711          10      LD  HL,FDRV
000273 0373 117F11          10      LD  DE,DTA_CCP
000276 0376 010900          10      LD  BC,1+8
000279 0379 EDB0                    LDIR
00027B 037B 218811          10      LD  HL,DTA_CCP+9
00027E 037E 3643            10      LD  (HL),'C'
000280 0380 23               6      INC HL
000281 0381 364F            10      LD  (HL),'O'
000283 0383 23               6      INC HL
000284 0384 364D            10      LD  (HL),'M'
       0386                     C_EXE:
000286 0386 CDFC02          17      CALL    DEFCB
000289 0389 205A            12      JR  NZ,C_BAT
00028B 038B 11E411          10      LD  DE,DATA_COM
00028E 038E CD1403          17      CALL    SETDTA
                                
000291 0391 2A0600          16      LD  HL,(SYSTEM+1)
000294 0394 11E411          10      LD  DE,DATA_COM
000297 0397 ED52            15      SBC HL,DE
                                
000299 0399 CD5F03          17      CALL    S27DTA
00029C 039C 3D               4      DEC A
00029D 039D 37               4      SCF
00029E 039E C0              11      RET NZ
00029F 039F 7C               4      LD  A,H
0002A0 03A0 B5               4      OR  L
0002A1 03A1 37               4      SCF
0002A2 03A2 C8              11      RET Z
0002A3 03A3 22DF03          16      LD  (COMSIZ+1),HL
                                
0002A6 03A6 11E411          10      LD  DE,DATA_COM
0002A9 03A9 CD1403          17      CALL    SETDTA
0002AC 03AC 110000          10  COMPAT: LD  DE,0
0002AF 03AF CD7507          17      CALL    SETFCB
                                
0002B2 03B2 21280F          10      LD  HL,N_APPEND
0002B5 03B5 112F0F          10      LD  DE,V_APPEND
0002B8 03B8 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0002BA 03BA CD0500          17      CALL    SYSTEM
                                
0002BD 03BD 0E60             7      LD  C,60H       ;(BDOS)子プロセスの起動
0002BF 03BF CD0500          17      CALL    SYSTEM
0002C2 03C2 B7               4      OR  A
0002C3 03C3 2004            12      JR  NZ,COMP1
0002C5 03C5 78               4      LD  A,B
0002C6 03C6 32E311          13      LD  (PROCESS),A
       03C9                     COMP1:
0002C9 03C9 AF               4      XOR A
0002CA 03CA 67               4      LD  H,A
0002CB 03CB 6F               4      LD  L,A ;HL=0x0000
0002CC 03CC F3               4      DI
0002CD 03CD ED7B0600        20  SPPAT:  LD  SP,(SYSTEM+1)
0002D1 03D1 E5              11      PUSH    HL
0002D2 03D2 21EDB0          10      LD  HL,0B0EDH   ;LDIR
0002D5 03D5 22FE00          16      LD  (000FEH),HL
0002D8 03D8 21E411          10      LD  HL,DATA_COM
0002DB 03DB 110001          10      LD  DE,00100H
0002DE 03DE 010000          10  COMSIZ: LD  BC,0
0002E1 03E1 FB               4      EI
0002E2 03E2 C3FE00          10      JP  000FEH
                                
       03E5                     C_BAT:
0002E5 03E5 218811          10      LD  HL,DTA_CCP+9
0002E8 03E8 3642            10      LD  (HL),'B'
0002EA 03EA 23               6      INC HL
0002EB 03EB 3641            10      LD  (HL),'A'
0002ED 03ED 23               6      INC HL
0002EE 03EE 3654            10      LD  (HL),'T'
                                
0002F0 03F0 CDFC02          17      CALL    DEFCB
0002F3 03F3 C0              11      RET NZ
                                
0002F4 03F4 217F11          10      LD  HL,DTA_CCP
0002F7 03F7 7E               7      LD  A,(HL)
0002F8 03F8 B7               4      OR  A
0002F9 03F9 2009            12      JR  NZ,CBAT_DS
0002FB 03FB E5              11      PUSH    HL
0002FC 03FC 0E19             7      LD  C,019H      ;(BDOS)カレントドライブ番号の獲得(_CURDRV)
0002FE 03FE CD0500          17      CALL    SYSTEM
000301 0401 E1              10      POP HL
000302 0402 3C               4      INC A
000303 0403 77               7      LD  (HL),A
       0404                     CBAT_DS:
000304 0404 ED5BDE11        20      LD  DE,(FCB_BAT)
000308 0408 012500          10      LD  BC,37
00030B 040B EDB0                    LDIR
       040D                     C_BAT1:
00030D 040D CD1103          17      CALL    SETDTA100
000310 0410 CD4E04          17      CALL    FGETC_BAT
000313 0413 218100          10      LD  HL,DTA1+1
000316 0416 202A            12      JR  NZ,END_BATCH
000318 0418 FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
00031A 041A 38F1            12      JR  C,C_BAT1
00031C 041C 3620            10      LD  (HL),' '
00031E 041E 23               6      INC HL
       041F                     C_BAT2:
00031F 041F 77               7      LD  (HL),A
000320 0420 23               6      INC HL
000321 0421 7D               4      LD  A,L
000322 0422 3C               4      INC A       ;L==0FFH
000323 0423 2809            12      JR  Z,RUN_BATCH
000325 0425 CD4E04          17      CALL    FGETC_BAT
000328 0428 2004            12      JR  NZ,RUN_BATCH
00032A 042A FE20             7      CP  020H
00032C 042C 30F1            12      JR  NC,C_BAT2
       042E                     RUN_BATCH:
00032E 042E 7D               4      LD  A,L
00032F 042F D67F             7      SUB DTA1-1
000331 0431 328000          13      LD  (DTA1),A
000334 0434 FE04             7      CP  4
000336 0436 380A            12      JR  C,END_BATCH
000338 0438 3600            10      LD  (HL),0
00033A 043A 3A9BFC          13      LD  A,(INTFLG)
00033D 043D FE03             7      CP  3
00033F 043F C2BA01          10      JP  NZ,COMMAND2
       0442                     END_BATCH:      ;バッチファイルを閉じる
000342 0442 2ADE11          16      LD  HL,(FCB_BAT)
000345 0445 3600            10      LD  (HL),0
000347 0447 ED7B0600        20      LD  SP,(SYSTEM+1)
00034B 044B C37F01          10      JP  WSTART
                                
       044E                     FGETC_BAT:
00034E 044E ED5BDE11        20      LD  DE,(FCB_BAT)
       0452                     FGETC:              ;1文字ずつ読み込む
000352 0452 E5              11      PUSH    HL      ;Z:成功
000353 0453 210100          10      LD  HL,1
000356 0456 CD6903          17      CALL    S27
000359 0459 E1              10      POP HL
00035A 045A 3A0080          13      LD  A,(DATA)
00035D 045D C9              10      RET
                                
       045E                     C_REM:
00035E 045E AF               4      XOR A
00035F 045F C9              10      RET
                                
       0460                     C_DEL:
000360 0460 CD7507          17      CALL    SETFCB
000363 0463 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力
000365 0465 CD0500          17      CALL    SYSTEM
000368 0468 0600             7      LD  B,0
00036A 046A 3AE60F          13      LD  A,(MAJOR_VER)
00036D 046D FE02             7      CP  2
00036F 046F 381E            12      JR  C,CDEL_DOS1
                                
000371 0471 215C00          10      LD  HL,FCB1
000374 0474 CD4202          17      CALL    OPEN_D2
000377 0477 37               4      SCF
       0478                     DEL1:
000378 0478 C0              11      RET NZ
000379 0479 3AF50F          13      LD  A,(SEARCH_IX+14);   (FIB)属性
00037C 047C CB67             8      BIT 4,A
00037E 047E 200A            12      JR  NZ,DEL2
                                
000380 0480 11E70F          10      LD  DE,SEARCH_IX
000383 0483 0E4D             7      LD  C,04DH      ;(BDOS)ファイル・サブディレクトリの削除(_DELETE)
000385 0485 CD2803          17      CALL    SYSTEM0
000388 0488 37               4      SCF
000389 0489 C0              11      RET NZ
       048A                     DEL2:
00038A 048A CDA802          17      CALL    OPEN2_D2
00038D 048D 18E9            12      JR  DEL1
                                
       048F                     CDEL_DOS1:
00038F 048F 0E13             7      LD  C,013H
000391 0491 1811            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       0493                     C_REN:
000393 0493 3AE60F          13      LD  A,(MAJOR_VER)
000396 0496 FE02             7      CP  2
000398 0498 3013            12      JR  NC,REN_DOS2
00039A 049A CD7507          17      CALL    SETFCB
00039D 049D 3E10             7      LD  A,010H      ;ディレクトリも対象にする(LSX-Dodgers)
00039F 049F 326900          13      LD  (FCB1+13),A ;属性
0003A2 04A2 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       04A4                     CDEL1:
0003A4 04A4 115C00          10      LD  DE,FCB1
       04A7                     REN2:
0003A7 04A7 CD0500          17      CALL    SYSTEM
0003AA 04AA C6FF             7      ADD A,0FFH
0003AC 04AC C9              10      RET
                                
       04AD                     REN_DOS2:           ;DOS2のリネーム(ディレクトリ対応)
0003AD 04AD CD0D0B          17      CALL    SPCUT
0003B0 04B0 6B               4      LD  L,E
0003B1 04B1 62               4      LD  H,D
       04B2                     REN_D2_1:
0003B2 04B2 7E               7      LD  A,(HL)
0003B3 04B3 FE21             7      CP  020H+1
0003B5 04B5 3803            12      JR  C,REN_D2_2
0003B7 04B7 23               6      INC HL
0003B8 04B8 18F8            12      JR  REN_D2_1
       04BA                     REN_D2_2:
0003BA 04BA 3600            10      LD  (HL),0
0003BC 04BC 23               6      INC HL
0003BD 04BD 0E4E             7      LD  C,04EH      ;(BDOS)ファイルあるいはサブディレクトリ名の変更(_RENAME)
0003BF 04BF 18E6            12      JR  REN2
                                
       04C1                     C_DIR:
0003C1 04C1 CD020A          17      CALL    FILEC_D2
0003C4 04C4 21B811          10      LD  HL,FDRV+1
0003C7 04C7 CDC309          17      CALL    CWILD1
0003CA 04CA 3EF1             7      LD  A,0F1H
0003CC 04CC 32C411          13      LD  (FDRV+13),A
0003CF 04CF CD4E02          17      CALL    OPEN1_D2
       04D2                     CDIR1:
0003D2 04D2 B7               4      OR  A
0003D3 04D3 2008            12      JR  NZ,PDSKF
0003D5 04D5 CD5805          17      CALL    P_NAME
0003D8 04D8 CDA802          17      CALL    OPEN2_D2
0003DB 04DB 18F5            12      JR  CDIR1
                                
       04DD                     PDSKF:
0003DD 04DD 3AB711          13      LD  A,(FDRV)
0003E0 04E0 5F               4      LD  E,A
0003E1 04E1 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
0003E3 04E3 CD0500          17      CALL    SYSTEM
0003E6 04E6 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
0003E7 04E7 C601             7      ADD A,001H
0003E9 04E9 D8              11      RET C       ;Aが0FFHだった場合
0003EA 04EA 3E06             7      LD  A,8-2
       04EC                     PDS1:               ;HL=未使用クラスタの総数
0003EC 04EC 3C               4      INC A
0003ED 04ED CB19             8      RR  C
0003EF 04EF 30FB            12      JR  NC,PDS1
       04F1                     PDS2:               ;B←論理セクタのサイズの上位8ビット
0003F1 04F1 3C               4      INC A
0003F2 04F2 CB18             8      RR  B
0003F4 04F4 30FB            12      JR  NC,PDS2
0003F6 04F6 47               4      LD  B,A
                                
0003F7 04F7 110000          10      LD  DE,0
       04FA                     PDS3:
0003FA 04FA 29              11      ADD HL,HL
0003FB 04FB EB               4      EX  DE,HL
0003FC 04FC ED6A            15      ADC HL,HL
0003FE 04FE EB               4      EX  DE,HL
0003FF 04FF 10F9            13      DJNZ    PDS3
       0501                     PDSKF1:
000401 0501 CDE605          17      CALL    PRDEC_DEHL
000404 0504 11BC0E          10      LD  DE,FREE
000407 0507 0E09             7      LD  C,9     ;(BDOS)文字列出力
000409 0509 CD0500          17      CALL    SYSTEM
00040C 050C CDC605          17      CALL    PUTDRV
00040F 050F 3E5C             7      LD  A,05CH      ;\
000411 0511 CDEF09          17      CALL    MSG_A
000414 0514 3AE60F          13      LD  A,(MAJOR_VER)
000417 0517 FE01             7      CP  1
000419 0519 3865            12      JR  C,LTNL
00041B 051B 200E            12      JR  NZ,PDSKF2
00041D 051D 2AC511          16      LD  HL,(FDRV+14)
000420 0520 AF               4      XOR A
000421 0521 11FEFF          10      LD  DE,0-2
000424 0524 19              11      ADD HL,DE
000425 0525 23               6      INC HL
000426 0526 DCE205          17      CALL    C,PRDEC_HL
000429 0529 1855            12      JR  LTNL
       052B                     PDSKF2:             ;MSX-DOS2
00042B 052B 3AB711          13      LD  A,(FDRV)
00042E 052E 47               4      LD  B,A     ;ドライブ
00042F 052F 110080          10      LD  DE,DATA
000432 0532 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
000434 0534 CD0500          17      CALL    SYSTEM
000437 0537 210080          10      LD  HL,DATA
                                
00043A 053A CD4205          17      CALL    MSX
00043D 053D 1841            12      JR  LTNL
                                
       053F                     MSX1:
00043F 053F CDEF09          17      CALL    MSG_A
       0542                     MSX:
000442 0542 7E               7      LD  A,(HL)
000443 0543 23               6      INC HL
000444 0544 B7               4      OR  A
000445 0545 20F8            12      JR  NZ,MSX1
000447 0547 C9              10      RET
                                
       0548                     MSXSLT1:
000448 0548 CDEF09          17      CALL    MSG_A
       054B                     MSXSLT:
00044B 054B C5              11      PUSH    BC
00044C 054C E5              11      PUSH    HL
00044D 054D 78               4      LD  A,B
00044E 054E CD0C00          17      CALL    RDSLT
000451 0551 E1              10      POP HL
000452 0552 C1              10      POP BC
000453 0553 23               6      INC HL
000454 0554 B7               4      OR  A
000455 0555 20F1            12      JR  NZ,MSXSLT1
000457 0557 C9              10      RET
                                
       0558                     P_NAME:
000458 0558 218011          10      LD  HL,DTA_CCP+1
00045B 055B 7E               7      LD  A,(HL)
00045C 055C FE2E             7      CP  '.'
00045E 055E C8              11      RET Z
00045F 055F CD3C06          17      CALL    FPRNT
000462 0562 3A8B11          13      LD  A,(DTA_CCP+12)
000465 0565 CB67             8      BIT 4,A
000467 0567 280A            12      JR  Z,DIR3
000469 0569 11CA0E          10      LD  DE,DIRMES
00046C 056C 0E09             7      LD  C,9     ;(BDOS)文字列出力
00046E 056E CD0500          17      CALL    SYSTEM
000471 0571 180A            12      JR  DIR6
       0573                     DIR3:
000473 0573 ED5B9E11        20      LD  DE,(DTA_CCP+1+01EH)
000477 0577 2A9C11          16      LD  HL,(DTA_CCP+1+01CH)
00047A 057A CDE605          17      CALL    PRDEC_DEHL
       057D                     DIR6:
00047D 057D CD5E06          17      CALL    PRTTMS
                                
       0580                     LTNL:
000480 0580 1E0D             7      LD  E,00DH
000482 0582 CDDE09          17      CALL    _PRINT
000485 0585 1E0A             7      LD  E,00AH
000487 0587 C3DE09          10      JP  _PRINT
                                
       058A                     C_PATH:
00048A 058A CD0D0B          17      CALL    SPCUT
00048D 058D FE21             7      CP  021H
00048F 058F 301C            12      JR  NC,CPATH0
                                
000491 0591 216F0F          10      LD  HL,N_PATH
000494 0594 11740F          10      LD  DE,V_PATH
000497 0597 0640             7      LD  B,PATHX
000499 0599 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
00049B 059B CD0500          17      CALL    SYSTEM
00049E 059E 21740F          10      LD  HL,V_PATH
       05A1                     CPATHP:
0004A1 05A1 7E               7      LD  A,(HL)
0004A2 05A2 23               6      INC HL
0004A3 05A3 FE20             7      CP  020H
0004A5 05A5 3F               4      CCF
0004A6 05A6 30D8            12      JR  NC,LTNL
0004A8 05A8 CDEF09          17      CALL    MSG_A
0004AB 05AB 18F4            12      JR  CPATHP
       05AD                     CPATH0:
0004AD 05AD 21740F          10      LD  HL,V_PATH
0004B0 05B0 FE3B             7      CP  ';'
0004B2 05B2 2001            12      JR  NZ,CPATH1
0004B4 05B4 13               6      INC DE
       05B5                     CPATH1:
0004B5 05B5 EB               4      EX  DE,HL
0004B6 05B6 014000          10      LD  BC,PATHX
0004B9 05B9 EDB0                    LDIR
                                
0004BB 05BB 216F0F          10      LD  HL,N_PATH
0004BE 05BE 11740F          10      LD  DE,V_PATH
0004C1 05C1 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0004C3 05C3 C30500          10      JP  SYSTEM
                                
       05C6                     PUTDRV:
0004C6 05C6 3AB711          13      LD  A,(FDRV)
0004C9 05C9 B7               4      OR  A
0004CA 05CA 200C            12      JR  NZ,PUTDRV1
0004CC 05CC C5              11      PUSH    BC
0004CD 05CD D5              11      PUSH    DE
0004CE 05CE E5              11      PUSH    HL
0004CF 05CF 0E19             7      LD  C,019H
0004D1 05D1 CD0500          17      CALL    SYSTEM
0004D4 05D4 E1              10      POP HL
0004D5 05D5 D1              10      POP DE
0004D6 05D6 C1              10      POP BC
0004D7 05D7 3C               4      INC A
       05D8                     PUTDRV1:
0004D8 05D8 C640             7      ADD A,'A'-1
0004DA 05DA CDEF09          17      CALL    MSG_A
0004DD 05DD 3E3A             7      LD  A,':'
       05DF                     MSG_AR:
0004DF 05DF C3EF09          10      JP  MSG_A
                                
       05E2                     PRDEC_HL:
0004E2 05E2 AF               4      XOR A
       05E3                     PRDEC_AHL:
0004E3 05E3 5F               4      LD  E,A
0004E4 05E4 1600             7      LD  D,0
       05E6                     PRDEC_DEHL:
0004E6 05E6 3E02             7      LD  A,2
0004E8 05E8 323106          13      LD  (DEC6+1),A
0004EB 05EB AF               4      XOR A
0004EC 05EC E5              11      PUSH    HL
0004ED 05ED 21B111          10      LD  HL,DECBF
0004F0 05F0 0605             7      LD  B,5
0004F2 05F2 CDD40A          17      CALL    FILL_MEMORY
0004F5 05F5 E1              10      POP HL
                                
0004F6 05F6 0E20             7      LD  C,32
       05F8                     DEC1:
0004F8 05F8 29              11      ADD HL,HL
0004F9 05F9 EB               4      EX  DE,HL
0004FA 05FA ED6A            15      ADC HL,HL
0004FC 05FC EB               4      EX  DE,HL
0004FD 05FD E5              11      PUSH    HL
0004FE 05FE 21B511          10      LD  HL,DECBF+4
000501 0601 0605             7      LD  B,5
       0603                     DEC2:
000503 0603 7E               7      LD  A,(HL)
000504 0604 8F               4      ADC A,A
000505 0605 27               4      DAA
000506 0606 77               7      LD  (HL),A
000507 0607 2B               6      DEC HL
000508 0608 10F9            13      DJNZ    DEC2
00050A 060A E1              10      POP HL
00050B 060B 0D               4      DEC C
00050C 060C 20EA            12      JR  NZ,DEC1
                                
00050E 060E 21B111          10      LD  HL,DECBF
000511 0611 3E20             7      LD  A,020H
000513 0613 0604             7      LD  B,4
       0615                     DEC3:
000515 0615 CD2206          17      CALL    DEC4
000518 0618 CD2206          17      CALL    DEC4
00051B 061B 23               6      INC HL
00051C 061C 10F7            13      DJNZ    DEC3
       061E                     DECX:
00051E 061E CD2206          17      CALL    DEC4
000521 0621 AF               4      XOR A
       0622                     DEC4:
000522 0622 ED6F            18      RLD
000524 0624 FE20             7      CP  020H
000526 0626 2808            12      JR  Z,DEC6
000528 0628 F630             7      OR  030H
       062A                     DEC5:
00052A 062A 18B3            12      JR  MSG_AR
       062C                     DEC7:
00052C 062C 3E20             7      LD  A,020H
00052E 062E 18AF            12      JR  MSG_AR
       0630                     DEC6:
000530 0630 3E02             7      LD  A,2
000532 0632 B7               4      OR  A
000533 0633 28F7            12      JR  Z,DEC7
000535 0635 3D               4      DEC A
000536 0636 323106          13      LD  (DEC6+1),A
000539 0639 3E20             7      LD  A,020H
00053B 063B C9              10      RET
                                
       063C                     FPRNT:
00053C 063C 0608             7      LD  B,8
00053E 063E CD4F06          17      CALL    P_N1
000541 0641 7E               7      LD  A,(HL)
000542 0642 C680             7      ADD A,0A0H-020H
000544 0644 FEA0             7      CP  0A0H
000546 0646 2802            12      JR  Z,FPR1
000548 0648 3E2E             7      LD  A,'.'
       064A                     FPR1:
00054A 064A CDEF09          17      CALL    MSG_A
00054D 064D 0603             7      LD  B,3
                                
       064F                     P_N1:
00054F 064F C5              11      PUSH    BC
000550 0650 E5              11      PUSH    HL
000551 0651 7E               7      LD  A,(HL)
000552 0652 CD2C0B          17      CALL    CAP3
000555 0655 CDEF09          17      CALL    MSG_A
000558 0658 E1              10      POP HL
000559 0659 C1              10      POP BC
00055A 065A 23               6      INC HL
00055B 065B 10F2            13      DJNZ    P_N1
00055D 065D C9              10      RET
                                
       065E                     PRTTMS:
00055E 065E 3E20             7      LD  A,020H
000560 0660 CDEF09          17      CALL    MSG_A
                                
000563 0663 2A9811          16      LD  HL,(DTA_CCP+1+24)
000566 0666 7D               4      LD  A,L
000567 0667 B7               4      OR  A
000568 0668 C8              11      RET Z
000569 0669 CB3C             8      SRL H
00056B 066B 17               4      RLA
00056C 066C 17               4      RLA
00056D 066D 17               4      RLA
00056E 066E 17               4      RLA
00056F 066F E60F             7      AND 00FH
000571 0671 57               4      LD  D,A
000572 0672 DD21B90F        14      LD  IX,V_DATE
       0676                     PRTTMS1:
000576 0676 DD7E00          19      LD  A,(IX+0)
000579 0679 B7               4      OR  A
00057A 067A 2808            12      JR  Z,PRTTMS2
00057C 067C CDFF06          17      CALL    PR_DATE
00057F 067F CD6A07          17      CALL    PR_DATE_SPLITER
000582 0682 18F2            12      JR  PRTTMS1
       0684                     PRTTMS2:
                                
000584 0684 CD120C          17      CALL    GET_WIDTH
000587 0687 FE21             7      CP  32+1
000589 0689 3005            12      JR  NC,SHOW_TIME
00058B 068B 3E1D             7      LD  A,01DH
00058D 068D C3EF09          10      JP  MSG_A
       0690                     SHOW_TIME:
000590 0690 2A9611          16      LD  HL,(DTA_CCP+1+22)
                                
000593 0693 3E20             7      LD  A,020H
000595 0695 CDEF09          17      CALL    MSG_A
000598 0698 7C               4      LD  A,H
000599 0699 65               4      LD  H,L
00059A 069A 1F               4      RRA
00059B 069B CB1D             8      RR  L
00059D 069D 1F               4      RRA
00059E 069E CB1D             8      RR  L
0005A0 06A0 1F               4      RRA
0005A1 06A1 CB1D             8      RR  L
0005A3 06A3 E61F             7      AND 01FH
0005A5 06A5 4F               4      LD  C,A
0005A6 06A6 3ADE0F          13      LD  A,(V_TIME)
0005A9 06A9 FE31             7      CP  '1'
0005AB 06AB 79               4      LD  A,C
0005AC 06AC 200B            12      JR  NZ,TIME24
0005AE 06AE FE0C             7      CP  12
0005B0 06B0 3802            12      JR  C,TIME12
0005B2 06B2 D60C             7      SUB 12
       06B4                     TIME12:
0005B4 06B4 B7               4      OR  A
0005B5 06B5 2002            12      JR  NZ,TIME24
0005B7 06B7 C60C             7      ADD A,12
       06B9                     TIME24:
0005B9 06B9 C5              11      PUSH    BC
0005BA 06BA CDEA06          17      CALL    PRDEC_A
0005BD 06BD 3E3A             7      LD  A,':'
0005BF 06BF CDEF09          17      CALL    MSG_A
0005C2 06C2 7D               4      LD  A,L
0005C3 06C3 0F               4      RRCA
0005C4 06C4 0F               4      RRCA
0005C5 06C5 E63F             7      AND 03FH
0005C7 06C7 CDEA06          17      CALL    PRDEC_A
                                
0005CA 06CA 3E3A             7      LD  A,':'
0005CC 06CC CDEF09          17      CALL    MSG_A
0005CF 06CF 7C               4      LD  A,H
0005D0 06D0 E61F             7      AND 01FH
0005D2 06D2 87               4      ADD A,A
0005D3 06D3 CDEA06          17      CALL    PRDEC_A
                                
0005D6 06D6 3ADE0F          13      LD  A,(V_TIME)
0005D9 06D9 FE31             7      CP  '1'
0005DB 06DB C1              10      POP BC
0005DC 06DC C0              11      RET NZ
0005DD 06DD 79               4      LD  A,C
0005DE 06DE 1E61             7      LD  E,'a'
0005E0 06E0 FE0C             7      CP  12
0005E2 06E2 DADE09          10      JP  C,_PRINT
0005E5 06E5 1E70             7      LD  E,'p'
0005E7 06E7 C3DE09          10      JP  _PRINT
                                
                                ;   PRINT10
                                
       06EA                     PRDEC_A:
0005EA 06EA E5              11      PUSH    HL
0005EB 06EB 0608             7      LD  B,8
0005ED 06ED 4F               4      LD  C,A
0005EE 06EE AF               4      XOR A
       06EF                     PRTA1:
0005EF 06EF CB01             4      RLC C
0005F1 06F1 8F               4      ADC A,A
0005F2 06F2 27               4      DAA
0005F3 06F3 10FA            13      DJNZ    PRTA1
0005F5 06F5 21B111          10      LD  HL,DECBF
0005F8 06F8 77               7      LD  (HL),A
0005F9 06F9 AF               4      XOR A
0005FA 06FA CD1E06          17      CALL    DECX
0005FD 06FD E1              10      POP HL
0005FE 06FE C9              10      RET
                                
       06FF                     PR_DATE:
0005FF 06FF DD7E00          19      LD  A,(IX+0)
000602 0702 FE20             7      CP  020H
000604 0704 D8              11      RET C
000605 0705 CD200B          17      CALL    CAP
000608 0708 FE44             7      CP  'D'
00060A 070A 2848            12      JR  Z,PR_DAY
00060C 070C FE4D             7      CP  'M'
00060E 070E 2820            12      JR  Z,PR_MONTH
000610 0710 FE59             7      CP  'Y'
000612 0712 2046            12      JR  NZ,PR_DATE1
000614 0714 4F               4      LD  C,A
000615 0715 DD7E02          19      LD  A,(IX+2)
000618 0718 CD200B          17      CALL    CAP
00061B 071B B9               4      CP  C
00061C 071C 200A            12      JR  NZ,YEAR2
00061E 071E 7C               4      LD  A,H     ;YEAR
00061F 071F C6EC             7      ADD A,80+256-100
000621 0721 3E13             7      LD  A,19
000623 0723 CE00             7      ADC A,0
000625 0725 CDEA06          17      CALL    PRDEC_A     ;年4桁
       0728                     YEAR2:
000628 0728 7C               4      LD  A,H     ;YEAR
000629 0729 C650             7      ADD A,80
00062B 072B CDEA06          17      CALL    PRDEC_A
00062E 072E 182A            12      JR  PR_DATE1
       0730                     PR_MONTH:
000630 0730 4F               4      LD  C,A
000631 0731 DD7E02          19      LD  A,(IX+2)
000634 0734 CD200B          17      CALL    CAP
000637 0737 B9               4      CP  C
000638 0738 2014            12      JR  NZ,MONTH2
00063A 073A E5              11      PUSH    HL      ;月を文字列で表示 Jan等
00063B 073B D5              11      PUSH    DE
00063C 073C 7A               4      LD  A,D
00063D 073D 3D               4      DEC A
00063E 073E 87               4      ADD A,A
00063F 073F 87               4      ADD A,A
000640 0740 21F80E          10      LD  HL,S_MONTH
000643 0743 1600             7      LD  D,0
000645 0745 5F               4      LD  E,A
000646 0746 19              11      ADD HL,DE
000647 0747 CD4205          17      CALL    MSX
00064A 074A D1              10      POP DE
00064B 074B E1              10      POP HL
00064C 074C 180C            12      JR  PR_DATE1
       074E                     MONTH2:
00064E 074E 7A               4      LD  A,D     ;月を数字で表示
00064F 074F CDEA06          17      CALL    PRDEC_A
000652 0752 1806            12      JR  PR_DATE1
       0754                     PR_DAY:
000654 0754 7D               4      LD  A,L
000655 0755 E61F             7      AND 01FH
000657 0757 CDEA06          17      CALL    PRDEC_A
       075A                     PR_DATE1:
00065A 075A DD23            10      INC IX
00065C 075C DD7E00          19      LD  A,(IX+0)
00065F 075F CD200B          17      CALL    CAP
000662 0762 FE41             7      CP  'A'
000664 0764 D8              11      RET C
000665 0765 FE5B             7      CP  'Z'+1
000667 0767 38F1            12      JR  C,PR_DATE1
000669 0769 C9              10      RET
       076A                     PR_DATE_SPLITER:
00066A 076A DD7E00          19      LD  A,(IX+0)
00066D 076D FE20             7      CP  020H
00066F 076F D8              11      RET C
000670 0770 DD23            10      INC IX
000672 0772 C3EF09          10      JP  MSG_A
                                
       0775                     SETFCB:
000675 0775 CD0D0B          17      CALL    SPCUT
000678 0778 1A               7      LD  A,(DE)
000679 0779 FE20             7      CP  020H
00067B 077B 3801            12      JR  C,SETFCBA
00067D 077D 1B               6      DEC DE
       077E                     SETFCBA:
00067E 077E D5              11      PUSH    DE
00067F 077F 215C00          10      LD  HL,FCB1
000682 0782 115D00          10      LD  DE,FCB1+1
000685 0785 012300          10      LD  BC,00023H
000688 0788 70               7      LD  (HL),B      ;B=0
000689 0789 EDB0                    LDIR
00068B 078B D1              10      POP DE
00068C 078C D5              11      PUSH    DE
00068D 078D 215C00          10      LD  HL,FCB1
000690 0790 DD21AE10        14      LD  IX,PATH_FN1
000694 0794 CDB10B          17      CALL    _SYS29      ;ファイル名の解析
000697 0797 216C00          10      LD  HL,FCB2
00069A 079A DD21EE10        14      LD  IX,PATH_FN2
00069E 079E CDB10B          17      CALL    _SYS29      ;ファイル名の解析
0006A1 07A1 E1              10      POP HL
0006A2 07A2 010050          10      LD  BC,05000H
0006A5 07A5 118100          10      LD  DE,00081H
       07A8                     SETFCB1:
0006A8 07A8 7E               7      LD  A,(HL)
0006A9 07A9 23               6      INC HL
0006AA 07AA FE20             7      CP  020H
0006AC 07AC 3805            12      JR  C,SETFCB2
0006AE 07AE 12               7      LD  (DE),A
0006AF 07AF 13               6      INC DE
0006B0 07B0 0C               4      INC C
0006B1 07B1 10F5            13      DJNZ    SETFCB1
       07B3                     SETFCB2:
0006B3 07B3 79               4      LD  A,C
0006B4 07B4 328000          13      LD  (DTA1),A
0006B7 07B7 04               4      INC B
0006B8 07B8 AF               4      XOR A
       07B9                     SETFCB3:
0006B9 07B9 12               7      LD  (DE),A
0006BA 07BA 13               6      INC DE
0006BB 07BB 10FC            13      DJNZ    SETFCB3
0006BD 07BD C9              10      RET
                                
       07BE                     C_COPY:
0006BE 07BE CD7507          17      CALL    SETFCB
0006C1 07C1 3AE60F          13      LD  A,(MAJOR_VER)
0006C4 07C4 FE02             7      CP  2
0006C6 07C6 3818            12      JR  C,COPYI0
0006C8 07C8 11EE10          10      LD  DE,PATH_FN2
0006CB 07CB AF               4      XOR A
0006CC 07CC 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
0006CE 07CE CD2803          17      CALL    SYSTEM0
0006D1 07D1 B7               4      OR  A
0006D2 07D2 200C            12      JR  NZ,COPYI0
0006D4 07D4 CB65             8      BIT 4,L     ;ディレクトリ
0006D6 07D6 2808            12      JR  Z,COPYI0
0006D8 07D8 21B811          10      LD  HL,FDRV+1
0006DB 07DB 060B             7      LD  B,8+3
0006DD 07DD CDD20A          17      CALL    FILE10
       07E0                     COPYI0:
0006E0 07E0 3AB711          13      LD  A,(FDRV)
0006E3 07E3 47               4      LD  B,A
0006E4 07E4 B7               4      OR  A
0006E5 07E5 200B            12      JR  NZ,COPYI1
0006E7 07E7 C5              11      PUSH    BC
0006E8 07E8 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
0006EA 07EA CD0500          17      CALL    SYSTEM
0006ED 07ED 3C               4      INC A
0006EE 07EE 32B711          13      LD  (FDRV),A
0006F1 07F1 C1              10      POP BC
       07F2                     COPYI1:
0006F2 07F2 C640             7      ADD A,040H
0006F4 07F4 322E11          13      LD  (CUR_DRV),A
0006F7 07F7 113111          10      LD  DE,CUR_PATH
0006FA 07FA 0E59             7      LD  C,059H      ;(BDOS)カレントディレクトリの獲得(_GETCD)
0006FC 07FC CD0500          17      CALL    SYSTEM
0006FF 07FF CD1108          17      CALL    COPYSUB
       0802                     RES_CUR_PATH:
000702 0802 112E11          10      LD  DE,CUR_DRV
       0805                     SET_CUR_PATH:
000705 0805 F5              11      PUSH    AF
000706 0806 3AB711          13      LD  A,(FDRV)
000709 0809 47               4      LD  B,A
00070A 080A 0E5A             7      LD  C,05AH      ;(BDOS)カレントディレクトリの変更(_CHDIR)
00070C 080C CD0500          17      CALL    SYSTEM
00070F 080F F1              10      POP AF
000710 0810 C9              10      RET
       0811                     COPYSUB:
000711 0811 11DD11          10      LD  DE,ZERO
000714 0814 CD280A          17      CALL    FILEC2
000717 0817 216C00          10      LD  HL,FCB2
00071A 081A CDFC0B          17      CALL    S29X1
                                
00071D 081D 3E10             7      LD  A,010H
00071F 081F 326900          13      LD  (FCB1+13),A
000722 0822 216D00          10      LD  HL,FCB2+1
000725 0825 CDC309          17      CALL    CWILD1
       0828                     COPY0:
000728 0828 CDC009          17      CALL    CWILD
00072B 082B 215C00          10      LD  HL,FCB1
00072E 082E CD4202          17      CALL    OPEN_D2
000731 0831 37               4      SCF
       0832                     COPY1:
000732 0832 C0              11      RET NZ
000733 0833 CDBE02          17      CALL    DEFCB_D2
                                
000736 0836 3A8B11          13      LD  A,(DTA_CCP+12)
000739 0839 CB67             8      BIT 4,A
00073B 083B 2821            12      JR  Z,COPY1A
                                
00073D 083D 215D00          10      LD  HL,FCB1+1
000740 0840 CD590B          17      CALL    CHKWILD
000743 0843 3811            12      JR  C,COPY9
                                
000745 0845 3E20             7      LD  A,020H
000747 0847 325D00          13      LD  (FCB1+1),A
00074A 084A 2A9911          16      LD  HL,(DTA_CCP+26)
00074D 084D 23               6      INC HL
00074E 084E 226A00          16      LD  (FCB1+14),HL
000751 0851 18D5            12      JR  COPY0
                                
       0853                     COPY8:
000753 0853 CDA80C          17      CALL    SHOW_OK
       0856                     COPY9:
000756 0856 CD0208          17      CALL    RES_CUR_PATH
000759 0859 CDA802          17      CALL    OPEN2_D2
00075C 085C 18D4            12      JR  COPY1
                                
       085E                     COPY1A:
00075E 085E 216C00          10      LD  HL,FCB2
000761 0861 11B711          10      LD  DE,FDRV
000764 0864 018111          10      LD  BC,DTA_CCP+2
000767 0867 EDA0            16      LDI
000769 0869 3E0B             7      LD  A,11
       086B                     COPY2:
00076B 086B F5              11      PUSH    AF
00076C 086C 7E               7      LD  A,(HL)
00076D 086D FE3F             7      CP  '?'
00076F 086F 2001            12      JR  NZ,COPY3
000771 0871 0A               7      LD  A,(BC)
       0872                     COPY3:
000772 0872 12               7      LD  (DE),A
000773 0873 03               6      INC BC
000774 0874 13               6      INC DE
000775 0875 23               6      INC HL
000776 0876 F1              10      POP AF
000777 0877 3D               4      DEC A
000778 0878 20F1            12      JR  NZ,COPY2
00077A 087A 010500          10      LD  BC,16-11
00077D 087D EDB0                    LDIR
       087F                     PUTNAME:
00077F 087F 215D00          10      LD  HL,FCB1+1
000782 0882 CD590B          17      CALL    CHKWILD
000785 0885 300B            12      JR  NC,PUTN1
000787 0887 21B811          10      LD  HL,FDRV+1
00078A 088A CD3C06          17      CALL    FPRNT
00078D 088D 3E20             7      LD  A,020H
00078F 088F CDEF09          17      CALL    MSG_A
       0892                     PUTN1:
000792 0892 11EE10          10      LD  DE,PATH_FN2
000795 0895 CD0508          17      CALL    SET_CUR_PATH
                                
000798 0898 11B711          10      LD  DE,FDRV
00079B 089B 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
00079D 089D CD2803          17      CALL    SYSTEM0
0007A0 08A0 C24109          10      JP  NZ,COPYE2
0007A3 08A3 67               4      LD  H,A     ;A=0
0007A4 08A4 6F               4      LD  L,A
0007A5 08A5 22D811          16      LD  (FDRV+33),HL    ;(FCB)ランダム・レコード
0007A8 08A8 22DA11          16      LD  (FDRV+35),HL
0007AB 08AB 2C               4      INC L       ;HL=1
0007AC 08AC 22C511          16      LD  (FDRV+14),HL    ;(FCB)レコード・サイズ
       08AF                     COPY6:
0007AF 08AF CDD209          17      CALL    BUFSIZ
0007B2 08B2 CD4803          17      CALL    S27DTA_D2
0007B5 08B5 3C               4      INC A
0007B6 08B6 CA3009          10      JP  Z,COPYE
0007B9 08B9 47               4      LD  B,A
0007BA 08BA 7C               4      LD  A,H
0007BB 08BB B5               4      OR  L
0007BC 08BC 280F            12      JR  Z,COPY7
0007BE 08BE 11B711          10      LD  DE,FDRV
0007C1 08C1 C5              11      PUSH    BC
0007C2 08C2 0E26             7      LD  C,026H      ;(BDOS)ランダム・ブロック・ライト
0007C4 08C4 CD0500          17      CALL    SYSTEM
0007C7 08C7 C1              10      POP BC
0007C8 08C8 B7               4      OR  A
0007C9 08C9 2065            12      JR  NZ,COPYE
0007CB 08CB 10E2            13      DJNZ    COPY6
       08CD                     COPY7:
0007CD 08CD 3AE60F          13      LD  A,(MAJOR_VER)
0007D0 08D0 FE02             7      CP  2
0007D2 08D2 3011            12      JR  NC,COPY7_MSX2   ;DOS2はFCBの仕様が違う
0007D4 08D4 3A8C11          13      LD  A,(DTA_CCP+13)  ;(FCB)属性(アトリビュート)
0007D7 08D7 32C411          13      LD  (FDRV+13),A ;(FCB)属性(アトリビュート)
0007DA 08DA 219311          10      LD  HL,DTA_CCP+20
0007DD 08DD 11CB11          10      LD  DE,FDRV+20  ;(FCB)更新日時
0007E0 08E0 010400          10      LD  BC,4
0007E3 08E3 EDB0                    LDIR
       08E5                     COPY7_MSX2:
0007E5 08E5 11B711          10      LD  DE,FDRV
0007E8 08E8 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0007EA 08EA CD2803          17      CALL    SYSTEM0
                                
0007ED 08ED 2041            12      JR  NZ,COPYE
0007EF 08EF 3AE60F          13      LD  A,(MAJOR_VER)
0007F2 08F2 FE02             7      CP  2
0007F4 08F4 3837            12      JR  C,COPY_DOS2DT
                                
0007F6 08F6 ED4B2710        20      LD  BC,(HANDLE1)
0007FA 08FA 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
0007FC 08FC CD0500          17      CALL    SYSTEM
                                
0007FF 08FF 11EE10          10      LD  DE,PATH_FN2
000802 0902 CD0508          17      CALL    SET_CUR_PATH
                                
000805 0905 11B711          10      LD  DE,FDRV
000808 0908 217111          10      LD  HL,DOS2NAME
00080B 090B CD4309          17      CALL    FCB2FNAME
                                
00080E 090E 3AF50F          13      LD  A,(SEARCH_IX+14);   (FIB)属性
000811 0911 6F               4      LD  L,A
000812 0912 117111          10      LD  DE,DOS2NAME
000815 0915 3E01             7      LD  A,1
000817 0917 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
000819 0919 CD2803          17      CALL    SYSTEM0
                                
00081C 091C DD2AF60F        20      LD  IX,(SEARCH_IX+15)   ;(FIB)更新時間
000820 0920 2AF80F          16      LD  HL,(SEARCH_IX+17)   ;(FIB)更新日
000823 0923 117111          10      LD  DE,DOS2NAME
000826 0926 3E01             7      LD  A,1
000828 0928 0E51             7      LD  C,51H       ;(BDOS)_FTIME ファイルの日付および時刻の獲得・設定
00082A 092A CD2803          17      CALL    SYSTEM0
       092D                     COPY_DOS2DT:
00082D 092D C35308          10      JP  COPY8
                                
       0930                     COPYE:
000830 0930 ED4B2710        20      LD  BC,(HANDLE1)
000834 0934 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
000836 0936 CD0500          17      CALL    SYSTEM
000839 0939 11B711          10      LD  DE,FDRV
00083C 093C 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
00083E 093E CD0500          17      CALL    SYSTEM
       0941                     COPYE2:
000841 0941 37               4      SCF
000842 0942 C9              10      RET
                                
       0943                     FCB2FNAME:
000843 0943 1A               7      LD  A,(DE)
000844 0944 13               6      INC DE
000845 0945 C640             7      ADD A,040H
000847 0947 77               7      LD  (HL),A
000848 0948 23               6      INC HL
000849 0949 363A            10      LD  (HL),':'
00084B 094B 23               6      INC HL
                                
00084C 094C 0608             7      LD  B,8
       094E                     FCB2FNAME1:
00084E 094E 1A               7      LD  A,(DE)
00084F 094F FE21             7      CP  020H+1
000851 0951 3807            12      JR  C,FCB2FNAME2
000853 0953 13               6      INC DE
000854 0954 77               7      LD  (HL),A
000855 0955 23               6      INC HL
000856 0956 10F6            13      DJNZ    FCB2FNAME1
000858 0958 1803            12      JR  FCB2FNAME3
       095A                     FCB2FNAME2:
00085A 095A 13               6      INC DE
00085B 095B 10FD            13      DJNZ    FCB2FNAME2
       095D                     FCB2FNAME3:
00085D 095D 1A               7      LD  A,(DE)
00085E 095E FE21             7      CP  020H+1
000860 0960 380F            12      JR  C,FCB2FNAME5
000862 0962 362E            10      LD  (HL),'.'
000864 0964 23               6      INC HL
000865 0965 0603             7      LD  B,3
       0967                     FCB2FNAME4:
000867 0967 1A               7      LD  A,(DE)
000868 0968 13               6      INC DE
000869 0969 FE21             7      CP  020H+1
00086B 096B 3804            12      JR  C,FCB2FNAME5
00086D 096D 77               7      LD  (HL),A
00086E 096E 23               6      INC HL
00086F 096F 10F6            13      DJNZ    FCB2FNAME4
       0971                     FCB2FNAME5:
000871 0971 3600            10      LD  (HL),0
000873 0973 C9              10      RET
                                
       0974                     C_TYPE:
000874 0974 CD7507          17      CALL    SETFCB
000877 0977 215C00          10      LD  HL,FCB1
00087A 097A CD4202          17      CALL    OPEN_D2
00087D 097D 37               4      SCF
       097E                     TYPE1:
00087E 097E C0              11      RET NZ
00087F 097F CDBE02          17      CALL    DEFCB_D2
000882 0982 3E1A             7      LD  A,01AH
000884 0984 CDEF09          17      CALL    MSG_A
       0987                     TYPE2:
000887 0987 CDD209          17      CALL    BUFSIZ
00088A 098A CD4803          17      CALL    S27DTA_D2
00088D 098D C6FE             7      ADD A,0FEH
00088F 098F D8              11      RET C
000890 0990 7C               4      LD  A,H
000891 0991 B5               4      OR  L
000892 0992 281A            12      JR  Z,TYPEE
000894 0994 010080          10      LD  BC,DATA
       0997                     TYPE3:
000897 0997 0A               7      LD  A,(BC)
000898 0998 03               6      INC BC
000899 0999 FE1A             7      CP  01AH
00089B 099B 2811            12      JR  Z,TYPEE
00089D 099D 5F               4      LD  E,A
00089E 099E C5              11      PUSH    BC
00089F 099F E5              11      PUSH    HL
0008A0 09A0 0E02             7      LD  C,2     ;(BDOS)コンソール出力
0008A2 09A2 CD0500          17      CALL    SYSTEM
0008A5 09A5 E1              10      POP HL
0008A6 09A6 C1              10      POP BC
0008A7 09A7 2B               6      DEC HL
0008A8 09A8 7C               4      LD  A,H
0008A9 09A9 B5               4      OR  L
0008AA 09AA 20EB            12      JR  NZ,TYPE3
0008AC 09AC 18D9            12      JR  TYPE2
       09AE                     TYPEE:
0008AE 09AE 3AE60F          13      LD  A,(MAJOR_VER)   ;DOS2対応
0008B1 09B1 FE02             7      CP  2
0008B3 09B3 3806            12      JR  C,TYPEE2
0008B5 09B5 ED4B2710        20      LD  BC,(HANDLE1)
0008B9 09B9 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
       09BB                     TYPEE2:
0008BB 09BB CDA802          17      CALL    OPEN2_D2
0008BE 09BE 18BE            12      JR  TYPE1
                                
       09C0                     CWILD:
0008C0 09C0 215D00          10      LD  HL,FCB1+1
       09C3                     CWILD1:
0008C3 09C3 7E               7      LD  A,(HL)
0008C4 09C4 FE20             7      CP  020H
0008C6 09C6 C0              11      RET NZ
       09C7                     CWILD2:
0008C7 09C7 54               4      LD  D,H
0008C8 09C8 5D               4      LD  E,L
0008C9 09C9 13               6      INC DE
0008CA 09CA 010A00          10      LD  BC,10
0008CD 09CD 363F            10      LD  (HL),'?'
0008CF 09CF EDB0                    LDIR
0008D1 09D1 C9              10      RET
                                
       09D2                     BUFSIZ:
0008D2 09D2 3A0700          13      LD  A,(SYSTEM+2)
0008D5 09D5 D681             7      SUB (DATA/256)+1
0008D7 09D7 E6F8             7      AND 0F8H
0008D9 09D9 67               4      LD  H,A
0008DA 09DA 2E00             7      LD  L,0
0008DC 09DC C9              10      RET
                                
0008DD 09DD E9               4  JP_HL:  JP  (HL)
                                
       09DE                     _PRINT:
0008DE 09DE C5              11      PUSH    BC
0008DF 09DF D5              11      PUSH    DE
0008E0 09E0 E5              11      PUSH    HL
0008E1 09E1 DDE5            15      PUSH    IX
0008E3 09E3 0E06             7      LD  C,6
0008E5 09E5 CD0500          17      CALL    SYSTEM
0008E8 09E8 DDE1            14      POP IX
0008EA 09EA E1              10      POP HL
0008EB 09EB D1              10      POP DE
0008EC 09EC C1              10      POP BC
0008ED 09ED B7               4      OR  A
0008EE 09EE C9              10      RET
                                
       09EF                     MSG_A:
0008EF 09EF F5              11      PUSH    AF
0008F0 09F0 C5              11      PUSH    BC
0008F1 09F1 D5              11      PUSH    DE
0008F2 09F2 E5              11      PUSH    HL
0008F3 09F3 DDE5            15      PUSH    IX
0008F5 09F5 5F               4      LD  E,A
0008F6 09F6 0E02             7      LD  C,2
0008F8 09F8 CD0500          17      CALL    SYSTEM
0008FB 09FB DDE1            14      POP IX
0008FD 09FD E1              10      POP HL
0008FE 09FE D1              10      POP DE
0008FF 09FF C1              10      POP BC
000900 0A00 F1              10      POP AF
000901 0A01 C9              10      RET
                                ;       FILE
       0A02                     FILEC_D2:       ;DOS2対応
000902 0A02 3AE60F          13      LD  A,(MAJOR_VER)
000905 0A05 FE02             7      CP  2
000907 0A07 381C            12      JR  C,FILEC
000909 0A09 C5              11      PUSH    BC
00090A 0A0A D5              11      PUSH    DE
00090B 0A0B E5              11      PUSH    HL
00090C 0A0C CD0D0B          17      CALL    SPCUT
00090F 0A0F 212E10          10      LD  HL,PATH_CCP
000912 0A12 0640             7      LD  B,64
       0A14                     PATHCD1:
000914 0A14 1A               7      LD  A,(DE)
000915 0A15 13               6      INC DE
000916 0A16 FE20             7      CP  020H
000918 0A18 3002            12      JR  NC,PATHCD2
00091A 0A1A 3E00             7      LD  A,0
       0A1C                     PATHCD2:
00091C 0A1C 77               7      LD  (HL),A
00091D 0A1D 3803            12      JR  C,PATHCD3
00091F 0A1F 23               6      INC HL
000920 0A20 10F2            13      DJNZ    PATHCD1
       0A22                     PATHCD3:
000922 0A22 E1              10      POP HL
000923 0A23 D1              10      POP DE
000924 0A24 C1              10      POP BC
       0A25                     FILEC:
000925 0A25 CD300A          17      CALL    FILE
       0A28                     FILEC2:
000928 0A28 3AB811          13      LD  A,(FDRV+1)
00092B 0A2B FE20             7      CP  020H
00092D 0A2D C8              11      RET Z
00092E 0A2E 1839            12      JR  SETDIR1
                                
       0A30                     FILE:
000930 0A30 AF               4      XOR A
000931 0A31 32B711          13      LD  (FDRV),A
000934 0A34 67               4      LD  H,A
000935 0A35 6F               4      LD  L,A
000936 0A36 22C511          16      LD  (FDRV+14),HL
000939 0A39 CD0D0B          17      CALL    SPCUT
00093C 0A3C CDF20A          17      CALL    CCHK3
00093F 0A3F 2812            12      JR  Z,DEVI1
000941 0A41 13               6      INC DE
000942 0A42 1A               7      LD  A,(DE)
000943 0A43 1B               6      DEC DE
000944 0A44 FE3A             7      CP  ':'
000946 0A46 200B            12      JR  NZ,DEVI1
000948 0A48 1A               7      LD  A,(DE)      ;DRIVE
000949 0A49 CD200B          17      CALL    CAP
00094C 0A4C D640             7      SUB '@'
00094E 0A4E 13               6      INC DE
00094F 0A4F 13               6      INC DE
000950 0A50 32B711          13      LD  (FDRV),A
       0A53                     DEVI1:
000953 0A53 1A               7      LD  A,(DE)
000954 0A54 D65C             7      SUB 05CH        ;\
000956 0A56 2009            12      JR  NZ,NOROOT
000958 0A58 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000959 0A59 22D111          16      LD  (FDRV+26),HL
00095C 0A5C 2C               4      INC L
00095D 0A5D 22C511          16      LD  (FDRV+14),HL
000960 0A60 13               6      INC DE
       0A61                     NOROOT:
                                
       0A61                     SETDIR:
000961 0A61 CD920A          17      CALL    FILED
000964 0A64 1A               7      LD  A,(DE)
000965 0A65 FE5C             7      CP  05CH        ;\
000967 0A67 C0              11      RET NZ
000968 0A68 13               6      INC DE
       0A69                     SETDIR1:
000969 0A69 3AE60F          13      LD  A,(MAJOR_VER)
00096C 0A6C FE01             7      CP  1
00096E 0A6E C0              11      RET NZ
                                                ;for LSX-Dodgers
00096F 0A6F 3E10             7      LD  A,010H      ;Directory
000971 0A71 32C411          13      LD  (FDRV+13),A
000974 0A74 D5              11      PUSH    DE
000975 0A75 11B711          10      LD  DE,FDRV
000978 0A78 0E0F             7      LD  C,00FH
00097A 0A7A CD0500          17      CALL    SYSTEM
00097D 0A7D D1              10      POP DE
00097E 0A7E B7               4      OR  A
00097F 0A7F C0              11      RET NZ
                                
000980 0A80 3AC411          13      LD  A,(FDRV+13)
000983 0A83 CB67             8      BIT 4,A
000985 0A85 C8              11      RET Z
                                
000986 0A86 CDD90A          17      CALL    FILEI
000989 0A89 2AD111          16      LD  HL,(FDRV+26)
00098C 0A8C 23               6      INC HL
00098D 0A8D 22C511          16      LD  (FDRV+14),HL
000990 0A90 18CF            12      JR  SETDIR
                                
       0A92                     FILED:
000992 0A92 CDD90A          17      CALL    FILEI
                                
000995 0A95 0608             7      LD  B,8
       0A97                     FILE2:
000997 0A97 CDE70A          17      CALL    CCHKF
00099A 0A9A C8              11      RET Z
00099B 0A9B FE2A             7      CP  '*'
00099D 0A9D 282E            12      JR  Z,FILE9
00099F 0A9F FE2E             7      CP  '.'
0009A1 0AA1 280C            12      JR  Z,FILE4
0009A3 0AA3 77               7      LD  (HL),A
0009A4 0AA4 23               6      INC HL
0009A5 0AA5 10F0            13      DJNZ    FILE2
                                
       0AA7                     FILE3:
0009A7 0AA7 CDE70A          17      CALL    CCHKF
0009AA 0AAA C8              11      RET Z
0009AB 0AAB FE2E             7      CP  '.'
0009AD 0AAD 20F8            12      JR  NZ,FILE3
                                
       0AAF                     FILE4:
0009AF 0AAF 21C011          10      LD  HL,FNAME+8
0009B2 0AB2 0603             7      LD  B,3
                                
       0AB4                     FILE4L:
0009B4 0AB4 CDE70A          17      CALL    CCHKF
0009B7 0AB7 C8              11      RET Z
0009B8 0AB8 FE2E             7      CP  '.'
0009BA 0ABA 2008            12      JR  NZ,FILE12
0009BC 0ABC 32B811          13      LD  (FNAME),A   ;Parent directory(..)
0009BF 0ABF 32B911          13      LD  (FNAME+1),A
0009C2 0AC2 3E20             7      LD  A,020H
       0AC4                     FILE12:
0009C4 0AC4 FE2A             7      CP  '*'
0009C6 0AC6 280A            12      JR  Z,FILE10
0009C8 0AC8 77               7      LD  (HL),A
0009C9 0AC9 23               6      INC HL
0009CA 0ACA 10E8            13      DJNZ    FILE4L
0009CC 0ACC C9              10      RET
                                
       0ACD                     FILE9:              ;名前の*処理、名前の残りを?で埋める
0009CD 0ACD CDD20A          17      CALL    FILE10
0009D0 0AD0 18D5            12      JR  FILE3
                                
       0AD2                     FILE10:
0009D2 0AD2 3E3F             7      LD  A,'?'
                                
       0AD4                     FILL_MEMORY:                ;HLからBバイトAで埋める
0009D4 0AD4 77               7      LD  (HL),A
0009D5 0AD5 23               6      INC HL
0009D6 0AD6 10FC            13      DJNZ    FILL_MEMORY
0009D8 0AD8 C9              10      RET
                                
       0AD9                     FILEI:              ;名前＋拡張子をスペースで初期化
0009D9 0AD9 3E20             7      LD  A,020H
0009DB 0ADB 01000B          10      LD  BC,11*256
0009DE 0ADE 21B811          10      LD  HL,FNAME
0009E1 0AE1 E5              11      PUSH    HL
0009E2 0AE2 CDD40A          17      CALL    FILL_MEMORY
0009E5 0AE5 E1              10      POP HL
0009E6 0AE6 C9              10      RET
                                
       0AE7                     CCHKF:
0009E7 0AE7 1A               7      LD  A,(DE)
0009E8 0AE8 CDEF0A          17      CALL    CCHK2
0009EB 0AEB C8              11      RET Z
0009EC 0AEC C3420B          10      JP  FKAN
                                
       0AEF                     CCHK2:
0009EF 0AEF 0C               4      INC C
0009F0 0AF0 0D               4      DEC C
0009F1 0AF1 C0              11      RET NZ
       0AF2                     CCHK3:              ;ZF=1 で使えない文字
0009F2 0AF2 FE2B             7      CP  '+'
0009F4 0AF4 C8              11      RET Z
0009F5 0AF5 FE2C             7      CP  ','
0009F7 0AF7 C8              11      RET Z
0009F8 0AF8 FE2F             7      CP  '/'
0009FA 0AFA C8              11      RET Z
0009FB 0AFB FE3A             7      CP  ':'
0009FD 0AFD C8              11      RET Z
0009FE 0AFE FE3B             7      CP  ';'
000A00 0B00 C8              11      RET Z
000A01 0B01 FE3D             7      CP  '='
000A03 0B03 C8              11      RET Z
000A04 0B04 FE5C             7      CP  05CH    ;\
000A06 0B06 C8              11      RET Z
000A07 0B07 FE20             7      CP  020H
000A09 0B09 D0              11      RET NC
000A0A 0B0A BF               4      CP  A       ;Z=1
000A0B 0B0B C9              10      RET
                                
       0B0C                     SS1:
000A0C 0B0C 13               6      INC DE
       0B0D                     SPCUT:              ;スペースをカット
000A0D 0B0D 1A               7      LD  A,(DE)
000A0E 0B0E FE20             7      CP  020H
000A10 0B10 28FA            12      JR  Z,SS1
000A12 0B12 C9              10      RET
                                
       0B13                     TOZERO:
000A13 0B13 D5              11      PUSH    DE
       0B14                     TZ1:
000A14 0B14 1A               7      LD  A,(DE)
000A15 0B15 FE20             7      CP  20H
000A17 0B17 3803            12      JR  C,TZ2
000A19 0B19 13               6      INC DE
000A1A 0B1A 18F8            12      JR  TZ1
       0B1C                     TZ2:
000A1C 0B1C AF               4      XOR A
000A1D 0B1D 12               7      LD  (DE),A
000A1E 0B1E D1              10      POP DE
000A1F 0B1F C9              10      RET
                                
       0B20                     CAP:
000A20 0B20 FE61             7      CP  'a'
000A22 0B22 D8              11      RET C
000A23 0B23 FE7B             7      CP  'z'+1
000A25 0B25 D0              11      RET NC
000A26 0B26 D620             7      SUB 020H
000A28 0B28 C9              10      RET
       0B29                     CAP2:
000A29 0B29 CD200B          17      CALL    CAP
       0B2C                     CAP3:
000A2C 0B2C CD350B          17      CALL    CAP4
000A2F 0B2F FE21             7      CP  021H
000A31 0B31 D0              11      RET NC
000A32 0B32 3E20             7      LD  A,020H
000A34 0B34 C9              10      RET
       0B35                     CAP4:
000A35 0B35 FE05             7      CP  5
000A37 0B37 C0              11      RET NZ
000A38 0B38 3EE5             7      LD  A,0E5H
000A3A 0B3A C9              10      RET
                                
       0B3B                     FKANC:
000A3B 0B3B CB41             8      BIT 0,C
000A3D 0B3D CC290B          17      CALL    Z,CAP2
000A40 0B40 1801            12      JR  FKANX
       0B42                     FKAN:           ;漢字チェック
000A42 0B42 13               6      INC DE
       0B43                     FKANX:
000A43 0B43 CB41             8      BIT 0,C
000A45 0B45 CB81             8      RES 0,C
000A47 0B47 C0              11      RET NZ
000A48 0B48 FE80             7      CP  080H
000A4A 0B4A D8              11      RET C
000A4B 0B4B FEA0             7      CP  0A0H
000A4D 0B4D 3803            12      JR  C,FKAN1
000A4F 0B4F FEE0             7      CP  0E0H
000A51 0B51 D8              11      RET C
       0B52                     FKAN1:
000A52 0B52 0C               4      INC C
000A53 0B53 A7               4      AND A
000A54 0B54 C9              10      RET
                                
       0B55                     CHKWILDX:
000A55 0B55 FDE5            15      PUSH    IY
000A57 0B57 E1              10      POP HL
000A58 0B58 23               6      INC HL
       0B59                     CHKWILD:
000A59 0B59 060B             7      LD  B,11
000A5B 0B5B 3E3F             7      LD  A,'?'
       0B5D                     CHKWIL1:
000A5D 0B5D BE               7      CP  (HL)
000A5E 0B5E 23               6      INC HL
000A5F 0B5F 37               4      SCF
000A60 0B60 C8              11      RET Z
000A61 0B61 10FA            13      DJNZ    CHKWIL1
000A63 0B63 AF               4      XOR A
000A64 0B64 C9              10      RET
                                
       0B65                     CPNAME:
000A65 0B65 C5              11      PUSH    BC
000A66 0B66 D5              11      PUSH    DE
000A67 0B67 11A611          10      LD  DE,CPBUF
000A6A 0B6A 010700          10      LD  BC,7
000A6D 0B6D EDB0                    LDIR
000A6F 0B6F D1              10      POP DE
000A70 0B70 D5              11      PUSH    DE
000A71 0B71 E5              11      PUSH    HL
000A72 0B72 21A611          10      LD  HL,CPBUF
000A75 0B75 CD880B          17      CALL    CPFILE
000A78 0B78 E1              10      POP HL
000A79 0B79 D1              10      POP DE
000A7A 0B7A C1              10      POP BC
000A7B 0B7B 2005            12      JR  NZ,CPNAME1
000A7D 0B7D 7E               7      LD  A,(HL)
000A7E 0B7E 23               6      INC HL
000A7F 0B7F 66               7      LD  H,(HL)
000A80 0B80 6F               4      LD  L,A
000A81 0B81 C9              10      RET
       0B82                     CPNAME1:
000A82 0B82 23               6      INC HL
000A83 0B83 23               6      INC HL
000A84 0B84 10DF            13      DJNZ    CPNAME
000A86 0B86 37               4      SCF
000A87 0B87 C9              10      RET
                                
       0B88                     CPFILE:
000A88 0B88 C5              11      PUSH    BC
000A89 0B89 01000B          10      LD  BC,00B00H
       0B8C                     CPSTR1:
000A8C 0B8C 1A               7      LD  A,(DE)
000A8D 0B8D FE3F             7      CP  '?'     ;Wild card
000A8F 0B8F 2812            12      JR  Z,CPSTR2
000A91 0B91 7E               7      LD  A,(HL)
000A92 0B92 CD3B0B          17      CALL    FKANC
000A95 0B95 E5              11      PUSH    HL
000A96 0B96 67               4      LD  H,A
000A97 0B97 1A               7      LD  A,(DE)
000A98 0B98 CB01             4      RLC C
000A9A 0B9A CD3B0B          17      CALL    FKANC
000A9D 0B9D CB09             4      RRC C
000A9F 0B9F BC               4      CP  H       ;CP (HL),(DE)
000AA0 0BA0 E1              10      POP HL
000AA1 0BA1 2004            12      JR  NZ,CPSTR3
       0BA3                     CPSTR2:
000AA3 0BA3 13               6      INC DE
000AA4 0BA4 23               6      INC HL
000AA5 0BA5 10E5            13      DJNZ    CPSTR1
       0BA7                     CPSTR3:
000AA7 0BA7 C1              10      POP BC
000AA8 0BA8 C9              10      RET
                                
       0BA9                     CPFILE2:
000AA9 0BA9 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
000AAC 0BAC F6E1             7      OR  0E1H
000AAE 0BAE 2F               4      CPL
000AAF 0BAF A6               7      AND (HL)
000AB0 0BB0 C9              10      RET
                                
       0BB1                     _SYS29:     ;(BDOS)ファイル名の解析
000AB1 0BB1 C5              11      PUSH    BC
000AB2 0BB2 D5              11      PUSH    DE
000AB3 0BB3 0640             7      LD  B,64
000AB5 0BB5 CD0D0B          17      CALL    SPCUT
000AB8 0BB8 ED53A411        20      LD  (DIR_CK),DE
       0BBC                     D2FN1:
000ABC 0BBC 1A               7      LD  A,(DE)
000ABD 0BBD FE21             7      CP  020H+1
000ABF 0BBF 3808            12      JR  C,D2FN2
000AC1 0BC1 13               6      INC DE
000AC2 0BC2 DD7700          19      LD  (IX+0),A
000AC5 0BC5 DD23            10      INC IX
000AC7 0BC7 10F3            13      DJNZ    D2FN1
       0BC9                     D2FN2:
000AC9 0BC9 DD360000        19      LD  (IX+0),0
000ACD 0BCD DD7EFF          19      LD  A,(IX-1)
000AD0 0BD0 FE5C             7      CP  05CH        ;\
000AD2 0BD2 201F            12      JR  NZ,D2FN3
000AD4 0BD4 DD7EFE          19      LD  A,(IX-2)
000AD7 0BD7 FE3A             7      CP  ':'
000AD9 0BD9 2818            12      JR  Z,D2FN3
                                
000ADB 0BDB DD36FF00        19      LD  (IX-1),0
000ADF 0BDF ED5BA411        20      LD  DE,(DIR_CK)
000AE3 0BE3 AF               4      XOR A
000AE4 0BE4 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
000AE6 0BE6 CD2803          17      CALL    SYSTEM0
000AE9 0BE9 2004            12      JR  NZ,D2FN4
000AEB 0BEB CB65             8      BIT 4,L
000AED 0BED 2004            12      JR  NZ,D2FN3
       0BEF                     D2FN4:
000AEF 0BEF DD36FF5C        19      LD  (IX-1),05CH ;\
       0BF3                     D2FN3:
000AF3 0BF3 D1              10      POP DE
000AF4 0BF4 C1              10      POP BC
000AF5 0BF5 C5              11      PUSH    BC
000AF6 0BF6 E5              11      PUSH    HL
000AF7 0BF7 CD300A          17      CALL    FILE
000AFA 0BFA E1              10      POP HL
000AFB 0BFB C1              10      POP BC
       0BFC                     S29X1:
000AFC 0BFC C5              11      PUSH    BC
000AFD 0BFD D5              11      PUSH    DE
000AFE 0BFE E5              11      PUSH    HL
000AFF 0BFF EB               4      EX  DE,HL
000B00 0C00 21B711          10      LD  HL,FDRV
000B03 0C03 010D00          10      LD  BC,13
000B06 0C06 EDB0                    LDIR
000B08 0C08 70               7      LD  (HL),B      ;B=0
000B09 0C09 0E03             7      LD  C,3
000B0B 0C0B EDB0                    LDIR
000B0D 0C0D E1              10      POP HL
000B0E 0C0E D1              10      POP DE
000B0F 0C0F C1              10      POP BC
000B10 0C10 AF               4      XOR A
000B11 0C11 C9              10      RET
       0C12                     GET_WIDTH:
000B12 0C12 3AE50F          13      LD  A,(IS_MSX)
000B15 0C15 B7               4      OR  A
000B16 0C16 2804            12      JR  Z,NOT_MSX
000B18 0C18 3AB0F3          13      LD  A,(LINLEN)
000B1B 0C1B C9              10      RET
       0C1C                     NOT_MSX:
000B1C 0C1C E5              11      PUSH    HL
000B1D 0C1D 2A0100          16      LD  HL,(1)
000B20 0C20 2EB1             7      LD  L,0B1H
000B22 0C22 7E               7      LD  A,(HL)
000B23 0C23 E1              10      POP HL
000B24 0C24 C9              10      RET
                                
       0C25                     C_MODE:
000B25 0C25 3AE50F          13      LD  A,(IS_MSX)
000B28 0C28 B7               4      OR  A
000B29 0C29 C8              11      RET Z
000B2A 0C2A 0E29             7      LD  C,41
000B2C 0C2C 3AF8FA          13      LD  A,(EXBRSA)
000B2F 0C2F B7               4      OR  A
000B30 0C30 2802            12      JR  Z,MODE_MSX1
000B32 0C32 0E51             7      LD  C,81
       0C34                     MODE_MSX1:
000B34 0C34 C5              11      PUSH    BC
000B35 0C35 CDF90D          17      CALL    GETNUM
000B38 0C38 C1              10      POP BC
000B39 0C39 7D               4      LD  A,L
000B3A 0C3A B9               4      CP  C
000B3B 0C3B 301C            12      JR  NC,MODE1
000B3D 0C3D B7               4      OR  A
000B3E 0C3E 2819            12      JR  Z,MODE1
000B40 0C40 FE21             7      CP  33
000B42 0C42 381E            12      JR  C,MODE32
000B44 0C44 32AEF3          13      LD  (LINL40),A
000B47 0C47 DD216C00        14      LD  IX,INITXT
000B4B 0C4B CD520C          17      CALL    CALLROM
000B4E 0C4E DD217800        14      LD  IX,SETTXT
       0C52                     CALLROM:
000B52 0C52 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000B56 0C56 C31C00          10      JP  CALSLT
       0C59                     MODE1:
000B59 0C59 3AB0F3          13      LD  A,(LINLEN)
000B5C 0C5C CDEA06          17      CALL    PRDEC_A
000B5F 0C5F C38005          10      JP  LTNL
       0C62                     MODE32:
000B62 0C62 32AFF3          13      LD  (LINL32),A
000B65 0C65 DD216F00        14      LD  IX,INIT32
000B69 0C69 CD520C          17      CALL    CALLROM
000B6C 0C6C DD217B00        14      LD  IX,SETT32
000B70 0C70 18E0            12      JR  CALLROM
                                
       0C72                     C_PAUSE:
000B72 0C72 CD0D0B          17      CALL    SPCUT
000B75 0C75 EB               4      EX  DE,HL
000B76 0C76 7E               7      LD  A,(HL)
000B77 0C77 B7               4      OR  A
000B78 0C78 2003            12      JR  NZ,C_PAUSE1
000B7A 0C7A 21DD0E          10      LD  HL,PAUSE
       0C7D                     C_PAUSE1:
000B7D 0C7D CD4205          17      CALL    MSX
000B80 0C80 0E07             7      LD  C,7     ;(BDOS)コンソール直接入力(_DIRIN)
000B82 0C82 CD0500          17      CALL    SYSTEM
000B85 0C85 FE03             7      CP  3
000B87 0C87 CA4204          10      JP  Z,END_BATCH
000B8A 0C8A C38005          10      JP  LTNL
                                
       0C8D                     C_ECHO:
000B8D 0C8D CD0D0B          17      CALL    SPCUT
000B90 0C90 EB               4      EX  DE,HL
000B91 0C91 CD4205          17      CALL    MSX
000B94 0C94 C38005          10      JP  LTNL
                                
       0C97                     C_MKDIR:
000B97 0C97 CD0D0B          17      CALL    SPCUT
000B9A 0C9A 014490          10      LD  BC,09044H   ;B=新規作成+ディレクトリ/C=(BDOS)ファイルハンドルの作成(_CREATE)
000B9D 0C9D CD0500          17      CALL    SYSTEM
000BA0 0CA0 C6FF             7      ADD A,0FFH
000BA2 0CA2 D8              11      RET C
000BA3 0CA3 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
000BA5 0CA5 CD0500          17      CALL    SYSTEM
       0CA8                     SHOW_OK:
000BA8 0CA8 11D30E          10      LD  DE,OK
000BAB 0CAB 0E09             7      LD  C,9     ;(BDOS)文字列出力
000BAD 0CAD CD0500          17      CALL    SYSTEM
000BB0 0CB0 C38005          10      JP  LTNL
                                
       0CB3                     C_RMDIR:
000BB3 0CB3 CD0D0B          17      CALL    SPCUT
000BB6 0CB6 AF               4      XOR A
000BB7 0CB7 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
000BB9 0CB9 D5              11      PUSH    DE
000BBA 0CBA CD0500          17      CALL    SYSTEM
000BBD 0CBD D1              10      POP DE
000BBE 0CBE C6FF             7      ADD A,0FFH
000BC0 0CC0 D8              11      RET C
000BC1 0CC1 CB65             8      BIT 4,L
000BC3 0CC3 C8              11      RET Z
000BC4 0CC4 0E4D             7      LD  C,04DH      ;(BDOS)ファイル・サブディレクトリの削除
000BC6 0CC6 CD0500          17      CALL    SYSTEM
000BC9 0CC9 C6FF             7      ADD A,0FFH
000BCB 0CCB D8              11      RET C
000BCC 0CCC 18DA            12      JR  SHOW_OK
                                
       0CCE                     C_SET:
000BCE 0CCE CD0D0B          17      CALL    SPCUT
000BD1 0CD1 ED53E40C        20      LD  (CSET_PARAM),DE
       0CD5                     CSET2:
000BD5 0CD5 1A               7      LD  A,(DE)
000BD6 0CD6 FE20             7      CP  020H
000BD8 0CD8 3838            12      JR  C,CSET_LIST
000BDA 0CDA D63D             7      SUB '='
000BDC 0CDC 2803            12      JR  Z,CSET_SET
000BDE 0CDE 13               6      INC DE
000BDF 0CDF 18F4            12      JR  CSET2
       0CE1                     CSET_SET:
000BE1 0CE1 12               7      LD  (DE),A
000BE2 0CE2 13               6      INC DE
       0CE4                     CSET_PARAM  EQU $+1
000BE3 0CE3 210000          10      LD  HL,0
000BE6 0CE6 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000BE8 0CE8 CD0500          17      CALL    SYSTEM
       0CEB                     INIT_VAR:           ;環境変数の初期化
000BEB 0CEB 21B40F          10      LD  HL,N_DATE
000BEE 0CEE 11B90F          10      LD  DE,V_DATE
000BF1 0CF1 0610             7      LD  B,16
000BF3 0CF3 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000BF5 0CF5 CD0500          17      CALL    SYSTEM
                                
000BF8 0CF8 21D90F          10      LD  HL,N_TIME
000BFB 0CFB 11DE0F          10      LD  DE,V_TIME
000BFE 0CFE 0603             7      LD  B,3
000C00 0D00 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000C02 0D02 CD0500          17      CALL    SYSTEM
                                
000C05 0D05 21280F          10      LD  HL,N_APPEND
000C08 0D08 112F0F          10      LD  DE,V_APPEND
000C0B 0D0B 0640             7      LD  B,PATHX
000C0D 0D0D 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000C0F 0D0F C30500          10      JP  SYSTEM
                                
       0D12                     CSET_LIST:
000C12 0D12 3E0A             7      LD  A,10
000C14 0D14 32E211          13      LD  (CSET_DATA),A
000C17 0D17 110100          10      LD  DE,1
       0D1A                     CSET1:
000C1A 0D1A D5              11      PUSH    DE
000C1B 0D1B 016DFF          10      LD  BC,0FF6DH   ;_FENV 環境変数の検索
000C1E 0D1E 21E411          10      LD  HL,DATA_COM
000C21 0D21 3600            10      LD  (HL),0
000C23 0D23 CD0500          17      CALL    SYSTEM
000C26 0D26 B7               4      OR  A
000C27 0D27 2030            12      JR  NZ,CSET_ERROR
000C29 0D29 21E411          10      LD  HL,DATA_COM
000C2C 0D2C 7E               7      LD  A,(HL)
000C2D 0D2D B7               4      OR  A
000C2E 0D2E 2829            12      JR  Z,CSET_ERROR
000C30 0D30 CD4205          17      CALL    MSX
000C33 0D33 1E3D             7      LD  E,'='
000C35 0D35 CDDE09          17      CALL    _PRINT
000C38 0D38 21E411          10      LD  HL,DATA_COM
000C3B 0D3B 11E412          10      LD  DE,DATA_COM+256
000C3E 0D3E 016BFF          10      LD  BC,0FF6BH   ;_GENV 環境変数の獲得
000C41 0D41 CD0500          17      CALL    SYSTEM
000C44 0D44 21E412          10      LD  HL,DATA_COM+256
000C47 0D47 CD4205          17      CALL    MSX
000C4A 0D4A CD8005          17      CALL    LTNL
000C4D 0D4D 3E0A             7      LD  A,10
000C4F 0D4F 32E211          13      LD  (CSET_DATA),A
       0D52                     CSET_NEXT:
000C52 0D52 D1              10      POP DE
000C53 0D53 13               6      INC DE
000C54 0D54 7A               4      LD  A,D
000C55 0D55 B3               4      OR  E
000C56 0D56 20C2            12      JR  NZ,CSET1
000C58 0D58 C9              10      RET
       0D59                     CSET_ERROR:
000C59 0D59 21E211          10      LD  HL,CSET_DATA
000C5C 0D5C 35              11      DEC (HL)
000C5D 0D5D 20F3            12      JR  NZ,CSET_NEXT
       0D5F                     CSET_END:
000C5F 0D5F D1              10      POP DE
000C60 0D60 C9              10      RET
                                
       0D61                     C_FORMAT:
000C61 0D61 3AE50F          13      LD  A,(IS_MSX)
000C64 0D64 B7               4      OR  A
000C65 0D65 C8              11      RET Z
000C66 0D66 3AE60F          13      LD  A,(MAJOR_VER)
000C69 0D69 FE02             7      CP  2
000C6B 0D6B 300B            12      JR  NC,FORMAT2
       0D6D                     FORMAT1:
000C6D 0D6D FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000C71 0D71 DD214701        14      LD  IX,FORMAT
000C75 0D75 C31C00          10      JP  CALSLT
       0D78                     FORMAT2:
000C78 0D78 CD7507          17      CALL    SETFCB
000C7B 0D7B 3A5C00          13      LD  A,(FCB1)
000C7E 0D7E B7               4      OR  A
000C7F 0D7F 28EC            12      JR  Z,FORMAT1
000C81 0D81 47               4      LD  B,A
000C82 0D82 AF               4      XOR A
000C83 0D83 0E67             7      LD  C,067H      ;(_FORMAT)ディスクのフォーマット
000C85 0D85 CD0500          17      CALL    SYSTEM
000C88 0D88 B7               4      OR  A
000C89 0D89 20E2            12      JR  NZ,FORMAT1
000C8B 0D8B CD4B05          17      CALL    MSXSLT
000C8E 0D8E 21E20F          10      LD  HL,PROMPT
000C91 0D91 CD4205          17      CALL    MSX
       0D94                     FORMAT3:
000C94 0D94 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力(_INNOE)
000C96 0D96 CD0500          17      CALL    SYSTEM
000C99 0D99 D631             7      SUB '0'+1
000C9B 0D9B 38F7            12      JR  C,FORMAT3
000C9D 0D9D 3C               4      INC A
000C9E 0D9E FE0A             7      CP  10
000CA0 0DA0 30F2            12      JR  NC,FORMAT3
000CA2 0DA2 F5              11      PUSH    AF
000CA3 0DA3 CD8005          17      CALL    LTNL
000CA6 0DA6 21DD0E          10      LD  HL,PAUSE
000CA9 0DA9 CD4205          17      CALL    MSX
000CAC 0DAC 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力(_INNOE)
000CAE 0DAE CD0500          17      CALL    SYSTEM
000CB1 0DB1 CD8005          17      CALL    LTNL
000CB4 0DB4 F1              10      POP AF
000CB5 0DB5 ED4B5B00        20      LD  BC,(FCB1-1)
000CB9 0DB9 210080          10      LD  HL,08000H
000CBC 0DBC 110040          10      LD  DE,04000H
000CBF 0DBF 0E67             7      LD  C,067H      ;(_FORMAT)ディスクのフォーマット
000CC1 0DC1 C30500          10      JP  SYSTEM
                                
       0DC4                     C_RAMDISK:
000CC4 0DC4 3AE50F          13      LD  A,(IS_MSX)
000CC7 0DC7 B7               4      OR  A
000CC8 0DC8 C8              11      RET Z
000CC9 0DC9 3AE60F          13      LD  A,(MAJOR_VER)
000CCC 0DCC FE02             7      CP  2
000CCE 0DCE D8              11      RET C
000CCF 0DCF CD0D0B          17      CALL    SPCUT
000CD2 0DD2 1A               7      LD  A,(DE)
000CD3 0DD3 FE30             7      CP  '0'
000CD5 0DD5 D8              11      RET C
000CD6 0DD6 FE3A             7      CP  '9'+1
000CD8 0DD8 3F               4      CCF
000CD9 0DD9 D8              11      RET C
000CDA 0DDA CDF90D          17      CALL    GETNUM
000CDD 0DDD 110F00          10      LD  DE,15       ;切り上げの為
000CE0 0DE0 19              11      ADD HL,DE
000CE1 0DE1 7D               4      LD  A,L
000CE2 0DE2 0604             7      LD  B,4     ;16で割る
       0DE4                     RAMDISK1:
000CE4 0DE4 CB3C             8      SRL H   ;/2
000CE6 0DE6 1F               4      RRA
000CE7 0DE7 10FB            13      DJNZ    RAMDISK1
000CE9 0DE9 FEFF             7      CP  0FFH
000CEB 0DEB 2001            12      JR  NZ,RAMDISK2
000CED 0DED 3D               4      DEC A
       0DEE                     RAMDISK2:
000CEE 0DEE 47               4      LD  B,A
000CEF 0DEF 0E68             7      LD  C,068H      ;(_RAMD)RAMディスクの作成あるいは消去
000CF1 0DF1 CD0500          17      CALL    SYSTEM
000CF4 0DF4 B7               4      OR  A
000CF5 0DF5 CCA80C          17      CALL    Z,SHOW_OK
000CF8 0DF8 C9              10      RET
                                
       0DF9                     GETNUM:
000CF9 0DF9 CD0D0B          17      CALL    SPCUT
000CFC 0DFC 210000          10      LD  HL,0
       0DFF                     GETNUM1:
000CFF 0DFF 1A               7      LD  A,(DE)
000D00 0E00 13               6      INC DE
000D01 0E01 D630             7      SUB '0'
000D03 0E03 D8              11      RET C
000D04 0E04 FE0A             7      CP  10
000D06 0E06 D0              11      RET NC
000D07 0E07 4D               4      LD  C,L
000D08 0E08 44               4      LD  B,H
000D09 0E09 29              11      ADD HL,HL   ;*2
000D0A 0E0A 29              11      ADD HL,HL   ;*4
000D0B 0E0B 09              11      ADD HL,BC   ;*5
000D0C 0E0C 29              11      ADD HL,HL   ;*10
000D0D 0E0D 4F               4      LD  C,A
000D0E 0E0E 0600             7      LD  B,0
000D10 0E10 09              11      ADD HL,BC
000D11 0E11 18EC            12      JR  GETNUM1
                                
       0E13                     CHDIR:
000D13 0E13 3AE60F          13      LD  A,(MAJOR_VER)
000D16 0E16 FE02             7      CP  2
000D18 0E18 D8              11      RET C
000D19 0E19 C5              11      PUSH    BC
000D1A 0E1A E5              11      PUSH    HL
000D1B 0E1B 0E5A             7      LD  C,05AH      ;(BDOS)_CHDIR カレントディレクトリの変更
000D1D 0E1D CD0500          17      CALL    SYSTEM
000D20 0E20 E1              10      POP HL
000D21 0E21 C1              10      POP BC
000D22 0E22 C9              10      RET
                                
       0011                     COMS    EQU 17
       0E23                     COMTB:
000D23 0E23 44202020202020          DB  "D      "   ;1
000D2A 0E2A C104                    DW  C_DIR
000D2C 0E2C 44495220202020          DB  "DIR    "   ;2
000D33 0E33 C104                    DW  C_DIR
000D35 0E35 434F5059202020          DB  "COPY   "   ;3
000D3C 0E3C BE07                    DW  C_COPY
000D3E 0E3E 43442020202020          DB  "CD     "   ;4
000D45 0E45 2D03                    DW  C_CD
000D47 0E47 44454C20202020          DB  "DEL    "   ;5
000D4E 0E4E 6004                    DW  C_DEL
000D50 0E50 50415448202020          DB  "PATH   "   ;6
000D57 0E57 8A05                    DW  C_PATH
000D59 0E59 52454E20202020          DB  "REN    "   ;7
000D60 0E60 9304                    DW  C_REN
000D62 0E62 54595045202020          DB  "TYPE   "   ;8
000D69 0E69 7409                    DW  C_TYPE
000D6B 0E6B 52454D20202020          DB  "REM    "   ;9
000D72 0E72 5E04                    DW  C_REM
000D74 0E74 4D4F4445202020          DB  "MODE   "   ;10
000D7B 0E7B 250C                    DW  C_MODE
000D7D 0E7D 50415553452020          DB  "PAUSE  "   ;11
000D84 0E84 720C                    DW  C_PAUSE
000D86 0E86 53455420202020          DB  "SET    "   ;12
000D8D 0E8D CE0C                    DW  C_SET
000D8F 0E8F 4543484F202020          DB  "ECHO   "   ;13
000D96 0E96 8D0C                    DW  C_ECHO
000D98 0E98 4D4B4449522020          DB  "MKDIR  "   ;14
000D9F 0E9F 970C                    DW  C_MKDIR
000DA1 0EA1 524D4449522020          DB  "RMDIR  "   ;15
000DA8 0EA8 B30C                    DW  C_RMDIR
000DAA 0EAA 464F524D415420          DB  "FORMAT "   ;16
000DB1 0EB1 610D                    DW  C_FORMAT
000DB3 0EB3 52414D4449534B          DB  "RAMDISK"   ;17
000DBA 0EBA C40D                    DW  C_RAMDISK
                                
000DBC 0EBC 2062797465732066    FREE:   DB  " bytes free  $"
            726565202024        
000DCA 0ECA 2020203C4449523E    DIRMES: DB  "   <DIR>$"
            24                  
000DD3 0ED3 4F4B24              OK: DB  "OK$"
000DD6 0ED6 4572726F722124      COMERM: DB  "Error!$"
000DDD 0EDD 537472696B652061    PAUSE:  DB  "Strike any key when ready ",0
            6E79206B65792077    
            68656E2072656164    
            792000              
                                
       0EF8                     S_MONTH:
000DF8 0EF8 4A616E00                DB  "Jan",0
000DFC 0EFC 46656200                DB  "Feb",0
000E00 0F00 4D617200                DB  "Mar",0
000E04 0F04 41707200                DB  "Apr",0
000E08 0F08 4D617900                DB  "May",0
000E0C 0F0C 4A756E00                DB  "Jun",0
000E10 0F10 4A756C00                DB  "Jul",0
000E14 0F14 41756700                DB  "Aug",0
000E18 0F18 53657000                DB  "Sep",0
000E1C 0F1C 4F637400                DB  "Oct",0
000E20 0F20 4E6F7600                DB  "Nov",0
000E24 0F24 44656300                DB  "Dec",0
                                
       0F28                     N_APPEND:
000E28 0F28 415050454E4400          DB  "APPEND",0
       0F2F                     V_APPEND:
000E2F 0F2F                         DS  64
       0F6F                     N_PATH:
000E6F 0F6F 5041544800              DB  "PATH",0
       0F74                     V_PATH:
000E74 0F74                         DS  PATHX
       0FB4                     N_DATE:
000EB4 0FB4 4441544500              DB  "DATE",0
       0FB9                     V_DATE:
000EB9 0FB9 79792D6D6D2D6464        DB  "yy-mm-dd"
000EC1 0FC1                         DS  8
       0FC9                     V_DATE1:
000EC9 0FC9 6D6D2D64642D7979        DB  "mm-dd-yy"
       0FD1                     V_DATE2:
000ED1 0FD1 64642D6D6D2D7979        DB  "dd-mm-yy"
       0FD9                     N_TIME:
000ED9 0FD9 54494D4500              DB  "TIME",0
       0FDE                     V_TIME:
000EDE 0FDE 323400                  DB  "24",0
       0FE1                     F_TIME:
000EE1 0FE1 00                      DB  0
       0FE2                     PROMPT:
000EE2 0FE2 3F2000                  DB  "? ",0
       0FE5                     IS_MSX:
000EE5 0FE5 00                      DB  0
       0FE6                     MAJOR_VER:
000EE6 0FE6 00                      DB  0
       0FE7                     SEARCH_IX:
000EE7 0FE7                         DS  64  ;DOS2用
       1027                     HANDLE1:
000F27 1027 0000                    DW  0
       1029                     PATH_POS:
000F29 1029 0000                    DW  0
       102B                     PATH_DRV:
000F2B 102B 413A5C                  DB  "A:\\"
       102E                     PATH_CCP:
000F2E 102E                         DS  64  ;DOS2用
       106E                     PATH_PAR:
000F6E 106E                         DS  64  ;DOS2用
       10AE                     PATH_FN1:
000FAE 10AE                         DS  64  ;DOS2用
       10EE                     PATH_FN2:
000FEE 10EE                         DS  64  ;DOS2用
       112E                     CUR_DRV:
00102E 112E 413A5C                  DB  "A:\\"
       1131                     CUR_PATH:
001031 1131                         DS  64  ;DOS2用
       1171                     DOS2NAME:
001071 1171                         DS  2+8+3+1 ;DOS2用
       117F                     DTA_CCP:
00107F 117F                         DS  37
       11A4                     DIR_CK:
0010A4 11A4 0000                    DW  0
                                
       11A6                     CPBUF:
0010A6 11A6 0000                LEFTX:  DW  0
0010A8 11A8 0000                DTAX:   DW  0
0010AA 11AA 20                      DB  020H    ;CPBUFで使う
0010AB 11AB 20                      DB  020H
0010AC 11AC 20                      DB  020H
0010AD 11AD 20                      DB  020H
0010AE 11AE 20                      DB  020H
0010AF 11AF 20                      DB  020H
0010B0 11B0 20                      DB  020H
                                
       11B1                     DECBF:
0010B1 11B1                         DS  5
       11B6                     FCB_BAT2:
0010B6 11B6 00                      DB  0
       11B7                     FDRV:
0010B7 11B7 00                      DB  0
       11B8                     FNAME:
0010B8 11B8                         DS  37
       11DD                     ZERO:
0010DD 11DD 00                      DB  0
       11DE                     FCB_BAT:
0010DE 11DE B611                    DW  FCB_BAT2
       11E0                     X_PATH:
0010E0 11E0 0000                    DW  0
       11E2                     CSET_DATA:
0010E2 11E2 00                      DB  0
       11E3                     PROCESS:
0010E3 11E3 00                      DB  0
                                
       11E4                     DATA_COM:
[EOF:COMMAND.ASM:SHIFT_JIS]
