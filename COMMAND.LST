                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                
                                ;   似非COMMAND.COM
                                
       0005                     SYSTEM  EQU 00005H
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
       001C                     CALSLT  EQU 0001CH
       006C                     INITXT  EQU 0006CH
       006F                     INIT32  EQU 0006FH
       0078                     SETTXT  EQU 00078H
       007B                     SETT32  EQU 0007BH
                                
       F3AE                     LINL40  EQU 0F3AEH
       F3AF                     LINL32  EQU 0F3AFH
       F3B0                     LINLEN  EQU 0F3B0H
       F55E                     BUF EQU 0F55EH
       FAF8                     EXBRSA  EQU 0FAF8H
       FC9B                     INTFLG  EQU 0FC9BH
       FCC1                     EXPTBL  EQU 0FCC1H
                                
                                
       0040                     PATHX   EQU 64
                                
       8000                     DATA    EQU 08000H
                                
000000 0100                         ORG 0100H
000000 0100 C31501          10      JP  START
000003 0103 0D0A434F4D4D414E    VER:    DB  00DH,00AH,"COMMAND v0.11",00DH,00AH,'$'
            442076302E31310D    
            0A24                
       0115                     START:
000015 0115 ED7B0600        20      LD  SP,(SYSTEM+1)
000019 0119 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
00001B 011B CD0500          17      CALL    SYSTEM
00001E 011E D8              11      RET C
00001F 011F 211D01          10      LD  HL,0011DH
000022 0122 ED42            15      SBC HL,BC
000024 0124 78               4      LD  A,B
000025 0125 32870D          13      LD  (MAJOR_VER),A
000028 0128 B5               4      OR  L
000029 0129 32860D          13      LD  (IS_MSX),A
00002C 012C B7               4      OR  A
00002D 012D 282E            12      JR  Z,WSTART
                                
00002F 012F 3A860E          13      LD  A,(PROCESS)
000032 0132 0E61             7      LD  C,61H       ;(BDOS)親プロセスに戻る
000034 0134 47               4      LD  B,A
000035 0135 B7               4      OR  A
000036 0136 C40500          17      CALL    NZ,SYSTEM
000039 0139 AF               4      XOR A
00003A 013A 32860E          13      LD  (PROCESS),A
                                
00003D 013D CD670B          17      CALL    INIT_VAR
                                
000040 0140 2A0600          16      LD  HL,(SYSTEM+1)
000043 0143 2EDB             7      LD  L,256-37
000045 0145 24               4      INC H
000046 0146 22810E          16      LD  (FCB_BAT),HL
000049 0149 3A8000          13      LD  A,(DTA1)
00004C 014C B7               4      OR  A
00004D 014D 280E            12      JR  Z,WSTART
00004F 014F 110301          10      LD  DE,VER
000052 0152 0E09             7      LD  C,9
000054 0154 CD0500          17      CALL    SYSTEM
000057 0157 118100          10      LD  DE,DTA1+1
00005A 015A CDAB01          17      CALL    COMANL
       015D                     WSTART:
00005D 015D 21DC0C          10      LD  HL,N_APPEND
000060 0160 11E30C          10      LD  DE,V_APPEND
000063 0163 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000065 0165 CD0500          17      CALL    SYSTEM
                                
000068 0168 CDB404          17      CALL    LTNL
       016B                     COMMAND:
00006B 016B E5              11      PUSH    HL
00006C 016C 2A810E          16      LD  HL,(FCB_BAT)
00006F 016F 7E               7      LD  A,(HL)
000070 0170 E1              10      POP HL
000071 0171 B7               4      OR  A
000072 0172 C27703          10      JP  NZ,C_BAT1
000075 0175 CDA202          17      CALL    SETDTA1
000078 0178 D5              11      PUSH    DE
000079 0179 C5              11      PUSH    BC
00007A 017A E5              11      PUSH    HL
00007B 017B 0E19             7      LD  C,019H      ;(BDOS)_CURDRV デフォルトドライブの獲得
00007D 017D CD0500          17      CALL    SYSTEM
000080 0180 E1              10      POP HL
000081 0181 C1              10      POP BC
000082 0182 C641             7      ADD A,'A'
000084 0184 5F               4      LD  E,A
000085 0185 CD9E08          17      CALL    _PRINT
000088 0188 1E3E             7      LD  E,'>'
00008A 018A CD9E08          17      CALL    _PRINT
00008D 018D D1              10      POP DE      ;DE=DTA1
00008E 018E 3E50             7      LD  A,80
000090 0190 12               7      LD  (DE),A
000091 0191 0E0A             7      LD  C,0AH       ;(BDOS)文字列入力
000093 0193 CD0500          17      CALL    SYSTEM
000096 0196 CDB404          17      CALL    LTNL
       0199                     COMMAND2:
000099 0199 118200          10      LD  DE,DTA1+2
00009C 019C CDAB01          17      CALL    COMANL
00009F 019F 30CA            12      JR  NC,COMMAND
0000A1 01A1 118A0C          10      LD  DE,COMERM
0000A4 01A4 0E09             7      LD  C,9     ;(BDOS)文字列出力
0000A6 01A6 CD0500          17      CALL    SYSTEM
0000A9 01A9 18B2            12      JR  WSTART
                                
       01AB                     COMANL:
0000AB 01AB CDD309          17      CALL    TOZERO
0000AE 01AE CDF008          17      CALL    FILE
0000B1 01B1 D5              11      PUSH    DE
0000B2 01B2 115B0E          10      LD  DE,FNAME
0000B5 01B5 1A               7      LD  A,(DE)
0000B6 01B6 FE20             7      CP  020H
0000B8 01B8 285C            12      JR  Z,SDVSW
0000BA 01BA 1B               6      DEC DE
0000BB 01BB 1A               7      LD  A,(DE)
0000BC 01BC C6FF             7      ADD A,0FFH
0000BE 01BE 380A            12      JR  C,COMB
0000C0 01C0 13               6      INC DE
                                
0000C1 01C1 21070C          10      LD  HL,COMTB
0000C4 01C4 3E0F             7      LD  A,COMS
0000C6 01C6 47               4      LD  B,A
0000C7 01C7 CD250A          17      CALL    CPNAME
       01CA                     COMB:
0000CA 01CA D1              10      POP DE
0000CB 01CB D29D08          10      JP  NC,JP_HL
       01CE                     COMB2:
0000CE 01CE EB               4      EX  DE,HL
0000CF 01CF 221703          16      LD  (COMPAT+1),HL
0000D2 01D2 CDDA02          17      CALL    CEXE4
                                
0000D5 01D5 21230D          10      LD  HL,N_PATH
0000D8 01D8 11280D          10      LD  DE,V_PATH
0000DB 01DB 0640             7      LD  B,PATHX
0000DD 01DD 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
0000DF 01DF CD0500          17      CALL    SYSTEM
                                
0000E2 01E2 21280D          10      LD  HL,V_PATH
0000E5 01E5 22830E          16      LD  (X_PATH),HL
       01E8                     CEX1:
0000E8 01E8 2A830E          16      LD  HL,(X_PATH)
0000EB 01EB 7E               7      LD  A,(HL)
0000EC 01EC FE20             7      CP  020H
0000EE 01EE D8              11      RET C
       01EF                     CEX2:
0000EF 01EF 7E               7      LD  A,(HL)
0000F0 01F0 FE20             7      CP  020H
0000F2 01F2 3807            12      JR  C,CEX3
0000F4 01F4 FE3B             7      CP  ';'
0000F6 01F6 2803            12      JR  Z,CEX3
0000F8 01F8 23               6      INC HL
0000F9 01F9 18F4            12      JR  CEX2
       01FB                     CEX3:
0000FB 01FB 3600            10      LD  (HL),0
0000FD 01FD FE20             7      CP  020H
0000FF 01FF 3801            12      JR  C,CEX4
000101 0201 23               6      INC HL
       0202                     CEX4:
000102 0202 ED5B830E        20      LD  DE,(X_PATH)
000106 0206 22830E          16      LD  (X_PATH),HL
000109 0209 21DC0C          10      LD  HL,N_APPEND
00010C 020C 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
00010E 020E CD0500          17      CALL    SYSTEM
                                
000111 0211 CDDA02          17      CALL    CEXE4
000114 0214 18D2            12      JR  CEX1
                                
       0216                     SDVSW:
000116 0216 F1              10      POP AF
000117 0217 3A5A0E          13      LD  A,(FDRV)
00011A 021A 3D               4      DEC A
00011B 021B 5F               4      LD  E,A
00011C 021C 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
00011E 021E C3A902          10      JP  SYSTEM0
                                
       0221                     OPEN1_D2:           ;DOS2対応
000121 0221 3A870D          13      LD  A,(MAJOR_VER)
000124 0224 FE02             7      CP  2
000126 0226 382C            12      JR  C,OPEN1
                                
000128 0228 11C80D          10      LD  DE,PATH_CCP
00012B 022B DD21880D        14      LD  IX,SEARCH_IX
00012F 022F 014010          10      LD  BC,01040H   ;(BDOS)最初のエントリ検索
000132 0232 CD0500          17      CALL    SYSTEM
       0235                     FIB2DIRENT:
000135 0235 B7               4      OR  A
000136 0236 C0              11      RET NZ
                                
000137 0237 11890D          10      LD  DE,SEARCH_IX+1
00013A 023A 21250E          10      LD  HL,DTA_CCP+1
00013D 023D 0E5C             7      LD  C,05CH      ;(BDOS)ファイル名の解析
00013F 023F CD0500          17      CALL    SYSTEM
                                
000142 0242 21960D          10      LD  HL,SEARCH_IX+14
000145 0245 11300E          10      LD  DE,DTA_CCP+1+8+3
000148 0248 EDA0            16      LDI
00014A 024A 113B0E          10      LD  DE,DTA_CCP+1+8+3+1+10
00014D 024D 010A00          10      LD  BC,2+2+2+4  ;最終変更時刻+最終変更日付+開始クラスタ+ファイルサイズ
000150 0250 EDB0                    LDIR
000152 0252 AF               4      XOR A
000153 0253 C9              10      RET
                                
       0254                     OPEN1:
000154 0254 215A0E          10      LD  HL,FDRV
       0257                     OPEN:
000157 0257 0E11             7      LD  C,011H      ;(BDOS)最初のファイルの検索
       0259                     OPEN3:
000159 0259 D5              11      PUSH    DE
00015A 025A 11240E          10      LD  DE,DTA_CCP
00015D 025D CD9502          17      CALL    SETDTA
000160 0260 EB               4      EX  DE,HL
000161 0261 CD0500          17      CALL    SYSTEM
000164 0264 D1              10      POP DE
000165 0265 B7               4      OR  A
000166 0266 C9              10      RET
                                
       0267                     OPEN2_D2:           ;DOS2対応
000167 0267 3A870D          13      LD  A,(MAJOR_VER)
00016A 026A FE02             7      CP  2
00016C 026C 380B            12      JR  C,OPEN2
00016E 026E DD21880D        14      LD  IX,SEARCH_IX
000172 0272 0E41             7      LD  C,41H       ;(BDOS)次のエントリ検索
000174 0274 CD0500          17      CALL    SYSTEM
000177 0277 18BC            12      JR  FIB2DIRENT
       0279                     OPEN2:
000179 0279 0E12             7      LD  C,012H
00017B 027B 18DC            12      JR  OPEN3
                                
       027D                     DEFCB:              ;Z=Ok NZ=Error
00017D 027D 11240E          10      LD  DE,DTA_CCP
000180 0280 CDA702          17      CALL    SYSC0F
000183 0283 B7               4      OR  A
000184 0284 C0              11      RET NZ
                                
000185 0285 210100          10      LD  HL,1
000188 0288 22320E          16      LD  (DTA_CCP+14),HL
00018B 028B 2D               4      DEC L
00018C 028C 22450E          16      LD  (DTA_CCP+33),HL
00018F 028F 22470E          16      LD  (DTA_CCP+35),HL
       0292                     SETDTA100:
000192 0292 110080          10      LD  DE,DATA
       0295                     SETDTA:
000195 0295 C5              11      PUSH    BC
000196 0296 D5              11      PUSH    DE
000197 0297 E5              11      PUSH    HL
000198 0298 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
00019A 029A CD0500          17      CALL    SYSTEM
00019D 029D E1              10      POP HL
00019E 029E D1              10      POP DE
00019F 029F C1              10      POP BC
0001A0 02A0 AF               4      XOR A
0001A1 02A1 C9              10      RET
                                
       02A2                     SETDTA1:
0001A2 02A2 118000          10      LD  DE,DTA1
0001A5 02A5 18EE            12      JR  SETDTA
                                
       02A7                     SYSC0F:
0001A7 02A7 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       02A9                     SYSTEM0:
0001A9 02A9 CD0500          17      CALL    SYSTEM
0001AC 02AC B7               4      OR  A
0001AD 02AD C9              10      RET
                                
       02AE                     C_CD:
0001AE 02AE CDC208          17      CALL    FILEC_D2
0001B1 02B1 11C80D          10      LD  DE,PATH_CCP
0001B4 02B4 1A               7      LD  A,(DE)
0001B5 02B5 FE20             7      CP  020H
0001B7 02B7 3805            12      JR  C,PWD
0001B9 02B9 0E5A             7      LD  C,5AH       ;(BDOS)_CHDIR カレントディレクトリの変更
0001BB 02BB C30500          10      JP  SYSTEM
       02BE                     PWD:
0001BE 02BE CDFA04          17      CALL    PUTDRV
0001C1 02C1 3E5C             7      LD  A,05CH
0001C3 02C3 CDAF08          17      CALL    MSG_A
0001C6 02C6 C36E04          10      JP  PDSKF2
                                
       02C9                     S27DTA:
0001C9 02C9 110100          10      LD  DE,1
0001CC 02CC ED53320E        20      LD  (DTA_CCP+14),DE
0001D0 02D0 11240E          10      LD  DE,DTA_CCP
       02D3                     S27:
0001D3 02D3 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
0001D5 02D5 CD0500          17      CALL    SYSTEM
0001D8 02D8 B7               4      OR  A
0001D9 02D9 C9              10      RET
                                
       02DA                     CEXE4:
0001DA 02DA 215A0E          10      LD  HL,FDRV
0001DD 02DD 11240E          10      LD  DE,DTA_CCP
0001E0 02E0 010900          10      LD  BC,1+8
0001E3 02E3 EDB0                    LDIR
0001E5 02E5 212D0E          10      LD  HL,DTA_CCP+9
0001E8 02E8 3643            10      LD  (HL),'C'
0001EA 02EA 23               6      INC HL
0001EB 02EB 364F            10      LD  (HL),'O'
0001ED 02ED 23               6      INC HL
0001EE 02EE 364D            10      LD  (HL),'M'
       02F0                     C_EXE:
0001F0 02F0 CD7D02          17      CALL    DEFCB
0001F3 02F3 205A            12      JR  NZ,C_BAT
0001F5 02F5 11870E          10      LD  DE,DATA_COM
0001F8 02F8 CD9502          17      CALL    SETDTA
                                
0001FB 02FB 2A0600          16      LD  HL,(SYSTEM+1)
0001FE 02FE 11870E          10      LD  DE,DATA_COM
000201 0301 ED52            15      SBC HL,DE
                                
000203 0303 CDC902          17      CALL    S27DTA
000206 0306 3D               4      DEC A
000207 0307 37               4      SCF
000208 0308 C0              11      RET NZ
000209 0309 7C               4      LD  A,H
00020A 030A B5               4      OR  L
00020B 030B 37               4      SCF
00020C 030C C8              11      RET Z
00020D 030D 224903          16      LD  (COMSIZ+1),HL
                                
000210 0310 11870E          10      LD  DE,DATA_COM
000213 0313 CD9502          17      CALL    SETDTA
000216 0316 110000          10  COMPAT: LD  DE,0
000219 0319 CDA906          17      CALL    SETFCB
                                
00021C 031C 21DC0C          10      LD  HL,N_APPEND
00021F 031F 11E30C          10      LD  DE,V_APPEND
000222 0322 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000224 0324 CD0500          17      CALL    SYSTEM
                                
000227 0327 0E60             7      LD  C,60H       ;(BDOS)子プロセスの起動
000229 0329 CD0500          17      CALL    SYSTEM
00022C 032C B7               4      OR  A
00022D 032D 2004            12      JR  NZ,COMP1
00022F 032F 78               4      LD  A,B
000230 0330 32860E          13      LD  (PROCESS),A
       0333                     COMP1:
000233 0333 AF               4      XOR A
000234 0334 67               4      LD  H,A
000235 0335 6F               4      LD  L,A ;HL=0x0000
000236 0336 F3               4      DI
000237 0337 ED7B0600        20  SPPAT:  LD  SP,(SYSTEM+1)
00023B 033B E5              11      PUSH    HL
00023C 033C 21EDB0          10      LD  HL,0B0EDH   ;LDIR
00023F 033F 22FE00          16      LD  (000FEH),HL
000242 0342 21870E          10      LD  HL,DATA_COM
000245 0345 110001          10      LD  DE,00100H
000248 0348 010000          10  COMSIZ: LD  BC,0
00024B 034B FB               4      EI
00024C 034C C3FE00          10      JP  000FEH
                                
       034F                     C_BAT:
00024F 034F 212D0E          10      LD  HL,DTA_CCP+9
000252 0352 3642            10      LD  (HL),'B'
000254 0354 23               6      INC HL
000255 0355 3641            10      LD  (HL),'A'
000257 0357 23               6      INC HL
000258 0358 3654            10      LD  (HL),'T'
                                
00025A 035A CD7D02          17      CALL    DEFCB
00025D 035D C0              11      RET NZ
                                
00025E 035E 21240E          10      LD  HL,DTA_CCP
000261 0361 7E               7      LD  A,(HL)
000262 0362 B7               4      OR  A
000263 0363 2009            12      JR  NZ,CBAT_DS
000265 0365 E5              11      PUSH    HL
000266 0366 0E19             7      LD  C,019H      ;(BDOS)カレントドライブ番号の獲得(_CURDRV)
000268 0368 CD0500          17      CALL    SYSTEM
00026B 036B E1              10      POP HL
00026C 036C 3C               4      INC A
00026D 036D 77               7      LD  (HL),A
       036E                     CBAT_DS:
00026E 036E ED5B810E        20      LD  DE,(FCB_BAT)
000272 0372 012500          10      LD  BC,37
000275 0375 EDB0                    LDIR
       0377                     C_BAT1:
000277 0377 CD9202          17      CALL    SETDTA100
00027A 037A CDB803          17      CALL    FGETC_BAT
00027D 037D 218100          10      LD  HL,DTA1+1
000280 0380 202A            12      JR  NZ,END_BATCH
000282 0382 FE21             7      CP  021H        ;スペースや改行など制御文字を飛ばす
000284 0384 38F1            12      JR  C,C_BAT1
000286 0386 3620            10      LD  (HL),' '
000288 0388 23               6      INC HL
       0389                     C_BAT2:
000289 0389 77               7      LD  (HL),A
00028A 038A 23               6      INC HL
00028B 038B 7D               4      LD  A,L
00028C 038C 3C               4      INC A       ;L==0FFH
00028D 038D 2809            12      JR  Z,RUN_BATCH
00028F 038F CDB803          17      CALL    FGETC_BAT
000292 0392 2004            12      JR  NZ,RUN_BATCH
000294 0394 FE20             7      CP  020H
000296 0396 30F1            12      JR  NC,C_BAT2
       0398                     RUN_BATCH:
000298 0398 7D               4      LD  A,L
000299 0399 D67F             7      SUB DTA1-1
00029B 039B 328000          13      LD  (DTA1),A
00029E 039E FE04             7      CP  4
0002A0 03A0 380A            12      JR  C,END_BATCH
0002A2 03A2 3600            10      LD  (HL),0
0002A4 03A4 3A9BFC          13      LD  A,(INTFLG)
0002A7 03A7 FE03             7      CP  3
0002A9 03A9 C29901          10      JP  NZ,COMMAND2
       03AC                     END_BATCH:      ;バッチファイルを閉じる
0002AC 03AC 2A810E          16      LD  HL,(FCB_BAT)
0002AF 03AF 3600            10      LD  (HL),0
0002B1 03B1 ED7B0600        20      LD  SP,(SYSTEM+1)
0002B5 03B5 C35D01          10      JP  WSTART
                                
       03B8                     FGETC_BAT:
0002B8 03B8 ED5B810E        20      LD  DE,(FCB_BAT)
       03BC                     FGETC:              ;1文字ずつ読み込む
0002BC 03BC E5              11      PUSH    HL      ;Z:成功
0002BD 03BD 210100          10      LD  HL,1
0002C0 03C0 CDD302          17      CALL    S27
0002C3 03C3 E1              10      POP HL
0002C4 03C4 3A0080          13      LD  A,(DATA)
0002C7 03C7 C9              10      RET
                                
       03C8                     C_REM:
0002C8 03C8 AF               4      XOR A
0002C9 03C9 C9              10      RET
                                
       03CA                     C_DEL:
0002CA 03CA CDA906          17      CALL    SETFCB
0002CD 03CD 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力
0002CF 03CF CD0500          17      CALL    SYSTEM
                                
0002D2 03D2 0E13             7      LD  C,013H
0002D4 03D4 1811            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       03D6                     C_REN:
0002D6 03D6 3A870D          13      LD  A,(MAJOR_VER)
0002D9 03D9 FE02             7      CP  2
0002DB 03DB 3013            12      JR  NC,REN_DOS2
0002DD 03DD CDA906          17      CALL    SETFCB
0002E0 03E0 3E10             7      LD  A,010H      ;ディレクトリも対象にする(LSX-Dodgers)
0002E2 03E2 326900          13      LD  (FCB1+13),A ;属性
0002E5 03E5 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       03E7                     CDEL1:
0002E7 03E7 115C00          10      LD  DE,FCB1
       03EA                     REN2:
0002EA 03EA CD0500          17      CALL    SYSTEM
0002ED 03ED C6FF             7      ADD A,0FFH
0002EF 03EF C9              10      RET
                                
       03F0                     REN_DOS2:           ;DOS2のリネーム(ディレクトリ対応)
0002F0 03F0 CDCD09          17      CALL    SPCUT
0002F3 03F3 6B               4      LD  L,E
0002F4 03F4 62               4      LD  H,D
       03F5                     REN_D2_1:
0002F5 03F5 7E               7      LD  A,(HL)
0002F6 03F6 FE21             7      CP  020H+1
0002F8 03F8 3803            12      JR  C,REN_D2_2
0002FA 03FA 23               6      INC HL
0002FB 03FB 18F8            12      JR  REN_D2_1
       03FD                     REN_D2_2:
0002FD 03FD 3600            10      LD  (HL),0
0002FF 03FF 23               6      INC HL
000300 0400 0E4E             7      LD  C,04EH      ;(BDOS)ファイルあるいはサブディレクトリ名の変更(_RENAME)
000302 0402 18E6            12      JR  REN2
                                
       0404                     C_DIR:
000304 0404 CDC208          17      CALL    FILEC_D2
000307 0407 215B0E          10      LD  HL,FDRV+1
00030A 040A CD8308          17      CALL    CWILD1
00030D 040D 3EF1             7      LD  A,0F1H
00030F 040F 32670E          13      LD  (FDRV+13),A
000312 0412 CD2102          17      CALL    OPEN1_D2
       0415                     CDIR1:
000315 0415 B7               4      OR  A
000316 0416 2008            12      JR  NZ,PDSKF
000318 0418 CD8C04          17      CALL    P_NAME
00031B 041B CD6702          17      CALL    OPEN2_D2
00031E 041E 18F5            12      JR  CDIR1
                                
       0420                     PDSKF:
000320 0420 3A5A0E          13      LD  A,(FDRV)
000323 0423 5F               4      LD  E,A
000324 0424 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
000326 0426 CD0500          17      CALL    SYSTEM
000329 0429 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
00032A 042A C601             7      ADD A,001H
00032C 042C D8              11      RET C       ;Aが0FFHだった場合
00032D 042D 3E06             7      LD  A,8-2
       042F                     PDS1:               ;HL=未使用クラスタの総数
00032F 042F 3C               4      INC A
000330 0430 CB19             8      RR  C
000332 0432 30FB            12      JR  NC,PDS1
       0434                     PDS2:               ;B←論理セクタのサイズの上位8ビット
000334 0434 3C               4      INC A
000335 0435 CB18             8      RR  B
000337 0437 30FB            12      JR  NC,PDS2
000339 0439 47               4      LD  B,A
                                
00033A 043A 110000          10      LD  DE,0
       043D                     PDS3:
00033D 043D 29              11      ADD HL,HL
00033E 043E EB               4      EX  DE,HL
00033F 043F ED6A            15      ADC HL,HL
000341 0441 EB               4      EX  DE,HL
000342 0442 10F9            13      DJNZ    PDS3
       0444                     PDSKF1:
000344 0444 CD1A05          17      CALL    PRDEC_DEHL
000347 0447 11700C          10      LD  DE,FREE
00034A 044A 0E09             7      LD  C,9     ;(BDOS)文字列出力
00034C 044C CD0500          17      CALL    SYSTEM
00034F 044F CDFA04          17      CALL    PUTDRV
000352 0452 3E5C             7      LD  A,05CH
000354 0454 CDAF08          17      CALL    MSG_A
000357 0457 3A870D          13      LD  A,(MAJOR_VER)
00035A 045A FE01             7      CP  1
00035C 045C 3856            12      JR  C,LTNL
00035E 045E 200E            12      JR  NZ,PDSKF2
000360 0460 2A680E          16      LD  HL,(FDRV+14)
000363 0463 AF               4      XOR A
000364 0464 11FEFF          10      LD  DE,0-2
000367 0467 19              11      ADD HL,DE
000368 0468 23               6      INC HL
000369 0469 DC1605          17      CALL    C,PRDEC_HL
00036C 046C 1846            12      JR  LTNL
       046E                     PDSKF2:             ;MSX-DOS2
00036E 046E 3A5A0E          13      LD  A,(FDRV)
000371 0471 47               4      LD  B,A     ;ドライブ
000372 0472 110080          10      LD  DE,DATA
000375 0475 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
000377 0477 CD0500          17      CALL    SYSTEM
00037A 047A 210080          10      LD  HL,DATA
                                
00037D 047D CD8604          17      CALL    MSX
000380 0480 1832            12      JR  LTNL
                                
       0482                     MSX1:
000382 0482 5F               4      LD  E,A
000383 0483 CD9E08          17      CALL    _PRINT
       0486                     MSX:
000386 0486 7E               7      LD  A,(HL)
000387 0487 23               6      INC HL
000388 0488 B7               4      OR  A
000389 0489 20F7            12      JR  NZ,MSX1
00038B 048B C9              10      RET
                                
       048C                     P_NAME:
00038C 048C 21250E          10      LD  HL,DTA_CCP+1
00038F 048F 7E               7      LD  A,(HL)
000390 0490 FE2E             7      CP  '.'
000392 0492 C8              11      RET Z
000393 0493 CD7005          17      CALL    FPRNT
000396 0496 3A300E          13      LD  A,(DTA_CCP+12)
000399 0499 CB67             8      BIT 4,A
00039B 049B 280A            12      JR  Z,DIR3
00039D 049D 117E0C          10      LD  DE,DIRMES
0003A0 04A0 0E09             7      LD  C,9     ;(BDOS)文字列出力
0003A2 04A2 CD0500          17      CALL    SYSTEM
0003A5 04A5 180A            12      JR  DIR6
       04A7                     DIR3:
0003A7 04A7 ED5B430E        20      LD  DE,(DTA_CCP+1+01EH)
0003AB 04AB 2A410E          16      LD  HL,(DTA_CCP+1+01CH)
0003AE 04AE CD1A05          17      CALL    PRDEC_DEHL
       04B1                     DIR6:
0003B1 04B1 CD9205          17      CALL    PRTTMS
                                
       04B4                     LTNL:
0003B4 04B4 1E0D             7      LD  E,00DH
0003B6 04B6 CD9E08          17      CALL    _PRINT
0003B9 04B9 1E0A             7      LD  E,00AH
0003BB 04BB C39E08          10      JP  _PRINT
                                
       04BE                     C_PATH:
0003BE 04BE CDCD09          17      CALL    SPCUT
0003C1 04C1 FE21             7      CP  021H
0003C3 04C3 301C            12      JR  NC,CPATH0
                                
0003C5 04C5 21230D          10      LD  HL,N_PATH
0003C8 04C8 11280D          10      LD  DE,V_PATH
0003CB 04CB 0640             7      LD  B,PATHX
0003CD 04CD 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
0003CF 04CF CD0500          17      CALL    SYSTEM
0003D2 04D2 21280D          10      LD  HL,V_PATH
       04D5                     CPATHP:
0003D5 04D5 7E               7      LD  A,(HL)
0003D6 04D6 23               6      INC HL
0003D7 04D7 FE20             7      CP  020H
0003D9 04D9 3F               4      CCF
0003DA 04DA 30D8            12      JR  NC,LTNL
0003DC 04DC CDAF08          17      CALL    MSG_A
0003DF 04DF 18F4            12      JR  CPATHP
       04E1                     CPATH0:
0003E1 04E1 21280D          10      LD  HL,V_PATH
0003E4 04E4 FE3B             7      CP  ';'
0003E6 04E6 2001            12      JR  NZ,CPATH1
0003E8 04E8 13               6      INC DE
       04E9                     CPATH1:
0003E9 04E9 EB               4      EX  DE,HL
0003EA 04EA 014000          10      LD  BC,PATHX
0003ED 04ED EDB0                    LDIR
                                
0003EF 04EF 21230D          10      LD  HL,N_PATH
0003F2 04F2 11280D          10      LD  DE,V_PATH
0003F5 04F5 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
0003F7 04F7 C30500          10      JP  SYSTEM
                                
       04FA                     PUTDRV:
0003FA 04FA 3A5A0E          13      LD  A,(FDRV)
0003FD 04FD B7               4      OR  A
0003FE 04FE 200C            12      JR  NZ,PUTDRV1
000400 0500 C5              11      PUSH    BC
000401 0501 D5              11      PUSH    DE
000402 0502 E5              11      PUSH    HL
000403 0503 0E19             7      LD  C,019H
000405 0505 CD0500          17      CALL    SYSTEM
000408 0508 E1              10      POP HL
000409 0509 D1              10      POP DE
00040A 050A C1              10      POP BC
00040B 050B 3C               4      INC A
       050C                     PUTDRV1:
00040C 050C C640             7      ADD A,'A'-1
00040E 050E CDAF08          17      CALL    MSG_A
000411 0511 3E3A             7      LD  A,':'
       0513                     MSG_AR:
000413 0513 C3AF08          10      JP  MSG_A
                                
       0516                     PRDEC_HL:
000416 0516 AF               4      XOR A
       0517                     PRDEC_AHL:
000417 0517 5F               4      LD  E,A
000418 0518 1600             7      LD  D,0
       051A                     PRDEC_DEHL:
00041A 051A 3E02             7      LD  A,2
00041C 051C 326505          13      LD  (DEC6+1),A
00041F 051F AF               4      XOR A
000420 0520 E5              11      PUSH    HL
000421 0521 21540E          10      LD  HL,DECBF
000424 0524 0605             7      LD  B,5
000426 0526 CD9409          17      CALL    FILL_MEMORY
000429 0529 E1              10      POP HL
                                
00042A 052A 0E20             7      LD  C,32
       052C                     DEC1:
00042C 052C 29              11      ADD HL,HL
00042D 052D EB               4      EX  DE,HL
00042E 052E ED6A            15      ADC HL,HL
000430 0530 EB               4      EX  DE,HL
000431 0531 E5              11      PUSH    HL
000432 0532 21580E          10      LD  HL,DECBF+4
000435 0535 0605             7      LD  B,5
       0537                     DEC2:
000437 0537 7E               7      LD  A,(HL)
000438 0538 8F               4      ADC A,A
000439 0539 27               4      DAA
00043A 053A 77               7      LD  (HL),A
00043B 053B 2B               6      DEC HL
00043C 053C 10F9            13      DJNZ    DEC2
00043E 053E E1              10      POP HL
00043F 053F 0D               4      DEC C
000440 0540 20EA            12      JR  NZ,DEC1
                                
000442 0542 21540E          10      LD  HL,DECBF
000445 0545 3E20             7      LD  A,020H
000447 0547 0604             7      LD  B,4
       0549                     DEC3:
000449 0549 CD5605          17      CALL    DEC4
00044C 054C CD5605          17      CALL    DEC4
00044F 054F 23               6      INC HL
000450 0550 10F7            13      DJNZ    DEC3
       0552                     DECX:
000452 0552 CD5605          17      CALL    DEC4
000455 0555 AF               4      XOR A
       0556                     DEC4:
000456 0556 ED6F            18      RLD
000458 0558 FE20             7      CP  020H
00045A 055A 2808            12      JR  Z,DEC6
00045C 055C F630             7      OR  030H
       055E                     DEC5:
00045E 055E 18B3            12      JR  MSG_AR
       0560                     DEC7:
000460 0560 3E20             7      LD  A,020H
000462 0562 18AF            12      JR  MSG_AR
       0564                     DEC6:
000464 0564 3E02             7      LD  A,2
000466 0566 B7               4      OR  A
000467 0567 28F7            12      JR  Z,DEC7
000469 0569 3D               4      DEC A
00046A 056A 326505          13      LD  (DEC6+1),A
00046D 056D 3E20             7      LD  A,020H
00046F 056F C9              10      RET
                                
       0570                     FPRNT:
000470 0570 0608             7      LD  B,8
000472 0572 CD8305          17      CALL    P_N1
000475 0575 7E               7      LD  A,(HL)
000476 0576 C680             7      ADD A,0A0H-020H
000478 0578 FEA0             7      CP  0A0H
00047A 057A 2802            12      JR  Z,FPR1
00047C 057C 3E2E             7      LD  A,'.'
       057E                     FPR1:
00047E 057E CDAF08          17      CALL    MSG_A
000481 0581 0603             7      LD  B,3
                                
       0583                     P_N1:
000483 0583 C5              11      PUSH    BC
000484 0584 E5              11      PUSH    HL
000485 0585 7E               7      LD  A,(HL)
000486 0586 CDEC09          17      CALL    CAP3
000489 0589 CDAF08          17      CALL    MSG_A
00048C 058C E1              10      POP HL
00048D 058D C1              10      POP BC
00048E 058E 23               6      INC HL
00048F 058F 10F2            13      DJNZ    P_N1
000491 0591 C9              10      RET
                                
       0592                     PRTTMS:
000492 0592 3E20             7      LD  A,020H
000494 0594 CDAF08          17      CALL    MSG_A
                                
000497 0597 2A3D0E          16      LD  HL,(DTA_CCP+1+24)
00049A 059A 7D               4      LD  A,L
00049B 059B B7               4      OR  A
00049C 059C C8              11      RET Z
00049D 059D CB3C             8      SRL H
00049F 059F 17               4      RLA
0004A0 05A0 17               4      RLA
0004A1 05A1 17               4      RLA
0004A2 05A2 17               4      RLA
0004A3 05A3 E60F             7      AND 00FH
0004A5 05A5 57               4      LD  D,A
0004A6 05A6 DD216D0D        14      LD  IX,V_DATE
       05AA                     PRTTMS1:
0004AA 05AA DD7E00          19      LD  A,(IX+0)
0004AD 05AD B7               4      OR  A
0004AE 05AE 2808            12      JR  Z,PRTTMS2
0004B0 05B0 CD3306          17      CALL    PR_DATE
0004B3 05B3 CD9E06          17      CALL    PR_DATE_SPLITER
0004B6 05B6 18F2            12      JR  PRTTMS1
       05B8                     PRTTMS2:
                                
0004B8 05B8 CD8E0A          17      CALL    GET_WIDTH
0004BB 05BB FE21             7      CP  32+1
0004BD 05BD 3005            12      JR  NC,SHOW_TIME
0004BF 05BF 3E1D             7      LD  A,01DH
0004C1 05C1 C3AF08          10      JP  MSG_A
       05C4                     SHOW_TIME:
0004C4 05C4 2A3B0E          16      LD  HL,(DTA_CCP+1+22)
                                
0004C7 05C7 3E20             7      LD  A,020H
0004C9 05C9 CDAF08          17      CALL    MSG_A
0004CC 05CC 7C               4      LD  A,H
0004CD 05CD 65               4      LD  H,L
0004CE 05CE 1F               4      RRA
0004CF 05CF CB1D             8      RR  L
0004D1 05D1 1F               4      RRA
0004D2 05D2 CB1D             8      RR  L
0004D4 05D4 1F               4      RRA
0004D5 05D5 CB1D             8      RR  L
0004D7 05D7 E61F             7      AND 01FH
0004D9 05D9 4F               4      LD  C,A
0004DA 05DA 3A820D          13      LD  A,(V_TIME)
0004DD 05DD FE31             7      CP  '1'
0004DF 05DF 79               4      LD  A,C
0004E0 05E0 200B            12      JR  NZ,TIME24
0004E2 05E2 FE0C             7      CP  12
0004E4 05E4 3802            12      JR  C,TIME12
0004E6 05E6 D60C             7      SUB 12
       05E8                     TIME12:
0004E8 05E8 B7               4      OR  A
0004E9 05E9 2002            12      JR  NZ,TIME24
0004EB 05EB C60C             7      ADD A,12
       05ED                     TIME24:
0004ED 05ED C5              11      PUSH    BC
0004EE 05EE CD1E06          17      CALL    PRDEC_A
0004F1 05F1 3E3A             7      LD  A,':'
0004F3 05F3 CDAF08          17      CALL    MSG_A
0004F6 05F6 7D               4      LD  A,L
0004F7 05F7 0F               4      RRCA
0004F8 05F8 0F               4      RRCA
0004F9 05F9 E63F             7      AND 03FH
0004FB 05FB CD1E06          17      CALL    PRDEC_A
                                
0004FE 05FE 3E3A             7      LD  A,':'
000500 0600 CDAF08          17      CALL    MSG_A
000503 0603 7C               4      LD  A,H
000504 0604 E61F             7      AND 01FH
000506 0606 87               4      ADD A,A
000507 0607 CD1E06          17      CALL    PRDEC_A
                                
00050A 060A 3A820D          13      LD  A,(V_TIME)
00050D 060D FE31             7      CP  '1'
00050F 060F C1              10      POP BC
000510 0610 C0              11      RET NZ
000511 0611 79               4      LD  A,C
000512 0612 1E61             7      LD  E,'a'
000514 0614 FE0C             7      CP  12
000516 0616 DA9E08          10      JP  C,_PRINT
000519 0619 1E70             7      LD  E,'p'
00051B 061B C39E08          10      JP  _PRINT
                                
                                ;   PRINT10
                                
       061E                     PRDEC_A:
00051E 061E E5              11      PUSH    HL
00051F 061F 0608             7      LD  B,8
000521 0621 4F               4      LD  C,A
000522 0622 AF               4      XOR A
       0623                     PRTA1:
000523 0623 CB01             4      RLC C
000525 0625 8F               4      ADC A,A
000526 0626 27               4      DAA
000527 0627 10FA            13      DJNZ    PRTA1
000529 0629 21540E          10      LD  HL,DECBF
00052C 062C 77               7      LD  (HL),A
00052D 062D AF               4      XOR A
00052E 062E CD5205          17      CALL    DECX
000531 0631 E1              10      POP HL
000532 0632 C9              10      RET
                                
       0633                     PR_DATE:
000533 0633 DD7E00          19      LD  A,(IX+0)
000536 0636 FE20             7      CP  020H
000538 0638 D8              11      RET C
000539 0639 CDE009          17      CALL    CAP
00053C 063C FE44             7      CP  'D'
00053E 063E 2848            12      JR  Z,PR_DAY
000540 0640 FE4D             7      CP  'M'
000542 0642 2820            12      JR  Z,PR_MONTH
000544 0644 FE59             7      CP  'Y'
000546 0646 2046            12      JR  NZ,PR_DATE1
000548 0648 4F               4      LD  C,A
000549 0649 DD7E02          19      LD  A,(IX+2)
00054C 064C CDE009          17      CALL    CAP
00054F 064F B9               4      CP  C
000550 0650 200A            12      JR  NZ,YEAR2
000552 0652 7C               4      LD  A,H     ;YEAR
000553 0653 C6EC             7      ADD A,80+256-100
000555 0655 3E13             7      LD  A,19
000557 0657 CE00             7      ADC A,0
000559 0659 CD1E06          17      CALL    PRDEC_A     ;年4桁
       065C                     YEAR2:
00055C 065C 7C               4      LD  A,H     ;YEAR
00055D 065D C650             7      ADD A,80
00055F 065F CD1E06          17      CALL    PRDEC_A
000562 0662 182A            12      JR  PR_DATE1
       0664                     PR_MONTH:
000564 0664 4F               4      LD  C,A
000565 0665 DD7E02          19      LD  A,(IX+2)
000568 0668 CDE009          17      CALL    CAP
00056B 066B B9               4      CP  C
00056C 066C 2014            12      JR  NZ,MONTH2
00056E 066E E5              11      PUSH    HL      ;月を文字列で表示 Jan等
00056F 066F D5              11      PUSH    DE
000570 0670 7A               4      LD  A,D
000571 0671 3D               4      DEC A
000572 0672 87               4      ADD A,A
000573 0673 87               4      ADD A,A
000574 0674 21AC0C          10      LD  HL,S_MONTH
000577 0677 1600             7      LD  D,0
000579 0679 5F               4      LD  E,A
00057A 067A 19              11      ADD HL,DE
00057B 067B CD8604          17      CALL    MSX
00057E 067E D1              10      POP DE
00057F 067F E1              10      POP HL
000580 0680 180C            12      JR  PR_DATE1
       0682                     MONTH2:
000582 0682 7A               4      LD  A,D     ;月を数字で表示
000583 0683 CD1E06          17      CALL    PRDEC_A
000586 0686 1806            12      JR  PR_DATE1
       0688                     PR_DAY:
000588 0688 7D               4      LD  A,L
000589 0689 E61F             7      AND 01FH
00058B 068B CD1E06          17      CALL    PRDEC_A
       068E                     PR_DATE1:
00058E 068E DD23            10      INC IX
000590 0690 DD7E00          19      LD  A,(IX+0)
000593 0693 CDE009          17      CALL    CAP
000596 0696 FE41             7      CP  'A'
000598 0698 D8              11      RET C
000599 0699 FE5B             7      CP  'Z'+1
00059B 069B 38F1            12      JR  C,PR_DATE1
00059D 069D C9              10      RET
       069E                     PR_DATE_SPLITER:
00059E 069E DD7E00          19      LD  A,(IX+0)
0005A1 06A1 FE20             7      CP  020H
0005A3 06A3 D8              11      RET C
0005A4 06A4 DD23            10      INC IX
0005A6 06A6 C3AF08          10      JP  MSG_A
                                
       06A9                     SETFCB:
0005A9 06A9 CDCD09          17      CALL    SPCUT
0005AC 06AC 1A               7      LD  A,(DE)
0005AD 06AD FE20             7      CP  020H
0005AF 06AF 3801            12      JR  C,SETFCBA
0005B1 06B1 1B               6      DEC DE
       06B2                     SETFCBA:
0005B2 06B2 D5              11      PUSH    DE
0005B3 06B3 215C00          10      LD  HL,FCB1
0005B6 06B6 115D00          10      LD  DE,FCB1+1
0005B9 06B9 012300          10      LD  BC,00023H
0005BC 06BC 70               7      LD  (HL),B      ;B=0
0005BD 06BD EDB0                    LDIR
0005BF 06BF D1              10      POP DE
0005C0 06C0 D5              11      PUSH    DE
0005C1 06C1 215C00          10      LD  HL,FCB1
0005C4 06C4 CD710A          17      CALL    _SYS29      ;ファイル名の解析
0005C7 06C7 216C00          10      LD  HL,FCB2
0005CA 06CA CD710A          17      CALL    _SYS29      ;ファイル名の解析
0005CD 06CD E1              10      POP HL
0005CE 06CE 010050          10      LD  BC,05000H
0005D1 06D1 118100          10      LD  DE,00081H
       06D4                     SETFCB1:
0005D4 06D4 7E               7      LD  A,(HL)
0005D5 06D5 23               6      INC HL
0005D6 06D6 FE20             7      CP  020H
0005D8 06D8 3805            12      JR  C,SETFCB2
0005DA 06DA 12               7      LD  (DE),A
0005DB 06DB 13               6      INC DE
0005DC 06DC 0C               4      INC C
0005DD 06DD 10F5            13      DJNZ    SETFCB1
       06DF                     SETFCB2:
0005DF 06DF 79               4      LD  A,C
0005E0 06E0 328000          13      LD  (DTA1),A
0005E3 06E3 04               4      INC B
0005E4 06E4 AF               4      XOR A
       06E5                     SETFCB3:
0005E5 06E5 12               7      LD  (DE),A
0005E6 06E6 13               6      INC DE
0005E7 06E7 10FC            13      DJNZ    SETFCB3
0005E9 06E9 C9              10      RET
                                
       06EA                     C_COPY:
0005EA 06EA CDA906          17      CALL    SETFCB
                                
0005ED 06ED 11800E          10      LD  DE,ZERO
0005F0 06F0 CDE808          17      CALL    FILEC2
0005F3 06F3 216C00          10      LD  HL,FCB2
0005F6 06F6 CD780A          17      CALL    S29X1
                                
0005F9 06F9 3E10             7      LD  A,010H
0005FB 06FB 326900          13      LD  (FCB1+13),A
0005FE 06FE 216D00          10      LD  HL,FCB2+1
000601 0701 CD8308          17      CALL    CWILD1
       0704                     COPY0:
000604 0704 CD8008          17      CALL    CWILD
000607 0707 215C00          10      LD  HL,FCB1
00060A 070A CD5702          17      CALL    OPEN
00060D 070D 37               4      SCF
       070E                     COPY1:
00060E 070E C0              11      RET NZ
00060F 070F CD7D02          17      CALL    DEFCB
                                
000612 0712 3A310E          13      LD  A,(DTA_CCP+13)
000615 0715 CB67             8      BIT 4,A
000617 0717 281E            12      JR  Z,COPY1A
                                
000619 0719 215D00          10      LD  HL,FCB1+1
00061C 071C CD190A          17      CALL    CHKWILD
00061F 071F 3811            12      JR  C,COPY9
                                
000621 0721 3E20             7      LD  A,020H
000623 0723 325D00          13      LD  (FCB1+1),A
000626 0726 2A3E0E          16      LD  HL,(DTA_CCP+26)
000629 0729 23               6      INC HL
00062A 072A 226A00          16      LD  (FCB1+14),HL
00062D 072D 18D5            12      JR  COPY0
                                
       072F                     COPY8:
00062F 072F CD240B          17      CALL    SHOW_OK
       0732                     COPY9:
000632 0732 CD7902          17      CALL    OPEN2
000635 0735 18D7            12      JR  COPY1
                                
       0737                     COPY1A:
000637 0737 216C00          10      LD  HL,FCB2
00063A 073A 115A0E          10      LD  DE,FDRV
00063D 073D 01260E          10      LD  BC,DTA_CCP+2
000640 0740 EDA0            16      LDI
000642 0742 3E0B             7      LD  A,11
       0744                     COPY2:
000644 0744 F5              11      PUSH    AF
000645 0745 7E               7      LD  A,(HL)
000646 0746 FE3F             7      CP  '?'
000648 0748 2001            12      JR  NZ,COPY3
00064A 074A 0A               7      LD  A,(BC)
       074B                     COPY3:
00064B 074B 12               7      LD  (DE),A
00064C 074C 03               6      INC BC
00064D 074D 13               6      INC DE
00064E 074E 23               6      INC HL
00064F 074F F1              10      POP AF
000650 0750 3D               4      DEC A
000651 0751 20F1            12      JR  NZ,COPY2
000653 0753 010500          10      LD  BC,16-11
000656 0756 EDB0                    LDIR
       0758                     PUTNAME:
000658 0758 215D00          10      LD  HL,FCB1+1
00065B 075B CD190A          17      CALL    CHKWILD
00065E 075E 300B            12      JR  NC,PUTN1
000660 0760 215B0E          10      LD  HL,FDRV+1
000663 0763 CD7005          17      CALL    FPRNT
000666 0766 3E20             7      LD  A,020H
000668 0768 CDAF08          17      CALL    MSG_A
       076B                     PUTN1:
00066B 076B 115A0E          10      LD  DE,FDRV
00066E 076E 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000670 0770 CDA902          17      CALL    SYSTEM0
000673 0773 C20E08          10      JP  NZ,COPYE2
000676 0776 67               4      LD  H,A     ;A=0
000677 0777 6F               4      LD  L,A
000678 0778 227B0E          16      LD  (FDRV+33),HL    ;(FCB)ランダム・レコード
00067B 077B 227D0E          16      LD  (FDRV+35),HL
00067E 077E 2C               4      INC L       ;HL=1
00067F 077F 22680E          16      LD  (FDRV+14),HL    ;(FCB)レコード・サイズ
       0782                     COPY6:
000682 0782 CD9208          17      CALL    BUFSIZ
000685 0785 CDC902          17      CALL    S27DTA
000688 0788 3C               4      INC A
000689 0789 287B            12      JR  Z,COPYE
00068B 078B 47               4      LD  B,A
00068C 078C 7C               4      LD  A,H
00068D 078D B5               4      OR  L
00068E 078E 280F            12      JR  Z,COPY7
000690 0790 115A0E          10      LD  DE,FDRV
000693 0793 C5              11      PUSH    BC
000694 0794 0E26             7      LD  C,026H      ;(BDOS)ランダム・ブロック・ライト
000696 0796 CD0500          17      CALL    SYSTEM
000699 0799 C1              10      POP BC
00069A 079A B7               4      OR  A
00069B 079B 2069            12      JR  NZ,COPYE
00069D 079D 10E3            13      DJNZ    COPY6
       079F                     COPY7:
00069F 079F 3A870D          13      LD  A,(MAJOR_VER)
0006A2 07A2 FE02             7      CP  2
0006A4 07A4 3011            12      JR  NC,COPY7_MSX2   ;DOS2はFCBの仕様が違う
0006A6 07A6 3A310E          13      LD  A,(DTA_CCP+13)  ;(FCB)属性(アトリビュート)
0006A9 07A9 32670E          13      LD  (FDRV+13),A ;(FCB)属性(アトリビュート)
0006AC 07AC 21380E          10      LD  HL,DTA_CCP+20
0006AF 07AF 116E0E          10      LD  DE,FDRV+20  ;(FCB)更新日時
0006B2 07B2 010400          10      LD  BC,4
0006B5 07B5 EDB0                    LDIR
       07B7                     COPY7_MSX2:
0006B7 07B7 115A0E          10      LD  DE,FDRV
0006BA 07BA 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0006BC 07BC CDA902          17      CALL    SYSTEM0
                                
0006BF 07BF 2045            12      JR  NZ,COPYE
0006C1 07C1 3A870D          13      LD  A,(MAJOR_VER)
0006C4 07C4 FE02             7      CP  2
0006C6 07C6 383B            12      JR  C,COPY_DOS2DT
                                
0006C8 07C8 11240E          10      LD  DE,DTA_CCP
0006CB 07CB 21080E          10      LD  HL,DOS2NAME
0006CE 07CE CD1008          17      CALL    FCB2FNAME
                                
0006D1 07D1 115A0E          10      LD  DE,FDRV
0006D4 07D4 21160E          10      LD  HL,DOS2NAME2
0006D7 07D7 CD1008          17      CALL    FCB2FNAME
                                
0006DA 07DA 11080E          10      LD  DE,DOS2NAME
0006DD 07DD AF               4      XOR A
0006DE 07DE 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
0006E0 07E0 CDA902          17      CALL    SYSTEM0
                                
0006E3 07E3 11160E          10      LD  DE,DOS2NAME2
0006E6 07E6 3E01             7      LD  A,1
0006E8 07E8 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
0006EA 07EA CDA902          17      CALL    SYSTEM0
                                
0006ED 07ED 11080E          10      LD  DE,DOS2NAME
0006F0 07F0 AF               4      XOR A
0006F1 07F1 0E51             7      LD  C,51H       ;(BDOS)_FTIME ファイルの日付および時刻の獲得・設定
0006F3 07F3 CDA902          17      CALL    SYSTEM0
                                
0006F6 07F6 D5              11      PUSH    DE
0006F7 07F7 DDE1            14      POP IX
                                
0006F9 07F9 11160E          10      LD  DE,DOS2NAME2
0006FC 07FC 3E01             7      LD  A,1
0006FE 07FE 0E51             7      LD  C,51H       ;(BDOS)_FTIME ファイルの日付および時刻の獲得・設定
000700 0800 CDA902          17      CALL    SYSTEM0
       0803                     COPY_DOS2DT:
000703 0803 C32F07          10      JP  COPY8
                                
       0806                     COPYE:
000706 0806 115A0E          10      LD  DE,FDRV
000709 0809 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
00070B 080B CD0500          17      CALL    SYSTEM
       080E                     COPYE2:
00070E 080E 37               4      SCF
00070F 080F C9              10      RET
                                
       0810                     FCB2FNAME:
000710 0810 1A               7      LD  A,(DE)
000711 0811 13               6      INC DE
000712 0812 C640             7      ADD A,'@'
000714 0814 77               7      LD  (HL),A
000715 0815 23               6      INC HL
000716 0816 363A            10      LD  (HL),':'
000718 0818 23               6      INC HL
                                
000719 0819 0608             7      LD  B,8
       081B                     FCB2FNAME1:
00071B 081B 1A               7      LD  A,(DE)
00071C 081C FE21             7      CP  020H+1
00071E 081E 3807            12      JR  C,FCB2FNAME2
000720 0820 13               6      INC DE
000721 0821 77               7      LD  (HL),A
000722 0822 23               6      INC HL
000723 0823 10F6            13      DJNZ    FCB2FNAME1
000725 0825 1803            12      JR  FCB2FNAME3
       0827                     FCB2FNAME2:
000727 0827 13               6      INC DE
000728 0828 10FD            13      DJNZ    FCB2FNAME2
       082A                     FCB2FNAME3:
00072A 082A 1A               7      LD  A,(DE)
00072B 082B FE21             7      CP  020H+1
00072D 082D 380F            12      JR  C,FCB2FNAME5
00072F 082F 362E            10      LD  (HL),'.'
000731 0831 23               6      INC HL
000732 0832 0603             7      LD  B,3
       0834                     FCB2FNAME4:
000734 0834 1A               7      LD  A,(DE)
000735 0835 13               6      INC DE
000736 0836 FE21             7      CP  020H+1
000738 0838 3804            12      JR  C,FCB2FNAME5
00073A 083A 77               7      LD  (HL),A
00073B 083B 23               6      INC HL
00073C 083C 10F6            13      DJNZ    FCB2FNAME4
       083E                     FCB2FNAME5:
00073E 083E 3600            10      LD  (HL),0
000740 0840 C9              10      RET
                                
       0841                     C_TYPE:
000741 0841 CDA906          17      CALL    SETFCB
000744 0844 215C00          10      LD  HL,FCB1
000747 0847 CD5702          17      CALL    OPEN
00074A 084A 37               4      SCF
       084B                     TYPE1:
00074B 084B C0              11      RET NZ
00074C 084C CD7D02          17      CALL    DEFCB
00074F 084F 3E1A             7      LD  A,01AH
000751 0851 CDAF08          17      CALL    MSG_A
       0854                     TYPE2:
000754 0854 CD9208          17      CALL    BUFSIZ
000757 0857 CDC902          17      CALL    S27DTA
00075A 085A C6FE             7      ADD A,0FEH
00075C 085C D8              11      RET C
00075D 085D 7C               4      LD  A,H
00075E 085E B5               4      OR  L
00075F 085F 281A            12      JR  Z,TYPEE
000761 0861 010080          10      LD  BC,DATA
       0864                     TYPE3:
000764 0864 0A               7      LD  A,(BC)
000765 0865 03               6      INC BC
000766 0866 FE1A             7      CP  01AH
000768 0868 2811            12      JR  Z,TYPEE
00076A 086A 5F               4      LD  E,A
00076B 086B C5              11      PUSH    BC
00076C 086C E5              11      PUSH    HL
00076D 086D 0E02             7      LD  C,2     ;(BDOS)コンソール出力
00076F 086F CD0500          17      CALL    SYSTEM
000772 0872 E1              10      POP HL
000773 0873 C1              10      POP BC
000774 0874 2B               6      DEC HL
000775 0875 7C               4      LD  A,H
000776 0876 B5               4      OR  L
000777 0877 20EB            12      JR  NZ,TYPE3
000779 0879 18D9            12      JR  TYPE2
       087B                     TYPEE:
00077B 087B CD7902          17      CALL    OPEN2
00077E 087E 18CB            12      JR  TYPE1
                                
       0880                     CWILD:
000780 0880 215D00          10      LD  HL,FCB1+1
       0883                     CWILD1:
000783 0883 7E               7      LD  A,(HL)
000784 0884 FE20             7      CP  020H
000786 0886 C0              11      RET NZ
       0887                     CWILD2:
000787 0887 54               4      LD  D,H
000788 0888 5D               4      LD  E,L
000789 0889 13               6      INC DE
00078A 088A 010A00          10      LD  BC,10
00078D 088D 363F            10      LD  (HL),'?'
00078F 088F EDB0                    LDIR
000791 0891 C9              10      RET
                                
       0892                     BUFSIZ:
000792 0892 3A0700          13      LD  A,(SYSTEM+2)
000795 0895 D681             7      SUB (DATA/256)+1
000797 0897 E6F8             7      AND 0F8H
000799 0899 67               4      LD  H,A
00079A 089A 2E00             7      LD  L,0
00079C 089C C9              10      RET
                                
00079D 089D E9               4  JP_HL:  JP  (HL)
                                
       089E                     _PRINT:
00079E 089E C5              11      PUSH    BC
00079F 089F D5              11      PUSH    DE
0007A0 08A0 E5              11      PUSH    HL
0007A1 08A1 DDE5            15      PUSH    IX
0007A3 08A3 0E06             7      LD  C,6
0007A5 08A5 CD0500          17      CALL    SYSTEM
0007A8 08A8 DDE1            14      POP IX
0007AA 08AA E1              10      POP HL
0007AB 08AB D1              10      POP DE
0007AC 08AC C1              10      POP BC
0007AD 08AD B7               4      OR  A
0007AE 08AE C9              10      RET
                                
       08AF                     MSG_A:
0007AF 08AF F5              11      PUSH    AF
0007B0 08B0 C5              11      PUSH    BC
0007B1 08B1 D5              11      PUSH    DE
0007B2 08B2 E5              11      PUSH    HL
0007B3 08B3 DDE5            15      PUSH    IX
0007B5 08B5 5F               4      LD  E,A
0007B6 08B6 0E02             7      LD  C,2
0007B8 08B8 CD0500          17      CALL    SYSTEM
0007BB 08BB DDE1            14      POP IX
0007BD 08BD E1              10      POP HL
0007BE 08BE D1              10      POP DE
0007BF 08BF C1              10      POP BC
0007C0 08C0 F1              10      POP AF
0007C1 08C1 C9              10      RET
                                ;       FILE
       08C2                     FILEC_D2:       ;DOS2対応
0007C2 08C2 3A870D          13      LD  A,(MAJOR_VER)
0007C5 08C5 FE02             7      CP  2
0007C7 08C7 381C            12      JR  C,FILEC
0007C9 08C9 C5              11      PUSH    BC
0007CA 08CA D5              11      PUSH    DE
0007CB 08CB E5              11      PUSH    HL
0007CC 08CC CDCD09          17      CALL    SPCUT
0007CF 08CF 21C80D          10      LD  HL,PATH_CCP
0007D2 08D2 0640             7      LD  B,64
       08D4                     PATHCD1:
0007D4 08D4 1A               7      LD  A,(DE)
0007D5 08D5 13               6      INC DE
0007D6 08D6 FE20             7      CP  020H
0007D8 08D8 3002            12      JR  NC,PATHCD2
0007DA 08DA 3E00             7      LD  A,0
       08DC                     PATHCD2:
0007DC 08DC 77               7      LD  (HL),A
0007DD 08DD 3803            12      JR  C,PATHCD3
0007DF 08DF 23               6      INC HL
0007E0 08E0 10F2            13      DJNZ    PATHCD1
       08E2                     PATHCD3:
0007E2 08E2 E1              10      POP HL
0007E3 08E3 D1              10      POP DE
0007E4 08E4 C1              10      POP BC
       08E5                     FILEC:
0007E5 08E5 CDF008          17      CALL    FILE
       08E8                     FILEC2:
0007E8 08E8 3A5B0E          13      LD  A,(FDRV+1)
0007EB 08EB FE20             7      CP  020H
0007ED 08ED C8              11      RET Z
0007EE 08EE 1839            12      JR  SETDIR1
                                
       08F0                     FILE:
0007F0 08F0 AF               4      XOR A
0007F1 08F1 325A0E          13      LD  (FDRV),A
0007F4 08F4 67               4      LD  H,A
0007F5 08F5 6F               4      LD  L,A
0007F6 08F6 22680E          16      LD  (FDRV+14),HL
0007F9 08F9 CDCD09          17      CALL    SPCUT
0007FC 08FC CDB209          17      CALL    CCHK3
0007FF 08FF 2812            12      JR  Z,DEVI1
000801 0901 13               6      INC DE
000802 0902 1A               7      LD  A,(DE)
000803 0903 1B               6      DEC DE
000804 0904 FE3A             7      CP  ':'
000806 0906 200B            12      JR  NZ,DEVI1
000808 0908 1A               7      LD  A,(DE)      ;DRIVE
000809 0909 CDE009          17      CALL    CAP
00080C 090C D640             7      SUB '@'
00080E 090E 13               6      INC DE
00080F 090F 13               6      INC DE
000810 0910 325A0E          13      LD  (FDRV),A
       0913                     DEVI1:
000813 0913 1A               7      LD  A,(DE)
000814 0914 D65C             7      SUB 05CH        ;\
000816 0916 2009            12      JR  NZ,NOROOT
000818 0918 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
000819 0919 22740E          16      LD  (FDRV+26),HL
00081C 091C 2C               4      INC L
00081D 091D 22680E          16      LD  (FDRV+14),HL
000820 0920 13               6      INC DE
       0921                     NOROOT:
                                
       0921                     SETDIR:
000821 0921 CD5209          17      CALL    FILED
000824 0924 1A               7      LD  A,(DE)
000825 0925 FE5C             7      CP  05CH        ;\
000827 0927 C0              11      RET NZ
000828 0928 13               6      INC DE
       0929                     SETDIR1:
000829 0929 3A870D          13      LD  A,(MAJOR_VER)
00082C 092C FE01             7      CP  1
00082E 092E C0              11      RET NZ
                                                ;for LSX-Dodgers
00082F 092F 3E10             7      LD  A,010H      ;Directory
000831 0931 32670E          13      LD  (FDRV+13),A
000834 0934 D5              11      PUSH    DE
000835 0935 115A0E          10      LD  DE,FDRV
000838 0938 0E0F             7      LD  C,00FH
00083A 093A CD0500          17      CALL    SYSTEM
00083D 093D D1              10      POP DE
00083E 093E B7               4      OR  A
00083F 093F C0              11      RET NZ
                                
000840 0940 3A670E          13      LD  A,(FDRV+13)
000843 0943 CB67             8      BIT 4,A
000845 0945 C8              11      RET Z
                                
000846 0946 CD9909          17      CALL    FILEI
000849 0949 2A740E          16      LD  HL,(FDRV+26)
00084C 094C 23               6      INC HL
00084D 094D 22680E          16      LD  (FDRV+14),HL
000850 0950 18CF            12      JR  SETDIR
                                
       0952                     FILED:
000852 0952 CD9909          17      CALL    FILEI
                                
000855 0955 0608             7      LD  B,8
       0957                     FILE2:
000857 0957 CDA709          17      CALL    CCHKF
00085A 095A C8              11      RET Z
00085B 095B FE2A             7      CP  '*'
00085D 095D 282E            12      JR  Z,FILE9
00085F 095F FE2E             7      CP  '.'
000861 0961 280C            12      JR  Z,FILE4
000863 0963 77               7      LD  (HL),A
000864 0964 23               6      INC HL
000865 0965 10F0            13      DJNZ    FILE2
                                
       0967                     FILE3:
000867 0967 CDA709          17      CALL    CCHKF
00086A 096A C8              11      RET Z
00086B 096B FE2E             7      CP  '.'
00086D 096D 20F8            12      JR  NZ,FILE3
                                
       096F                     FILE4:
00086F 096F 21630E          10      LD  HL,FNAME+8
000872 0972 0603             7      LD  B,3
                                
       0974                     FILE4L:
000874 0974 CDA709          17      CALL    CCHKF
000877 0977 C8              11      RET Z
000878 0978 FE2E             7      CP  '.'
00087A 097A 2008            12      JR  NZ,FILE12
00087C 097C 325B0E          13      LD  (FNAME),A   ;Parent directory(..)
00087F 097F 325C0E          13      LD  (FNAME+1),A
000882 0982 3E20             7      LD  A,020H
       0984                     FILE12:
000884 0984 FE2A             7      CP  '*'
000886 0986 280A            12      JR  Z,FILE10
000888 0988 77               7      LD  (HL),A
000889 0989 23               6      INC HL
00088A 098A 10E8            13      DJNZ    FILE4L
00088C 098C C9              10      RET
                                
       098D                     FILE9:              ;名前の*処理、名前の残りを?で埋める
00088D 098D CD9209          17      CALL    FILE10
000890 0990 18D5            12      JR  FILE3
                                
       0992                     FILE10:
000892 0992 3E3F             7      LD  A,'?'
                                
       0994                     FILL_MEMORY:                ;HLからBバイトAで埋める
000894 0994 77               7      LD  (HL),A
000895 0995 23               6      INC HL
000896 0996 10FC            13      DJNZ    FILL_MEMORY
000898 0998 C9              10      RET
                                
       0999                     FILEI:              ;名前＋拡張子をスペースで初期化
000899 0999 3E20             7      LD  A,020H
00089B 099B 01000B          10      LD  BC,11*256
00089E 099E 215B0E          10      LD  HL,FNAME
0008A1 09A1 E5              11      PUSH    HL
0008A2 09A2 CD9409          17      CALL    FILL_MEMORY
0008A5 09A5 E1              10      POP HL
0008A6 09A6 C9              10      RET
                                
       09A7                     CCHKF:
0008A7 09A7 1A               7      LD  A,(DE)
0008A8 09A8 CDAF09          17      CALL    CCHK2
0008AB 09AB C8              11      RET Z
0008AC 09AC C3020A          10      JP  FKAN
                                
       09AF                     CCHK2:
0008AF 09AF 0C               4      INC C
0008B0 09B0 0D               4      DEC C
0008B1 09B1 C0              11      RET NZ
       09B2                     CCHK3:              ;ZF=1 で使えない文字
0008B2 09B2 FE2B             7      CP  '+'
0008B4 09B4 C8              11      RET Z
0008B5 09B5 FE2C             7      CP  ','
0008B7 09B7 C8              11      RET Z
0008B8 09B8 FE2F             7      CP  '/'
0008BA 09BA C8              11      RET Z
0008BB 09BB FE3A             7      CP  ':'
0008BD 09BD C8              11      RET Z
0008BE 09BE FE3B             7      CP  ';'
0008C0 09C0 C8              11      RET Z
0008C1 09C1 FE3D             7      CP  '='
0008C3 09C3 C8              11      RET Z
0008C4 09C4 FE5C             7      CP  05CH    ;\
0008C6 09C6 C8              11      RET Z
0008C7 09C7 FE20             7      CP  020H
0008C9 09C9 D0              11      RET NC
0008CA 09CA BF               4      CP  A       ;Z=1
0008CB 09CB C9              10      RET
                                
       09CC                     SS1:
0008CC 09CC 13               6      INC DE
       09CD                     SPCUT:              ;スペースをカット
0008CD 09CD 1A               7      LD  A,(DE)
0008CE 09CE FE20             7      CP  020H
0008D0 09D0 28FA            12      JR  Z,SS1
0008D2 09D2 C9              10      RET
                                
       09D3                     TOZERO:
0008D3 09D3 D5              11      PUSH    DE
       09D4                     TZ1:
0008D4 09D4 1A               7      LD  A,(DE)
0008D5 09D5 FE20             7      CP  20H
0008D7 09D7 3803            12      JR  C,TZ2
0008D9 09D9 13               6      INC DE
0008DA 09DA 18F8            12      JR  TZ1
       09DC                     TZ2:
0008DC 09DC AF               4      XOR A
0008DD 09DD 12               7      LD  (DE),A
0008DE 09DE D1              10      POP DE
0008DF 09DF C9              10      RET
                                
       09E0                     CAP:
0008E0 09E0 FE61             7      CP  'a'
0008E2 09E2 D8              11      RET C
0008E3 09E3 FE7B             7      CP  'z'+1
0008E5 09E5 D0              11      RET NC
0008E6 09E6 D620             7      SUB 020H
0008E8 09E8 C9              10      RET
       09E9                     CAP2:
0008E9 09E9 CDE009          17      CALL    CAP
       09EC                     CAP3:
0008EC 09EC CDF509          17      CALL    CAP4
0008EF 09EF FE21             7      CP  021H
0008F1 09F1 D0              11      RET NC
0008F2 09F2 3E20             7      LD  A,020H
0008F4 09F4 C9              10      RET
       09F5                     CAP4:
0008F5 09F5 FE05             7      CP  5
0008F7 09F7 C0              11      RET NZ
0008F8 09F8 3EE5             7      LD  A,0E5H
0008FA 09FA C9              10      RET
                                
       09FB                     FKANC:
0008FB 09FB CB41             8      BIT 0,C
0008FD 09FD CCE909          17      CALL    Z,CAP2
000900 0A00 1801            12      JR  FKANX
       0A02                     FKAN:           ;漢字チェック
000902 0A02 13               6      INC DE
       0A03                     FKANX:
000903 0A03 CB41             8      BIT 0,C
000905 0A05 CB81             8      RES 0,C
000907 0A07 C0              11      RET NZ
000908 0A08 FE80             7      CP  080H
00090A 0A0A D8              11      RET C
00090B 0A0B FEA0             7      CP  0A0H
00090D 0A0D 3803            12      JR  C,FKAN1
00090F 0A0F FEE0             7      CP  0E0H
000911 0A11 D8              11      RET C
       0A12                     FKAN1:
000912 0A12 0C               4      INC C
000913 0A13 A7               4      AND A
000914 0A14 C9              10      RET
                                
       0A15                     CHKWILDX:
000915 0A15 FDE5            15      PUSH    IY
000917 0A17 E1              10      POP HL
000918 0A18 23               6      INC HL
       0A19                     CHKWILD:
000919 0A19 060B             7      LD  B,11
00091B 0A1B 3E3F             7      LD  A,'?'
       0A1D                     CHKWIL1:
00091D 0A1D BE               7      CP  (HL)
00091E 0A1E 23               6      INC HL
00091F 0A1F 37               4      SCF
000920 0A20 C8              11      RET Z
000921 0A21 10FA            13      DJNZ    CHKWIL1
000923 0A23 AF               4      XOR A
000924 0A24 C9              10      RET
                                
       0A25                     CPNAME:
000925 0A25 C5              11      PUSH    BC
000926 0A26 D5              11      PUSH    DE
000927 0A27 11490E          10      LD  DE,CPBUF
00092A 0A2A 010500          10      LD  BC,5
00092D 0A2D EDB0                    LDIR
00092F 0A2F D1              10      POP DE
000930 0A30 D5              11      PUSH    DE
000931 0A31 E5              11      PUSH    HL
000932 0A32 21490E          10      LD  HL,CPBUF
000935 0A35 CD480A          17      CALL    CPFILE
000938 0A38 E1              10      POP HL
000939 0A39 D1              10      POP DE
00093A 0A3A C1              10      POP BC
00093B 0A3B 2005            12      JR  NZ,CPNAME1
00093D 0A3D 7E               7      LD  A,(HL)
00093E 0A3E 23               6      INC HL
00093F 0A3F 66               7      LD  H,(HL)
000940 0A40 6F               4      LD  L,A
000941 0A41 C9              10      RET
       0A42                     CPNAME1:
000942 0A42 23               6      INC HL
000943 0A43 23               6      INC HL
000944 0A44 10DF            13      DJNZ    CPNAME
000946 0A46 37               4      SCF
000947 0A47 C9              10      RET
                                
       0A48                     CPFILE:
000948 0A48 C5              11      PUSH    BC
000949 0A49 01000B          10      LD  BC,00B00H
       0A4C                     CPSTR1:
00094C 0A4C 1A               7      LD  A,(DE)
00094D 0A4D FE3F             7      CP  '?'     ;Wild card
00094F 0A4F 2812            12      JR  Z,CPSTR2
000951 0A51 7E               7      LD  A,(HL)
000952 0A52 CDFB09          17      CALL    FKANC
000955 0A55 E5              11      PUSH    HL
000956 0A56 67               4      LD  H,A
000957 0A57 1A               7      LD  A,(DE)
000958 0A58 CB01             4      RLC C
00095A 0A5A CDFB09          17      CALL    FKANC
00095D 0A5D CB09             4      RRC C
00095F 0A5F BC               4      CP  H       ;CP (HL),(DE)
000960 0A60 E1              10      POP HL
000961 0A61 2004            12      JR  NZ,CPSTR3
       0A63                     CPSTR2:
000963 0A63 13               6      INC DE
000964 0A64 23               6      INC HL
000965 0A65 10E5            13      DJNZ    CPSTR1
       0A67                     CPSTR3:
000967 0A67 C1              10      POP BC
000968 0A68 C9              10      RET
                                
       0A69                     CPFILE2:
000969 0A69 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00096C 0A6C F6E1             7      OR  0E1H
00096E 0A6E 2F               4      CPL
00096F 0A6F A6               7      AND (HL)
000970 0A70 C9              10      RET
                                
       0A71                     _SYS29:     ;(BDOS)ファイル名の解析
000971 0A71 C5              11      PUSH    BC
000972 0A72 E5              11      PUSH    HL
000973 0A73 CDF008          17      CALL    FILE
000976 0A76 E1              10      POP HL
000977 0A77 C1              10      POP BC
       0A78                     S29X1:
000978 0A78 C5              11      PUSH    BC
000979 0A79 D5              11      PUSH    DE
00097A 0A7A E5              11      PUSH    HL
00097B 0A7B EB               4      EX  DE,HL
00097C 0A7C 215A0E          10      LD  HL,FDRV
00097F 0A7F 010D00          10      LD  BC,13
000982 0A82 EDB0                    LDIR
000984 0A84 70               7      LD  (HL),B      ;B=0
000985 0A85 0E03             7      LD  C,3
000987 0A87 EDB0                    LDIR
000989 0A89 E1              10      POP HL
00098A 0A8A D1              10      POP DE
00098B 0A8B C1              10      POP BC
00098C 0A8C AF               4      XOR A
00098D 0A8D C9              10      RET
       0A8E                     GET_WIDTH:
00098E 0A8E 3A860D          13      LD  A,(IS_MSX)
000991 0A91 B7               4      OR  A
000992 0A92 2804            12      JR  Z,NOT_MSX
000994 0A94 3AB0F3          13      LD  A,(LINLEN)
000997 0A97 C9              10      RET
       0A98                     NOT_MSX:
000998 0A98 E5              11      PUSH    HL
000999 0A99 2A0100          16      LD  HL,(1)
00099C 0A9C 2EB1             7      LD  L,0B1H
00099E 0A9E 7E               7      LD  A,(HL)
00099F 0A9F E1              10      POP HL
0009A0 0AA0 C9              10      RET
                                
       0AA1                     C_MODE:
0009A1 0AA1 3A860D          13      LD  A,(IS_MSX)
0009A4 0AA4 B7               4      OR  A
0009A5 0AA5 C8              11      RET Z
0009A6 0AA6 0E29             7      LD  C,41
0009A8 0AA8 3AF8FA          13      LD  A,(EXBRSA)
0009AB 0AAB B7               4      OR  A
0009AC 0AAC 2802            12      JR  Z,MODE_MSX1
0009AE 0AAE 0E51             7      LD  C,81
       0AB0                     MODE_MSX1:
0009B0 0AB0 C5              11      PUSH    BC
0009B1 0AB1 CDDD0B          17      CALL    GETNUM
0009B4 0AB4 C1              10      POP BC
0009B5 0AB5 7D               4      LD  A,L
0009B6 0AB6 B9               4      CP  C
0009B7 0AB7 301C            12      JR  NC,MODE1
0009B9 0AB9 B7               4      OR  A
0009BA 0ABA 2819            12      JR  Z,MODE1
0009BC 0ABC FE21             7      CP  33
0009BE 0ABE 381E            12      JR  C,MODE32
0009C0 0AC0 32AEF3          13      LD  (LINL40),A
0009C3 0AC3 DD216C00        14      LD  IX,INITXT
0009C7 0AC7 CDCE0A          17      CALL    CALLROM
0009CA 0ACA DD217800        14      LD  IX,SETTXT
       0ACE                     CALLROM:
0009CE 0ACE FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
0009D2 0AD2 C31C00          10      JP  CALSLT
       0AD5                     MODE1:
0009D5 0AD5 3AB0F3          13      LD  A,(LINLEN)
0009D8 0AD8 CD1E06          17      CALL    PRDEC_A
0009DB 0ADB C3B404          10      JP  LTNL
       0ADE                     MODE32:
0009DE 0ADE 32AFF3          13      LD  (LINL32),A
0009E1 0AE1 DD216F00        14      LD  IX,INIT32
0009E5 0AE5 CDCE0A          17      CALL    CALLROM
0009E8 0AE8 DD217B00        14      LD  IX,SETT32
0009EC 0AEC 18E0            12      JR  CALLROM
                                
       0AEE                     C_PAUSE:
0009EE 0AEE CDCD09          17      CALL    SPCUT
0009F1 0AF1 EB               4      EX  DE,HL
0009F2 0AF2 7E               7      LD  A,(HL)
0009F3 0AF3 B7               4      OR  A
0009F4 0AF4 2003            12      JR  NZ,C_PAUSE1
0009F6 0AF6 21910C          10      LD  HL,PAUSE
       0AF9                     C_PAUSE1:
0009F9 0AF9 CD8604          17      CALL    MSX
0009FC 0AFC 0E07             7      LD  C,7     ;(BDOS)コンソール直接入力(_DIRIN)
0009FE 0AFE CD0500          17      CALL    SYSTEM
000A01 0B01 FE03             7      CP  3
000A03 0B03 CAAC03          10      JP  Z,END_BATCH
000A06 0B06 C3B404          10      JP  LTNL
                                
       0B09                     C_ECHO:
000A09 0B09 CDCD09          17      CALL    SPCUT
000A0C 0B0C EB               4      EX  DE,HL
000A0D 0B0D CD8604          17      CALL    MSX
000A10 0B10 C3B404          10      JP  LTNL
                                
       0B13                     C_MKDIR:
000A13 0B13 CDCD09          17      CALL    SPCUT
000A16 0B16 014490          10      LD  BC,09044H   ;B=新規作成+ディレクトリ/C=(BDOS)ファイルハンドルの作成(_CREATE)
000A19 0B19 CD0500          17      CALL    SYSTEM
000A1C 0B1C C6FF             7      ADD A,0FFH
000A1E 0B1E D8              11      RET C
000A1F 0B1F 0E45             7      LD  C,045H      ;(BDOS)ファイルハンドルのクローズ(_CLOSE)
000A21 0B21 CD0500          17      CALL    SYSTEM
       0B24                     SHOW_OK:
000A24 0B24 11870C          10      LD  DE,OK
000A27 0B27 0E09             7      LD  C,9     ;(BDOS)文字列出力
000A29 0B29 CD0500          17      CALL    SYSTEM
000A2C 0B2C C3B404          10      JP  LTNL
                                
       0B2F                     C_RMDIR:
000A2F 0B2F CDCD09          17      CALL    SPCUT
000A32 0B32 AF               4      XOR A
000A33 0B33 0E50             7      LD  C,050H      ;(BDOS)_ATTR ファイル属性の獲得・設定
000A35 0B35 D5              11      PUSH    DE
000A36 0B36 CD0500          17      CALL    SYSTEM
000A39 0B39 D1              10      POP DE
000A3A 0B3A C6FF             7      ADD A,0FFH
000A3C 0B3C D8              11      RET C
000A3D 0B3D CB65             8      BIT 4,L
000A3F 0B3F C8              11      RET Z
000A40 0B40 0E4D             7      LD  C,04DH      ;(BDOS)ファイル・サブディレクトリの削除
000A42 0B42 CD0500          17      CALL    SYSTEM
000A45 0B45 C6FF             7      ADD A,0FFH
000A47 0B47 D8              11      RET C
000A48 0B48 18DA            12      JR  SHOW_OK
                                
       0B4A                     C_SET:
000A4A 0B4A CDCD09          17      CALL    SPCUT
000A4D 0B4D ED53600B        20      LD  (CSET_PARAM),DE
       0B51                     CSET2:
000A51 0B51 1A               7      LD  A,(DE)
000A52 0B52 FE20             7      CP  020H
000A54 0B54 3838            12      JR  C,CSET_LIST
000A56 0B56 D63D             7      SUB '='
000A58 0B58 2803            12      JR  Z,CSET_SET
000A5A 0B5A 13               6      INC DE
000A5B 0B5B 18F4            12      JR  CSET2
       0B5D                     CSET_SET:
000A5D 0B5D 12               7      LD  (DE),A
000A5E 0B5E 13               6      INC DE
       0B60                     CSET_PARAM  EQU $+1
000A5F 0B5F 210000          10      LD  HL,0
000A62 0B62 0E6C             7      LD  C,06CH      ;_SENV 環境変数の設定
000A64 0B64 CD0500          17      CALL    SYSTEM
       0B67                     INIT_VAR:           ;環境変数の初期化
000A67 0B67 21680D          10      LD  HL,N_DATE
000A6A 0B6A 116D0D          10      LD  DE,V_DATE
000A6D 0B6D 0610             7      LD  B,16
000A6F 0B6F 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000A71 0B71 CD0500          17      CALL    SYSTEM
                                
000A74 0B74 217D0D          10      LD  HL,N_TIME
000A77 0B77 11820D          10      LD  DE,V_TIME
000A7A 0B7A 0603             7      LD  B,3
000A7C 0B7C 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000A7E 0B7E CD0500          17      CALL    SYSTEM
                                
000A81 0B81 21DC0C          10      LD  HL,N_APPEND
000A84 0B84 11E30C          10      LD  DE,V_APPEND
000A87 0B87 0640             7      LD  B,PATHX
000A89 0B89 0E6B             7      LD  C,06BH      ;_GENV 環境変数の獲得
000A8B 0B8B C30500          10      JP  SYSTEM
                                
       0B8E                     CSET_LIST:
000A8E 0B8E 3E0A             7      LD  A,10
000A90 0B90 32850E          13      LD  (CSET_DATA),A
000A93 0B93 110100          10      LD  DE,1
       0B96                     CSET1:
000A96 0B96 D5              11      PUSH    DE
000A97 0B97 016DFF          10      LD  BC,0FF6DH   ;_FENV 環境変数の検索
000A9A 0B9A 21870E          10      LD  HL,DATA_COM
000A9D 0B9D 3600            10      LD  (HL),0
000A9F 0B9F CD0500          17      CALL    SYSTEM
000AA2 0BA2 B7               4      OR  A
000AA3 0BA3 2030            12      JR  NZ,CSET_ERROR
000AA5 0BA5 21870E          10      LD  HL,DATA_COM
000AA8 0BA8 7E               7      LD  A,(HL)
000AA9 0BA9 B7               4      OR  A
000AAA 0BAA 2829            12      JR  Z,CSET_ERROR
000AAC 0BAC CD8604          17      CALL    MSX
000AAF 0BAF 1E3D             7      LD  E,'='
000AB1 0BB1 CD9E08          17      CALL    _PRINT
000AB4 0BB4 21870E          10      LD  HL,DATA_COM
000AB7 0BB7 11870F          10      LD  DE,DATA_COM+256
000ABA 0BBA 016BFF          10      LD  BC,0FF6BH   ;_GENV 環境変数の獲得
000ABD 0BBD CD0500          17      CALL    SYSTEM
000AC0 0BC0 21870F          10      LD  HL,DATA_COM+256
000AC3 0BC3 CD8604          17      CALL    MSX
000AC6 0BC6 CDB404          17      CALL    LTNL
000AC9 0BC9 3E0A             7      LD  A,10
000ACB 0BCB 32850E          13      LD  (CSET_DATA),A
       0BCE                     CSET_NEXT:
000ACE 0BCE D1              10      POP DE
000ACF 0BCF 13               6      INC DE
000AD0 0BD0 7A               4      LD  A,D
000AD1 0BD1 B3               4      OR  E
000AD2 0BD2 20C2            12      JR  NZ,CSET1
000AD4 0BD4 C9              10      RET
       0BD5                     CSET_ERROR:
000AD5 0BD5 21850E          10      LD  HL,CSET_DATA
000AD8 0BD8 35              11      DEC (HL)
000AD9 0BD9 20F3            12      JR  NZ,CSET_NEXT
       0BDB                     CSET_END:
000ADB 0BDB D1              10      POP DE
000ADC 0BDC C9              10      RET
                                
       0BDD                     GETNUM:
000ADD 0BDD CDCD09          17      CALL    SPCUT
000AE0 0BE0 210000          10      LD  HL,0
       0BE3                     GETNUM1:
000AE3 0BE3 1A               7      LD  A,(DE)
000AE4 0BE4 13               6      INC DE
000AE5 0BE5 D630             7      SUB '0'
000AE7 0BE7 D8              11      RET C
000AE8 0BE8 FE0A             7      CP  10
000AEA 0BEA D0              11      RET NC
000AEB 0BEB 4D               4      LD  C,L
000AEC 0BEC 44               4      LD  B,H
000AED 0BED 29              11      ADD HL,HL   ;*2
000AEE 0BEE 29              11      ADD HL,HL   ;*4
000AEF 0BEF 09              11      ADD HL,BC   ;*5
000AF0 0BF0 29              11      ADD HL,HL   ;*10
000AF1 0BF1 4F               4      LD  C,A
000AF2 0BF2 0600             7      LD  B,0
000AF4 0BF4 09              11      ADD HL,BC
000AF5 0BF5 18EC            12      JR  GETNUM1
                                
       0BF7                     CHDIR:
000AF7 0BF7 3A870D          13      LD  A,(MAJOR_VER)
000AFA 0BFA FE02             7      CP  2
000AFC 0BFC D8              11      RET C
000AFD 0BFD C5              11      PUSH    BC
000AFE 0BFE E5              11      PUSH    HL
000AFF 0BFF 0E5A             7      LD  C,05AH      ;(BDOS)_CHDIR カレントディレクトリの変更
000B01 0C01 CD0500          17      CALL    SYSTEM
000B04 0C04 E1              10      POP HL
000B05 0C05 C1              10      POP BC
000B06 0C06 C9              10      RET
                                
       000F                     COMS    EQU 15
       0C07                     COMTB:
000B07 0C07 4420202020              DB  "D    " ;1
000B0C 0C0C 0404                    DW  C_DIR
000B0E 0C0E 4449522020              DB  "DIR  " ;2
000B13 0C13 0404                    DW  C_DIR
000B15 0C15 434F505920              DB  "COPY " ;3
000B1A 0C1A EA06                    DW  C_COPY
000B1C 0C1C 4344202020              DB  "CD   " ;4
000B21 0C21 AE02                    DW  C_CD
000B23 0C23 44454C2020              DB  "DEL  " ;5
000B28 0C28 CA03                    DW  C_DEL
000B2A 0C2A 5041544820              DB  "PATH " ;6
000B2F 0C2F BE04                    DW  C_PATH
000B31 0C31 52454E2020              DB  "REN  " ;7
000B36 0C36 D603                    DW  C_REN
000B38 0C38 5459504520              DB  "TYPE " ;8
000B3D 0C3D 4108                    DW  C_TYPE
000B3F 0C3F 52454D2020              DB  "REM  " ;9
000B44 0C44 C803                    DW  C_REM
000B46 0C46 4D4F444520              DB  "MODE " ;10
000B4B 0C4B A10A                    DW  C_MODE
000B4D 0C4D 5041555345              DB  "PAUSE" ;11
000B52 0C52 EE0A                    DW  C_PAUSE
000B54 0C54 5345542020              DB  "SET  " ;12
000B59 0C59 4A0B                    DW  C_SET
000B5B 0C5B 4543484F20              DB  "ECHO " ;13
000B60 0C60 090B                    DW  C_ECHO
000B62 0C62 4D4B444952              DB  "MKDIR" ;14
000B67 0C67 130B                    DW  C_MKDIR
000B69 0C69 524D444952              DB  "RMDIR" ;15
000B6E 0C6E 2F0B                    DW  C_RMDIR
                                
000B70 0C70 2062797465732066    FREE:   DB  " bytes free  $"
            726565202024        
000B7E 0C7E 2020203C4449523E    DIRMES: DB  "   <DIR>$"
            24                  
000B87 0C87 4F4B24              OK: DB  "OK$"
000B8A 0C8A 4572726F722124      COMERM: DB  "Error!$"
000B91 0C91 537472696B652061    PAUSE:  DB  "Strike any key when ready ",0
            6E79206B65792077    
            68656E2072656164    
            792000              
                                
       0CAC                     S_MONTH:
000BAC 0CAC 4A616E00                DB  "Jan",0
000BB0 0CB0 46656200                DB  "Feb",0
000BB4 0CB4 4D617200                DB  "Mar",0
000BB8 0CB8 41707200                DB  "Apr",0
000BBC 0CBC 4D617900                DB  "May",0
000BC0 0CC0 4A756E00                DB  "Jun",0
000BC4 0CC4 4A756C00                DB  "Jul",0
000BC8 0CC8 41756700                DB  "Aug",0
000BCC 0CCC 53657000                DB  "Sep",0
000BD0 0CD0 4F637400                DB  "Oct",0
000BD4 0CD4 4E6F7600                DB  "Nov",0
000BD8 0CD8 44656300                DB  "Dec",0
                                
       0CDC                     N_APPEND:
000BDC 0CDC 415050454E4400          DB  "APPEND",0
       0CE3                     V_APPEND:
000BE3 0CE3                         DS  64
       0D23                     N_PATH:
000C23 0D23 5041544800              DB  "PATH",0
       0D28                     V_PATH:
000C28 0D28                         DS  PATHX
       0D68                     N_DATE:
000C68 0D68 4441544500              DB  "DATE",0
       0D6D                     V_DATE:
000C6D 0D6D 79792D6D6D2D6464        DB  "yy-mm-dd"
000C75 0D75                         DS  8
       0D7D                     N_TIME:
000C7D 0D7D 54494D4500              DB  "TIME",0
       0D82                     V_TIME:
000C82 0D82 323400                  DB  "24",0
       0D85                     F_TIME:
000C85 0D85 00                      DB  0
                                
       0D86                     IS_MSX:
000C86 0D86 00                      DB  0
       0D87                     MAJOR_VER:
000C87 0D87 00                      DB  0
                                
       0D88                     SEARCH_IX:; EQU $4000
000C88 0D88                         DS  64  ;DOS2用
                                
       0DC8                     PATH_CCP:;  EQU $5000
000CC8 0DC8                         DS  64  ;DOS2用
                                
       0E08                     DOS2NAME:
000D08 0E08                         DS  2+8+3+1
       0E16                     DOS2NAME2:
000D16 0E16                         DS  2+8+3+1
                                
       0E24                     DTA_CCP:;       EQU $6000
000D24 0E24                         DS  37
       0E49                     CPBUF:
000D49 0E49 0000                LEFTX:  DW  0
000D4B 0E4B 0000                DTAX:   DW  0
000D4D 0E4D 20                      DB  020H    ;CPBUFで使う
000D4E 0E4E 20                      DB  020H
000D4F 0E4F 20                      DB  020H
000D50 0E50 20                      DB  020H
000D51 0E51 20                      DB  020H
000D52 0E52 20                      DB  020H
000D53 0E53 20                      DB  020H
                                
       0E54                     DECBF:
000D54 0E54                         DS  5
       0E59                     FCB_BAT2:
000D59 0E59 00                      DB  0
       0E5A                     FDRV:
000D5A 0E5A 00                      DB  0
       0E5B                     FNAME:
000D5B 0E5B                         DS  37
       0E80                     ZERO:
000D80 0E80 00                      DB  0
       0E81                     FCB_BAT:
000D81 0E81 590E                    DW  FCB_BAT2
       0E83                     X_PATH:
000D83 0E83 0000                    DW  0
       0E85                     CSET_DATA:
000D85 0E85 00                      DB  0
       0E86                     PROCESS:
000D86 0E86 00                      DB  0
                                
       0E87                     DATA_COM:
[EOF:COMMAND.ASM:SHIFT_JIS]
