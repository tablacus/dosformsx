                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                
                                ;   似非COMMAND.COM
                                
       0005                     SYSTEM  EQU 00005H
       000B                     BASE    EQU 0000BH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       0080                     DTA1    EQU 00080H
                                
000000 0100                         ORG 0100H
000000 0100 C31501          10      JP  START
000003 0103 0D0A434F4D4D414E    VER:    DB  00DH,00AH,"COMMAND v0.01",00DH,00AH,'$'
            442076302E30310D    
            0A24                
       0115                     START:
000015 0115 ED7B0600        20      LD  SP,(SYSTEM+1)
000019 0119 0E6F             7      LD  C,06FH      ;(BDOS)MSX-DOS のバージョン番号の獲得
00001B 011B CD0500          17      CALL    SYSTEM
00001E 011E ED439C08        20      LD  (MSX_VER),BC
000022 0122 3A8000          13      LD  A,(DTA1)
000025 0125 B7               4      OR  A
000026 0126 280E            12      JR  Z,WSTART
000028 0128 110301          10      LD  DE,VER
00002B 012B 0E09             7      LD  C,9
00002D 012D CD0500          17      CALL    SYSTEM
000030 0130 118100          10      LD  DE,DTA1+1
000033 0133 CD6F01          17      CALL    COMANL
       0136                     WSTART:
000036 0136 CD9103          17      CALL    LTNL
       0139                     COMMAND:
000039 0139 CDE301          17      CALL    SETDTA1
00003C 013C D5              11      PUSH    DE
00003D 013D C5              11      PUSH    BC
00003E 013E E5              11      PUSH    HL
00003F 013F 0E19             7      LD  C,019H
000041 0141 CD0500          17      CALL    SYSTEM
000044 0144 E1              10      POP HL
000045 0145 C1              10      POP BC
000046 0146 C641             7      ADD A,'A'
000048 0148 5F               4      LD  E,A
000049 0149 CD7806          17      CALL    _PRINT
00004C 014C 1E3E             7      LD  E,'>'
00004E 014E CD7806          17      CALL    _PRINT
000051 0151 D1              10      POP DE      ;DE=DTA1
000052 0152 3E50             7      LD  A,80
000054 0154 12               7      LD  (DE),A
000055 0155 0E0A             7      LD  C,0AH       ;(BDOS)文字列入力
000057 0157 CD0500          17      CALL    SYSTEM
00005A 015A CD9103          17      CALL    LTNL
                                
00005D 015D 118200          10      LD  DE,DTA1+2
000060 0160 CD6F01          17      CALL    COMANL
000063 0163 30D4            12      JR  NC,COMMAND
000065 0165 119508          10      LD  DE,COMERM
000068 0168 0E09             7      LD  C,9     ;(BDOS)文字列出力
00006A 016A CD0500          17      CALL    SYSTEM
00006D 016D 18C7            12      JR  WSTART
                                
       016F                     COMANL:
00006F 016F CD9F06          17      CALL    FILE
000072 0172 D5              11      PUSH    DE
000073 0173 11D508          10      LD  DE,FNAME
000076 0176 1A               7      LD  A,(DE)
000077 0177 FE20             7      CP  020H
000079 0179 2829            12      JR  Z,SDVSW
00007B 017B 1B               6      DEC DE
00007C 017C 1A               7      LD  A,(DE)
00007D 017D C6FF             7      ADD A,0FFH
00007F 017F 380A            12      JR  C,COMB
000081 0181 13               6      INC DE
                                
000082 0182 214408          10      LD  HL,COMTB
000085 0185 3E08             7      LD  A,COMS
000087 0187 47               4      LD  B,A
000088 0188 CDC707          17      CALL    CPNAME
       018B                     COMB:
00008B 018B D1              10      POP DE
00008C 018C D27706          10      JP  NC,JP_HL
00008F 018F EB               4      EX  DE,HL
000090 0190 226702          16      LD  (COMPAT+1),HL
000093 0193 F5              11      PUSH    AF
000094 0194 CD0802          17      CALL    CEXE4
000097 0197 F1              10      POP AF
000098 0198 21D508          10      LD  HL,FNAME
00009B 019B 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
00009E 019E 010B00          10      LD  BC,11
0000A1 01A1 EDB0                    LDIR
0000A3 01A3 C9              10      RET
                                
       01A4                     SDVSW:
0000A4 01A4 F1              10      POP AF
0000A5 01A5 3AD408          13      LD  A,(FDRV)
0000A8 01A8 3D               4      DEC A
0000A9 01A9 5F               4      LD  E,A
0000AA 01AA 0E0E             7      LD  C,00EH      ;(BDOS)カレント・ドライブの設定
0000AC 01AC 183C            12      JR  SYSTEM0
                                
       01AE                     OPEN1:
0000AE 01AE 21D408          10      LD  HL,FDRV
       01B1                     OPEN:
0000B1 01B1 0E11             7      LD  C,011H      ;(BDOS)最初のファイルの検索
       01B3                     OPEN3:
0000B3 01B3 D5              11      PUSH    DE
0000B4 01B4 119F08          10      LD  DE,DTA_CCP
0000B7 01B7 CDD701          17      CALL    SETDTA
0000BA 01BA EB               4      EX  DE,HL
0000BB 01BB CD0500          17      CALL    SYSTEM
0000BE 01BE D1              10      POP DE
0000BF 01BF B7               4      OR  A
0000C0 01C0 C9              10      RET
                                
       01C1                     OPEN2:
0000C1 01C1 0E12             7      LD  C,012H
0000C3 01C3 18EE            12      JR  OPEN3
                                
       01C5                     DEFCB:              ;Z=Ok NZ=Error
0000C5 01C5 119F08          10      LD  DE,DTA_CCP
0000C8 01C8 CDE801          17      CALL    SYSC0F
                                
0000CB 01CB 210000          10      LD  HL,0
0000CE 01CE 22C008          16      LD  (DTA_CCP+33),HL
0000D1 01D1 22C208          16      LD  (DTA_CCP+35),HL
0000D4 01D4 11F908          10      LD  DE,DATA
       01D7                     SETDTA:
0000D7 01D7 C5              11      PUSH    BC
0000D8 01D8 D5              11      PUSH    DE
0000D9 01D9 E5              11      PUSH    HL
0000DA 01DA 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
0000DC 01DC CD0500          17      CALL    SYSTEM
0000DF 01DF E1              10      POP HL
0000E0 01E0 D1              10      POP DE
0000E1 01E1 C1              10      POP BC
0000E2 01E2 C9              10      RET
                                
       01E3                     SETDTA1:
0000E3 01E3 118000          10      LD  DE,DTA1
0000E6 01E6 18EF            12      JR  SETDTA
                                
       01E8                     SYSC0F:
0000E8 01E8 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       01EA                     SYSTEM0:
0000EA 01EA CD0500          17      CALL    SYSTEM
0000ED 01ED B7               4      OR  A
0000EE 01EE C9              10      RET
                                
       01EF                     C_CD:
0000EF 01EF CD7C07          17      CALL    SPCUT
0000F2 01F2 0E5A             7      LD  C,5AH       ;(BDOS)CHDIR カレントディレクトリの変更
0000F4 01F4 C30500          10      JP  SYSTEM
                                
       01F7                     S27DTA:
0000F7 01F7 110100          10      LD  DE,1
0000FA 01FA ED53AD08        20      LD  (DTA_CCP+14),DE
0000FE 01FE 119F08          10      LD  DE,DTA_CCP
       0201                     S27:
000101 0201 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
000103 0203 CD0500          17      CALL    SYSTEM
000106 0206 B7               4      OR  A
000107 0207 C9              10      RET
                                
       0208                     CEXE4:
000108 0208 3AD408          13      LD  A,(FDRV)
00010B 020B 325700          13      LD  (00057H),A
00010E 020E 2AE208          16      LD  HL,(FDRV+14)
000111 0211 225800          16      LD  (00058H),HL
                                
000114 0214 21DD08          10      LD  HL,FNAME+8
000117 0217 7E               7      LD  A,(HL)
000118 0218 FE20             7      CP  020H
00011A 021A 2007            12      JR  NZ,CEXE7
00011C 021C 3E3F             7      LD  A,'?'
00011E 021E 77               7      LD  (HL),A
00011F 021F 23               6      INC HL
000120 0220 77               7      LD  (HL),A
000121 0221 23               6      INC HL
000122 0222 77               7      LD  (HL),A
       0223                     CEXE7:
000123 0223 CDAE01          17      CALL    OPEN1
       0226                     CEXE5:
000126 0226 C0              11      RET NZ
000127 0227 2AA908          16      LD  HL,(DTA_CCP+1+9)
00012A 022A 7C               4      LD  A,H
00012B 022B CD8207          17      CALL    CAP
00012E 022E 67               4      LD  H,A
00012F 022F 7D               4      LD  A,L
000130 0230 CD8207          17      CALL    CAP
000133 0233 6F               4      LD  L,A
000134 0234 3AA808          13      LD  A,(DTA_CCP+1+8)
000137 0237 CD8207          17      CALL    CAP
00013A 023A D642             7      SUB 'B'
00013C 023C 284A            12      JR  Z,C_BAT
00013E 023E 3D               4      DEC A       ;'C'
00013F 023F 2805            12      JR  Z,C_EXE
       0241                     CEXE6:
000141 0241 CDC101          17      CALL    OPEN2
000144 0244 18E0            12      JR  CEXE5
                                
       0246                     C_EXE:
000146 0246 7C               4      LD  A,H
000147 0247 FE4D             7      CP  'M'
000149 0249 20F6            12      JR  NZ,CEXE6
                                
00014B 024B CDC501          17      CALL    DEFCB
00014E 024E 2A0600          16      LD  HL,(SYSTEM+1)
000151 0251 11F908          10      LD  DE,DATA
000154 0254 ED52            15      SBC HL,DE
000156 0256 CDF701          17      CALL    S27DTA
000159 0259 3D               4      DEC A
00015A 025A 37               4      SCF
00015B 025B C0              11      RET NZ
00015C 025C 7C               4      LD  A,H
00015D 025D B5               4      OR  L
00015E 025E 37               4      SCF
00015F 025F C8              11      RET Z
000160 0260 228202          16      LD  (COMSIZ+1),HL
000163 0263 CDE301          17      CALL    SETDTA1
000166 0266 110000          10  COMPAT: LD  DE,0
000169 0269 CDB004          17      CALL    SETFCB
                                
00016C 026C AF               4      XOR A
00016D 026D 67               4      LD  H,A
00016E 026E 6F               4      LD  L,A ;HL=0x0000
00016F 026F F3               4      DI
000170 0270 ED7B0600        20  SPPAT:  LD  SP,(SYSTEM+1)
000174 0274 E5              11      PUSH    HL
000175 0275 21EDB0          10      LD  HL,0B0EDH   ;LDIR 
000178 0278 22FE00          16      LD  (000FEH),HL
00017B 027B 21F908          10      LD  HL,DATA
00017E 027E 110001          10      LD  DE,00100H
000181 0281 010000          10  COMSIZ: LD  BC,0
000184 0284 FB               4      EI
000185 0285 C3FE00          10      JP  000FEH
                                
       0288                     C_BAT:
000188 0288 114154          10      LD  DE,'A'+'T'*256
00018B 028B ED52            15      SBC HL,DE
00018D 028D 20B2            12      JR  NZ,CEXE6
                                
00018F 028F F1              10      POP AF
000190 0290 F1              10      POP AF
000191 0291 CDC501          17      CALL    DEFCB
000194 0294 217E00          10      LD  HL,126
000197 0297 CDF701          17      CALL    S27DTA
00019A 029A C6FE             7      ADD A,0FEH
00019C 029C D8              11      RET C
00019D 029D 4D               4      LD  C,L
00019E 029E 44               4      LD  B,H
00019F 029F 7D               4      LD  A,L
0001A0 02A0 328000          13      LD  (DTA1),A
0001A3 02A3 118100          10      LD  DE,DTA1+1
0001A6 02A6 21F908          10      LD  HL,DATA
0001A9 02A9 EDB0                    LDIR
0001AB 02AB AF               4      XOR A
0001AC 02AC 12               7      LD  (DE),A
0001AD 02AD F1              10      POP AF
0001AE 02AE 118100          10      LD  DE,DTA1+1
0001B1 02B1 CD6F01          17      CALL    COMANL
0001B4 02B4 C33601          10      JP  WSTART
                                
       02B7                     SWITCH:
0001B7 02B7 1A               7      LD  A,(DE)
       02B8                     SW1:
0001B8 02B8 13               6      INC DE
0001B9 02B9 B9               4      CP  C
0001BA 02BA 1A               7      LD  A,(DE)
0001BB 02BB C8              11      RET Z
0001BC 02BC FE20             7      CP  020H
0001BE 02BE 30F8            12      JR  NC,SW1
       02C0                     C_REM:
0001C0 02C0 AF               4      XOR A
0001C1 02C1 C9              10      RET
                                
       02C2                     C_DEL:
0001C2 02C2 CDB004          17      CALL    SETFCB
0001C5 02C5 0E08             7      LD  C,8     ;(BDOS)エコーなしコンソール入力
0001C7 02C7 CD0500          17      CALL    SYSTEM
                                
0001CA 02CA 0E13             7      LD  C,013H
0001CC 02CC 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       02CE                     C_REN:
0001CE 02CE CDB004          17      CALL    SETFCB
0001D1 02D1 3E10             7      LD  A,010H      ;ディレクトリも対象にする
0001D3 02D3 326900          13      LD  (FCB1+13),A ;属性
0001D6 02D6 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       02D8                     CDEL1:
0001D8 02D8 115C00          10      LD  DE,FCB1
0001DB 02DB CD0500          17      CALL    SYSTEM
0001DE 02DE C6FF             7      ADD A,0FFH
0001E0 02E0 C9              10      RET
                                
       02E1                     C_DIR:
0001E1 02E1 CD9406          17      CALL    FILEC
0001E4 02E4 21D508          10      LD  HL,FDRV+1
0001E7 02E7 CD5D06          17      CALL    CWILD1
0001EA 02EA 3EF1             7      LD  A,0F1H
0001EC 02EC 32E108          13      LD  (FDRV+13),A
0001EF 02EF CDAE01          17      CALL    OPEN1
       02F2                     CDIR1:
0001F2 02F2 B7               4      OR  A
0001F3 02F3 2008            12      JR  NZ,PDSKF
0001F5 02F5 CD6903          17      CALL    P_NAME
0001F8 02F8 CDC101          17      CALL    OPEN2
0001FB 02FB 18F5            12      JR  CDIR1
                                
       02FD                     PDSKF:
0001FD 02FD 3AD408          13      LD  A,(FDRV)
000200 0300 5F               4      LD  E,A
000201 0301 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
000203 0303 CD0500          17      CALL    SYSTEM
000206 0306 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
000207 0307 C601             7      ADD A,001H
000209 0309 D8              11      RET C       ;Aが0FFHだった場合
00020A 030A 3E06             7      LD  A,8-2
       030C                     PDS1:               ;HL=未使用クラスタの総数
00020C 030C 3C               4      INC A
00020D 030D CB19             8      RR  C
00020F 030F 30FB            12      JR  NC,PDS1
       0311                     PDS2:               ;B←論理セクタのサイズの上位8ビット
000211 0311 3C               4      INC A
000212 0312 CB18             8      RR  B
000214 0314 30FB            12      JR  NC,PDS2
000216 0316 47               4      LD  B,A
                                
000217 0317 110000          10      LD  DE,0
       031A                     PDS3:
00021A 031A 29              11      ADD HL,HL
00021B 031B EB               4      EX  DE,HL
00021C 031C ED6A            15      ADC HL,HL
00021E 031E EB               4      EX  DE,HL
00021F 031F 10F9            13      DJNZ    PDS3
       0321                     PDSKF1:
000221 0321 CDBB03          17      CALL    PRDEC_DEHL
000224 0324 117408          10      LD  DE,FREE
000227 0327 0E09             7      LD  C,9     ;(BDOS)文字列出力
000229 0329 CD0500          17      CALL    SYSTEM
00022C 032C CD9B03          17      CALL    PUTDRV
00022F 032F 3E5C             7      LD  A,05CH
000231 0331 CD8506          17      CALL    MSG_A
000234 0334 3A9D08          13      LD  A,(MAJOR_VER)
000237 0337 FE01             7      CP  1
000239 0339 3856            12      JR  C,LTNL
00023B 033B 200E            12      JR  NZ,PDSKF2
00023D 033D 2AE208          16      LD  HL,(FDRV+14)
000240 0340 AF               4      XOR A
000241 0341 11FEFF          10      LD  DE,0-2
000244 0344 19              11      ADD HL,DE
000245 0345 23               6      INC HL
000246 0346 DCB703          17      CALL    C,PRDEC_HL
000249 0349 1846            12      JR  LTNL
       034B                     PDSKF2:             ;MSX-DOS2
00024B 034B 3AD408          13      LD  A,(FDRV)
00024E 034E 47               4      LD  B,A     ;ドライブ
00024F 034F 11F908          10      LD  DE,DATA
000252 0352 0E59             7      LD  C,059H      ;(BDOS)GETCD カレントディレクトリの獲得
000254 0354 CD0500          17      CALL    SYSTEM
000257 0357 210500          10      LD  HL,SYSTEM
00025A 035A CD6303          17      CALL    MSX
00025D 035D 1832            12      JR  LTNL
                                
       035F                     MSX1:
00025F 035F 5F               4      LD  E,A
000260 0360 CD7806          17      CALL    _PRINT
       0363                     MSX:
000263 0363 7E               7      LD  A,(HL)
000264 0364 23               6      INC HL
000265 0365 B7               4      OR  A
000266 0366 20F7            12      JR  NZ,MSX1
000268 0368 C9              10      RET
                                
       0369                     P_NAME:
000269 0369 21A008          10      LD  HL,DTA_CCP+1
00026C 036C 7E               7      LD  A,(HL)
00026D 036D FE2E             7      CP  '.'
00026F 036F C8              11      RET Z
000270 0370 CD1104          17      CALL    FPRNT
000273 0373 3AAC08          13      LD  A,(DTA_CCP+13)
000276 0376 CB67             8      BIT 4,A
000278 0378 280A            12      JR  Z,DIR3
00027A 037A 118208          10      LD  DE,DIRMES
00027D 037D 0E09             7      LD  C,9     ;(BDOS)文字列出力
00027F 037F CD0500          17      CALL    SYSTEM
000282 0382 180A            12      JR  DIR6
       0384                     DIR3:
000284 0384 ED5BBE08        20      LD  DE,(DTA_CCP+1+01EH)
000288 0388 2ABC08          16      LD  HL,(DTA_CCP+1+01CH)
00028B 038B CDBB03          17      CALL    PRDEC_DEHL
       038E                     DIR6:
00028E 038E CD3304          17      CALL    PRTTMS
                                
       0391                     LTNL:
000291 0391 1E0D             7      LD  E,00DH
000293 0393 CD7806          17      CALL    _PRINT
000296 0396 1E0A             7      LD  E,00AH
000298 0398 C37806          10      JP  _PRINT
                                
       039B                     PUTDRV:
00029B 039B 3AD408          13      LD  A,(FDRV)
00029E 039E B7               4      OR  A
00029F 039F 200C            12      JR  NZ,PUTDRV1
0002A1 03A1 C5              11      PUSH    BC
0002A2 03A2 D5              11      PUSH    DE
0002A3 03A3 E5              11      PUSH    HL
0002A4 03A4 0E19             7      LD  C,019H
0002A6 03A6 CD0500          17      CALL    SYSTEM
0002A9 03A9 E1              10      POP HL
0002AA 03AA D1              10      POP DE
0002AB 03AB C1              10      POP BC
0002AC 03AC 3C               4      INC A
       03AD                     PUTDRV1:
0002AD 03AD C640             7      ADD A,'A'-1
0002AF 03AF CD8506          17      CALL    MSG_A
0002B2 03B2 3E3A             7      LD  A,':'
       03B4                     MSG_AR:
0002B4 03B4 C38506          10      JP  MSG_A
                                
       03B7                     PRDEC_HL:
0002B7 03B7 AF               4      XOR A
       03B8                     PRDEC_AHL:
0002B8 03B8 5F               4      LD  E,A
0002B9 03B9 1600             7      LD  D,0
       03BB                     PRDEC_DEHL:
0002BB 03BB 3E02             7      LD  A,2
0002BD 03BD 320604          13      LD  (DEC6+1),A
0002C0 03C0 AF               4      XOR A
0002C1 03C1 E5              11      PUSH    HL
0002C2 03C2 21CF08          10      LD  HL,DECBF
0002C5 03C5 0605             7      LD  B,5
0002C7 03C7 CD4307          17      CALL    FILL_MEMORY
0002CA 03CA E1              10      POP HL
                                
0002CB 03CB 0E20             7      LD  C,32
       03CD                     DEC1:
0002CD 03CD 29              11      ADD HL,HL
0002CE 03CE EB               4      EX  DE,HL
0002CF 03CF ED6A            15      ADC HL,HL
0002D1 03D1 EB               4      EX  DE,HL
0002D2 03D2 E5              11      PUSH    HL
0002D3 03D3 21D308          10      LD  HL,DECBF+4
0002D6 03D6 0605             7      LD  B,5
       03D8                     DEC2:
0002D8 03D8 7E               7      LD  A,(HL)
0002D9 03D9 8F               4      ADC A,A
0002DA 03DA 27               4      DAA
0002DB 03DB 77               7      LD  (HL),A
0002DC 03DC 2B               6      DEC HL
0002DD 03DD 10F9            13      DJNZ    DEC2
0002DF 03DF E1              10      POP HL
0002E0 03E0 0D               4      DEC C
0002E1 03E1 20EA            12      JR  NZ,DEC1
                                
0002E3 03E3 21CF08          10      LD  HL,DECBF
0002E6 03E6 3E20             7      LD  A,020H
0002E8 03E8 0604             7      LD  B,4
       03EA                     DEC3:
0002EA 03EA CDF703          17      CALL    DEC4
0002ED 03ED CDF703          17      CALL    DEC4
0002F0 03F0 23               6      INC HL
0002F1 03F1 10F7            13      DJNZ    DEC3
       03F3                     DECX:
0002F3 03F3 CDF703          17      CALL    DEC4
0002F6 03F6 AF               4      XOR A
       03F7                     DEC4:
0002F7 03F7 ED6F            18      RLD
0002F9 03F9 FE20             7      CP  020H
0002FB 03FB 2808            12      JR  Z,DEC6
0002FD 03FD F630             7      OR  030H
       03FF                     DEC5:
0002FF 03FF 18B3            12      JR  MSG_AR
       0401                     DEC7:
000301 0401 3E20             7      LD  A,020H
000303 0403 18AF            12      JR  MSG_AR
       0405                     DEC6:
000305 0405 3E02             7      LD  A,2
000307 0407 B7               4      OR  A
000308 0408 28F7            12      JR  Z,DEC7
00030A 040A 3D               4      DEC A
00030B 040B 320604          13      LD  (DEC6+1),A
00030E 040E 3E20             7      LD  A,020H
000310 0410 C9              10      RET
                                
       0411                     FPRNT:
000311 0411 0608             7      LD  B,8
000313 0413 CD2404          17      CALL    P_N1
000316 0416 7E               7      LD  A,(HL)
000317 0417 C680             7      ADD A,0A0H-020H
000319 0419 FEA0             7      CP  0A0H
00031B 041B 2802            12      JR  Z,FPR1
00031D 041D 3E2E             7      LD  A,'.'
       041F                     FPR1:
00031F 041F CD8506          17      CALL    MSG_A
000322 0422 0603             7      LD  B,3
                                
       0424                     P_N1:
000324 0424 C5              11      PUSH    BC
000325 0425 E5              11      PUSH    HL
000326 0426 7E               7      LD  A,(HL)
000327 0427 CD8E07          17      CALL    CAP3
00032A 042A CD8506          17      CALL    MSG_A
00032D 042D E1              10      POP HL
00032E 042E C1              10      POP BC
00032F 042F 23               6      INC HL
000330 0430 10F2            13      DJNZ    P_N1
000332 0432 C9              10      RET
                                
       0433                     PRTTMS:
000333 0433 3E20             7      LD  A,020H
000335 0435 CD8506          17      CALL    MSG_A
                                
000338 0438 2AB808          16      LD  HL,(DTA_CCP+1+24)
00033B 043B 7D               4      LD  A,L
00033C 043C B7               4      OR  A
00033D 043D C8              11      RET Z
00033E 043E CB3C             8      SRL H
000340 0440 17               4      RLA
000341 0441 17               4      RLA
000342 0442 17               4      RLA
000343 0443 17               4      RLA
000344 0444 E60F             7      AND 00FH
000346 0446 57               4      LD  D,A
000347 0447 7C               4      LD  A,H
000348 0448 C650             7      ADD A,80
00034A 044A CD9B04          17      CALL    PRDEC_A
00034D 044D 3E2D             7      LD  A,'-'
00034F 044F CD8506          17      CALL    MSG_A
000352 0452 7A               4      LD  A,D
000353 0453 CD9B04          17      CALL    PRDEC_A
000356 0456 3E2D             7      LD  A,'-'
000358 0458 CD8506          17      CALL    MSG_A
00035B 045B 7D               4      LD  A,L
00035C 045C E61F             7      AND 01FH
00035E 045E CD9B04          17      CALL    PRDEC_A
                                
000361 0461 CD3008          17      CALL    GET_WIDTH
000364 0464 FE21             7      CP  32+1
000366 0466 3005            12      JR  NC,SHOW_TIME
000368 0468 3E1D             7      LD  A,01DH
00036A 046A C38506          10      JP  MSG_A
       046D                     SHOW_TIME:
00036D 046D 2AB608          16      LD  HL,(DTA_CCP+1+22)
                                
000370 0470 3E20             7      LD  A,020H
000372 0472 CD8506          17      CALL    MSG_A
000375 0475 7C               4      LD  A,H
000376 0476 65               4      LD  H,L
000377 0477 1F               4      RRA
000378 0478 CB1D             8      RR  L
00037A 047A 1F               4      RRA
00037B 047B CB1D             8      RR  L
00037D 047D 1F               4      RRA
00037E 047E CB1D             8      RR  L
000380 0480 E61F             7      AND 01FH
000382 0482 CD9B04          17      CALL    PRDEC_A
000385 0485 3E3A             7      LD  A,':'
000387 0487 CD8506          17      CALL    MSG_A
00038A 048A 7D               4      LD  A,L
00038B 048B 0F               4      RRCA
00038C 048C 0F               4      RRCA
00038D 048D E63F             7      AND 03FH
00038F 048F CD9B04          17      CALL    PRDEC_A
                                
000392 0492 3E3A             7      LD  A,':'
000394 0494 CD8506          17      CALL    MSG_A
000397 0497 7C               4      LD  A,H
000398 0498 E61F             7      AND 01FH
00039A 049A 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       049B                     PRDEC_A:
00039B 049B E5              11      PUSH    HL
00039C 049C 0608             7      LD  B,8
00039E 049E 4F               4      LD  C,A
00039F 049F AF               4      XOR A
       04A0                     PRTA1:
0003A0 04A0 CB01             4      RLC C
0003A2 04A2 8F               4      ADC A,A
0003A3 04A3 27               4      DAA
0003A4 04A4 10FA            13      DJNZ    PRTA1
0003A6 04A6 21CF08          10      LD  HL,DECBF
0003A9 04A9 77               7      LD  (HL),A
0003AA 04AA AF               4      XOR A
0003AB 04AB CDF303          17      CALL    DECX
0003AE 04AE E1              10      POP HL
0003AF 04AF C9              10      RET
                                
       04B0                     SETFCB:
0003B0 04B0 CD7C07          17      CALL    SPCUT
0003B3 04B3 1A               7      LD  A,(DE)
0003B4 04B4 FE20             7      CP  020H
0003B6 04B6 3801            12      JR  C,SETFCBA
0003B8 04B8 1B               6      DEC DE
       04B9                     SETFCBA:
0003B9 04B9 D5              11      PUSH    DE
0003BA 04BA 215C00          10      LD  HL,FCB1
0003BD 04BD 115D00          10      LD  DE,FCB1+1
0003C0 04C0 012300          10      LD  BC,00023H
0003C3 04C3 70               7      LD  (HL),B      ;B=0
0003C4 04C4 EDB0                    LDIR
0003C6 04C6 D1              10      POP DE
0003C7 04C7 D5              11      PUSH    DE
0003C8 04C8 215C00          10      LD  HL,FCB1
0003CB 04CB CD1308          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0003CE 04CE 216C00          10      LD  HL,FCB2
0003D1 04D1 CD1308          17      CALL    _SYS29      ;(BDOS)ファイル名の解析
0003D4 04D4 E1              10      POP HL
0003D5 04D5 010050          10      LD  BC,05000H
0003D8 04D8 118100          10      LD  DE,00081H
       04DB                     SETFCB1:
0003DB 04DB 7E               7      LD  A,(HL)
0003DC 04DC 23               6      INC HL
0003DD 04DD FE20             7      CP  020H
0003DF 04DF 3805            12      JR  C,SETFCB2
0003E1 04E1 12               7      LD  (DE),A
0003E2 04E2 13               6      INC DE
0003E3 04E3 0C               4      INC C
0003E4 04E4 10F5            13      DJNZ    SETFCB1
       04E6                     SETFCB2:
0003E6 04E6 79               4      LD  A,C
0003E7 04E7 328000          13      LD  (DTA1),A
0003EA 04EA 04               4      INC B
0003EB 04EB AF               4      XOR A
       04EC                     SETFCB3:
0003EC 04EC 12               7      LD  (DE),A
0003ED 04ED 13               6      INC DE
0003EE 04EE 10FC            13      DJNZ    SETFCB3
0003F0 04F0 C9              10      RET
                                
       04F1                     C_COPY:
0003F1 04F1 CDB004          17      CALL    SETFCB
0003F4 04F4 118100          10      LD  DE,DTA1+1
0003F7 04F7 0E2F             7      LD  C,'/'
0003F9 04F9 CDB702          17      CALL    SWITCH
0003FC 04FC CD8207          17      CALL    CAP
0003FF 04FF 328905          13      LD  (SW+1),A
                                
000402 0502 119E08          10      LD  DE,ZERO
000405 0505 CD9706          17      CALL    FILEC2
000408 0508 216C00          10      LD  HL,FCB2
00040B 050B CD1A08          17      CALL    S29X1
                                
00040E 050E 3E10             7      LD  A,010H
000410 0510 326900          13      LD  (FCB1+13),A
000413 0513 216D00          10      LD  HL,FCB2+1
000416 0516 CD5D06          17      CALL    CWILD1
       0519                     COPY0:
000419 0519 CD5A06          17      CALL    CWILD
00041C 051C 215C00          10      LD  HL,FCB1
00041F 051F CDB101          17      CALL    OPEN
000422 0522 37               4      SCF
       0523                     COPY1:
000423 0523 C0              11      RET NZ
000424 0524 CDC501          17      CALL    DEFCB
                                
000427 0527 3AAC08          13      LD  A,(DTA_CCP+13)
00042A 052A CB67             8      BIT 4,A
00042C 052C 2826            12      JR  Z,COPY1A
                                
00042E 052E 215D00          10      LD  HL,FCB1+1
000431 0531 CDBB07          17      CALL    CHKWILD
000434 0534 3819            12      JR  C,COPY9
                                
000436 0536 3E20             7      LD  A,020H
000438 0538 325D00          13      LD  (FCB1+1),A
00043B 053B 2AB908          16      LD  HL,(DTA_CCP+26)
00043E 053E 23               6      INC HL
00043F 053F 226A00          16      LD  (FCB1+14),HL
000442 0542 18D5            12      JR  COPY0
                                
       0544                     COPYS:
000444 0544 119008          10      LD  DE,SKIP
       0547                     COPY8:
000447 0547 0E09             7      LD  C,9     ;(BDOS)文字列出力
000449 0549 CD0500          17      CALL    SYSTEM
00044C 054C CD9103          17      CALL    LTNL
       054F                     COPY9:
00044F 054F CDC101          17      CALL    OPEN2
000452 0552 18CF            12      JR  COPY1
                                
       0554                     COPY1A:
000454 0554 216C00          10      LD  HL,FCB2
000457 0557 11D408          10      LD  DE,FDRV
00045A 055A 01A108          10      LD  BC,DTA_CCP+2
00045D 055D EDA0            16      LDI
00045F 055F 3E0B             7      LD  A,11
       0561                     COPY2:
000461 0561 F5              11      PUSH    AF
000462 0562 7E               7      LD  A,(HL)
000463 0563 FE3F             7      CP  '?'
000465 0565 2001            12      JR  NZ,COPY3
000467 0567 0A               7      LD  A,(BC)
       0568                     COPY3:
000468 0568 12               7      LD  (DE),A
000469 0569 03               6      INC BC
00046A 056A 13               6      INC DE
00046B 056B 23               6      INC HL
00046C 056C F1              10      POP AF
00046D 056D 3D               4      DEC A
00046E 056E 20F1            12      JR  NZ,COPY2
000470 0570 010500          10      LD  BC,16-11
000473 0573 EDB0                    LDIR
       0575                     PUTNAME:
000475 0575 215D00          10      LD  HL,FCB1+1
000478 0578 CDBB07          17      CALL    CHKWILD
00047B 057B 300B            12      JR  NC,PUTN1
00047D 057D 21D508          10      LD  HL,FDRV+1
000480 0580 CD1104          17      CALL    FPRNT
000483 0583 3E20             7      LD  A,020H
000485 0585 CD8506          17      CALL    MSG_A
       0588                     PUTN1:
000488 0588 3E00             7  SW: LD  A,000H
00048A 058A FE54             7      CP  'T'
00048C 058C 2005            12      JR  NZ,CSW1
00048E 058E 21A805          10      LD  HL,SWNE
000491 0591 1807            12      JR  SWT1
       0593                     CSW1:
000493 0593 FE4E             7      CP  'N'
000495 0595 2011            12      JR  NZ,SWNE
000497 0597 214405          10      LD  HL,COPYS
       059A                     SWT1:
00049A 059A 11D408          10      LD  DE,FDRV
00049D 059D CDE801          17      CALL    SYSC0F
0004A0 05A0 2801            12      JR  Z,SWN1
0004A2 05A2 E9               4      JP  (HL)
       05A3                     SWN1:
0004A3 05A3 CD0606          17      CALL    CTIME
0004A6 05A6 309C            12      JR  NC,COPYS
       05A8                     SWNE:
0004A8 05A8 11D408          10      LD  DE,FDRV
0004AB 05AB 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
0004AD 05AD CDEA01          17      CALL    SYSTEM0
0004B0 05B0 2052            12      JR  NZ,COPYE2
0004B2 05B2 67               4      LD  H,A     ;A=0
0004B3 05B3 6F               4      LD  L,A
0004B4 05B4 22F508          16      LD  (FDRV+33),HL    ;(FCB)ランダム・レコード
0004B7 05B7 22F708          16      LD  (FDRV+35),HL
0004BA 05BA 2C               4      INC L       ;HL=1
0004BB 05BB 22E208          16      LD  (FDRV+14),HL    ;(FCB)レコード・サイズ
       05BE                     COPY6:
0004BE 05BE CD6C06          17      CALL    BUFSIZ
0004C1 05C1 CDF701          17      CALL    S27DTA
0004C4 05C4 3C               4      INC A
0004C5 05C5 2835            12      JR  Z,COPYE
0004C7 05C7 47               4      LD  B,A
0004C8 05C8 7C               4      LD  A,H
0004C9 05C9 B5               4      OR  L
0004CA 05CA 280F            12      JR  Z,COPY7
0004CC 05CC 11D408          10      LD  DE,FDRV
0004CF 05CF C5              11      PUSH    BC
0004D0 05D0 0E26             7      LD  C,026H      ;(BDOS)ランダム・ブロック・ライト
0004D2 05D2 CD0500          17      CALL    SYSTEM
0004D5 05D5 C1              10      POP BC
0004D6 05D6 B7               4      OR  A
0004D7 05D7 2023            12      JR  NZ,COPYE
0004D9 05D9 10E3            13      DJNZ    COPY6
       05DB                     COPY7:
0004DB 05DB 3AAC08          13      LD  A,(DTA_CCP+13)  ;(FCB)属性(アトリビュート)
0004DE 05DE 32E108          13      LD  (FDRV+13),A ;(FCB)属性(アトリビュート)
0004E1 05E1 21B308          10      LD  HL,DTA_CCP+20
0004E4 05E4 11E808          10      LD  DE,FDRV+20  ;(FCB)更新日時
0004E7 05E7 010400          10      LD  BC,4
0004EA 05EA EDB0                    LDIR
                                
0004EC 05EC 11D408          10      LD  DE,FDRV
0004EF 05EF 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0004F1 05F1 CDEA01          17      CALL    SYSTEM0
0004F4 05F4 2006            12      JR  NZ,COPYE
                                
0004F6 05F6 118D08          10      LD  DE,OK
0004F9 05F9 C34705          10      JP  COPY8
                                
       05FC                     COPYE:
0004FC 05FC 11D408          10      LD  DE,FDRV
0004FF 05FF 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
000501 0601 CD0500          17      CALL    SYSTEM
       0604                     COPYE2:
000504 0604 37               4      SCF
000505 0605 C9              10      RET
                                
       0606                     CTIME:
000506 0606 ED5BB308        20      LD  DE,(DTA_CCP+20)
00050A 060A 2AE808          16      LD  HL,(FDRV+20)
00050D 060D A7               4      AND A
00050E 060E ED52            15      SBC HL,DE
000510 0610 C0              11      RET NZ
000511 0611 ED5BB508        20      LD  DE,(DTA_CCP+22)
000515 0615 2AEA08          16      LD  HL,(FDRV+22)
000518 0618 ED52            15      SBC HL,DE
00051A 061A C9              10      RET
                                
       061B                     C_TYPE:
00051B 061B CDB004          17      CALL    SETFCB
00051E 061E 215C00          10      LD  HL,FCB1
000521 0621 CDB101          17      CALL    OPEN
000524 0624 37               4      SCF
       0625                     TYPE1:
000525 0625 C0              11      RET NZ
000526 0626 CDC501          17      CALL    DEFCB
000529 0629 3E1A             7      LD  A,01AH
00052B 062B CD8506          17      CALL    MSG_A
       062E                     TYPE2:
00052E 062E CD6C06          17      CALL    BUFSIZ
000531 0631 CDF701          17      CALL    S27DTA
000534 0634 C6FE             7      ADD A,0FEH
000536 0636 D8              11      RET C
000537 0637 7C               4      LD  A,H
000538 0638 B5               4      OR  L
000539 0639 281A            12      JR  Z,TYPEE
00053B 063B 01F908          10      LD  BC,DATA
       063E                     TYPE3:
00053E 063E 0A               7      LD  A,(BC)
00053F 063F 03               6      INC BC
000540 0640 FE1A             7      CP  01AH
000542 0642 2811            12      JR  Z,TYPEE
000544 0644 5F               4      LD  E,A
000545 0645 C5              11      PUSH    BC
000546 0646 E5              11      PUSH    HL
000547 0647 0E02             7      LD  C,2     ;(BDOS)コンソール出力
000549 0649 CD0500          17      CALL    SYSTEM
00054C 064C E1              10      POP HL
00054D 064D C1              10      POP BC
00054E 064E 2B               6      DEC HL
00054F 064F 7C               4      LD  A,H
000550 0650 B5               4      OR  L
000551 0651 20EB            12      JR  NZ,TYPE3
000553 0653 18D9            12      JR  TYPE2
       0655                     TYPEE:
000555 0655 CDC101          17      CALL    OPEN2
000558 0658 18CB            12      JR  TYPE1
                                
       065A                     CWILD:
00055A 065A 215D00          10      LD  HL,FCB1+1
       065D                     CWILD1:
00055D 065D 7E               7      LD  A,(HL)
00055E 065E FE20             7      CP  020H
000560 0660 C0              11      RET NZ
       0661                     CWILD2:
000561 0661 54               4      LD  D,H
000562 0662 5D               4      LD  E,L
000563 0663 13               6      INC DE
000564 0664 010A00          10      LD  BC,10
000567 0667 363F            10      LD  (HL),'?'
000569 0669 EDB0                    LDIR
00056B 066B C9              10      RET
                                
       066C                     BUFSIZ:
00056C 066C 3A0700          13      LD  A,(SYSTEM+2)
00056F 066F D609             7      SUB (DATA/256)+1
000571 0671 E6F8             7      AND 0F8H
000573 0673 67               4      LD  H,A
000574 0674 2E00             7      LD  L,0
000576 0676 C9              10      RET
                                
000577 0677 E9               4  JP_HL:  JP  (HL)
                                
       0678                     _PRINT:
000578 0678 C5              11      PUSH    BC
000579 0679 D5              11      PUSH    DE
00057A 067A E5              11      PUSH    HL
00057B 067B 0E06             7      LD  C,6
00057D 067D CD0500          17      CALL    SYSTEM
000580 0680 E1              10      POP HL
000581 0681 D1              10      POP DE
000582 0682 C1              10      POP BC
000583 0683 B7               4      OR  A
000584 0684 C9              10      RET
                                
       0685                     MSG_A:
000585 0685 F5              11      PUSH    AF
000586 0686 C5              11      PUSH    BC
000587 0687 D5              11      PUSH    DE
000588 0688 E5              11      PUSH    HL
000589 0689 5F               4      LD  E,A
00058A 068A 0E02             7      LD  C,2
00058C 068C CD0500          17      CALL    SYSTEM
00058F 068F E1              10      POP HL
000590 0690 D1              10      POP DE
000591 0691 C1              10      POP BC
000592 0692 F1              10      POP AF
000593 0693 C9              10      RET
                                ;       FILE
       0694                     FILEC:
000594 0694 CD9F06          17      CALL    FILE
       0697                     FILEC2:
000597 0697 3AD508          13      LD  A,(FDRV+1)
00059A 069A FE20             7      CP  020H
00059C 069C C8              11      RET Z
00059D 069D 1839            12      JR  SETDIR1
                                
       069F                     FILE:
00059F 069F AF               4      XOR A
0005A0 06A0 32D408          13      LD  (FDRV),A
0005A3 06A3 67               4      LD  H,A
0005A4 06A4 6F               4      LD  L,A
0005A5 06A5 22E208          16      LD  (FDRV+14),HL
0005A8 06A8 CD7C07          17      CALL    SPCUT
0005AB 06AB CD6107          17      CALL    CCHK3
0005AE 06AE 2812            12      JR  Z,DEVI1
0005B0 06B0 13               6      INC DE
0005B1 06B1 1A               7      LD  A,(DE)
0005B2 06B2 1B               6      DEC DE
0005B3 06B3 FE3A             7      CP  ':'
0005B5 06B5 200B            12      JR  NZ,DEVI1
0005B7 06B7 1A               7      LD  A,(DE)      ;DRIVE
0005B8 06B8 CD8207          17      CALL    CAP
0005BB 06BB D640             7      SUB '@'
0005BD 06BD 13               6      INC DE
0005BE 06BE 13               6      INC DE
0005BF 06BF 32D408          13      LD  (FDRV),A
       06C2                     DEVI1:
0005C2 06C2 1A               7      LD  A,(DE)
0005C3 06C3 D65C             7      SUB 05CH        ;\
0005C5 06C5 2009            12      JR  NZ,NOROOT
0005C7 06C7 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
0005C8 06C8 22EE08          16      LD  (FDRV+26),HL
0005CB 06CB 2C               4      INC L
0005CC 06CC 22E208          16      LD  (FDRV+14),HL
0005CF 06CF 13               6      INC DE
       06D0                     NOROOT:
                                
       06D0                     SETDIR:
0005D0 06D0 CD0107          17      CALL    FILED
0005D3 06D3 1A               7      LD  A,(DE)
0005D4 06D4 FE5C             7      CP  05CH        ;\
0005D6 06D6 C0              11      RET NZ
0005D7 06D7 13               6      INC DE
       06D8                     SETDIR1:
0005D8 06D8 3A9D08          13      LD  A,(MAJOR_VER)
0005DB 06DB FE01             7      CP  1
0005DD 06DD C0              11      RET NZ
                                                ;for LSX-Dodgers
0005DE 06DE 3E10             7      LD  A,010H      ;Directory
0005E0 06E0 32E108          13      LD  (FDRV+13),A
0005E3 06E3 D5              11      PUSH    DE
0005E4 06E4 11D408          10      LD  DE,FDRV
0005E7 06E7 0E0F             7      LD  C,00FH
0005E9 06E9 CD0500          17      CALL    SYSTEM
0005EC 06EC D1              10      POP DE
0005ED 06ED B7               4      OR  A
0005EE 06EE C0              11      RET NZ
                                
0005EF 06EF 3AE108          13      LD  A,(FDRV+13)
0005F2 06F2 CB67             8      BIT 4,A
0005F4 06F4 C8              11      RET Z
                                
0005F5 06F5 CD4807          17      CALL    FILEI
0005F8 06F8 2AEE08          16      LD  HL,(FDRV+26)
0005FB 06FB 23               6      INC HL
0005FC 06FC 22E208          16      LD  (FDRV+14),HL
0005FF 06FF 18CF            12      JR  SETDIR
                                
       0701                     FILED:
000601 0701 CD4807          17      CALL    FILEI
                                
000604 0704 0608             7      LD  B,8
       0706                     FILE2:
000606 0706 CD5607          17      CALL    CCHKF
000609 0709 C8              11      RET Z
00060A 070A FE2A             7      CP  '*'
00060C 070C 282E            12      JR  Z,FILE9
00060E 070E FE2E             7      CP  '.'
000610 0710 280C            12      JR  Z,FILE4
000612 0712 77               7      LD  (HL),A
000613 0713 23               6      INC HL
000614 0714 10F0            13      DJNZ    FILE2
                                
       0716                     FILE3:
000616 0716 CD5607          17      CALL    CCHKF
000619 0719 C8              11      RET Z
00061A 071A FE2E             7      CP  '.'
00061C 071C 20F8            12      JR  NZ,FILE3
                                
       071E                     FILE4:
00061E 071E 21DD08          10      LD  HL,FNAME+8
000621 0721 0603             7      LD  B,3
                                
       0723                     FILE4L:
000623 0723 CD5607          17      CALL    CCHKF
000626 0726 C8              11      RET Z
000627 0727 FE2E             7      CP  '.'
000629 0729 2008            12      JR  NZ,FILE12
00062B 072B 32D508          13      LD  (FNAME),A   ;Parent directory(..)
00062E 072E 32D608          13      LD  (FNAME+1),A
000631 0731 3E20             7      LD  A,020H
       0733                     FILE12:
000633 0733 FE2A             7      CP  '*'
000635 0735 280A            12      JR  Z,FILE10
000637 0737 77               7      LD  (HL),A
000638 0738 23               6      INC HL
000639 0739 10E8            13      DJNZ    FILE4L
00063B 073B C9              10      RET
                                
       073C                     FILE9:              ;名前の*処理、名前の残りを?で埋める
00063C 073C CD4107          17      CALL    FILE10
00063F 073F 18D5            12      JR  FILE3
                                
       0741                     FILE10:
000641 0741 3E3F             7      LD  A,'?'
                                
       0743                     FILL_MEMORY:                ;HLからBバイトAで埋める
000643 0743 77               7      LD  (HL),A
000644 0744 23               6      INC HL
000645 0745 10FC            13      DJNZ    FILL_MEMORY
000647 0747 C9              10      RET
                                
       0748                     FILEI:              ;名前＋拡張子をスペースで初期化
000648 0748 3E20             7      LD  A,020H
00064A 074A 01000B          10      LD  BC,11*256
00064D 074D 21D508          10      LD  HL,FNAME
000650 0750 E5              11      PUSH    HL
000651 0751 CD4307          17      CALL    FILL_MEMORY
000654 0754 E1              10      POP HL
000655 0755 C9              10      RET
                                
       0756                     CCHKF:
000656 0756 1A               7      LD  A,(DE)
000657 0757 CD5E07          17      CALL    CCHK2
00065A 075A C8              11      RET Z
00065B 075B C3A407          10      JP  FKAN
                                
       075E                     CCHK2:
00065E 075E 0C               4      INC C
00065F 075F 0D               4      DEC C
000660 0760 C0              11      RET NZ
       0761                     CCHK3:              ;ZF=1 で使えない文字
000661 0761 FE2B             7      CP  '+'
000663 0763 C8              11      RET Z
000664 0764 FE2C             7      CP  ','
000666 0766 C8              11      RET Z
000667 0767 FE2F             7      CP  '/'
000669 0769 C8              11      RET Z
00066A 076A FE3A             7      CP  ':'
00066C 076C C8              11      RET Z
00066D 076D FE3B             7      CP  ';'
00066F 076F C8              11      RET Z
000670 0770 FE3D             7      CP  '='
000672 0772 C8              11      RET Z
000673 0773 FE5C             7      CP  05CH    ;\
000675 0775 C8              11      RET Z
000676 0776 FE20             7      CP  020H
000678 0778 D0              11      RET NC
000679 0779 BF               4      CP  A       ;Z=1
00067A 077A C9              10      RET
                                
       077B                     SS1:
00067B 077B 13               6      INC DE
       077C                     SPCUT:              ;スペースをカット
00067C 077C 1A               7      LD  A,(DE)
00067D 077D FE20             7      CP  020H
00067F 077F 28FA            12      JR  Z,SS1
000681 0781 C9              10      RET
                                
       0782                     CAP:
000682 0782 FE61             7      CP  'a'
000684 0784 D8              11      RET C
000685 0785 FE7B             7      CP  'z'+1
000687 0787 D0              11      RET NC
000688 0788 D620             7      SUB 020H
00068A 078A C9              10      RET
       078B                     CAP2:
00068B 078B CD8207          17      CALL    CAP
       078E                     CAP3:
00068E 078E CD9707          17      CALL    CAP4
000691 0791 FE21             7      CP  021H
000693 0793 D0              11      RET NC
000694 0794 3E20             7      LD  A,020H
000696 0796 C9              10      RET
       0797                     CAP4:
000697 0797 FE05             7      CP  5
000699 0799 C0              11      RET NZ
00069A 079A 3EE5             7      LD  A,0E5H
00069C 079C C9              10      RET
                                
       079D                     FKANC:
00069D 079D CB41             8      BIT 0,C
00069F 079F CC8B07          17      CALL    Z,CAP2
0006A2 07A2 1801            12      JR  FKANX
       07A4                     FKAN:           ;漢字チェック
0006A4 07A4 13               6      INC DE
       07A5                     FKANX:
0006A5 07A5 CB41             8      BIT 0,C
0006A7 07A7 CB81             8      RES 0,C
0006A9 07A9 C0              11      RET NZ
0006AA 07AA FE80             7      CP  080H
0006AC 07AC D8              11      RET C
0006AD 07AD FEA0             7      CP  0A0H
0006AF 07AF 3803            12      JR  C,FKAN1
0006B1 07B1 FEE0             7      CP  0E0H
0006B3 07B3 D8              11      RET C
       07B4                     FKAN1:
0006B4 07B4 0C               4      INC C
0006B5 07B5 A7               4      AND A
0006B6 07B6 C9              10      RET
                                
       07B7                     CHKWILDX:
0006B7 07B7 FDE5            15      PUSH    IY
0006B9 07B9 E1              10      POP HL
0006BA 07BA 23               6      INC HL
       07BB                     CHKWILD:
0006BB 07BB 060B             7      LD  B,11
0006BD 07BD 3E3F             7      LD  A,'?'
       07BF                     CHKWIL1:
0006BF 07BF BE               7      CP  (HL)
0006C0 07C0 23               6      INC HL
0006C1 07C1 37               4      SCF
0006C2 07C2 C8              11      RET Z
0006C3 07C3 10FA            13      DJNZ    CHKWIL1
0006C5 07C5 AF               4      XOR A
0006C6 07C6 C9              10      RET
                                
       07C7                     CPNAME:
0006C7 07C7 C5              11      PUSH    BC
0006C8 07C8 D5              11      PUSH    DE
0006C9 07C9 11C408          10      LD  DE,CPBUF
0006CC 07CC 010400          10      LD  BC,4
0006CF 07CF EDB0                    LDIR
0006D1 07D1 D1              10      POP DE
0006D2 07D2 D5              11      PUSH    DE
0006D3 07D3 E5              11      PUSH    HL
0006D4 07D4 21C408          10      LD  HL,CPBUF
0006D7 07D7 CDEA07          17      CALL    CPFILE
0006DA 07DA E1              10      POP HL
0006DB 07DB D1              10      POP DE
0006DC 07DC C1              10      POP BC
0006DD 07DD 2005            12      JR  NZ,CPNAME1
0006DF 07DF 7E               7      LD  A,(HL)
0006E0 07E0 23               6      INC HL
0006E1 07E1 66               7      LD  H,(HL)
0006E2 07E2 6F               4      LD  L,A
0006E3 07E3 C9              10      RET
       07E4                     CPNAME1:
0006E4 07E4 23               6      INC HL
0006E5 07E5 23               6      INC HL
0006E6 07E6 10DF            13      DJNZ    CPNAME
0006E8 07E8 37               4      SCF
0006E9 07E9 C9              10      RET
                                
       07EA                     CPFILE:
0006EA 07EA C5              11      PUSH    BC
0006EB 07EB 01000B          10      LD  BC,00B00H
       07EE                     CPSTR1:
0006EE 07EE 1A               7      LD  A,(DE)
0006EF 07EF FE3F             7      CP  '?'     ;Wild card
0006F1 07F1 2812            12      JR  Z,CPSTR2
0006F3 07F3 7E               7      LD  A,(HL)
0006F4 07F4 CD9D07          17      CALL    FKANC
0006F7 07F7 E5              11      PUSH    HL
0006F8 07F8 67               4      LD  H,A
0006F9 07F9 1A               7      LD  A,(DE)
0006FA 07FA CB01             4      RLC C
0006FC 07FC CD9D07          17      CALL    FKANC
0006FF 07FF CB09             4      RRC C
000701 0801 BC               4      CP  H       ;CP (HL),(DE)
000702 0802 E1              10      POP HL
000703 0803 2004            12      JR  NZ,CPSTR3
       0805                     CPSTR2:
000705 0805 13               6      INC DE
000706 0806 23               6      INC HL
000707 0807 10E5            13      DJNZ    CPSTR1
       0809                     CPSTR3:
000709 0809 C1              10      POP BC
00070A 080A C9              10      RET
                                
       080B                     CPFILE2:
00070B 080B FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00070E 080E F6E1             7      OR  0E1H
000710 0810 2F               4      CPL
000711 0811 A6               7      AND (HL)
000712 0812 C9              10      RET
                                
       0813                     _SYS29:     ;(BDOS)ファイル名の解析
000713 0813 C5              11      PUSH    BC
000714 0814 E5              11      PUSH    HL
000715 0815 CD9F06          17      CALL    FILE
000718 0818 E1              10      POP HL
000719 0819 C1              10      POP BC
       081A                     S29X1:
00071A 081A C5              11      PUSH    BC
00071B 081B D5              11      PUSH    DE
00071C 081C E5              11      PUSH    HL
00071D 081D EB               4      EX  DE,HL
00071E 081E 21D408          10      LD  HL,FDRV
000721 0821 010D00          10      LD  BC,13
000724 0824 EDB0                    LDIR
000726 0826 70               7      LD  (HL),B      ;B=0
000727 0827 0E03             7      LD  C,3
000729 0829 EDB0                    LDIR
00072B 082B E1              10      POP HL
00072C 082C D1              10      POP DE
00072D 082D C1              10      POP BC
00072E 082E AF               4      XOR A
00072F 082F C9              10      RET
       0830                     GET_WIDTH:
000730 0830 3A9D08          13      LD  A,(MAJOR_VER)
000733 0833 FE01             7      CP  1
000735 0835 2804            12      JR  Z,NOT_MSX
000737 0837 3AB0F3          13      LD  A,(0F3B0H)  ;WIDTH
00073A 083A C9              10      RET
       083B                     NOT_MSX:
00073B 083B E5              11      PUSH    HL
00073C 083C 2A0A00          16      LD  HL,(BASE-1)
00073F 083F 2EB1             7      LD  L,0B1H
000741 0841 7E               7      LD  A,(HL)
000742 0842 E1              10      POP HL
000743 0843 C9              10      RET
                                
                                ;PATHX  EQU 64
                                ;PATHD: DS  PATHX
                                ;PATHE: DB  0
                                
       0008                     COMS    EQU 8
       0844                     COMTB:
000744 0844 44202020                DB  "D   "  ;1
000748 0848 E102                    DW  C_DIR
00074A 084A 44495220                DB  "DIR "  ;2
00074E 084E E102                    DW  C_DIR
000750 0850 434F5059                DB  "COPY"  ;3
000754 0854 F104                    DW  C_COPY
000756 0856 43442020                DB  "CD  "  ;4
00075A 085A EF01                    DW  C_CD
00075C 085C 44454C20                DB  "DEL "  ;5
000760 0860 C202                    DW  C_DEL
                                ;   DB  "PATH"  ;6
                                ;   DW  C_PATH
000762 0862 52454E20                DB  "REN "  ;7
000766 0866 CE02                    DW  C_REN
000768 0868 54595045                DB  "TYPE"  ;8
00076C 086C 1B06                    DW  C_TYPE
00076E 086E 52454D20                DB  "REM "  ;9
000772 0872 C002                    DW  C_REM
                                
000774 0874 2062797465732066    FREE:   DB  " bytes free  $"
            726565202024        
000782 0882 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
00078D 088D 4F4B24              OK: DB  "OK$"
000790 0890 536B697024          SKIP:   DB  "Skip$"
000795 0895 4572726F722124      COMERM: DB  "Error!$"
                                
       089C                     MSX_VER:
00079C 089C 00                      DB  0
       089D                     MAJOR_VER:
00079D 089D 00                      DB  0
                                
00079E 089E 00                  ZERO:   DB  0
                                
       089F                     DTA_CCP:
00079F 089F                         DS  37
       08C4                     CPBUF:
0007C4 08C4 0000                LEFTX:  DW  0
0007C6 08C6 0000                DTAX:   DW  0
0007C8 08C8 20                      DB  020H    ;CPBUFで使う
0007C9 08C9 20                      DB  020H
0007CA 08CA 20                      DB  020H
0007CB 08CB 20                      DB  020H
0007CC 08CC 20                      DB  020H
0007CD 08CD 20                      DB  020H
0007CE 08CE 20                      DB  020H
                                
       08CF                     DECBF:
0007CF 08CF                         DS  5
       08D4                     FDRV:
0007D4 08D4 00                      DB  0
       08D5                     FNAME:
0007D5 08D5                         DS  35
0007F8 08F8 00                      DB  0   ;DSで終わるとゼロクリアされない
                                
       08F9                     DATA:
[EOF:COMMAND.ASM:SHIFT_JIS]
