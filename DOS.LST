                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   似非DOS
                                
       0005                     SYSTEM  EQU 00005H
       001C                     CALSLT  EQU 0001CH
       0024                     ENASLT  EQU 00024H  
       005F                     CHGMOD  EQU 0005FH
       006C                     INITXT  EQU 0006CH
       0078                     SETTXT  EQU 00078H
       005C                     FCB1    EQU 0005CH
       0080                     DTA1    EQU 00080H
       F307                     FCB11   EQU 0F307H
       F37D                     BDOS    EQU 0F37DH
       F3AE                     LINL40  EQU 0F3AEH
       F55E                     BUF EQU 0F55EH
       F672                     MEMSIZ  EQU 0F672H
       FCC1                     EXPTBL  EQU 0FCC1H
       FFCA                     EXTBIOS EQU 0FFCAH
       0402                     MAPPER  EQU 00402H
                                
000000 0100                         ORG 0100H
000000 0100 CD6BF3          17      CALL    0F36BH      ;ページ1をメインRAMに切り替える
000003 0103 3EC3             7      LD  A,0C3H      ;JP
000005 0105 320000          13      LD  (0),A
000008 0108 320500          13      LD  (SYSTEM),A
                                
00000B 010B ED5B72F6        20      LD  DE,(MEMSIZ)
00000F 010F 1E03             7      LD  E,3
000011 0111 15               4      DEC D
000012 0112 ED530100        20      LD  (1),DE
000016 0116 15               4      DEC D
000017 0117 7A               4      LD  A,D
000018 0118 321D01          13      LD  (SPPAT+2),A
00001B 011B 310400          10  SPPAT:  LD  SP,4
00001E 011E 7A               4      LD  A,D
00001F 011F 1E04             7      LD  E,4
000021 0121 21CE01          10      LD  HL,REAL
000024 0124 012501          10      LD  BC,MAIN_END-MAIN
000027 0127 EDB0                    LDIR
                                                ;リロケータブル
000029 0129 67               4      LD  H,A
00002A 012A 2E08             7      LD  L,BDOS0+2
00002C 012C 77               7      LD  (HL),A
00002D 012D 2E89             7      LD  L,SAVEFCB1+2
00002F 012F 77               7      LD  (HL),A
000030 0130 2E98             7      LD  L,ALTFCB0+2
000032 0132 77               7      LD  (HL),A
000033 0133 2EBB             7      LD  L,ALTFCB1+2
000035 0135 77               7      LD  (HL),A
000036 0136 2E92             7      LD  L,_SAVE_DE+3
000038 0138 77               7      LD  (HL),A
000039 0139 2EA3             7      LD  L,SAVE_SP+3
00003B 013B 77               7      LD  (HL),A
00003C 013C 24               4      INC H
00003D 013D 2E02             7      LD  L,2
00003F 013F 77               7      LD  (HL),A
000040 0140 2E05             7      LD  L,WBOOT+2-BOOT
000042 0142 77               7      LD  (HL),A
000043 0143 2E08             7      LD  L,CONST_+2-BOOT
000045 0145 77               7      LD  (HL),A
000046 0146 2E0B             7      LD  L,CONIN+2-BOOT
000048 0148 77               7      LD  (HL),A
000049 0149 2E0E             7      LD  L,CONOUT+2-BOOT
00004B 014B 77               7      LD  (HL),A
00004C 014C 25               4      DEC H
00004D 014D 3C               4      INC A
00004E 014E 2E11             7      LD  L,FCBPAT+2-BOOT
000050 0150 77               7      LD  (HL),A
000051 0151 2E50             7      LD  L,SHOW_ERROR+2
000053 0153 77               7      LD  (HL),A
000054 0154 3C               4      INC A
000055 0155 2EA6             7      LD  L,EXTSP+1
000057 0157 77               7      LD  (HL),A
000058 0158 D602             7      SUB 2
00005A 015A 2E06             7      LD  L,BDOS0
00005C 015C 220600          16      LD  (SYSTEM+1),HL
00005F 015F E5              11      PUSH    HL
000060 0160 0E19             7      LD  C,19H       ;(BDOS)カレント・ドライブ番号の獲得
000062 0162 CD7DF3          17      CALL    BDOS
000065 0165 3C               4      INC A
000066 0166 E1              10      POP HL
000067 0167 24               4      INC H
000068 0168 2E0F             7      LD  L,FCBCMD-BOOT
00006A 016A 77               7      LD  (HL),A
                                
00006B 016B 3E28             7      LD  A,40
00006D 016D 32AEF3          13      LD  (LINL40),A
000070 0170 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000074 0174 DD216C00        14      LD  IX,INITXT
000078 0178 CD1C00          17      CALL    CALSLT
00007B 017B FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
00007F 017F DD217800        14      LD  IX,SETTXT
000083 0183 CD1C00          17      CALL    CALSLT
                                
000086 0186 11AE01          10      LD  DE,TITLE
000089 0189 0E09             7      LD  C,9
00008B 018B CD7DF3          17      CALL    BDOS
00008E 018E 010900          10      LD  BC,9
000091 0191 21C501          10      LD  HL,AUTOEXEC
000094 0194 118100          10      LD  DE,00081H
000097 0197 EDB0                    LDIR
000099 0199 215EF5          10      LD  HL,BUF
00009C 019C 115FF5          10      LD  DE,BUF+1
00009F 019F 3600            10      LD  (HL),0
0000A1 01A1 010101          10      LD  BC,257
0000A4 01A4 EDB0                    LDIR
0000A6 01A6 3E09             7      LD  A,9
0000A8 01A8 2A0600          16      LD  HL,(SYSTEM+1)
0000AB 01AB 2E0E             7      LD  L,CBOOT & $FF
       01AD                     JP_HL:
0000AD 01AD E9               4      JP  (HL)
       01AE                     TITLE:
0000AE 01AE 444F5320666F7220        DB  "DOS for MSX v0.02 Gaku$"
            4D53582076302E30    
            322047616B7524      
       01C5                     AUTOEXEC:
0000C5 01C5 4155544F45584543        DB  "AUTOEXEC",0
            00                  
       01CE                     REAL:
0000CE 0004                         ORG 4,REAL-0100H
       0004                     MAIN:
0000CE 0004 0000                    DW  0
       0006                     BDOS0:
0000D0 0006 C30900          10      JP  BDOS1
       0009                     BDOS1:
0000D3 0009 79               4      LD  A,C
0000D4 000A B7               4      OR  A
0000D5 000B 2051            12      JR  NZ,BDOS2
       000D                     WBOOT1:
0000D7 000D AF               4      XOR A
       000E                     CBOOT:
0000D8 000E F5              11      PUSH    AF
0000D9 000F 210F01          10  FCBPAT: LD  HL,FCBCMD
0000DC 0012 115C00          10      LD  DE,FCB1
0000DF 0015 011000          10      LD  BC,16
0000E2 0018 EDB0                    LDIR
                                
0000E4 001A 115C00          10      LD  DE,FCB1
0000E7 001D 0E0F             7      LD  C,00FH
0000E9 001F CD7DF3          17      CALL    BDOS
0000EC 0022 B7               4      OR  A
0000ED 0023 2029            12      JR  NZ,SHOW_ERROR
0000EF 0025 210000          10      LD  HL,0
0000F2 0028 227D00          16      LD  (FCB1+33),HL
0000F5 002B 227F00          16      LD  (FCB1+35),HL
0000F8 002E 2C               4      INC L
0000F9 002F 226A00          16      LD  (FCB1+14),HL
                                
0000FC 0032 110001          10      LD  DE,00100H
0000FF 0035 0E1A             7      LD  C,01AH      ;(BDOS)DTAの設定
000101 0037 CD7DF3          17      CALL    BDOS
                                
000104 003A 115C00          10      LD  DE,FCB1
000107 003D 2100BF          10      LD  HL,0BF00H
00010A 0040 0E27             7      LD  C,027H      ;(BDOS)ランダム・ブロック・リード
00010C 0042 CD7DF3          17      CALL    BDOS
00010F 0045 F1              10      POP AF
000110 0046 328000          13      LD  (DTA1),A
000113 0049 7C               4      LD  A,H
000114 004A B5               4      OR  L
                                
000115 004B C20001          10      JP  NZ,0100H
       004E                     SHOW_ERROR:
000118 004E 111F01          10      LD  DE,ERROR
00011B 0051 0E09             7      LD  C,9
00011D 0053 CD7DF3          17      CALL    BDOS
000120 0056 0E08             7      LD  C,8
000122 0058 CD7DF3          17      CALL    BDOS
000125 005B AF               4      XOR A
000126 005C 18B0            12      JR  CBOOT
       005E                     BDOS2:
000128 005E 79               4      LD  A,C
000129 005F FE0F             7      CP  00FH
00012B 0061 3823            12      JR  C,SAVEFCB0
00012D 0063 FE12             7      CP  012H
00012F 0065 2004            12      JR  NZ,NOBD12
000131 0067 ED5B07F3        20      LD  DE,(FCB11)
       006B                     NOBD12:
000135 006B FE18             7      CP  018H
000137 006D 380A            12      JR  C,SAVEFCB36
000139 006F FE21             7      CP  021H
00013B 0071 3813            12      JR  C,SAVEFCB0
00013D 0073 FE29             7      CP  029H
00013F 0075 3802            12      JR  C,SAVEFCB36
000141 0077 180D            12      JR  SAVEFCB0
       0079                     SAVEFCB36:
000143 0079 7A               4      LD  A,D
000144 007A FE3F             7      CP  03FH
000146 007C 3808            12      JR  C,SAVEFCB0
000148 007E FE80             7      CP  080H
00014A 0080 3004            12      JR  NC,SAVEFCB0
00014C 0082 3E24             7      LD  A,36
00014E 0084 1801            12      JR  SAVEFCB1
       0086                     SAVEFCB0:
000150 0086 AF               4      XOR A
       0087                     SAVEFCB1:
000151 0087 32AF00          13      LD  (SAVEFCB),A
000154 008A B7               4      OR  A
000155 008B 2813            12      JR  Z,BDOS3
000157 008D C5              11      PUSH    BC
000158 008E E5              11      PUSH    HL
       008F                     _SAVE_DE:
000159 008F ED53BD00        20      LD  (SAVE_DE),DE
00015D 0093 4F               4      LD  C,A
00015E 0094 0600             7      LD  B,0
       0096                     ALTFCB0:
000160 0096 21D600          10      LD  HL,ALTFCB
000163 0099 EB               4      EX  DE,HL
000164 009A D5              11      PUSH    DE
000165 009B EDB0                    LDIR
000167 009D D1              10      POP DE
000168 009E E1              10      POP HL
000169 009F C1              10      POP BC
       00A0                     BDOS3:
       00A0                     SAVE_SP:
00016A 00A0 ED73AB00        20      LD  (BDSP),SP
       00A5                     EXTSP   EQU $+1
00016E 00A4 310000          10      LD  SP,0
000171 00A7 CD7DF3          17      CALL    BDOS
       00AB                     BDSP    EQU $+1
000174 00AA 310000          10      LD  SP,0
                                
000177 00AD F5              11      PUSH    AF
       00AF                     SAVEFCB EQU $+1
000178 00AE 3E00             7      LD  A,0
00017A 00B0 B7               4      OR  A
00017B 00B1 2811            12      JR  Z,BDOS4
00017D 00B3 C5              11      PUSH    BC
00017E 00B4 D5              11      PUSH    DE
00017F 00B5 E5              11      PUSH    HL
000180 00B6 4F               4      LD  C,A
000181 00B7 0600             7      LD  B,0
       00B9                     ALTFCB1:
000183 00B9 21D600          10      LD  HL,ALTFCB
       00BD                     SAVE_DE EQU $+1
000186 00BC 110000          10      LD  DE,0
000189 00BF EDB0                    LDIR
00018B 00C1 E1              10      POP HL
00018C 00C2 D1              10      POP DE
00018D 00C3 C1              10      POP BC
       00C4                     BDOS4:
00018E 00C4 F1              10      POP AF
00018F 00C5 C9              10      RET
                                
       00C6                     CONST1:
000190 00C6 0E0B             7      LD  C,0BH
000192 00C8 C30500          10      JP  SYSTEM
       00CB                     CONIN1:
000195 00CB 0E07             7      LD  C,7
000197 00CD C30500          10      JP  SYSTEM
       00D0                     CONOUT1:
00019A 00D0 59               4      LD  E,C
00019B 00D1 0E02             7      LD  C,2
00019D 00D3 C30500          10      JP  SYSTEM
                                
       00D6                     ALTFCB:
0001A0 00D6                         DS  37
0001C5 00FB                         DS  5
                                ;           下位1バイト0になるように
       0100                     BOOT:
0001CA 0100 C30D00          10      JP  WBOOT1
       0103                     WBOOT:
0001CD 0103 C30D00          10      JP  WBOOT1
       0106                     CONST_:         ;(BDOS)コンソール直接入力
0001D0 0106 C3C600          10      JP  CONST1
       0109                     CONIN:
0001D3 0109 C3CB00          10      JP  CONIN1
       010C                     CONOUT:
0001D6 010C C3D000          10      JP  CONOUT1
       010F                     FCBCMD:
0001D9 010F 00434F4D4D414E44        DB  0,"COMMAND COM",0,0,0,0
            20434F4D00000000    
       011F                     ERROR:
0001E9 011F 0D0A496E7320444F        DB  00DH,00AH,"Ins DOS$"
            5324                
       0129                     MAIN_END:
[EOF:DOS.ASM:UTF_8]
